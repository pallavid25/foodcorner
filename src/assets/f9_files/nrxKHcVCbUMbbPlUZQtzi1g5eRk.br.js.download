var StaticImage=function(){function n(n,t,i,r,u,f,e,o,s){var a=this,h,c,l;this._cardPadding=0;n&&t&&(this._staticImageUrl=t.replace(/amp;/g,""),this._parentDiv=n,this._updateSize(),this._testHooks=r,h=typeof Microsoft!="undefined"&&Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal,r&&typeof h!="undefined"&&h._Helper?(c=h._Helper._getUrlParam(window.location,"mockV8Map"),c?(this._excelsior=h._Helper._getUrlParam(window.location,"setApplicationEndpoint"),this._excelsior||(this._excelsior=h._Helper._getUrlParam(window.location,"SetSnrInstance")),this._excelsior||(this._excelsior="localhost"),this._selector='img[data-src-original*="'+this._excelsior+'"]'):this._selector='img[data-src-original*="'+i+'"]'):this._selector='img[src*="'+i+'"]',this._staticImage=this._parentDiv.querySelector(this._selector),this._staticImage||(this._staticImage=this._parentDiv.querySelector("img[src*='blob:']")),!this._staticImage&&this._staticImageUrl&&(this._selector='img[src*="'+this._staticImageUrl+'"]',this._staticImage=this._parentDiv.querySelector(this._selector)),this._staticImage?this._initialize(u,o,!0,s):sj_evt.bind("RMS.ImgAOLCompleted",function(){return a._initialize(u,o,!1,s)}));f&&(l=new BootstrapStreetsideOverlay,l.initialize(r,e))}return n.prototype.removeImage=function(){if(this._testHooks){var n=document.getElementById("staticImageTesthook");n&&n.setAttribute("data-removeSuccess","StaticImageRemoved")}this._staticImageContainer&&this._parentDiv&&(this._staticImageContainer.parentElement===this._parentDiv?this._parentDiv.removeChild(this._staticImageContainer):this._staticImageContainer.parentElement&&this._staticImageContainer.parentElement.removeChild(this._staticImageContainer));this._staticImageContainer=null},n.replaceOrAppendMapModeParams=function(t,i,r,u){var h=i?"h":"r",f=n._replaceOrAppendParam(t,n._styleParam,h),c=r?"1":"",e,o,s;return f=n._replaceOrAppendParam(f,n._trafficParam,c),u&&(e=u.centerPoint.latitude+"~"+u.centerPoint.longitude,f=n._replaceOrAppendParam(f,n._centerPointParam,e),o=u.zoomLevel.toString(),f=n._replaceOrAppendParam(f,n._ZoomLevelParam,o),s=u.nwLocation.latitude+"~"+u.nwLocation.longitude+"~"+u.seLocation.latitude+"~"+u.seLocation.longitude,f=n._replaceOrAppendParam(f,n._MapViewParam,s,!0)),f},n.getUpdatedUrl=function(t,i,r){var u;if(i<n._minWidth?i=n._minWidth:i>n._maxWidth&&(i=n._maxWidth),r<n._minHeight?r=n._minHeight:r>n._maxHeight&&(r=n._maxHeight),u=t.indexOf("?ms=")+4,u!==3){var e=t.substring(0,u),f=t.substring(u,t.length),o=f.substring(f.indexOf("&"),f.length),s=i.toString(),h=r.toString();return e+s+","+h+o}},n.getCaptionSectionWidth=function(){var t=0;return t=n._getViewPortWidth(),t<n._minWidth?n._minWidth:t>n._maxWidth?n._maxWidth:t},n.getCaptionSectionHeight=function(){var t=0;return t=n._getViewPortHeight(),t<n._minHeight?n._minHeight:t>n._maxHeight?n._maxHeight:t},n.prototype._initialize=function(t,i,r){var u=this,f,e,s,o;r||(this._staticImage=this._parentDiv.querySelector("#mv_baseMap"));this._staticImageContainer=this._staticImage.parentElement!==this._parentDiv?this._staticImage.parentElement:this._staticImage;t&&t.imageInfoArr&&t.imageInfoArr.length>1?(this._imageInfoArr=t.imageInfoArr,f=this._parentDiv.querySelector("."+t.aerialButtonClassName),f&&(this._aerialButton=f,n._removeOrAddCssClass(this._aerialButton,"b_hide"),sj_be(this._aerialButton,"click",function(){return u._toggleAerialAndTraffic(!1)}),sj_be(this._aerialButton,"keydown",function(n){return u._processKeyboardEvent(n,!1)})),f=this._parentDiv.querySelector("."+t.trafficButtonClassName),f&&(this._trafficButton=f,n._removeOrAddCssClass(this._trafficButton,"b_hide"),sj_be(this._trafficButton,"click",function(){return u._toggleAerialAndTraffic(!0)}),sj_be(this._trafficButton,"keydown",function(n){return u._processKeyboardEvent(n,!0)})),t.resizeImage&&(this._cardPadding=parseInt(t.cardPadding),r?this._resizeImage():sj_evt.bind("onP1",function(){return u._resizeImage()}),sj_be(window,"resize",function(){return u._resizeImage()})),t.titleElemId&&(e=_ge(t.titleElemId),e&&(this._titleElement=e.querySelector("a"))),this._parentDiv.style.cssText=""):this._staticImageContainer&&i&&(s="position:absolute;overflow:hidden;z-index:10000;width:",this._staticImageContainer.style.cssText=s+this._width+"px;height:"+this._height+"px",o=function(){if(u._parentDiv&&u._staticImageContainer){u._updateSize();var n=u._staticImageContainer.style;n.width="".concat(u._width,"px");n.height="".concat(u._height,"px")}},sj_be(window,"resize",function(){return o()}),sj_evt.bind("LargeMapHidden",function(){return o()}))},n.prototype._updateSize=function(){this._width=this._parentDiv.offsetWidth;this._height=this._parentDiv.offsetHeight},n.prototype._resizeImage=function(){var t=n.getCaptionSectionWidth()-this._cardPadding,r=t.toString(),i=this._testHooks&&this._excelsior?this._staticImageUrl:n.getUpdatedUrl(this._staticImageUrl,t*2,this._height*2);this._staticImageUrl=i;this._staticImage.setAttribute("width",r);this._staticImage.setAttribute("src",i);this._updateMapImageUrls(t*2)},n.prototype._processKeyboardEvent=function(n,t){var i=n.which;(i===13||i===32)&&this._toggleAerialAndTraffic(t)},n.prototype._toggleAerialAndTraffic=function(t){var i=t?this._trafficButton:this._aerialButton,r;n._removeOrAddCssClass(i,"selected");r=this._getImageIndex(t);this._updateImageAndTitle(r);t||(n._removeOrAddCssClass(this._aerialButton,"mv_dark"),this._trafficButton&&n._removeOrAddCssClass(this._trafficButton,"mv_dark"));Log!==undefined&&Log.Log(t?"TrafficIcon":"AerialIcon",i.className,"MapsAnswer",!1);this._aerialEnabled=this._aerialButton.className.indexOf("mv_dark")>0;this._trafficEnabled=this._trafficButton.className.indexOf("selected")>0},n.prototype._getImageIndex=function(n){for(var i,t=0;t<this._imageInfoArr.length;t++)if(this._staticImageUrl===this._imageInfoArr[t].url){i=n?(t+2)%this._imageInfoArr.length:t%2==0?t+1:t-1;break}return i},n.prototype._updateImageAndTitle=function(t){t>=this._imageInfoArr.length||t<0||(this._staticImageUrl=this._imageInfoArr[t].url,this._staticImage.setAttribute("src",this._staticImageUrl),this._staticImageContainer.setAttribute("href",this._imageInfoArr[t].linkUrl),this._titleElement&&(this._titleElement.href=n.replaceOrAppendMapModeParams(this._titleElement.href,this._aerialButton.className.indexOf("selected")>0,this._trafficButton&&this._trafficButton.className.indexOf("selected")>0)))},n.prototype._updateMapImageUrls=function(t){if(this._imageInfoArr)for(var i=0;i<this._imageInfoArr.length;i++)this._imageInfoArr[i].url=n.getUpdatedUrl(this._imageInfoArr[i].url,t,this._height*2)},n._getViewPortWidth=function(){return typeof innerWidth!="undefined"?window.innerWidth:typeof _d.documentElement!="undefined"&&typeof _d.documentElement.clientWidth!="undefined"&&_d.documentElement.clientWidth!==0?document.documentElement.clientWidth:document.getElementsByTagName("body")[0].clientWidth},n._getViewPortHeight=function(){return typeof innerHeight!="undefined"?window.innerHeight:typeof _d.documentElement!="undefined"&&typeof _d.documentElement.clientHeight!="undefined"&&_d.documentElement.clientHeight!==0?document.documentElement.clientHeight:document.getElementsByTagName("body")[0].clientHeight},n._removeOrAddCssClass=function(n,t){t=" "+t;var i=n.className;i=i.indexOf(t)===-1?i.concat(t):i.replace(t,"");n.className=i},n._replaceOrAppendParam=function(t,i,r,u){var e=i+r,o=i.replace("&","?"),f=t;return t.indexOf(i)>0?f=n._replace(t,i,e):t.indexOf(o)>0?f=n._replace(t,o,e.replace("&","?")):u||(f+=e),f},n._replace=function(n,t,i){var u=n,f=n.indexOf(t),r,e;return f>=0?(r=n.indexOf("&",f+1),r==-1&&(r=n.length),e=u.substring(f,r),u.replace(e,i)):u},n._styleParam="&style=",n._trafficParam="&trfc=",n._centerPointParam="&cp=",n._ZoomLevelParam="&lvl=",n._MapViewParam="&mb=",n._minWidth=50,n._maxWidth=1182,n._minHeight=50,n._maxHeight=1440,n}(),BootstrapMapsAnswer=function(){function n(t){this.childrenBoundariesLayerId="childrenBoundariesLayer";this._mapOptions=t;this._bootstrappingTimeout=this._mapOptions&&this._mapOptions.testHooks?3e4:(this._mapOptions&&this._mapOptions.childrenBoundaryNames?2:1)*n._defaultTimeoutForBootstrapping;this.pinclick=new Microsoft.Maps.Internal._JSEvent;this.pinhover=new Microsoft.Maps.Internal._JSEvent;this.pinhoverend=new Microsoft.Maps.Internal._JSEvent;this._navigateToMapsVertical=!0}return n.getCurrentMap=function(){return n._mapInstance},n.prototype.bootstrap=function(t,i,r,u){var e=this,f=this._mapOptions,o=this._mapOptions.testHooks,s,h;this._titleElementId=t;this._dynamicProperties=Microsoft.Maps.GlobalConfig.dynamicProperties;var c=this._mapOptions.staticImageHostName,l=document.getElementById(this._mapOptions.id),a=o?FunctionalTestHooks.buildStaticImageUrl(this._getUrlParam,"DefaultStatic"):this._mapOptions.staticImageUrl;this._staticImage=new StaticImage(l,a,c,o,null,!1,null,!0,u);i&&(s=new BootstrapStreetsideOverlay,s.initialize(o,r));o&&(h=window.location.search.indexOf("&disableFunctionalTestHooks")>0?!1:!0,f.testHooksOptions={hitTest:!1,perfRun:!1,perfTest:!1,debugRun:!1,enableFunctionalTestHooks:h});f.navigationBarMode=2;f.navigationBarOrientation=1;this._mapOptions.centerLatitude&&this._mapOptions.centerLongitude&&(f.center=new Microsoft.Maps.Location(parseFloat(this._mapOptions.centerLatitude),parseFloat(this._mapOptions.centerLongitude)));f.showScalebar=typeof f.showScalebar=="boolean"?f.showScalebar:!1;f.showTermsLink=!1;f.allTileFeatures=!0;this._map=n._mapInstance=new Microsoft.Maps.Map(document.getElementById(this._mapOptions.id),this._mapOptions);this._dynamicProperties.serpIG=_G&&_G.IG;this._dynamicProperties.impressionGuid=_G.IG;this._bootstrapTimeoutHandle=window.setTimeout(function(){e._finishBootstrapping()},this._bootstrappingTimeout);this._createDataForV7MapInterfaceBootstrap();this._onMapLoaded();sj_evt.fire("dynMapLoaded",this._map,this);sj_evt.bind("DirectionsAnswerUpdated",function(){sj_evt.fire("dynMapRendered",e._map,e)});sj_evt.bind("MapOverlayControlAjaxUpdated",function(){sj_evt.fire("dynMapRendered",e._map,e)})},n.prototype._onMapLoaded=function(){function n(){i--;i===0&&t._setNewFrame(function(){t._finishBootstrapping();t._instrumentServiceScenario()})}var t=this,i=this._mapOptions.childrenBoundaryNames||this._mapOptions.vectorDataPipelineId||this._mapOptions.polygonPoints?2:1,r;this._bootstrapCommonMapScenarios(function(){n()});this._mapOptions.childrenBoundaryNames?this._bootstrapChildrenBoundariesScenario(function(){n()}):this._mapOptions.vectorDataPipelineId?this._bootstrapBoundaryScenario(function(){n()}):this._mapOptions.polygonPoints&&this._bootstrapAreaPolygonScenario(function(){n()});this._mapOptions.pushpins&&this._bootstrapLocalEntitiesScenario();r=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.features&&Microsoft.Maps.GlobalConfig.features.localSearch&&(Microsoft.Maps.GlobalConfig.features.localSearch.sendFakeGlinkPingForStaticMap||this._mapOptions.searchQueryCategory&&Microsoft.Maps.GlobalConfig.features.localSearch.sendFakeGlinkPingForStaticMapSegments&&Microsoft.Maps.GlobalConfig.features.localSearch.sendFakeGlinkPingForStaticMapSegments.length>0&&Microsoft.Maps.GlobalConfig.features.localSearch.sendFakeGlinkPingForStaticMapSegments.indexOf(this._mapOptions.searchQueryCategory)>-1);r&&this._sendFakeGlinkPingForStaticMapClick()},n.prototype._sendFakeGlinkPingForStaticMapClick=function(){var n=_ge("mv_baseMap");n&&sj_be(n,"click",function(){var t=_ge("lm_ovl_inst"),n;t&&(n=t.getAttribute("inst"),n&&_w.si_T&&_w.si_T(n))})},n.prototype._instrumentServiceScenario=function(){var i,r,u,n,t,f;Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger&&Microsoft.Maps.logger.logObject&&(i={feature:"MapControl",action:"MapsLoaded",data:{scenario:this._mapOptions.scenario,service:this._mapOptions.service,switchToDynamicView:this._mapOptions.switchToDynamicView}},this._mapOptions.switchToDynamicView&&(i.data.showZoomButtons=this._mapOptions.showZoomButtons,i.data.showMapTypeSelector=this._mapOptions.showMapTypeSelector),Microsoft.Maps.logger.logObject(i),r=Microsoft.Maps.Internal,r&&(u=r._PerfV2Logger,n=r._Helper,u&&n&&(t=this._mapOptions.searchQueryCategory,f=n._isHotelsCategory(t)?"Maps_CSHTTG":n._isRestaurantCategory(t)?"Maps_CSRTTG":n._isHouseCategory(t)?"Maps_CSRETTG":n._isAttractionCategory(t)?"Maps_CSATTG":typeof BootstrapMapsAnswerForTravelOverlay!="undefined"&&this instanceof BootstrapMapsAnswerForTravelOverlay?"Maps_CSTTTG":"",f&&u.mark(f))))},n.prototype._applyCatIdsToAllPois=function(){var t=this._mapOptions.pushpins,r,i,n;if(t&&t.length>0){for(r=void 0,i=void 0,n=0;n<t.length;n++)t[n].CatId?i||(i=t[n].CatId):r=!0;if(r&&i)for(n=0;n<t.length;n++)t[n].CatId||(t[n].CatId="334",t[n].GroupCatId=t[n].GroupCatId||i)}},n.prototype._bootstrapLocalEntitiesScenario=function(){var o=this,c=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.features&&Microsoft.Maps.GlobalConfig.features.localSearch&&Microsoft.Maps.GlobalConfig.features.localSearch.applyCatIdsForAllPins,r,a,v,u,t,f,i,h,n,e;if(c&&(this._applyCatIdsToAllPois(),this._mapOptions.nearbyPushpin)){var s=this._mapOptions.nearbyPushpin,y={title:s.Label},p=new Microsoft.Maps.Location(s.Location.Latitude,s.Location.Longitude),l=new Microsoft.Maps.Pushpin(p,y);l.catId="PivotEntity";this._map.entities.add(l)}if(r=this._mapOptions.pushpins,r&&r.length>0)for(a={"151":{state:4,colorIndex:1},"152":{state:2,colorIndex:1},"163":{state:2,colorIndex:1},"164":{state:2,colorIndex:2},"165":{state:2,colorIndex:3},"166":{state:5,colorIndex:1},"167":{state:5,colorIndex:2},"168":{state:5,colorIndex:3},"169":{state:4,colorIndex:1},"170":{state:4,colorIndex:2},"171":{state:4,colorIndex:3},"176":{state:4,colorIndex:1},"180":{state:2,colorIndex:1},S593:{state:2,colorIndex:1},"S593|SelectedPointState":{state:4,colorIndex:1},"S593|spss":{state:4,colorIndex:1},S575:{state:2,colorIndex:1},S541:{state:2,colorIndex:1},S589:{state:2,colorIndex:1}},v=[],u=0;u<r.length;u++)t=r[u],t.Location&&typeof t.Location.Latitude=="number"&&typeof t.Location.Longitude=="number"&&(i=parseInt(t.IconStyle),f=i===118?{title:t.Label,icon:"/s/local/map/118.png"}:i===182||i===181?{title:t.Label,icon:'<svg width="52" height="52" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M40.502 1.052a4.404 4.404 0 0 0-2.981 1.172 19.359 19.359 0 0 0-8.4-1.92 19.5 19.5 0 0 0-18.774 14.252 4.014 4.014 0 0 0-2.478 3.708v.335a4.003 4.003 0 0 0 2.93 3.852v6.888c-.002 3 1.077 5.9 3.04 8.17l-.04-.01 9.6 10.2 9.6-10.2-.197.049a12.477 12.477 0 0 0 3.077-8.209v-6.996a4.008 4.008 0 0 0 2.58-3.744v-.34a4.003 4.003 0 0 0-2.82-3.808 21.57 21.57 0 0 0-2.867-6.8l.008.007a7.841 7.841 0 0 1 3.847-.068A4.42 4.42 0 1 0 40.5 1.052z" id="b"/><filter x="-18.9%" y="-10.5%" width="137.8%" height="129.5%" filterUnits="objectBoundingBox" id="a"><feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter1"/><feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.6 0" in="shadowBlurOuter1"/><\/filter><\/defs><g transform="translate(2)" fill="none"><use fill="#000" filter="url(#a)" xlink:href="#b"/><use fill="#fff" xlink:href="#b"/><path d="M12.779 18.78h21.12v10.56c0 5.832-4.728 10.56-10.56 10.56-5.832 0-10.56-4.728-10.56-10.56V18.78z" fill="#D1B79F"/><path d="M12.779 18.78v10.56c0 5.832 4.728 10.56 10.56 10.56 5.832 0 10.56-4.728 10.56-10.56V18.78" stroke="#fff" stroke-width="3.3"/><path d="M16.739 36.737a6.96 6.96 0 0 1 6.6-4.757 6.96 6.96 0 0 1 6.6 4.757" stroke="#fff" stroke-width="2.2" stroke-linecap="round"/><path fill="#fff" d="M13.8 37.5l9.6 10.2L33 37.5l-9.6 2.4z"/><path d="M29.122.3C18.362.305 9.64 9.026 9.635 19.786l26.572-.443a21.567 21.567 0 0 0-3.43-11.69h.007A8.35 8.35 0 0 1 39.6 8.836c.32-.077.638-.163.96-.224l2.135-2.797A19.415 19.415 0 0 0 29.122.301z" fill="#E1392F"/><circle fill="#fff" cx="40.502" cy="5.482" r="4.428"/><rect fill="#fff" x="7.87" y="14.294" width="30.59" height="8.37" rx="3.346"/><path d="M0 0h48v48H0z"/><path d="M19.873 25.727A1.802 1.802 0 0 0 16.8 27c.002.205.039.408.11.6h3.379a1.78 1.78 0 0 0 .11-.6 1.8 1.8 0 0 0-.527-1.273zM30 27a1.8 1.8 0 0 0-3.6 0c.002.205.039.408.11.6h3.379a1.78 1.78 0 0 0 .11-.6z" fill="#000"/><\/g><\/svg>'}:i===48?{anchor:new Microsoft.Maps.Point(15,15),title:"",icon:'<svg width="30" height="30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15" fill-opacity=".3" fill="#a6a6a6"/><circle cx="15" cy="15" r="13"/><circle cx="15" cy="15" r="10" fill="#fff"/><circle cx="15" cy="15" r="6" fill="#409df8"/><\/svg>'}:{title:t.Label,isMicroPoi:t.IsMicroPoi},f.catId=t.CatId,f.groupCatId=t.GroupCatId,h=new Microsoft.Maps.Location(t.Location.Latitude,t.Location.Longitude),n=new Microsoft.Maps.Pushpin(h,f),n.id=t.Id,n.isAdsPoi=t.IsAdsPoi,v.push(h),e=a[t.IconStyle],e?(n.taskDisplayState={activationState:1,colorIndex:e.colorIndex,prominence:1},n.setState(e.state),this._map.entities.push(n)):i===118||i===181||i===182||i===48?this._map.entities.push(n):this._mapOptions.categoryId?(n.catId=this._mapOptions.categoryId,this._map.entities.push(n)):c&&(this._mapOptions.isChainQuery?(n.setOptions({text:t.Label,title:""}),this._map.entities.push(n)):n.catId&&this._map.entities.push(n)),Microsoft.Maps.Events.addHandler(n,"mouseover",function(){o.pinhover.invoke({pin:n})}),Microsoft.Maps.Events.addHandler(n,"mouseout",function(){o.pinhoverend.invoke({pin:n})}),Microsoft.Maps.Events.addHandler(n,"click",function(){o.pinclick.invoke({pin:n})}))},n.prototype._bootstrapCommonMapScenarios=function(n){var t=this;this._mapOptions.showTraffic?Microsoft.Maps.loadModule("Microsoft.Maps.Traffic",function(){t._trafficManager=new Microsoft.Maps.Traffic.TrafficManager(t._map);t._trafficManager.show();n&&n()}):n&&n()},n.prototype._bootstrapChildrenBoundariesScenario=function(n){this._bindChildrenEntitiesCarouselEvents();this._loadChildrenEntitiesBoundaries(n)},n.prototype._bootstrapBoundaryScenario=function(n){var t=this,i=3,r=11;this._map.getV8Map().getCityPolygonManager().then(function(u){t._cityPolygonManager=u;u.removeLayer();u.addLayer(t._mapOptions.vectorDataPipelineId,i,r);n&&n()})},n.prototype._bootstrapAreaPolygonScenario=function(n){for(var i,u,r=[],t=0;t<this._mapOptions.polygonPoints.length;t++)r.push(new Microsoft.Maps.Location(this._mapOptions.polygonPoints[t].latitude,this._mapOptions.polygonPoints[t].longitude));i=JSON.parse(this._mapOptions.polygonConfig);r.length>1&&(u=new Microsoft.Maps.Polygon(r,{fillColor:i.FillColor,strokeColor:i.PenColor,strokeThickness:Number(i.PenWidth)}),this._map.entities.push(u));n&&n()},n.prototype._finishBootstrapping=function(){window.clearTimeout(this._bootstrapTimeoutHandle);this._hasCalledFinishBootstrapping||(this._hasCalledFinishBootstrapping=!0,this.completeBootstrapping())},n.prototype.completeBootstrapping=function(){var t=this,n;this._mapOptions.sdkMapUnwrapNotificationEvent?sj_evt.bind(this._mapOptions.sdkMapUnwrapNotificationEvent,function(){t._removeStaticImageAndShowLargeMapLink()},1,1):this._mapOptions.switchToDynamicView&&this._removeStaticImageAndShowLargeMapLink();sj_evt.fire("v8MapRenderEnd");sj_evt.fire("v8MapDataRenderStart");sj_evt.fire("dynMapRendered",this._map,this);this.fireMapDataRenderEnd();this._mapOptions.testHooks&&(n=this._map.getV8Map().getRootElement()[0],n&&n.parentElement&&n.parentElement.setAttribute("data-mapLoaded","true"))},n.prototype.fireMapDataRenderEnd=function(){sj_evt.fire("v8MapDataRenderEnd")},n.prototype._createDataForV7MapInterfaceBootstrap=function(){var n=window.Bing=window.Bing||{};n.MapControl=n.MapControl||{};n.MapControl[this._mapOptions.id]=this;n.MapControl.MapCtrl=this;this.Map=this._map;Microsoft.Maps.EntityState={highlighted:2,none:0,selected:1}},n.prototype.ensureDynamic=function(n){n&&n()},n.prototype._loadChildrenEntitiesBoundaries=function(n){var t=this;if(this._childrenBoundariesLayer){this._childrenBoundariesLayer.setVisible(!0);n&&n();return}this._map.getV8Map().getCityPolygonManager().then(function(){t._childrenBoundariesLayer=new Microsoft.Maps.Layer(t.childrenBoundariesLayerId);t._map.layers.insert(t._childrenBoundariesLayer);Microsoft.Maps.Internal.CityPolygonManager.populatePostCodeLayer(t._map,t._childrenBoundariesLayer,t._mapOptions.childrenBoundaryNames,n)})},n.prototype._bindChildrenEntitiesCarouselEvents=function(){var n=this;this._map.getV8Map().getCityPolygonManager().then(function(){sj_evt.bind("Carousel.OnItemHover",function(t){var i,f,e,u,o,r;if(t&&t.length===4)for(i=[],n._childrenBoundariesLayer&&(f=function(n){return n.metadata&&n.metadata.title.indexOf(t[2])>=0},i=n._childrenBoundariesLayer.getPrimitives().filter(f),i.length===0&&(e=n._childrenBoundariesLayer.metadata&&n._childrenBoundariesLayer.metadata.pushpinPostCodes,i=e?e.filter(f):[])),u=0,o=i;u<o.length;u++)r=o[u],r&&r.metadata&&!r.metadata.polygon&&Microsoft.Maps.Internal.CityPolygonManager.handlePostCodePrimitiveHover({eventName:!t[3]?"mouseout":"mouseover",layer:n._childrenBoundariesLayer,primitive:r})})})},n.prototype._removeStaticImageAndShowLargeMapLink=function(){this._showLargeMapLink();this._staticImage.removeImage();this._map.enableFocus()},n.prototype._showLargeMapLink=function(){var r=this,n=this._getExploreMoreElement(this._mapOptions.id),t,i;if(n){var f=this._map.getV8Map(),e=document.getElementById(this._mapOptions.id),u=f.getRootElement()[0];e&&u&&(e.insertBefore(n,u),n.style.display="block");t=this._mapOptions.disableAllMapInteractions?u:n.querySelector("a");f.mapTapped.add(function(){if(n&&Microsoft.Maps.Internal._Gimme(n).get_style("display")!=="none"&&(n.click(),t)){var i="&"+t.getAttribute("data-h")+"&url="+encodeURIComponent(t.getAttribute("href"));_w.si_sbwu&&_w.si_sbwu(i)||_w.si_T&&_w.si_T(i)}});sj_be(t,"click",function(t){if(!r._mapOptions.supressLargerMapClick)if(r._mapOptions.disableAllMapInteractions){if(n.click(),Microsoft.Maps.GlobalConfig.features.localSearch.sendFakeGlinkPing){var i=window._lmutils;i&&i.ovlGPing&&i.ovlGPing()}}else r._processClickthrough(t)});this._titleElementId&&(i=_ge(this._titleElementId),i&&(i=i.querySelector("a"),sj_be(i,"click",function(n){return r._processClickthrough(n)})))}},n.prototype._getExploreMoreElement=function(n){var i="mv_lm",r=".mv_lm.icon",t;return n&&(t=_ge(n),t)?t.querySelector("#"+i)||t.querySelector(r):_ge(i)||_d.querySelector(r)},n.prototype._processClickthrough=function(n){n.preventDefault();var t=this._map.getV8Map(),i=t.getNavigationBar(),r=i&&i.getTrafficButton(),u=r&&r.getTrafficLayer();this._mapsUrl=StaticImage.replaceOrAppendMapModeParams(n.currentTarget.href,t.getMapType().id=="a"||t.getMapType().id=="h",i&&r&&u&&u.getIsShowing&&u.getIsShowing(),{centerPoint:{latitude:t.getView().cameraLocation.latitude,longitude:t.getView().cameraLocation.longitude},zoomLevel:t.getMercatorZoomLevel(),nwLocation:{latitude:t.getBounds().getNorthwest().latitude,longitude:t.getBounds().getNorthwest().longitude},seLocation:{latitude:t.getBounds().getSoutheast().latitude,longitude:t.getBounds().getSoutheast().longitude}});this._navigateToMapsVertical&&(window.location.href=this._mapsUrl)},n.prototype._getUrlParam=function(n,t){var r=encodeURI(t).replace(/[\.\(\)\*\+]/g,"\\$&"),u="^(?:.*[&\\?]"+r+"(?:\\=([^&]*))?)?.*$",i=new RegExp(u,"i").exec(n.search);return decodeURIComponent(i&&i[1]||"")},n.prototype._setNewFrame=function(n){var u=this._map.getV8Map(),i=u.getFrameManager(),t,r;i.frameRendered.isPreviouslyInvoked?n():(r=i.frameRendered.addOne(function(){t&&t.dispose();n()}),t=i.frameFailed.add(function(i){i.reason!==1&&(t&&t.dispose(),r&&r.dispose(),n())}))},n._defaultTimeoutForBootstrapping=3e3,n}()