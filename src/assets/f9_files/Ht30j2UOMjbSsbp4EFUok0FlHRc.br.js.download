(function(){var a,s,nt,i,c,k,y,ht,tt,e,d,it,rt;try{var f=window.$MicrosoftMaps8,n=f.Internal,ti=f.Anchor,ii=n.AreaLabel,lt=f.BitmapImageTemplate,ut=n.CanvasDrawingContext,p=n._CanvasLabelRenderer,ot=n._Color,at=f.CoordinateProjection,h=n._Debug,vt=n._EntityHelper,o=f.GlobalConfig,l=n._Gimme,t=n._Helper,ri=n._IconLabel,ui=n.HitTestIndex,fi=n._LabelData,yt=o.features.labels,g=n._LruCache,ei=f.Matrix2D,st=n._NAARectangle,oi=n._Observable,v=f.Point,ft=f.Rectangle,si=n.RelativePlacement,et=f.Size,hi=f.Viewport,ci=f.ZoomLevel,pt=f.VectorImageTemplate,li=f.VectorMapLayer,ai=n._ObjectWithId,r=n._VectorMath,vi=n._WorkDispatcher,yi=n._LayerRendererManager,pi=n.LabelRenderer,wt=n.LabelController,bt=n.VectorLabels,w=n._VectorLayerRenderer,wi=o.features.venueMap,b=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),u;(function(n){function r(n,t){n.clearColor(0,0,0,0);t?n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT):n.clear(n.COLOR_BUFFER_BIT)}function u(n,t,i,r){var u;return u=t?t:n.createBuffer(),n.bindBuffer(i,u),n.bufferData(i,r,n.DYNAMIC_DRAW),u}function f(n,t,i,r,u,f,e,o,s){n.bindBuffer(r,i);n.enableVertexAttribArray(t);n.vertexAttribPointer(t,u,f,e,o,s)}function e(n,i,r,u,f){var e;if(e=i?i:n.createTexture(),t(n,0,e),r)n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r);else if(u>0&&f>0)n.texImage2D(n.TEXTURE_2D,0,n.RGBA,u,f,0,n.RGBA,n.UNSIGNED_BYTE,null);else throw new Error("Invalid texture specification");return n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),e}function o(n,i,r,u,f){return i&&(t(n,0,i),n.texSubImage2D(n.TEXTURE_2D,0,r,u,n.RGBA,n.UNSIGNED_BYTE,f)),i}function s(n,t,r){var u=n.createProgram();if(i(n,n.VERTEX_SHADER,t,u),i(n,n.FRAGMENT_SHADER,r,u),n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS))throw n.getProgramInfoLog(u);return u}function h(n,t,i,r,u){return t&&(n.bindBuffer(i,t),n.bufferSubData(i,r,u)),t}function t(n,t,i){n.activeTexture(n.TEXTURE0+t);n.bindTexture(n.TEXTURE_2D,i)}function i(n,t,i,r){var u=n.createShader(t);if(n.shaderSource(u,i),n.compileShader(u),!n.getShaderParameter(u,n.COMPILE_STATUS))throw n.getShaderInfoLog(u);n.attachShader(r,u);n.deleteShader(u)}n.clear=r;n.uploadBuffer=u;n.readBuffer=f;n.createAndUploadTexture=e;n.updateTexture=o;n.createProgram=s;n.updateBuffer=h})(u||(u={})),function(n){function i(n){var i=n?"gl_PointSize = 3.0;":"";return t+"\n            attribute vec4 a_position;\n\n            uniform mat4 u_PTMatrix;\n            uniform vec2 u_halfScreen;\n            uniform vec4 u_color;\n            uniform float u_extrusionScale;\n            uniform float u_depth;\n            varying vec4 col;\n\n            void main() {\n                col = u_color;\n\n                vec4 clipPosition= u_PTMatrix * vec4(a_position.xy, 0, 1);\n                vec2 clipSpaceExtrusion = a_position.zw / u_halfScreen * clipPosition.w * u_extrusionScale;\n        \n                vec4 afterExtrusion = vec4(clipPosition.xy+clipSpaceExtrusion, clipPosition.z, clipPosition.w);\n                gl_Position = vec4(afterExtrusion.xy, u_depth, clipPosition.w);\n \n                ".concat(i,"\n            }")}var t="precision ".concat(o.isMobile?"highp":"mediump"," float;");n.textureVertex=t+"\n            attribute vec4 a_position;\n            attribute vec2 a_texCoord;\n            attribute float a_visibleZoom;\n\n            uniform mat4 u_PTMatrix;\n            uniform vec2 u_halfScreen;\n            uniform float u_extrusionScale;\n            uniform float u_zoom;\n            uniform float u_depth;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n                vec4 clipPosition= u_PTMatrix * vec4(a_position.xy, 0, 1);\n                float visibilityFlag = u_zoom < a_visibleZoom ? 0.0: 1.0;\n                vec2 clipSpaceExtrusion = a_position.zw / u_halfScreen * clipPosition.w * u_extrusionScale * visibilityFlag;\n                vec4 afterExtrusion = vec4(clipPosition.xy+clipSpaceExtrusion, clipPosition.z, clipPosition.w);\n                gl_Position = vec4(afterExtrusion.xy, u_depth, clipPosition.w);\n\n                /* pass the texCoord to the fragment shader */\n                v_texCoord = a_texCoord;\n            }";n.textureFragment=t+"\n            /* our texture */\n            uniform sampler2D u_image;\n\n            /* the texCoords passed in from the vertex shader. */\n            varying vec2 v_texCoord;\n\n            void main() {\n            gl_FragColor = texture2D(u_image, v_texCoord);\n            }";n.solidColorVertex=i;n.solidColorFragment=t+"\n          varying vec4 col;\n           void main() {\n           gl_FragColor = col;\n        }"}(a||(a={})),function(n){function f(n,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,n,t,i,1,]}function e(n,t,i,r){var u=1/(i-r);return[n/t,0,0,0,0,n,0,0,0,0,(i+r)*u,-1,0,0,i*r*u*2,0]}function o(n,t){var i=n[0],r=n[1],u=n[2],f=n[3],e=n[4],o=n[5],s=n[6],h=n[7],c=n[8],l=n[9],a=n[10],v=n[11],y=n[12],p=n[13],w=n[14],b=n[15],k=t[0],d=t[1],g=t[2],nt=t[3],tt=t[4],it=t[5],rt=t[6],ut=t[7],ft=t[8],et=t[9],ot=t[10],st=t[11],ht=t[12],ct=t[13],lt=t[14],at=t[15];return[k*i+d*e+g*c+nt*y,k*r+d*o+g*l+nt*p,k*u+d*s+g*a+nt*w,k*f+d*h+g*v+nt*b,tt*i+it*e+rt*c+ut*y,tt*r+it*o+rt*l+ut*p,tt*u+it*s+rt*a+ut*w,tt*f+it*h+rt*v+ut*b,ft*i+et*e+ot*c+st*y,ft*r+et*o+ot*l+st*p,ft*u+et*s+ot*a+st*w,ft*f+et*h+ot*v+st*b,ht*i+ct*e+lt*c+at*y,ht*r+ct*o+lt*l+at*p,ht*u+ct*s+lt*a+at*w,ht*f+ct*h+lt*v+at*b,]}function s(n){var u,e=i+.5,f,r;for(f in t)if(t.hasOwnProperty(f)&&(r=parseInt(f),u=r,Math.abs(n-r)<=e)){u=r;break}return u}function h(n){var i=s(n),r=Math.pow(2,n-i),u=r*t[i];return{align:i,pixelScale:u,zoomDelta:r}}function c(n,i,s,h,c){var l=s/2,a=l/r,v=l*u,y=t[n.align],p=e(y,i/s,a,v),w=l/n.zoomDelta,b=f(h,c,-w);return o(p,b)}function l(n,t,i,r,u,f,e,o,s,h,c,l,a,v,p){var k=b(e,o,s,h,a,v),d=w(i,r,u,f,c,l,p);return y(n,t,{vertices:d,textureLookup:k})}function a(n){for(var u=n*6,i=new Uint16Array(u),r=0,t=0;t<u;t+=6)i[t]=0+r,i[t+1]=1+r,i[t+2]=2+r,i[t+3]=2+r,i[t+4]=1+r,i[t+5]=3+r,r+=4;return i}function v(n,t,i){for(var r=0;r<4;r++)n.setFloat32(t,i,!0),t+=Float32Array.BYTES_PER_ELEMENT;return t}function y(n,t,i){for(var r,f=i.vertices,e=i.textureLookup,u=0;u<4;u++){for(r=0;r<4;r++)n.setFloat32(t,f[u*4+r],!0),t+=Float32Array.BYTES_PER_ELEMENT;for(r=0;r<2;r++)n.setUint16(t,e[u*2+r]*65535,!0),t+=Uint16Array.BYTES_PER_ELEMENT}return t}function p(n,t){return[n,0,0,0,n,t,0,t,]}function w(n,t,i,r,u,f,e){var s=[n,t,i,r,n,t,0,r,n,t,i,0,n,t,0,0,],o,h;if(e){for(o=0;o<s.length;o+=4)s[o]+=s[o+2],s[o+1]+=s[o+3],s[o+2]=0,s[o+3]=0;h=0}else h=2;for(o=0;o<s.length;o+=4)s[o+h]+=u,s[o+h+1]+=f;return s}function b(n,t,i,r,u,f){for(var e=p(i,r),o=0;o<e.length;o+=2)e[o]=(n+e[o])/u,e[o+1]=(t+e[o+1])/f;return e}var t={"4":.0078125,"11":1,"18":128},i=3,r=2<<i,u=2<<i+2;n.getScale=h;n.getMatrices=c;n.fillRectangleData=l;n.buildRectangleVertexIndex=a;n.fillOneRectangleVisibleZoom=v}(s||(s={}));nt=function(){function n(n,t,i,r,u,f,o){var c,s,h;this._translation={};this._depth=r?-.01:0;c=e.getColor(i.fillStyle,!0);this._attributes={isInterior:r,color:[c.red,c.green,c.blue,r?0:c.alpha]};this._updateData(n,t,this._attributes,u,f,o);this._borders=[];i.secondaryLineWidth>0&&i.secondaryStrokeStyle&&(s=e.getColor(i.secondaryStrokeStyle,!0),s.alpha>0&&(this._attributes.outerBorder={width:i.secondaryLineWidth,color:[s.red,s.green,s.blue,s.alpha]},this._borders.push(new k(n,t,this._attributes.outerBorder,u,f,null,this._depth))));i.lineWidth>0&&i.strokeStyle&&(h=e.getColor(i.strokeStyle,!0),h.alpha>0&&(this._attributes.border={width:i.lineWidth,color:[h.red,h.green,h.blue,h.alpha]},this._borders.push(new k(n,t,this._attributes.border,u,f,null,this._depth))))}return n.prototype._updateData=function(n,i,r,u,f,e){var h,l,o;this._gl=n;this._attributes=t._copyObject(r);var a=n.canvas.width/2,v=n.canvas.height/2,s=e(i);if(s&&s.triangles){for(h=s.triangles,l=[],o=0;o<h.length;o++)l.push(i[h[o]]);this._innerTriangles=c.generateBufferData(l,a,v,u,f)}},n.prototype.render=function(n,t,i,r,f){var o=this._gl,l={width:o.canvas.width/f,height:o.canvas.height/f},c,h;for(e.computeTranslate(r,l,i,this._translation),c=s.getMatrices(i,o.canvas.width,o.canvas.height,this._translation.translate.x*f,this._translation.translate.y*f),o.uniformMatrix4fv(n.u_PTMatrix,!1,c),o.uniform1f(n.u_depth,this._depth),this._innerTriangles&&((!this._innerTrianglesBuffer||t)&&(this._innerTrianglesBuffer=u.uploadBuffer(o,this._innerTrianglesBuffer,o.ARRAY_BUFFER,this._innerTriangles)),this._innerTrianglesBuffer&&(u.readBuffer(o,n.a_position,this._innerTrianglesBuffer,o.ARRAY_BUFFER,4,o.FLOAT,!1,0,0),o.uniform4f(n.u_color,this._attributes.color[0],this._attributes.color[1],this._attributes.color[2],this._attributes.color[3]),o.drawArrays(o.TRIANGLE_STRIP,0,this._innerTriangles.length/4))),h=0;h<this._borders.length;h++)this._borders[h].render(n,!1,i,r,f)},n.prototype.dispose=function(){this._gl&&(this._innerBuffer&&this._gl.deleteBuffer(this._innerBuffer),this._innerTrianglesBuffer&&this._gl.deleteBuffer(this._innerTrianglesBuffer));this._gl=this._innerTrianglesBuffer=this._innerBuffer=this._innerTriangles=null;t._clearDisposables(this._borders)},n}();i=function(){function n(n,t,i){this.anchor=n;this.offsetX=t;this.offsetY=i}return n.prototype["export"]=function(){return new v(this.anchor.x+this.offsetX,this.anchor.y+this.offsetY)},n}(),function(n){function s(n,t){var i=e(n),s=i.length,f=[],l,g,k;if(s>1&&t.width>1&&t.width<999){var y=t.cap||"round",tt=t.join||"round",it=t.miterLimit||10,d=t.width/2,h=[],b=!0,a=t.cullface,o;if(s===2)v.pointsEqual(i[0],i[1])||f.push.apply(f,p(y,i[0],i[1],d,a));else{for(v.pointsEqual(i[0],i[s-1])&&(g=i.shift(),k=r.getMidpoint2D(g,i[0]),i.unshift(k),i.push(k),b=!1),s=i.length,o=0;o<s-1;o++)o===0?h.push(i[0]):o===s-2?h.push(i[s-1]):h.push(r.getMidpoint2D(i[o],i[o+1]));for(s=h.length,o=1;o<s;o++){var nt=o===1,rt=o===s-1,c=r.rotatingDirection(h[o-1],i[o],h[o])!==2;l=w(h[o-1],i[o],h[o],c,d,tt,it,nt,rt,a);b&&nt&&(c?f.push.apply(f,u(y,i[0],l[1]["export"](),l[0]["export"](),c,a)):f.push.apply(f,u(y,i[0],l[0]["export"](),l[1]["export"](),c,a)));f.push.apply(f,l)}s=f.length;b&&(c?f.push.apply(f,u(y,i[i.length-1],f[s-2]["export"](),f[s-1]["export"](),c,a)):f.push.apply(f,u(y,i[i.length-1],f[s-1]["export"](),f[s-2]["export"](),c,a)))}}return f}function e(n){var t=[],i,r;if(n&&n.length>0)for(i=0;i<n.length;i++)r=n[i],r&&!v.pointsEqual(r,t[t.length-1])&&t.push(r);return t}function h(n,t,r,u,f){for(var o=[],h=f.pixelScale,e=0;e<n.length;e++){var c=n[e]instanceof i,s=c?n[e].anchor:n[e],l=(s.x*u-t)/h,a=(r-s.y*u)/h;o.push(l);o.push(a);c?(o.push(n[e].offsetX*u),o.push(-n[e].offsetY*u)):o.push(typeof s.z=="number"?s.z:0,0)}return new Float32Array(o)}function c(n,t,i,u,f,e){var it=n.width/i,rt=it/2,ft=t&&t.length>=2?t[1]:1,s,d,g,y,p,h,ct;t=[0,ft];t=ut.prepareLineDashes(t,it,!1);var w=t[1],c=[],et=[],a,v,b,k;for(s=1;s<u.length;s++){if(d=u[s].x,g=u[s].y,isNaN(a)||isNaN(v))b=u[s-1].x,k=u[s-1].y;else if(y=r.intersectLineCircle({x:u[s-1].x,y:u[s-1].y},{x:d,y:g},{x:a,y:v},w),y&&y.length!==0)b=y[0].x,k=y[0].y;else continue;var nt=d-b,tt=g-k,ot=Math.atan2(tt,nt),lt=Math.sqrt(nt*nt+tt*tt),at=Math.ceil(lt/w),st=Math.cos(ot)*w,ht=Math.sin(ot)*w;for(p=0;p<at;p++)a=b+p*st,v=k+p*ht,h=o(n,a,v,rt,f),ct=c.length,h.visibleZoom=l(ft,e,ct),c.push(h),h=o(n,a+st/2,v+ht/2,rt,f),h.visibleZoom=e+.5,et.push(h)}return c.push.apply(c,et),c}function o(n,i,r,u,f){var e=t._copyObject(n);return e.top=r-u,e.left=i-u,e.adjustX=e.adjustY=u,e.priority=f,e}function l(n,t,i){var r=f[n],u;for(r||(r=a(n),f[n]=r),u=0;u<3;u++){if(i%2==1)return t+r[u];i=i>>>1}return-1}function a(n){var t=(n-1)/(n/2),i=-t,u=[i],r=i,f=i-3;t<=0&&(t=.5);do r-=t,u.push(r);while(r>f);return u}function p(n,t,f,e,o){var h,c,s;if(t&&f){t.x>f.x&&(c=t,t=f,f=c);s=f.subtract(t);s=r.perpendicular2D(s).invert();s=r.normalizeVector2D(s).scalarMultiply(e);var l=new i(t,s.x,s.y),a=new i(t,-s.x,-s.y),v=new i(f,s.x,s.y),y=new i(f,-s.x,-s.y),p=[l,a,v,y];h=[];h.push.apply(h,u(n,t,a["export"](),l["export"](),!0,o));h.push.apply(h,p);h.push.apply(h,u(n,f,v["export"](),y["export"](),!0,o))}return h}function w(n,t,u,f,e,o,s,h,c,l){var y=[],a=t.subtract(n),st=r.getMagnitudeOfVector2D(a),v=u.subtract(t),ht=r.getMagnitudeOfVector2D(v),et,ot,it,rt;a=r.perpendicular2D(a);v=r.perpendicular2D(v);f&&(a=a.invert(),v=v.invert());a=r.normalizeVector2D(a).scalarMultiply(e);v=r.normalizeVector2D(v).scalarMultiply(e);var ut=new i(n,a.x,a.y),g=new i(t,a.x,a.y),ft=new i(u,v.x,v.y),nt=new i(t,v.x,v.y),tt=r.intersect2D(ut["export"](),g["export"](),ft["export"](),nt["export"]()),p,w=Number.MAX_VALUE;return tt&&(p=tt.subtract(t),w=r.getMagnitudeOfVector2D(p)),et=new i(n,-a.x,-a.y),ot=new i(u,-v.x,-v.y),w>st||w>ht?(it=new i(t,-a.x,-a.y),rt=new i(t,-v.x,-v.y)):it=rt=new i(t,-p.x,-p.y),y.push.apply(y,b(f,h,ut,et,g,it)),y.push.apply(y,d(o,t,g["export"](),nt["export"](),w,e,s,tt,f,l)),y.push.apply(y,k(f,c,nt,rt,ft,ot)),y}function b(n,t,i,r,u,f){var e=[];return n?(t&&(e.push(i),e.push(r)),e.push(u),e.push(f)):(t&&(e.push(r),e.push(i)),e.push(f),e.push(u)),e}function k(n,t,i,r,u,f){var e=[];return n?(e.push(i),e.push(r),t&&(e.push(u),e.push(f))):(e.push(r),e.push(u),t&&(e.push(f),e.push(u))),e}function u(n,t,i,r,u,f){var e;return n==="round"&&(e=y.sector(t,i,r,u,f)),e}function d(n,t,r,u,f,e,o,s,h,c){var l,w,a,v,p;return n==="round"?l=y.sector(t,r,u,h,c):(w=f/e,n==="bevel"||n==="miter"&&w>=o||!s?h||(a=r.subtract(u),l=[new i(t,0,0),new i(r,-a.x,-a.y)]):(v=r.subtract(s),p=new i(r,-v.x,-v.y),l=[p,p])),l}var f={};n.getTriangleStrip=s;n.cleanData=e;n.generateBufferData=h;n.generateRecords=c}(c||(c={}));k=function(){function n(n,r,u,f,e,o,s){function y(n){var r,t,u,f;if(o&&n){for(r=[],t=0;t<n.length;t++)u=n[t]instanceof i?n[t]["export"]():n[t],f=new i(o,u.x-o.x,u.y-o.y),r.push(f);return r}return n}var h,l,a,v;this._translation={};this._gl=n;h=u.width>1?u.width:1;h=h>999?999:h;this._attributes=t._copyObject(u);this._attributes.width=h;this._depth=s||0;l=n.canvas.width/2;a=n.canvas.height/2;h===1?this._lineStrip=c.generateBufferData(y(c.cleanData(r)),l,a,f,e):(v=c.getTriangleStrip(r,u),this._innerTriangles=c.generateBufferData(y(v),l,a,f,e))}return n.prototype.render=function(t,i,r,u,f){var o=this._gl,c={width:o.canvas.width/f,height:o.canvas.height/f},h;e.computeTranslate(u,c,r,this._translation);h=s.getMatrices(r,o.canvas.width,o.canvas.height,this._translation.translate.x*f,this._translation.translate.y*f);o.uniformMatrix4fv(t.u_PTMatrix,!1,h);o.uniform1f(t.u_depth,this._depth);this._lineStrip?((!this._lineStripBuffer||i)&&(this._lineStripBuffer=n._upsertBuffer(o,this._lineStripBuffer,this._lineStrip)),n._renderPass(o,t,o.LINE_STRIP,this._lineStripBuffer,this._attributes.color,4,this._lineStrip.length/4)):((!this._innerBuffer||i)&&(this._innerBuffer=n._upsertBuffer(o,this._innerBuffer,this._innerTriangles)),n._renderPass(o,t,o.TRIANGLE_STRIP,this._innerBuffer,this._attributes.color,4,this._innerTriangles.length/4))},n.prototype.setColor=function(n){this._attributes&&(this._attributes.color=[n.red,n.green,n.blue,n.alpha])},n.prototype.visible=function(){var n=this._attributes;return n&&n.color&&n.color[3]>0},n.prototype.getAttribute=function(){return this._attributes},n.prototype.dispose=function(){this._gl&&(this._innerBuffer&&this._gl.deleteBuffer(this._innerBuffer),this._lineStripBuffer&&this._gl.deleteBuffer(this._lineStripBuffer));this._gl=this._lineStripBuffer=this._innerBuffer=this._innerTriangles=this._lineStrip=null},n._upsertBuffer=function(n,t,i){return i&&i.length>0&&(t||(t=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,i,n.STATIC_DRAW)),t},n._renderPass=function(n,t,i,r,f,e,o){r&&(u.readBuffer(n,t.a_position,r,n.ARRAY_BUFFER,e,n.FLOAT,!1,0,0),n.uniform4f(t.u_color,f[0],f[1],f[2],f[3]),n.drawArrays(i,0,o))},n}(),function(n){function t(n,t,i,u,e){var o=r.twoPI;return o=-r.getAngleBetween(n,t,i),u?o>0&&(o-=r.twoPI):o<0&&(o=o+r.twoPI),f(n,t,o,u,e)}function u(n,t,r){var l=n.x,a=n.y,e={x:l,y:a},o=[new i(e,0,0)],s,u,f,h,c;if(r>=3)for(s=Math.PI*2/r,u=0,f=0;f<=r;f++)h=t*Math.cos(u),c=t*Math.sin(u),o.push(new i(e,h,c)),u+=s;return o}function f(n,t,u,f,e){var c=r.getMagnitudeOfVector2D(n.subtract(t)),s=[],h=Math.ceil(Math.abs(u*c)/4),p=-r.getAngleOfSegment2D(n,t),y,l,o,a,v;for(h+=h%2,y=u/h,l=new i(n,0,0),o=0;o<=h;o++)a=p+y*o,v=new i(n,c*Math.cos(a),-c*Math.sin(a)),f?(s.push(v),(e||o%2==0)&&s.push(l)):((e||o%2==0)&&s.push(l),s.push(v));return s}n.sector=t;n.regularPolygon=u}(y||(y={}));ht=function(){function n(n,t,i,r,u){this.update(n,t,i,r,u)}return n.prototype.update=function(n,t,i,r,f){function k(n){var t=2*Math.PI*n/4;return Math.ceil(t/10)*10}var s,l;!this._gl&&n&&(this._gl=n);s=Math.abs(i.radius);isNaN(this._radius)&&(this._radius=s,this._edges=0);this._scale=s/this._radius;l=Math.round(i.edges);!isNaN(l)&&l>=3&&(this._edges=l);var a=this._prevCenter,h=!(a&&t&&a.x===t.x&&a.y===t.y),o=i.vectorType===0?k(s):this._edges;if(o=Math.max(o,this._edges),this._scale>=1||h)if(o>this._edges||!this._triangles||h){this._radius=s;this._edges=o;var p=n.canvas.width/2,w=n.canvas.height/2,v=this._triangles=y.regularPolygon(t,s,this._edges),b=c.generateBufferData(v,p,w,r,f);this._buffer=u.uploadBuffer(n,this._buffer,n.ARRAY_BUFFER,b);this._translation={};this._updateBorder(n,t,i,r,f,o,h,v);this._scale=1}else this._updateBorder(n,t,i,r,f,o,h);else this._updateBorder(n,t,i,r,f,o,h);this._glColor=e.getColor(i.color,!0);this._border&&this._border.setColor(e.getColor(i.strokeColor,!0));this._prevCenter=t},n.prototype._updateBorder=function(n,t,i,r,u,f,o,s){var a=this._border?this._border.getAttribute().width:0,c=i.strokeWidth>0?i.strokeWidth:0,l,h;if((a!==c||this._scale!==1||o)&&(this._border&&this._border.dispose(),s||(s=y.regularPolygon(t,Math.abs(i.radius),f)),c>0)){for(l=[],h=1;h<s.length;h++)l.push(s[h]["export"]());this._border=e.createOneSolidLine(n,l,i.strokeColor,c,"butt","bevel",r,u,s[0]["export"]())}},n.prototype.render=function(n,t,i,r){var o=this._glColor,f,h,c;this._buffer&&o.alpha>0&&this._radius>0&&this._scale>0&&(f=this._gl,h={width:f.canvas.width/r,height:f.canvas.height/r},e.computeTranslate(i,h,t,this._translation),c=s.getMatrices(t,f.canvas.width,f.canvas.height,this._translation.translate.x*r,this._translation.translate.y*r),u.readBuffer(f,n.a_position,this._buffer,f.ARRAY_BUFFER,4,f.FLOAT,!1,0,0),f.uniformMatrix4fv(n.u_PTMatrix,!1,c),f.uniform4f(n.u_color,o.red,o.green,o.blue,o.alpha),f.uniform1f(n.u_extrusionScale,this._scale),f.drawArrays(f.TRIANGLE_FAN,0,this._triangles.length),f.uniform1f(n.u_extrusionScale,1),this._border&&this._border.visible()&&this._border.render(n,!1,t,i,r))},n.prototype.dispose=function(){this._gl&&this._buffer&&this._gl.deleteBuffer(this._buffer);this._border&&this._border.dispose();t._nullifyClass(this)},n}(),function(n){function t(n){return n&&n.length>0&&n[0]===0}function i(n,t,i,u,f,e){var o,s=i.outerWidth>i.width?i.outerWidth:i.width,h="".concat(i.rawColor,"_").concat(i.width,"_").concat(i.rawOuterColor,"_")+s*u;return o=n.records.getItem(h),o||(o={width:s*u,height:s*u,left:0,top:0,adjustX:0,adjustY:0,atlasX:-1,atlasY:-1,visibleZoom:-1,id:h},o.templateResults=[{resultImages:[r(i,s,u)]}]),c.generateRecords(o,i.dashes,u,t,f,e)}function r(n,t,i){var u=new ut(null,null,i),f=t/2,e=f,o=2*Math.PI,h=n.rawColor,s=n.rawOuterColor,r;return u.setSize(t,t),r=u.getRawContext(),s&&n.outerWidth>n.width&&(r.beginPath(),r.arc(f,e,n.outerWidth/2,0,o),r.fillStyle=s,r.fill(),r.closePath()),r.beginPath(),r.arc(f,e,n.width/2,0,o),r.fillStyle=h,r.fill(),r.closePath(),{width:t*i,height:t*i,drawX:0,drawY:0,source:u.getRootElement()[0]}}n.isSupported=t;n.makeAtlasRecords=i}(tt||(tt={})),function(n){function f(n,t,i,r){var u;if(r){var f=0,e=0,o=t.width/2,s=t.height/2;r.viewportCenter&&(u=n.getMode().tryLocationToPoint(r.viewportCenter),f=u.x-o,e=s-u.y);var h=r.translate?r.translate.x:0,c=r.translate?r.translate.y:0,l=f/i.pixelScale,a=e/i.pixelScale;h+=l;c+=a;r.viewportCenter=n.getMode().tryPointToLocation(new v(o,s));r.translate={x:h,y:c}}}function e(i,r,u,f,e,o,s,c,l){var a,at=o?o.text:"",p=w(f,at,u),ft=r&&r.currentData&&r.currentData.atlas.records,et=0,ot=0,st=0,ht=0,k,vt=ft&&ft.getItem(p),v,y,d,yt,ct,g,tt,it,rt,ut,lt;if(vt)a=t._copyObject(vt),a.cached=!0;else{for(v=void 0,y=[],d=0,yt=f?f.length:0;d<yt;d++){if(ct=f[d],ct.tainted){e.taintedTemplate=!0;n.renderCanvasTemplates(i,f,e,o,s,c,l);y=null;break}if(v=ct.renderData(u,{id:null,name:at},0,0,s,h.UserLogTag,e),v&&v.resultImages&&v.resultImages.length>0){for(g=0;g<v.resultImages.length;g++){var nt=v.resultImages[g],pt=nt.drawX*u,wt=nt.drawY*u;et=Math.min(et,pt);ot=Math.min(ot,wt);st=Math.max(st,pt+nt.width);ht=Math.max(ht,wt+nt.height)}y.push(v)}}tt=st-et;it=ht-ot;tt+=tt%2;it+=it%2;rt=void 0;ut=void 0;y.length===1&&y[0].resultImages.length===1?(rt=y[0].resultImages[0].anchorAdjustX,ut=y[0].resultImages[0].anchorAdjustY):(lt=o.region.bounds.bbox.getCenter(),k=o.region.bounds.anchor,rt=lt.x-k.x,ut=lt.y-k.y);a={width:tt,height:it,id:p,left:0,top:0,visibleZoom:0,adjustX:Math.ceil(rt),adjustY:Math.ceil(ut),templateResults:y,atlasX:-1,atlasY:-1}}return a.left=c-a.width/2/u+a.adjustX,a.top=l-a.height/2/u+a.adjustY,a.id=p,a.anchor=k,a.cached||ft.addItem(p,a),a.visibleZoom=b(e.visibilities),a}function o(n,t,i,r,u,f,e){for(var o=0,s=t.length;o<s;o++)t[o].renderCanvas(n,{id:null,name:r.text},f,e,u,h.UserLogTag,i)}function s(n,t,i,r,u,f,e,o){var it=n.polylineKeysToRender=[],ot=n.vectorIconKeysToRender=[],st=n.polygonKeysToRender=[],b=[],rt=[],k=n.polylineCache,v=n.polygonCache,p=n.vectorIconCache,ct=k.getCapacity(),lt=v.getCapacity(),at=p.getCapacity(),s,d,w,ht;for(s in i)if(i.hasOwnProperty(s))if(d=i[s],Array.isArray(d)){var g=[],nt=p.getItem(s),ut=s+"_"+f,h=v.getItem(ut),ft=!!h;for(ft||(h=[]),nt||(nt=[]),w=0,ht=d.length;w<ht;w++){var c=d[w],tt=c.shapes,et=c.type;tt&&tt.length!==0&&(et===2?g.push.apply(g,y(n,t,c.style,tt[0],r,f,u,c.glPriority,b,rt)):et!==3||ft?et===1&&(l(t,c,r,u,nt,w),ot.push(s)):h.push.apply(h,a(t,c.style,tt,r,u,e,o)),g.length>0&&(it.push(s),k.addItem(s,g,!0)),h.length>0&&(st.push(ut),ft||v.addItem(ut,h,!0)))}p.addItem(s,nt,!0)}else it.push(s);return p.getCapacity()>at&&p.setCapacity(Math.max(ot.length,2e3)),v.getCapacity()>lt&&v.setCapacity(Math.max(st.length,500)),k.getCapacity()>ct&&k.setCapacity(Math.max(it.length,500)),n.vectorPriorityRecordCounter=rt.length,b.push.apply(b,rt),b}function i(n,i){var r=u[n];return r||(r=ot.parse(n)||new ot([0,0,0,0]),u[n]=r),i&&(r=t._copyObject(r),r.red/=255,r.green/=255,r.blue/=255),r}function l(n,t,i,r,u,f){var o=t.shapes[0].points[0],e=u[f];e?e.update(n,o,t.icon,i,r):(e=new ht(n,o,t.icon,i,r),u[f]=e)}function a(n,t,i,r,u,f,e){var l=[],h,o,c,s;if(i.length>1)for(h=f({shapes:i.slice(1)}).shapes,o=0;o<h.length;o++)h[o].points.length<3||l.push(new nt(n,h[o].points,t,!0,r,u,e));for(c=f({shapes:i.slice(0,1)}).shapes,s=0;s<c.length;s++)c[s].points.length<3||l.push(new nt(n,c[s].points,t,!1,r,u,e));return l}function y(n,t,r,u,f,e,o,s,h,l){var w=r.lineCap,b=r.lineJoin,k=c.cleanData(u.points),v=r.dashes,a=i(r.strokeStyle,!0),d,y;if(v&&v.length>0)d={width:r.lineWidth,cap:w,join:b,color:[a.red,a.green,a.blue,a.alpha],dashes:v,rawColor:r.strokeStyle,rawOuterColor:r.secondaryStrokeStyle,outerWidth:r.secondaryLineWidth},y=tt.makeAtlasRecords(n.atlas,k,d,f,s,e),s===2?l.push.apply(l,y):h.push.apply(h,y);else return p(t,k,r,w,b,f,o)}function p(n,t,i,u,f,e,o){var s=[],h=i.secondaryLineWidth;return h&&s.push(r(n,t,i.secondaryStrokeStyle,h,u,f,e,o)),s.push(r(n,t,i.strokeStyle,i.lineWidth,u,f,e,o)),s}function r(n,t,r,u,f,e,o,s,h){var c=i(r,!0),l={width:u,cap:f,join:e,color:[c.red,c.green,c.blue,c.alpha]};return new k(n,t,l,o,s,h)}function w(n,t,i){for(var r,u=[],f=!1,e=0;e<n.length;e++)r=n[e],!f&&r instanceof pt&&r.hasText&&(f=!0),r.id&&u.push(r.id+r.getScale());return(f?u.join()+t:u.join())+i}function b(n){var i=-1,t;if(n)for(i=0,t=0;t<n.length;t++)if(n[t].visible){i=n[t].zoom;break}return i}var u={};n.computeTranslate=f;n.packGLTemplates=e;n.renderCanvasTemplates=o;n.buildVectorEntityData=s;n.getColor=i;n.createOneSolidLine=r}(e||(e={})),function(n){function i(n,t,i,u,e){var y=n.records,c=[],p=Object.keys(y.getInternalDictionary()),s=n.state,l,w,h,a,b,v;for(s||(n.state=s={lastAllocatedIndex:-1,resumePoint:{x:0,y:0},size:u?new et(t,t):new et(t/2,t*2)}),l=0,w=p.length;l<w;l++)h=y.getItem(p[l]),h.cached&&h.atlasX!==-1&&h.atlasY!==-1||c.push(h);return a=o.glPadding||0,b=a?0:1,s=n.state=f(c,s,b,a,e),v=s.lastAllocatedIndex>-1&&s.lastAllocatedIndex===c.length-1,v&&!e&&s.updatedArea.w>0&&s.updatedArea.h>0&&r(n,c,i),v}function r(n,t,i){var r=n.context,f=n.state,o=f.size,l,e;if(r){var s=f.updatedArea.w,h=f.updatedArea.h,c=r.getSize();c.width===s&&c.height===h?r.clear():r.setSize(s,h)}else r=new ut(null,null,1),r.setSize(o.width,o.height);for(n.context=r,l=t.length,e=0;e<l;e++)u(r,t[e],f.updatedArea.y,i)}function u(n,t,i,r){var e=t.templateResults,h,c=t.atlasY-i,p=n.getRawContext(),l,a,f,o;if(e&&(h=e.length)>0&&t.width>0&&t.height>0)for(l=t.atlasX+t.width/2,a=c+t.height/2,f=0;f<h;f++)for(o=0;o<e[f].resultImages.length;o++){var u=e[f].resultImages[o],v=r*(u.drawX-t.adjustX)+l,y=r*(u.drawY-t.adjustY)+a,s;u.shadow&&(s=n.getStyle(),n.setStyle(u.shadow));n.drawImage(u.source,v,y,u.width,u.height);s&&n.setStyle(s)}else t.drawFunc&&t.drawFunc(n,t.atlasX,c)}function f(n,i,r,u,f){function ft(){var n;return h+o.textureHeight+r+u>w?n=!1:(h+=c,c=0,s=u,n=!0),n}var g=2*u,s=i.resumePoint.x+u,h=i.resumePoint.y+u,c=0,nt=i.size.width-u,w=i.size.height-u,l=w,a=nt,v=0,b=0,tt,it,o,rt=-1,k,d;for(n.sort(t);v<n.length;)if(o=n[v],k=o.textureWidth=isNaN(o.textureWidth)?o.width:o.textureWidth,d=o.textureHeight=isNaN(o.textureHeight)?o.height:o.textureHeight,o&&(f||o.templateResults||o.drawFunc)&&k>0&&d>0){if(tt=nt-s,it=w-h,e(o,s,h,tt,it))a=Math.min(s-u,a),l=Math.min(h-u,l),c=Math.max(d+g+r,c),s+=k+g+r,b=Math.max(b,s),rt=v++,o.cached=!0;else if(c===0)break;else if(!ft())break}else v++;var ut=h+c,y=b-a-r-u,p=ut-l-r-u;return y=y>0?y:0,p=p>0?p:0,{lastAllocatedIndex:rt,resumePoint:{x:0,y:ut},size:i.size,updatedArea:{x:a,y:l,w:y,h:p}}}function e(n,t,i,r,u){return r>=n.textureWidth&&u>=n.textureHeight?(n.atlasX=t,n.atlasY=i,!0):!1}function t(n,t){var i=t.height-n.height;return i===0&&(i=t.width-n.width),i}n.build=i}(d||(d={}));it=function(){function n(i,r,f,e,o,s,h,c,l){var v=t.createContext(i[0],o,s||e,h,l),y,p;this._enableDepth=l;this._context=v;this._canvas=i;this.updateSize(r);y=u.createProgram(v,a.textureVertex,a.textureFragment);this._program={glProgram:y,a_position:v.getAttribLocation(y,"a_position"),a_texCoord:v.getAttribLocation(y,"a_texCoord"),a_visibleZoom:v.getAttribLocation(y,"a_visibleZoom"),u_PTMatrix:v.getUniformLocation(y,"u_PTMatrix"),u_halfScreen:v.getUniformLocation(y,"u_halfScreen"),u_extrusionScale:v.getUniformLocation(y,"u_extrusionScale"),u_zoom:v.getUniformLocation(y,"u_zoom")};p=!1;(e||p)&&(this._vectorProgram=n._createVectorProgram(v,p));this._maxTextureSize=f;this._initRenderData(null)}return n.prototype.render=function(i,r,u,f,o,h,c,l,a,v){var it=Date.now(),rt=u&&u.length>0,y=this.currentData,k=f&&Object.keys(f).length>0,d=y&&(y.polylineKeysToRender&&y.polylineKeysToRender.length>0||y.polygonKeysToRender&&y.polygonKeysToRender.length>0||y.vectorIconKeysToRender&&y.vectorIconKeysToRender.length>0),ut=y&&y.textures.length>0,w,b,tt;if(c=c>0?c:t._getDpr(),!ut&&!rt&&!k&&!d)return null;var g=i.getMercatorZoomLevel(),nt=this._context,p=s.getScale(g);return y.dpr!==c&&(l=4,this._initRenderData(c)),l===4&&(k||d)&&(w=e.buildVectorEntityData(this.currentData,this._context,f,c,p,g,a,v),u&&u.length>0?u.push.apply(u,w):u=w,this.currentData.vectorIconKeysToRender.length>0&&!this._vectorProgram&&(this._vectorProgram=n._createVectorProgram(this._context))),(l===4||l===1)&&this._buildAndUpdateAtlas(nt,u,o,0,c),(l===4||l===2||l===3)&&this._buildAndUploadRenderData(nt,u,c,p,l),e.computeTranslate(i,this._canvas.get_size(),p,this.currentData.translation),b=Date.now(),this.draw(i,h),tt=Date.now(),{prep:b-it,draw:tt-b}},n.prototype.updateSize=function(n,i){var e=this._canvas.get_size(),r=this._context,o=i>0?i:t._getDpr(),u=Math.floor(n.width*o),f=Math.floor(n.height*o);(e.width!==n.width||e.height!==n.height||r.drawingBufferWidth!==u||r.drawingBufferHeight!==f)&&(this._canvas.set_style({width:n.width,height:n.height,left:0,top:0}),r.canvas.width=u,r.canvas.height=f,r.viewport(0,0,u,f))},n.prototype.getCanvas=function(){return this._canvas},n._prepareDraw=function(n,t,i,r){n.useProgram(t.glProgram);n.uniformMatrix4fv(t.u_PTMatrix,!1,i);n.uniform2f(t.u_halfScreen,n.canvas.width/2,n.canvas.height/2);typeof t.u_extrusionScale!="undefined"&&n.uniform1f(t.u_extrusionScale,1);typeof t.u_zoom!="undefined"&&n.uniform1f(t.u_zoom,r);typeof t.u_depth!="undefined"&&n.uniform1f(t.u_depth,0)},n._drawTextureEntities=function(t,i,r,f,e,o,s){if(r.renderedRecords){var h=r.vectorPriorityRecordCounter,c=r.renderedRecords.length-h,l=s?h:c;if(l>0){var v=l*6,a=20,y=s?c:0,p=y*6*Uint16Array.BYTES_PER_ELEMENT;u.readBuffer(t,i.a_position,r.vertexBuffer,t.ARRAY_BUFFER,4,t.FLOAT,!1,a,0);u.readBuffer(t,i.a_texCoord,r.vertexBuffer,t.ARRAY_BUFFER,2,t.UNSIGNED_SHORT,!0,a,16);u.readBuffer(t,i.a_visibleZoom,r.visibilityBuffer,t.ARRAY_BUFFER,1,t.FLOAT,!1,0,0);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.elementIndexBuffer);n._prepareDraw(t,i,f,o);t.drawElements(t.TRIANGLES,v,t.UNSIGNED_SHORT,p)}}},n._drawVectorEntities=function(n,t,i,r,u,f,e,o,s,h){var y=i.polylineKeysToRender,k=y?y.length:0,p=i.polygonKeysToRender,d=p?p.length:0,c,l,w,g,b,a,v;if(k>0||d>0||i.pointBuffer||s){if(n.useProgram(t.glProgram),n.uniform2f(t.u_halfScreen,n.canvas.width/2,n.canvas.height/2),c=0,l=0,o)for(c=0;c<o.length;c++)n.disableVertexAttribArray(o[c]);if(s)for(w=i.vectorIconKeysToRender,g=i.vectorIconCache,c=0;c<w.length;c++)for(b=g.getItem(w[c]),l=0;l<b.length;l++)b[l].render(t,f,e,i.dpr);else{for(n.uniform1f(t.u_extrusionScale,1),c=0;c<k;c++)if(a=i.polylineCache.getItem(y[c]),a)for(l=0;l<a.length;l++)a[l].render(t,!1,f,e,i.dpr);if(h)for(c=0;c<d;c++)if(v=i.polygonCache.getItem(p[c]),v)for(l=0;l<v.length;l++)v[l].render(t,!1,f,e,i.dpr)}}},n.prototype.draw=function(t,i){var r=this.currentData,f=this._context,h=t.getMercatorZoomLevel(),e=s.getScale(h),c=[this._program.a_texCoord,this._program.a_visibleZoom],o;u.clear(f,this._enableDepth);o=s.getMatrices(e,f.canvas.width,f.canvas.height,r.translation.translate.x*r.dpr,r.translation.translate.y*r.dpr);n._drawTextureEntities(f,this._program,r,o,e,h,!1);n._drawVectorEntities(f,this._vectorProgram,r,o,i,e,t,c,!1,this._enableDepth);n._drawTextureEntities(f,this._program,r,o,e,h,!0);r.vectorIconKeysToRender&&n._drawVectorEntities(f,this._vectorProgram,r,o,i,e,t,c,!0,!1)},n.prototype._buildAndUpdateAtlas=function(t,i,r,f,e){var o=this.currentData,s=o.atlas,a=!!this._vectorProgram,h,v,y,c,p,l;if(n._upsertAtlas(s,i,!1)){if(h=d.build(s,o.maxTextureSize,e,a),!h&&(n._upsertAtlas(s,i,!0),h=d.build(s,o.maxTextureSize,e,a),!h))if(v=this._maxTextureSize*2,y="Too many records to render in WebGL",o.maxTextureSize>=v)throw new Error(y);else if(s.state=null,o.maxTextureSize=v,s.context&&s.context.dispose(),s.context=null,n._upsertAtlas(s,i,!0),h=d.build(s,o.maxTextureSize,e,a),!h)throw new Error(y);c=s.state.updatedArea;c.w>0&&c.h>0&&(p=s.context.getRootElement()[0],l=o.textures[f],l&&o.textureSizes[f]===o.maxTextureSize?u.updateTexture(t,l,c.x,c.y,p):(l=o.textures[f]=u.createAndUploadTexture(t,null,p),o.textureSizes[f]=o.maxTextureSize))}},n.prototype._buildAndUploadRenderData=function(n,t,i,r,f){var y=f!==3,e=this._mergeRenderData(t,y),v=e.renderedRecords?e.renderedRecords.length:0,g=e.visibilityBuffer,d,pt;if(v>0){var nt=o.glPadding||0,p=2*nt,wt=e.atlas.state.size.width,bt=e.atlas.state.size.height,ot=this._canvas.get_size(),kt=ot.width/2,dt=ot.height/2,st=r.pixelScale/i,h=void 0,c=void 0,tt=void 0,l=void 0,a=void 0,it=void 0,rt=void 0,w=void 0,b=void 0,ut=void 0,ft=void 0,ht=void 0,ct=void 0,k=void 0,lt=void 0,et=void 0,at=0,vt=0,yt=void 0;for(y&&(et=new ArrayBuffer(v*80),lt=new DataView(et)),d=new ArrayBuffer(v*Float32Array.BYTES_PER_ELEMENT*4),pt=new DataView(d),k=0;k<v;k++)h=e.renderedRecords[k],tt=h.disableExtrusion,y&&(c=e.atlas.records.getItem(h.id),l=c.width,a=c.height,it=h.left+l/2/i,rt=h.top+a/2/i,l+=p,a+=p,tt&&(l/=r.pixelScale,a/=r.pixelScale),w=it,b=rt,ut=0,ft=0,h.anchor&&(w=h.anchor.x,b=h.anchor.y,ut=(w-it)*i,ft=(rt-b)*i),ht=(w-kt)/st,ct=(dt-b)/st,at=s.fillRectangleData(lt,at,ht,ct,l,a,c.atlasX-nt,c.atlasY-nt,c.textureWidth+p,c.textureHeight+p,-l/2-ut,-a/2-ft,wt,bt,tt)),vt=s.fillOneRectangleVisibleZoom(pt,vt,h.visibleZoom);y?(e.vertexBuffer=u.uploadBuffer(n,e.vertexBuffer,n.ARRAY_BUFFER,et),g=e.visibilityBuffer=u.uploadBuffer(n,g,n.ARRAY_BUFFER,d),yt=s.buildRectangleVertexIndex(v),e.elementIndexBuffer=u.uploadBuffer(n,e.elementIndexBuffer,n.ELEMENT_ARRAY_BUFFER,yt)):u.updateBuffer(n,g,n.ARRAY_BUFFER,0,d)}},n.prototype._mergeRenderData=function(n,t){var u=this.currentData,e,o,i,f,r;if(t)u.translation={},u.renderedRecords=n;else{for(e={},o=u.renderedRecords,i=0,f=n.length;i<f;i++)n[i].visibleZoom>=0&&(e[n[i].id]=!0);for(i=0,f=o.length;i<f;i++)r=o[i],r.visibleZoom>=0&&r.visibleZoom!==127&&!e[r.id]&&(r.visibleZoom=127)}return u},n.prototype._initRenderData=function(n){var i=this.currentData,r={records:new g(5e3),polygonZoom:{}},u=new g(500),f=new g(500),e=new g(2e3);i&&(i.polylineCache&&i.polylineCache.clear(),i.polygonCache&&i.polygonCache.clear(),i.vectorIconCache&&i.vectorIconCache.clear());n&&i?(i.dpr=n,i.renderedRecords=[],i.atlas=r,i.translation={},i.frame=null,i.polylineCache=u,i.polygonCache=f,i.vectorIconCache=e):i=this.currentData={textures:[],textureSizes:[],renderedRecords:[],vectorPriorityRecordCounter:0,atlas:r,translation:{translate:{x:0,y:0}},frame:null,dpr:n||t._getDpr(),maxTextureSize:this._maxTextureSize,polylineCache:u,polygonCache:f,vectorIconCache:e}},n.prototype.clear=function(){var t=this._context,n=this.currentData,i;if(n.textures&&n.textures.length>0){for(i=0;i<n.textures.length;i++)t.deleteTexture(n.textures[i]);t.deleteBuffer(n.elementIndexBuffer);t.deleteBuffer(n.vertexBuffer);t.deleteBuffer(n.visibilityBuffer);t.deleteBuffer(n.pointBuffer)}this._initRenderData(null);t.clear(t.COLOR_BUFFER_BIT)},n.prototype.dispose=function(){var n=this._context;n&&(this.clear(),this._program&&n.deleteProgram(this._program.glProgram),this._vectorProgram&&n.deleteProgram(this._vectorProgram.glProgram),this._canvas=null,this._program=null,this._context=null)},n._upsertAtlas=function(n,i,r){var c=!1,h=n.records,f,u,e,o,s;if(r&&(h.clear(),n.state=null,n.polygonZoom={}),i)for(f=0;f<i.length;f++)u=i[f],e=u.id,u.width>0&&u.height>0&&(o=h.getItem(e),o&&o.atlasX!==-1&&o.width!==0||(c=!0,s=t._copyObject(u),s.id=e,r&&(s.cached=!1),h.addItem(e,s)));return c},n._createVectorProgram=function(n,t){var i=u.createProgram(n,a.solidColorVertex(t),a.solidColorFragment);return{glProgram:i,a_position:n.getAttribLocation(i,"a_position"),u_PTMatrix:n.getUniformLocation(i,"u_PTMatrix"),u_halfScreen:n.getUniformLocation(i,"u_halfScreen"),u_color:n.getUniformLocation(i,"u_color"),u_extrusionScale:n.getUniformLocation(i,"u_extrusionScale"),u_depth:n.getUniformLocation(i,"u_depth")}},n}();rt=function(n){function i(t,i,r,u,f){var e=this,o=r;return t&&t.getMapOptions().serpMultiMapsAccessible&&(o+=t.getRootElement().parent().get_native_prop("id")),e=n.call(this,t,i,o,u,f)||this,l.Browser.is_safari&&l(window).add_event("pagehide",function(){e.dispose()}),e}return b(i,n),i.prototype.transformContainer=function(i){var r=n.prototype.transformContainer.call(this,i);return t._renderAllPoiAndLabelsGL()&&this._adapter&&this._adapter.render(this._map,null,null,null,0,!0,t._getDpr(),0),r},i.prototype.copyCanvas=function(t){var i,r;n.prototype.copyCanvas.call(this,t);i=this._adapter;i&&(i.draw(this._map),r=i.getCanvas()[0],t.drawImage(r,0,0,r.width,r.height))},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._canvasGL&&this._canvasGL.removeFromParent();t._clearDisposables([this._adapter,this._frameLoadedHandler]);t._nullifyClass(this)},i.prototype._positionCanvas=function(r,u){var f=this,e=n.prototype._positionCanvas.call(this,r),s=this._renderEntityTypes.indexOf(1)>-1,h,c,a;return r||(h=this._adapter,c=t._renderAllPoiAndLabelsGL(),h?c&&h.updateSize(e):i._adapterFailed||(a=function(){f._appendCanvas();try{var r=s?2048:256,n=o.features.labels;f._adapter=new it(f._canvasGL,e,r,f._map.getMapOptions().glVectorIcon,n.allowSoftwareGL,l.Browser.is_safari,n.preserveGLBuffer,n.displayLabelBoundaries);i._adapterFailed=!1}catch(u){console.warn(u);t._disableRenderGL();i._adapterFailed=!0}},c&&(s||u)?a():this._frameLoadedHandler||s&&(this._frameLoadedHandler=this._map.getFrameManager().frameRendered.addOne(a)))),e},i.prototype._drawLabels=function(r,u,f){var b,o,s,it,a,v,y,rt,w,c,nt,e,ft;if(t._renderAllPoiAndLabelsGL()){if(b=i._dataUpdateLevel(u,f),o=this._orderedLabels,o){var k=p._getSortedPriorityKeys(Object.keys(o)),tt={},l=[];for(h.clearTestHooksLog(h.LabelDrawOrderTag),s=0,it=k.length;s<it;s++){if(a=o[k[s]],v=Object.keys(a),!v.length){delete o[k[s]];continue}for(y=0,rt=v.length;y<rt;y++){var ut=v[y],d=a[ut],g=Object.keys(d);if(g.length)for(w=g.length-1;w>=0;w--)(c=g[w],r||b!==0||(nt=d[c],e=nt&&nt.region,!e||e.type!==1||(ft=e&&e.label&&e.label.data&&e.label.data.primitives&&e.label.data.primitives[0],ft.taintedTemplate||!t._renderAllPoiAndLabelsGL())))&&(tt[c]=d[c],l.unshift(c));else delete a[ut]}}}l&&l.length>0?(this._positionCanvas(u,!0),this._drawLabelsInLayerGL(tt,l,r,u,this._drawingContext,this._dpiScale,f,b)):this._adapter&&this._adapter.clear()}else n.prototype._drawLabels.call(this,r,u,f),!r&&this._adapter&&this._adapter.clear()},i.prototype._appendCanvas=function(){var i=this,n;this._canvasGL||(n=this._canvasGL=t._createElement("canvas"),n.set_attr("id",this._canvasId),n.set_attr("class","labelCanvas"),n.set_style({outline:"none",position:"absolute",zIndex:this._canvasZIndex}),this._map.getMode().getRootElement().append(n),l(n).add_event("webglcontextlost",function(n){i._handleRenderFailure(n)},!1))},i.prototype._handleRenderFailure=function(r){console.warn(r);t._disableRenderGL();i._adapterFailed=!0;this._adapter&&(this._adapter.dispose(),this._adapter=null);n.prototype.endDraw.call(this,this._currentLabelRenderingContext,this._isAnimationFrame)},i.prototype._drawLabelsInLayerGL=function(i,r,u,e,o,s,c,l){var k,v,p,a,y,tt,d;this._isAnimationFrame=e;var g=0,nt=[],b=o?o.getDevicePixelRatio():t._getDpr(),w,rt=this._adapter&&t._renderAllPoiAndLabelsGL(),it={};for(k=r.length-1;k>=0;k--)if(v=i[r[k]],h.logLabelDrawOrder(v.text),p=v.region,a=p.label.data.primitives[0],w=null,y=v.iconTemplates,!u||(tt=y&&y[0],d=vt.getClickable(a&&a.entity),d||(d=tt&&tt.getIsHitTestable()),d&&a&&a.layer)){if(p.type===1){if(!y||!y.length)continue;h.logPoiLayerStyleStart();u?this._renderHitTesting(y,a,v,p):f.Pushpin&&a instanceof f.Pushpin&&a.hasVectorIcon()?this._renderVectorIcon(b,y,a,s,p.anchor,l,it):w=this._renderTemplates(o,b,y,a,v,s,p,l);h.logPoiLayerStyleEnd(h.UserLogTag);h.logPushpinPrimitive(h.UserLogTag,a)}else v.style&&(rt?g+=this._drawTextLabelGL(v,b,u,e,nt):n.prototype._drawTextLabel.call(this,v,u,e));w&&(nt.push(w),w.cached||g++)}if(!u&&this._adapter)try{this._adapter.render(this._map,c,nt,it,g,e,b,l)}catch(ut){this._handleRenderFailure(ut)}},i.prototype._renderVectorIcon=function(n,t,i,r,u,f,e){var o,s,h;if(f!==0)for(o=0,s=t.length;o<s;o++)h=t[o].renderData(n,null,u.x,u.y,r,null,i),e[i.id]=[h]},i.prototype._renderTemplates=function(i,r,u,f,o,s,h,c){var l,y=this._adapter&&!f.taintedTemplate&&t._renderAllPoiAndLabelsGL(),a=h.anchor.x*s,v=h.anchor.y*s;return y?c!==0&&(l=e.packGLTemplates(i,this._adapter,r,u,f,o,s,a,v)):(f.taintedTemplate&&(this._taintedTemplatesExists=!0,n.prototype._validate2DCanvas.call(this)),e.renderCanvasTemplates(i,u,f,o,s,a,v)),l},i.prototype._drawTextLabelGL=function(r,u,f,e,o){for(var s,v,b,l=this._adapter&&this._adapter.currentData&&this._adapter.currentData.atlas.records,h,c,y=n.prototype._getTextLabelData.call(this,r,f,e,u),p=0,w=r.region.anchor,a=0,k=y.labels.length;a<k;a++)(s=y.labels[a],s.text.trim().length!==0)&&(c=s.text+s.font+s.style.styleDynamic.fontColor+s.rotation+s.outlineColor+s.outlineSize+s.relativePlacement+s.horizontalAlignment,v=l&&l.getItem(c),v?(h=t._copyObject(v),h.cached=!0):r.region&&r.region.orientation&&r.type===3?h=i._constructTextRecord2(s,w,u,c):(h=i._constructTextRecord(s,u,c),b=s.horizontalAlignment===2?-3*u:0,h.adjustX+=b),h.left=(s.x+s.anchorOffetX+h.adjustX)/u,h.top=(s.y+s.anchorOffetY+h.adjustY)/u,h.anchor=w,h.cached||(l.addItem(c,h),p++),h.visibleZoom=0,o.push(h));return p},i._dataUpdateLevel=function(n,i){var r;if(i)if(n)r=t._renderAllPoiAndLabelsGL()?3:0;else switch(i.cause){case 7:r=0;break;case 3:r=2;default:r=4}else r=0;return r},i._constructTextRecord2=function(n,t,u,f){var e=n.w*u,o=n.h*u,s=0,h=0,c=n.rotation,p=ft.fromPoints({x:0,y:0},{x:e,y:o}),l=new st(p,c).bbox,a=l.minPoint,v=l.maxPoint;e=v.x-a.x;o=v.y-a.y;s=e/2;h=o/2;e=Math.ceil(e);e+=e%2;o=Math.ceil(o);o+=o%2;var w=function(t,r,u){var f=0;switch(n.horizontalAlignment){default:case 1:f=-e;break;case 0:f=-e/2;break;case 2:f=e}i._drawText(t,n,n.textBaseline,r+s+f,u+h,e)},y=r.rotatePoint(n.anchorOffetX,-n.anchorOffetY,c),b=t.x*u-n.x-n.anchorOffetX-s-y.x,k=t.y*u-n.y-n.anchorOffetY-h-y.y;return{width:e,height:o,id:f,left:0,top:0,visibleZoom:0,adjustX:b,adjustY:k,drawFunc:w,atlasX:-1,atlasY:-1}},i._constructTextRecord=function(n,t,r){var f,u,o=0,h=0,c=n.rotation,v,s,y;if(n.w*=t,n.h*=t,c===0)f=n.w,u=n.h;else{var w=ft.fromPoints({x:0,y:0},{x:n.w,y:n.h}),l=new st(w,c).bbox,e=l.minPoint,a=l.maxPoint;f=a.x-e.x;u=a.y-e.y;o=-e.x;h=-e.y}return v=p._getVerticalAdjustment(n.relativePlacement).verticalAdjustmentRatio*u,f=Math.ceil(f),f+=f%2,u=Math.ceil(u),u+=u%2,s=h+v,y=function(t,r,u){i._drawText(t,n,n.textBaseline,r+o,u+s,n.w)},{width:f,height:u,id:r,left:0,top:0,visibleZoom:0,adjustX:-o,adjustY:-s,drawFunc:y,atlasX:-1,atlasY:-1}},i._drawText=function(n,t,i,r,u,f){var e=n.getRawContext();switch(t.horizontalAlignment){default:case 1:e.textAlign="left";break;case 0:e.textAlign="center";r+=f/2;break;case 2:e.textAlign="right";r+=f}e.textBaseline=i;e.font=t.font;t.rotation!==0||t.resetFont?(n.save(),e.translate(r,u),e.rotate(t.rotation),p._strokeAndFillText(e,t.style,t.text,0,0,!1,t.glowColor,t.glowSize,t.outlineColor,t.outlineSize),n.restore(t.resetFont)):p._strokeAndFillText(e,t.style,t.text,r,u,!1,t.glowColor,t.glowSize,t.outlineColor,t.outlineSize)},i}(p);rt.init();var kt=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return b(t,n),t.prototype._constructVectorLabel=function(){return new dt(this._map)},t}(wt),dt=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return b(t,n),t.prototype._constructRenderers=function(n,t){var i=[];return o.features.taskFramework.glMicroPoi&&!o.glPolyline&&i.push(new rt(n,t,"vectorgl",10099,[2])),i.push(new rt(n,t,"labelgl",20001,[1])),i},t}(bt),gt=function(n){function i(r,u,f,e){var s=n.call(this,r,null,f,e,i._vectorGLCanvasId,t._getDpr())||this;s._map=u;l.Browser.is_safari&&l(window).add_event("pagehide",function(){s.dispose()});try{s._adapter=new it(s._canvasElement,s._map.getActualSize(),o.glVec?2048:256,o.glPolyline||o.glVec,yt.allowSoftwareGL,l.Browser.is_safari,!0,!1,o.glVec);s._disposables.push(s._adapter)}catch(h){console.warn(h);w.glFailure=!0}return s}return b(i,n),i.prototype._setupCanvas=function(i){if(!this._canvasElement){var r=t._createElement("canvas");r.add_event("webglcontextlost",function(){w.glFailure=!0},!1);this._canvasElement=l(r)}n.prototype._setupCanvas.call(this,i)},i.prototype.transformCanvas=function(){o.glPolyline&&this._adapter&&this._adapter.render(this._map,null,null,null,0,!0,t._getDpr(),0,this._polygonSplit,this._triangulate)},i.prototype.clear=function(){this._adapter&&this._adapter.clear()},i.prototype.copyCanvas=function(n){var t=this._canvasElement[0];n.drawImage(t,0,0,t.width,t.height)},i.prototype.setTriangulate=function(n){this._triangulate=n},i.prototype.setPolygonSplit=function(n){this._polygonSplit=n},i.prototype._prepareCanvas=function(n){var t=new et(n.viewport.pixelWidth,n.viewport.pixelHeight);this._adapter&&this._adapter.updateSize(t)},i.prototype._drawTemplateRenderingResults=function(n,i,r,u){var v,f,e,o,c,y,p,s,l,a,h;if(!u)if(f=Object.keys(r),r&&f.length!==0||i&&i.length!==0)try{for(e=f.length>500,o=0,c=f;o<c.length;o++)for(y=c[o],p=r[y]||[],s=0,l=p;s<l.length;s++)a=l[s],e||(h=a.shapes||[],h.length>0&&h[0].points&&h[0].points.length>4e3&&(e=!0)),e&&(a.type=2);this._adapter.render(this._map,null,i,r,0,!1,t._getDpr(),4,this._polygonSplit,this._triangulate)}catch(b){console.warn(b);this.clear();w.glFailure=!0;v=n}else this.clear();return v},i.prototype._renderIconTemplates=function(n,t,i,r){var u=new at(i.crs,n);return u.project(i.geometry.x,i.geometry.y),e.packGLTemplates(t,this._adapter,this._dpr,r,i,null,1,u.lastProjectedX,u.lastProjectedY)},i.prototype._vectorEntitiesGL=function(){return(o.glPolyline||o.glVec)&&!w.glFailure},i.prototype._isStyleSupported=function(n){var r=!0,i,u,t;if(n)for(i=0;i<n.length;i++)if(u=n[i],u.shapes&&(t=u.style,t&&t.dashes&&t.dashes.length>0&&(r=tt.isSupported(t.dashes))),!r)break;return r},i.prototype._isCached=function(n){var t=this._adapter.currentData.polylineCache;return t&&!!t.getItem(n)},i._vectorGLCanvasId="vectorgl",i}(w),ni=function(n){function t(t,i,r){var u=n.call(this,null,i,r)||this;return u._icon=t,u}return b(t,n),t.prototype.getBounds=function(){var i=this._anchor.x,r=this._anchor.y,t=this._icon,n=t.radius+(t.strokeWidth>0?t.strokeWidth:0);return ft.fromSides(i-n,i+n,r-n,r+n)},t.prototype.renderData=function(n,t,i,r,u,e,o){var s,h;return o instanceof f.Pushpin&&o.hasVectorIcon()&&(h={points:[new v(i,r)]},s={glPriority:4,icon:o.getIcon(),type:1,shapes:[h]}),s},t}(lt);n._LabelControllerGL=kt;n._GLAdapter=it;n._GLOperation=u;n._GLPolygon=nt;n._GLPolyline=k;n._RenderHelper=e;n._RenderData=s;n._ShaderCode=a;n._VectorLayerRendererGL=gt;n._VectorIconTemplate=ni}catch(ct){if(f.logger)f.logger.logCriticalError(ct);else throw ct;}}).call(window)