(function(){try{var i=window.$MicrosoftMaps8,r=i.Internal,hr=i.Tasks=i.Tasks||{},a=i.Traffic=i.Traffic||{},cr=r.TaskData=r.TaskData||{},ii=i.Anchor,ct=r.BaseTask,lt=r.BaseTaskViewModel,lr=r._BaseMapTemplateSelector,ar=i.BitmapImageTemplate,ri=i.BucketPrimitiveTemplateSelector,at=r.ControlTemplate,ui=r.Control,nt=i.DataHandlerKeys,vr=i.Internal._Debug,yr=i.DefaultTemplateSelector,o=i.GlobalConfig,tt=i.GlobalDataEventHandler,pr=r._EntityHelper,wr=r._EntryPoints,br=r._FeatureNames,f=r._Gimme,u=r._Helper,fi=i.ImageryMapLayer,kr=i.ImageFromCssHelper,dr=i.InfoboxOptions,ut=r._JSEvent,ei=r._LatLonCrs,vt=r._LocalStorageCache,yt=i.LocationRect,oi=i.MapView,k=i.Location,h=r.MapHelper,si=i.MapsInfobox,hi=r.MapInteractionBehavior,pt=i.MapMath,d=i.MapTypeId,st=r._Network,gr=r._Observable,wt=r._ObservableObject,bt=r._ObservableCollection,ci=r._Overlay,kt=r._OverlayEntity,li=r.CameraMiniOverlayTemplate,dt=i.Point,ft=i.PrimitiveOverlayHelper,ai=r.PyramidTileSpatialIndex,vi=i.RasterImageryScene,yi=i.MercatorCubeCrs,nu=i.Rectangle,n=i.ResourceManager.MapDelay,tu=r._TaskDataHandlerHelper,et=i.TaskTypes,t=o.features.traffic,pi=i.VectorMapLayer,v=o.features.xsr,wi=i.ZoomLevel,rt=r._MapAuthentication,bi='<div class="bm_cameraCardRoot" data-tag="cameraCardRoot">    <div class="backArrowDiv cameraBack">            <a class="commonButton backArrowButton trafficBackButton" event:click="onBackClick" href="#" role="button" data-tag="backToProblemTypeSelectButton">                <div class="trafficBackButtonText">                    <TextBlock Text="{Binding resources.L_TrafficBackButtonText}" />                <\/div>            <\/a>    <\/div>    <div class="cameraImgHolder">        <img src="{Binding cameraImageUrl}" style:display="{Binding IsImageError Converter=boolToNotDisplay}" class="cameraImg" data-tag="cameraImg" event:error="onImageError" />        <div style:display="{Binding IsImageError Converter=boolToDisplay}" class="cameraImageError">            <TextBlock Text="{Binding resources.L_CameraImageErrorText}"/>        <\/div>    <\/div>      <div class="copyright">        <TextBlock Text="{Binding copyright}"/>    <\/div>    <div class="cameraDisclaimer" style:display="{Binding disclaimer Converter=nullToDisplayNone}">        <TextBlock Text="{Binding disclaimer}"/>    <\/div><\/div>',ki='<div id="{Binding primitive.entity.id}" class="infoboxOverlay trafficInfoboxOverlay">\t<a href="#" class="dialogClose closeIcon" data-tag="Infobox.Close" event:click="onCloseClick" title="{StaticBinding resources.L_NavBarCloseRadialMenuToolTip_Text}" role="button" ><\/a>\t<div class="infoboxTitle">\t\t<TextBlock Text="{Binding primitive.entity.title}" />\t<\/div>\t    <img src="{Binding primitive.entity.cameraImageUrl}" width="320" /><\/div>',di='<div class="{Binding rootClassName}" data-tag="trafficCameraPopupRoot">    <a class="cameraClose" data-tag="cameraClose" role="button" aria-label="{StaticBinding resources.L_CameraCloseAriaLabel}"/>    <a class="customAction" data-tag="customAction" role="button" style:display="{StaticBinding customActionAriaLabel Converter=nullToDisplayNone}" aria-label="{StaticBinding customActionAriaLabel}"/>    <div class="cameraDesc" data-tag="cameraDesc">        <TextBlock Text="{Binding description}" />    <\/div>    <div class="trfcLoading loading"><\/div>    <img class="cameraImg loading" alt="{Binding altImageText}" data-tag="cameraImg"/>    <video class="cameraVideo loading" loop="" muted="" alt="{Binding altImageText}" data-tag="cameraVideo"/>    <div class="trfCamAgencyAttrib">        <TextBlock Text="{Binding copyright}" />    <\/div>    <div class="trfCamCtrl">        <div class="trfcPlayPause">            <svg class="trfcCtrlBtn trfcPlayBtn" width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M12.2221 5.68458C13.2586 6.25438 13.2586 7.74373 12.2221 8.31354L2.22259 13.8105C1.22292 14.36 -5.23707e-08 13.6367 0 12.496L5.04711e-07 1.50214C5.57082e-07 0.361374 1.22292 -0.361883 2.22259 0.187655L12.2221 5.68458Z" />            <\/svg>            <svg class="trfcCtrlBtn trfcPauseBtn" width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M9 1.5C9 0.671573 9.67157 0 10.5 0H12.5C13.3284 0 14 0.671573 14 1.5V14.5C14 15.3284 13.3284 16 12.5 16H10.5C9.67157 16 9 15.3284 9 14.5V1.5ZM0 1.5C0 0.671573 0.671573 0 1.5 0H3.5C4.32843 0 5 0.671573 5 1.5V14.5C5 15.3284 4.32843 16 3.5 16H1.5C0.671573 16 0 15.3284 0 14.5V1.5Z" />            <\/svg>        <\/div>        <div class="trfcProgress">            <div class="trfcProgressBarBack">                <div class="trfcProgressBarFront"><\/div>                <div class="trfcProgressSlider"><\/div>            <\/div>        <\/div>    <\/div><\/div>',gi='<div data-tag="incidentCardRoot">   <div class="backArrowDiv cameraBack">            <a class="commonButton backArrowButton trafficBackButton" event:click="onBackClick" href="#" role="button" data-tag="backToProblemTypeSelectButton">                <div class="trafficBackButtonText">                    <TextBlock Text="{Binding resources.L_TrafficBackButtonText}" />                <\/div>            <\/a>    <\/div>    <div>        <div class="incidentTitleRoot">            <div class="incidentTitle" data-tag="incidentTitle"> <TextBlock Text="{Binding incidentTitle}" /><\/div>            <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity"><span><TextBlock Text="{Binding severity}" /><\/span><\/p>        <\/div>        <div class="incidentDescriptionRoot">            <p class="incidentDescription"  data-tag="trafficDescription">            <TextBlock Text="{Binding trafficDescription}" /><\/p>            <p class="incidentTime" data-tag="start">            <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span><span><TextBlock Text="{Binding start}" /><\/span><\/p>            <p class="incidentTime" data-tag="end">            <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span><span><TextBlock Text="{Binding end}" /><\/span><\/p>        <\/div>    <\/div><\/div>',nr='<div data-tag="trafficCardRoot">    <div class="contentRoot trafficCard">        <div class="moduleRoot" data-tag="legendRoot">            <p class="moduleTitle" data-tag="legendTitle" aria-label="{Binding resources.L_TrafficLegendsTitle}" tabindex="0"><TextBlock Text="{Binding resources.L_TrafficLegendsTitle}" /><\/p>            <div class="legendTable" data-tag="legendContainer">                <table role="presentation">                    <tbody>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsHeavyAriaLabel}" >                                        <div class="legendHeavy" data-tag="legendHeavy"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendHeavyText"><TextBlock Text="{Binding resources.L_TrafficLegendsHeavy}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsLightAriaLabel}">                                        <div class="legendLight" data-tag="legendLight"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendLightText"><TextBlock Text="{Binding resources.L_TrafficLegendsLight}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsModerateAriaLabel}">                                        <div class="legendModerate" data-tag="legendModerate"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendModerateText"><TextBlock Text="{Binding resources.L_TrafficLegendsModerate}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsNoTrafficAriaLabel}">                                        <div class="legendNoTraffic" data-tag="legendNoTraffic"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendNoTrafficText"><TextBlock Text="{Binding resources.L_TrafficLegendsNoTraffic}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsClosedAriaLabel}">                                        <div class="legendClosed" data-tag="legendClosed"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendClosedText"><TextBlock Text="{Binding resources.L_TrafficLegendsClosed}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                    <\/tbody>                <\/table>            <\/div>        <\/div>            <\/div>    <ItemsControl ItemsSource="{Binding modules}" PanelTagName="ul">      <ItemsControl.ItemTemplate>        <DataTemplate>                <li class="contentRoot trafficCard" style:display="{Binding showModule Converter=boolToDisplay}">                    <div class="moduleRoot recentCameras" data-tag="moduleRoot">                        <p class="moduleTitle" data-tag="moduleTitle"><TextBlock Text="{Binding title}" /><\/p>                        <div>                            <ItemsControl ItemsSource="{Binding collection}" PanelTagName="ul">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <li class="{Binding incidentType Converter=typeToClass}" data-tag="moduleItem {Binding incidentType Converter=typeToClass}" style:display="{Binding show Converter=boolToDisplay}">                                            <a href="#" event:click="onModuleItemClick" role="button" aria-label="{Binding incidentAriaLabel}">                                                <div style:display="{Binding incidentType Converter=cameraTypeToDisplay}">                                                    <div class="camPreviewPlaceHolder" data-tag="imgPreviewPlaceHolder">                                                        <img src="{Binding cameraImageUrl}" alt="{Binding altDescription}" class="imgPreview" style:display="{Binding IsImageReady Converter=boolToDisplay}" event:error="onImageError" />                                                        <video loop="" muted="" autoplay="" src="{Binding cameraVideoUrl}" id="{Binding videoPreviewId}" class="videoPreview" style:display="{Binding IsVideoReady Converter=boolToDisplay}" alt="{Binding altDescription}" />                                                    <\/div>                                                    <div class="cameraTitle" data-tag="cameraTitle">                                                        <TextBlock Text="{Binding incidentTitle}" />                                                    <\/div>                                                <\/div>                                                <div style:display="{Binding incidentType Converter=incidentTypeToDisplay}" class="incidentContainer" data-tag="incidentContainer">                                                    <div class="tableCell">                                                        <div class="{Binding incidentType Converter=incidentTypeToIconClass}" data-tag="incidentIcon"><\/div>                                                    <\/div>                                                    <div class="tableCell">                                                        <div class="trafficDescriptionText" data-tag="incidentTrafficDescription"><TextBlock Text="{Binding trafficDescription}" /><\/div>                                                        <div class="trafficDescriptionText" data-tag="incidentSeverity"><TextBlock Text="{Binding severity}" /><\/div>                                                    <\/div>                                                <\/div>                                            <\/a>                                            <a href="#" class="removeRecentCamera" role="button" event:click="onRemoveRecentCameraClick" aria-label="{Binding removeCameraAriaLabel}" data-tag="removeRecentCameraLink">                                            <\/a>                                        <\/li>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                        <a href="#" class="removeAllRecentCameras" event:click="onRemoveAllRecentCamerasClick" data-tag="removeAllRecentCamerasLink" role="button">                            <div class="removeAllRecentCamerasText" data-tag="removeAllRecentCamerasText"><TextBlock Text="{Binding resources.L_TrafficRemoveAllRecentCamerasLink}" /><\/div>                        <\/a>                        <a href="#" class="moreLink" style:display="{Binding showMoreLink Converter=boolToDisplay}" event:click="onMoreClick" data-tag="moreLink" role="button">                            <div class="moreLinkText" data-tag="moreLinkText"><TextBlock Text="{Binding moreLinkText}" /><\/div>                            <div data-tag="arrow" class="{Binding arrowClass}"><\/div>                        <\/a>                        <div class="clear"><\/div>                    <\/div>                <\/li>            <\/DataTemplate>                  <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <div class="cameraSettings" tabindex="0" event:keyup="onCamerasKeyUp" event:click="onCamerasClick" role="checkbox" aria-checked="{Binding ariaChecked}">        <div class="switchSlot labelToggle" for="cameraToggleInput">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch" id="toggleSwitchLabel" title="{Binding resources.L_TrafficsToggleCameras}" data-tag="cameraToggleSwitch">                    <input id="cameraToggleInput" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" aria-hidden="true" aria-labelledby="{Binding camerasToggleUniqueId}" aria-checked="{Binding ariaChecked}"/>                    <label class="labelToggle_label" id="{Binding camerasToggleUniqueId}">                        <TextBlock Text="{Binding resources.L_TrafficsToggleCameras}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div class="zoomInNotification" style:display="{Binding showCameraNotification Converter=boolToDisplay}" data-tag="zoomInNotification">            <TextBlock Text="{Binding cameraNotification}" />        <\/div>    <\/div><\/div>',tr='<div class="trafficLegend" data-tag="trafficLegend">    <div class="tlGroup">        <div class="tlLegend">            <span class="tlSlow" data-tag="tlSlow"><TextBlock Text="{StaticBinding resources.L_TrafficLegendsSlow}" /><\/span>            <span class="tlFast" data-tag="tlFast"><TextBlock Text="{StaticBinding resources.L_TrafficLegendsFast}" /><\/span>            <div class="tlKey" data-tag="tlKey"><\/div>        <\/div>    <\/div><\/div>',ir='<div class="infoboxOverlay trafficMiniInfobox">    <p>        <span><TextBlock Text="{Binding primitive.entity.trafficDescription}" /><\/span>    <\/p>    <p>        <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span>        <span><TextBlock Text="{Binding primitive.entity.start}" /><\/span>    <\/p>    <p>        <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span>        <span><TextBlock Text="{Binding primitive.entity.end}" /><\/span>    <\/p><\/div>',rr='<div id="{Binding primitive.entity.id}" class="infoboxOverlay trafficInfoboxOverlay">\t<a href="#" class="dialogClose closeIcon" data-tag="Infobox.Close" event:click="onCloseClick" title="{StaticBinding resources.L_NavBarCloseRadialMenuToolTip_Text}" role="button" ><\/a>\t<div class="infoboxTitle">\t\t<TextBlock Text="{Binding primitive.entity.title}" />\t<\/div>\t<div class="trafficInfo">\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupSeverity_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.severity}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupDescription_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.trafficDescription}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.start}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.end}" /><\/span>\t\t<\/p>\t<\/div><\/div>',y=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ot=function(n){function t(i){var r=n.call(this,i.description,null)||this;return r.id="TCAM"+t._cameraId++,r.trafficDescription=i.description,r.cameraImageUrl=i.images&&i.images.length&&i.images[0].imageUrl,r.collisionBehavior=2,r}return y(t,n),t._cameraId=1,t}(kt),ur=function(){function i(i){i&&(this.altImageText=n.L_TrafficCurrentCameraImage_Text.replace("{0}",i.description),this.description=i.description,this.copyright=i.copyright,this.rootClassName="bm_trfcCamWrapper".concat(t.cameraAnimationEnabled?" camAnimation":""))}return i}(),fr=function(n){function t(t){var i=n.call(this)||this;return i.type=et.trafficFlipTask,i._controlTemplateFactory=t,i.displayState={colorIndex:6,groupName:"Traffic"},i}return y(t,n),t.prototype.activate=function(i,r){var u,f;r&&(this._taskState=r,u=r.incident,u&&u.type===12&&(this._taskState.location=new k(u.point.coordinates[0],u.point.coordinates[1]),this._taskState.description=u.description));this.setTitle(this._taskState.incident.description);n.prototype.activate.call(this,i,r);l.trafficTaskId=this.id;f=this._viewModel=new it(this._controlTemplateFactory,this._taskState.incident,i);s.selectedPin||(s.selectedPin=new g(this._taskState.incident),s.selectedPin.updatePinIcon(1));f.pin=s.selectedPin;this.addControl(f.getControl());t.trafficTaskId=this.id;this._taskState.incident.type===12&&(w.saveIncident(this._taskState.incident),l.mostRecentCameras.push(f));this.setPercentLoaded(1)},t.close=function(){var n={action:"remove",id:t.trafficTaskId};tt.invokeHandler(nt.taskDataHandlerKey,n)},t.prototype.deactivate=function(){var t=s.selectedPin;t&&this._viewModel.incidentData&&this._viewModel.incidentData.incidentId===t.incident.incidentId&&(t.updatePinIcon(0),s.selectedPin=null);n.prototype.deactivate.call(this)},t.prototype.processCallback=function(){},t.prototype.serialize=function(){return this._taskState},t.prototype.setDisplayState=function(i){n.prototype.setDisplayState.call(this,i);t.trafficTaskId=this.id},t.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},t.prototype.isSharable=function(){return!1},t.prototype.hasDefaultFocusElement=function(){return!0},t}(ct),er=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a){a===void 0&&(a=256);var v=n.call(this,t,i,r,u,f,e,o,s,h,c,l,a)||this;return v._disposables.push(v.mapTypeChanged=new ut),t&&(v._disposables.push(v._map.mapTypeChanged.add(function(n){return v._onMapTypeChanged(n)})),t.getMapType().id===d.roadDark&&(v.addDarkStyleToUrl(),v.tileUrlTemplateChanged.invoke(v))),v}return y(t,n),t.prototype._onMapTypeChanged=function(n){n&&(n.oldMapTypeId===d.roadDark||n.newMapTypeId===d.roadDark)&&(n.newMapTypeId===d.roadDark?this.addDarkStyleToUrl():this.removeDarkStyleFromUrl(),this.tileUrlTemplateChanged.invoke(this))},t.prototype.addDarkStyleToUrl=function(){typeof this._tileUrlTemplate=="string"&&this._tileUrlTemplate.indexOf(t.CSTL_DARK_TRAFFIC)===-1&&(this._tileUrlTemplate+=t.CSTL_DARK_TRAFFIC)},t.prototype.removeDarkStyleFromUrl=function(){typeof this._tileUrlTemplate=="string"&&(this._tileUrlTemplate=this._tileUrlTemplate.replace(t.CSTL_DARK_TRAFFIC,""))},t.CSTL_DARK_TRAFFIC="&cstl=vbd",t}(vi),s=function(){function r(i,u,f,e){var o=this,s;this._map=i;this._perfLog=f;this._layer=new pi("TrafficIncidents_"+hi.getUniqueId(),this,new ri(i),t.incidentsLayerZIndex);this._layer.setRenderTarget(1);this.inflateRegionOnDataFetch=!0;this._refreshInterval=t.incidentsLayerRefreshInterval;this._incidentPins={};this._incidentExpirationTimes={};this.invalidated=new ut;this.resources=n;this.spatialIndex=new ai(2);this._trafficLayer=e;this._controlTemplateFactory=u;this._cameraOverlay=this._constructOverlay(u,ki);this._primitiveOverlay=this._constructOverlay(u,rr);this._primitiveMiniOverlay=this._constructOverlay(u,ir);this._cameraMiniOverlay=this._constructOverlay(u,li);this._infoboxOptions={showCloseButton:!1,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0};s=this._disposables=[this._layer.primitiveTapped.add(function(n){o._onPrimitiveTapped(n)}),this._layer.primitiveHoverStarted.add(function(n){o._onPrimitiveHoverChanged(n,!0)}),this._layer.primitiveHoverStopped.add(function(n){o._onPrimitiveHoverChanged(n,!1)})];v.enableTrafficRefresh&&s.push(i.mapTapped.add(function(){var n;if((n=r.selectedPin)!==null&&n!==void 0)return n.updatePinIcon(0)}));this._layer.overlayEvent=0}return r.prototype._constructOverlay=function(n,t){return{overlayTemplate:n({templateText:t,staticResources:this}),overlayAnchor:new ii(-10,-10)}},r.prototype._showAndLogIncident=function(n){if(n){var t=b.getInstance();t.initialize(this._map,this._controlTemplateFactory);t.show(n,!0);this._logTrafficInstrumentation(n.incident,b.isCamera(n)?2:1)}},r.prototype._onPrimitiveHoverChanged=function(n,i){var u=n&&n.primitive,h,f,e,s;i?!o.isMapsVertical||u.entity instanceof ot?(this._overlayPrimitive&&ft.hideOverlay(this._map,this._overlayPrimitive),t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled?(this._showAndLogIncident(u),v.enableTrafficRefresh&&this._updateHoveredPin(u)):(h=u.entity instanceof ot?this._cameraMiniOverlay:this._primitiveMiniOverlay,ft.showOverlay(this._map,h,u)),this._overlayPrimitive=u):(f=u.entity,e=new k(f.point.coordinates[0],f.point.coordinates[1]),this._infoboxOptions.offset=new dt(10,10),this._infoboxOptions.location=e,this._infoboxOptions.htmlContent=this._getInfoBoxHtmlContent(f),t.trafficIncidentV2Enabled?this._showAndLogIncident(u):this._infobox?this._infobox.setOptions(this._infoboxOptions):(this._infobox=new si(e,this._infoboxOptions),this._infobox.setMap(this._map)),v.enableTrafficRefresh&&this._updateHoveredPin(u)):(this._infobox&&this._infobox.getVisible()&&(this._infobox.preventAutoClose||this._infobox.setOptions({visible:!1,closeDelayTime:800})),this._overlayPrimitive&&(ft.hideOverlay(this._map,u),this._overlayPrimitive=null),(t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled)&&b.getInstance().hide(!0),s=u,v.enableTrafficRefresh&&r.selectedPin!==s&&s.updatePinIcon(0))},r.prototype._updateHoveredPin=function(n){r.selectedPin&&(r.selectedPin.updatePinIcon(0),r.selectedPin=null);n.updatePinIcon(2)},r.prototype._logTrafficInstrumentation=function(n,t,i){var u=t===2||t===3?i?e.CAMCLK:e.CAMHVR:i?e.INCCLK:e.INCHVR,r={};r.IUT=t;r.Z=h.getMercatorZoomLevel(this._map);t===1&&(r.ST=n.severity,r.IT=n.type,r.IC=n.roadClosed,r.IID=n.incidentId);p.logInstrumentationEvent(u,r)},r.prototype._onPrimitiveTapped=function(n){var l,r,c,s,a,f;(u._isLargeMapShownOnSerp()||o.isMapsVertical||o.isMsftPartner)&&(l=n.primitive,r=l,this._overlayPrimitive&&(ft.hideOverlay(this._map,this._overlayPrimitive),this._overlayPrimitive=null),s=r.incident,s.type===12?(c=2,a=this._cameraOverlay):(c=1,a=this._primitiveOverlay),this._overlayPrimitive&&i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive),this._overlayPrimitive=null,r.select(!0),this._logTrafficInstrumentation(r.incident,b.isCamera(r)?2:1,!0),t.trafficCameraV2Enabled&&this._trafficLayer&&this._trafficLayer.updateRecentCameras&&r.incident&&r.incident.type===12&&this._trafficLayer.updateRecentCameras.invoke(r.incident),f={},f.IUT=c,f.Z=h.getMercatorZoomLevel(this._map),f.ST=s.severity,f.IT=s.type,f.IC=s.roadClosed,f.IID=s.incidentId,p.logInstrumentationEvent(e.ID,f))},r.prototype.onCloseClick=function(n){n.preventDefault();i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null},r.prototype.show=function(){var n=this._map.getLayers();n.indexOf(this._layer)<0&&n.insert(this._layer)},r.prototype.hide=function(){this._overlayPrimitive&&i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null;r.selectedPin&&r.selectedPin.updatePinIcon(0);r.selectedPin=null;this._infobox&&(this._infobox.setOptions({visible:!1}),this._infobox.preventAutoClose=!1);this._map.getLayers().remove(this._layer)},r.prototype.toggleCameras=function(){this._hideCameras=!this._hideCameras;this._incidentExpirationTimes={};this._map.getLayers().remove(this._layer);this._map.getLayers().insert(this._layer);p.logInstrumentationEvent(e.TC,{CTO:!this._hideCameras})},r.prototype.getCamerasHidden=function(){return this._hideCameras},r.prototype.getPrimitives=function(n,i){var r=h.getMercatorZoomLevel(this._map);r>=t.minZoomLevelToShowIncidents?this._updateTraffic(n,i,r):i({primitives:[]})},r.prototype.getDataUniquenessKey=function(n){var i=yt.fromRegionId(n),t=this._getBoundingBoxKey(i),r=this._incidentExpirationTimes[t];return t+"_"+r},r.prototype._updateTraffic=function(n,i,r){var u=this,s=this._getSeverityFilters(),e=yt.fromRegionId(n),f=this._getBoundingBoxKey(e),o;if(this._isIncidentFileExpired(f)){if(o=this._getTrafficIncludeItemsParam(r),!o)return i({primitives:[]});rt.instance.authenticateClientAndRetrieveSessionId(function(n){var c=t.incidentsUrlFormat.replace("{bounds}",f).replace("{sev}",s).replace("{credentials}",n),h;c+=o;u._perfLog&&(h=null,h=u._perfLog.start("T_IR"));st.downloadJsonp(c,"trfinc",function(n,t){return u._processIncidents(n,t,r,e)},function(n){return u._processErrors(n)},null,!1,{key:f,callback:i,state:h},3)})}else this._addIncidentPins(f,i,r,e)},r.prototype._getTrafficIncludeItemsParam=function(n){var i=[],r=this._map.getMapOptions().trafficOptions;return(u._isLargeMapShownOnSerp()||o.isMapsVertical||r&&r.camerasVisible)&&n>t.minZoomForAllCameras&&!this._hideCameras&&i.push("cameras"),r&&r.incidentsVisible===!1||i.push("incidents"),i.length&&"&includeItems=".concat(i.join("|"))},r.prototype._processIncidents=function(n,t,i,r){var s=t.state,f,e,o,u,h;for(s&&s.end(),f=t.key,this._incidentExpirationTimes[f]=Date.now()+this._refreshInterval,e=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0].resources,o=[],u=0,h=e.length;u<h;u++)o[u]=new g(e[u]);this._incidentPins[f]=o;this._addIncidentPins(f,t.callback,i,r)},r.prototype._processErrors=function(n){var t=n.state;t&&t.end()},r.prototype._addIncidentPins=function(n,i,r,u){var o=this._incidentPins[n],s=[],l,h,e,f;if(o){for(l=o.length,e=0;e<l;e++)f=o[e],h=c.findExistingRecentCamera(f.incident),h>=0&&(f=c.recentCameraVMs[h].pin),this._shouldShowIncident(f.incident,r)&&(f.layer=this._layer,s.push(f));if(r<=t.minZoomForAllCameras&&!this._hideCameras)for(e=0;e<c.recentCameraVMs.length;e++)f=c.recentCameraVMs[e].pin,f&&u.contains(f.getLocation())&&(f.layer=this._layer,s.push(f));i({primitives:s})}},r.prototype._shouldShowIncident=function(n,i){var r=!0;switch(n.type){case 2:r=!1;break;case 4:r=n.severity!=1;break;case 11:r=n.severity>2}if(r)switch(n.severity){case 1:r=i>t.minZoomForLowImpactIncidents;break;case 2:r=i>t.minZoomForMinorIncidents;break;case 0:r=i>t.minZoomForAllCameras}return r},r.prototype._getSeverityFilters=function(){var n="",t=h.getMercatorZoomLevel(this._map);return t<=9?n="4":t<=10?n="3,4":t<=12&&(n="0,2,3,4"),n},r.prototype._isIncidentFileExpired=function(n){var t=this._incidentExpirationTimes[n];return!t||Date.now()>t},r.prototype._getBoundingBoxKey=function(n){return[n.getSouth(),n.getWest(),n.getNorth(),n.getEast()].join(",")},r.prototype._getInfoBoxHtmlContent=function(n){return'<div class="trafficInfobox" data-tag="trafficInfobox"><div class="bm_ib_title" data-tag="trafficInfoBoxTitle"><span>'+n.trafficDescription+'<\/span><\/div><div class="bm_ib_metadata_noImg" data-tag="trafficInfoboxData"><span>'+this.resources.L_TrafficPopupStartTime_Text+"<\/span> <span>"+n.start+'<\/span><\/div><div class="bm_ib_metadata_noImg" data-tag="trafficInfoboxData"><span>'+this.resources.L_TrafficPopupEstEndTime_Text+"<\/span><span>"+n.end+"<\/span><\/div><\/div>"},r.prototype.dispose=function(){this.hide();u._clearDisposables(this._disposables)},r}(),b=function(){function i(){}return i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.initialize=function(t,i){var r=this;this._initialized||(this._map=t,this._controlTemplateFactory=i,this._hoverInstatiated=!1,this.resources=n,rt.instance.authenticateClientAndRetrieveSessionId(function(n){r._trafficCameraCreds=n}),t.mapTapped.add(function(){return r.hide()}),t.mapTypeChanged.add(function(n){return r._onMapTypeChanged(n)}),this._initialized=!0)},i.prototype.hide=function(n){this._currentCamInfobox&&(!n||n&&this._hoverInstatiated)&&(this._currentCamInfobox.setOptions({visible:!1,closeDelayTime:300}),this._hoverInstatiated=!1,this._shownIncidentId=null)},i.prototype.show=function(n,t,r){var s=this,e,o,u;this._currentCamInfobox&&this.hide();n&&n.incident&&(e=n.incident,this._hoverInstatiated=t,this._shownIncidentId=e.incidentId,o=i.isCamera(n),u={showCloseButton:!1,showPointer:!0,visible:!0,htmlContent:null,location:null,autoAlignment:!0},u.htmlContent=this._getHtmlContentForIncident(e,o,r),u.visible=!0,u.location=new Microsoft.Maps.Location(n.geometry.y,n.geometry.x),u.offset=new dt(6,6),this._currentCamInfobox?this._currentCamInfobox.setOptions(u):(this._currentCamInfobox=new Microsoft.Maps.Infobox(location,u),this._currentCamInfobox.setMap(this._map)),this._bindPopupClickHandlers(".cameraClose",function(n){s._onCloseClick(n)}),this._bindPopupClickHandlers(".customAction",function(){s._onCustomActionClick(e)}),f("".concat(i._trafficCamClsPrefix)).getParent().add_class("bm_trfcCam"),!t&&o&&w&&w.saveIncident(e),o&&this._trafficCameraCreds&&i.getCameraVisualUrl(e,this._trafficCameraCreds,!1,function(n,t,i){return s._onCameraVisualUrlResult(n,t,i)}))},i.prototype.setPopupCustomAction=function(n,t){this._onCustomActionClick=n;this._customActionAriaLabel=t},i.isCamera=function(n){return n.incident.images&&n.incident.images.length>0},i.prototype.nullToDisplayNone=function(n){return n?"":"none"},i.getCameraVisualUrl=function(n,t,r,u){var f=i.getCameraSrcUrl(n,t,r);f.indexOf("data:image")>-1?u(n,f,!1):st.downloadGeneric(f,"cameraVisual",function(t){return i._onCameraVisualBlobResponse(n,f,t,u)},"blob",function(){u(n,null,!1)})},i.getCameraSrcUrl=function(n,i,r){var s=n.images&&n.images.length>0?n.images[0]:null,u=s&&s.imageUrl;if(u&&u.indexOf("data:image")>-1)return u;var f=t.cameraUrlFormat.replace("{imageUrl}",u?u+(r?"&routeCamera=1":""):"").replace("{credentials}",i).replace("{cmnPltParam}",o.platformCommonParam),e="&setfeatures=",h="".concat(e,"mp4cameras"),c=f.indexOf(e);return c===-1?f+=h:f=f.replace(e,"".concat(h,",")),f},i.prototype._onMapTypeChanged=function(n){n.newMapTypeId!==n.oldMapTypeId&&n.newMapTypeId===d.streetside&&this.hide()},i._onCameraVisualBlobResponse=function(n,t,i,r){var f="video/mp4",u,e;i.type===f?(u=new FileReader,u.onloadend=function(){var t;try{var e=u.result,i=atob(e.slice(e.indexOf(",")+1)),o=new Array(i.length);for(t=0;t<i.length;t++)o[t]=i.charCodeAt(t);var s=new Uint8Array(o),h=new Blob([s],{type:f}),c=URL.createObjectURL(h);r(n,c,!0)}catch(l){r(n,null,!0)}},u.readAsDataURL(i)):(e=URL.createObjectURL(i),r(n,e,!1))},i.prototype._onCameraVisualUrlResult=function(n,i,r){var f=this,u;i&&this._shownIncidentId===n.incidentId&&(u=this._getCameraVisualGimme(r),r&&u[0]&&(this._cameraVideo=u[0],t.cameraAnimationAutoPlay&&u.set_attr("autoplay",""),u.add_event("loadeddata",function(){f._setUpAnimationHandlers()}),u.add_event("timeupdate",function(){f._cameraVideo&&f._setAnimationProgressUI(f._cameraVideo.currentTime/f._cameraVideo.duration)})),u.set_attr("src",i),this._removeSpinner(r))},i.prototype._removeSpinner=function(n){var t="loading",r="loaded";f("".concat(i._trafficCamClsPrefix," .trfcLoading")).swap_class(t,r);this._getCameraVisualGimme(n).swap_class(t,r)},i.prototype._onCloseClick=function(){this.hide()},i.prototype._setUpAnimationHandlers=function(){var n=this,r;f("".concat(i._trafficCamClsPrefix," .").concat(t.cameraAnimationAutoPlay?"trfcPauseBtn":"trfcPlayBtn")).add_class(i._camBtnActiveCls);f("".concat(i._trafficCamClsPrefix," .trfCamCtrl")).set_style({display:"flex"});r=f("".concat(i._trafficCamClsPrefix," .trfcPlayPause"));r.length&&(r[0].onclick=function(){var t=n._cameraVideo&&n._cameraVideo.paused;n._playOrPauseCameraAnimation(t,!0)});this._setUpAnimationSliderHandlers()},i.prototype._setUpAnimationSliderHandlers=function(){var n=this,o=f("".concat(i._trafficCamClsPrefix," .trfCamCtrl")),s=f("".concat(i._trafficCamClsPrefix," .trfcProgressSlider"));if(this._cameraVideo&&o.length&&s.length){this._setAnimationProgressUI(0);var r=o[0],h=s[0],t=!1,c=0,l=0,p=36,a=254,v=function(t,i,r){var h=u._clamp(t.pageX-c+l,0,a),f=n._cameraVideo.duration,e=h/a,o=i?Math.round(e*f)/f:e,s;n._setAnimationProgressUI(o);r&&(s=o*f,n._cameraVideo.currentTime=s)},y=function(i){t&&(t=!1,v(i,!1,!0),n._logCameraAnimationInteractions(e.CAMDRAG))},w=function(n){n.preventDefault();n.stopPropagation()};h.onpointerdown=function(i){w(i);n._playOrPauseCameraAnimation(!1,!1);t=!0;l=h.offsetLeft-p;c=i.pageX};r.onpointermove=function(n){t&&v(n,!1,!1)};r.onpointerup=function(n){y(n)};r.onpointerleave=function(n){y(n)}}},i.prototype._setAnimationProgressUI=function(n){var t=100*n;f("".concat(i._trafficCamClsPrefix," .trfcProgressBarFront")).set_style({width:"".concat(t,"%")});f("".concat(i._trafficCamClsPrefix," .trfcProgressSlider")).set_style({marginLeft:"calc(-8px + ".concat(t,"%)")})},i.prototype._playOrPauseCameraAnimation=function(n,t){if(this._cameraVideo){var o=f("".concat(i._trafficCamClsPrefix," .trfcPlayBtn")),s=f("".concat(i._trafficCamClsPrefix," .trfcPauseBtn")),r=i._camBtnActiveCls,u=null;n?(o.remove_class(r),s.add_class(r),this._cameraVideo.play(),u=e.CAMPLAY):(s.remove_class(r),o.add_class(r),this._cameraVideo.pause(),u=e.CAMPAUSE);t&&this._logCameraAnimationInteractions(u)}},i.prototype._getHtmlContentForIncident=function(n,t,i){var f=this,u="",e={severityTypeToClass:function(n){return it.ConvertSeverityTypeToClass(n)},nullToDisplayNone:function(n){return f.nullToDisplayNone(n)},customActionAriaLabel:this._customActionAriaLabel,resources:this.resources};if(n){var o=t?di:a.IncidentPopupTemplate,s=t?new ur(n,this._trafficCameraCreds,i):new it(this._controlTemplateFactory,n,this._map),h=new at(o,e),r=h.applyDataTemplate(s);r&&r.length>0&&(u=r[0].outerHTML)}return u},i.prototype._bindPopupClickHandlers=function(n,t){Microsoft.Maps.setTimeout(function(){var r=f("".concat(i._trafficCamClsPrefix," ").concat(n));r&&r.length&&(r[0].onclick=function(n){return t(n)})},0)},i.prototype._getCameraVisualGimme=function(n){return f("".concat(i._trafficCamClsPrefix," ").concat(n?".cameraVideo":".cameraImg"))},i.prototype._logCameraAnimationInteractions=function(n){var t=this._cameraVideo&&this._cameraVideo.duration;n&&t&&p.logInstrumentationEvent(n,{L:t})},i._trafficCamClsPrefix=".MicrosoftMap .bm_trfcCamWrapper",i._camBtnActiveCls="active",i}(),e;(function(n){n[n.A=1]="A";n[n.D=2]="D";n[n.ID=3]="ID";n[n.IH=4]="IH";n[n.ML=5]="ML";n[n.TC=6]="TC";n[n.TCF=7]="TCF";n[n.CAMCLK=8]="CAMCLK";n[n.CAMHVR=9]="CAMHVR";n[n.INCCLK=10]="INCCLK";n[n.INCHVR=11]="INCHVR";n[n.CAMPLAY=12]="CAMPLAY";n[n.CAMPAUSE=13]="CAMPAUSE";n[n.CAMDRAG=14]="CAMDRAG"})(e||(e={}));var p=function(){function n(){}return n.logInstrumentationEvent=function(t,i){var r={logData:{feature:n.featureName,action:e[t],data:i}};tt.invokeHandler(nt.instrumentationDataHandlerKey,r)},n.callMapSnRInstrumentation=function(){tt.invokeHandler(nt.callServerInstrumentationDataHandlerKey,{logData:{feature:"trfc",data:"traffic"}})},n.featureName="T",n}(),or=function(n){function i(i,r,u){var f=this,e={},o;return f=n.call(this,e)||this,e.defineProperty("isShowing",null,null,{defaultValue:!1}),f._map=i,f._controlTemplateFactory=r,f._perfLog=u,f.updateRecentCameras=new ut,o=f._map.getMapOptions(),o.trafficOptions.legendVisible&&f._addTrafficLegend(),f._trafficLayerOpacity=f._map.getConfig().liteMode?t.defaultTrafficLayerOpacityLiteMode:t.defaultTrafficLayerOpacity,f._disposables=[],f._disposables.push(i.mapTypeChanged.add(function(n){n.newMapTypeId===d.birdseye?(f._wasTrafficShowing=f.getIsShowing(),f._wasTrafficShowing&&f.toggle()):n.oldMapTypeId===d.birdseye&&f._wasTrafficShowing&&f.toggle()})),f}return y(i,n),i.prototype.getTrafficLayer=function(){return this.getIsShowing()?this._trafficMapLayer:null},i.prototype.show=function(n){var i,r,t;this.getIsShowing()||(this.setIsShowing(!0),this._perfLog&&(i=this._perfLog.start("T_LD"),r=this._map.getFrameManager(),i&&r&&r.frameRendered.addOne(function(){i.end()})),!l.isCardShowing&&o.isMapsVertical&&(t={},t.type=et.trafficTask,t.id=l.trafficTaskId,tt.invokeHandler(nt.taskDataHandlerKey,t),l.isCardShowing=!0),this.showTrafficMapLayer(),this.showIncidentsLayer(),p.logInstrumentationEvent(e.A,{EP:n,C:!0}),(n===1||n===3)&&p.callMapSnRInstrumentation(),this.showTrafficLegend())},i.prototype.hide=function(n,t){this.getIsShowing()&&(this.setIsShowing(!1),this._trafficMapLayer&&(this.hideTrafficMapLayer(),o.isSDK||(t?this._map.mapTapped.invoke(t):this._map.mapTapped.invoke()),this.hideIncidentsLayer()),w.commitChanges(),!n&&l.isCardShowing&&o.isMapsVertical&&l.close(),this.hideTrafficLegend(),p.logInstrumentationEvent(e.D,{}))},i.prototype.toggle=function(n){this.getIsShowing()?this.hide():this.show(n)},i.prototype.toggleCameras=function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.toggleCameras()},i.prototype.getCamerasHidden=function(){return this._trafficIncidentLayer&&this._trafficIncidentLayer.getCamerasHidden()},i.prototype.showTrafficLegend=function(){this._trafficLegendControl&&this._map.getMapOptions().trafficOptions.legendVisible&&this._trafficLegendControl.setVisible(!0)},i.prototype.hideTrafficLegend=function(){this._trafficLegendControl&&this._trafficLegendControl.setVisible(!1)},i.prototype.hideIncidentsLayer=function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.hide()},i.prototype.showIncidentsLayer=function(){var n=this._map.getMapOptions().trafficOptions||{};(n.incidentsVisible||n.camerasVisible)&&(this._trafficIncidentLayer||this.createTrafficIncidentsLayer(),this._trafficIncidentLayer&&this._trafficIncidentLayer.show())},i.prototype.hideTrafficMapLayer=function(){var n=this._map.getLayers();this._trafficMapLayer&&n&&n.indexOf(this._trafficMapLayer)>=0&&this._map.getLayers().remove(this._trafficMapLayer)},i.prototype.showTrafficMapLayer=function(){this._map.getMapOptions().trafficOptions.flowVisible&&(this._trafficMapLayer||this.createTrafficMapLayer(),this._trafficMapLayer&&this._map.getLayers().indexOf(this._trafficMapLayer)<0&&this._map.getLayers().insert(this._trafficMapLayer))},i.prototype.setOpacity=function(n){this._trafficLayerOpacity!=n&&(this._trafficLayerOpacity=n,this._trafficMapLayer&&this._trafficMapLayer.setOpacity(n))},i.prototype.dispose=function(){if(this.hideTrafficMapLayer(),n.prototype.dispose.call(this),u._clearDisposables(this._disposables),this._trafficIncidentLayer&&this._trafficIncidentLayer.dispose(),this._trafficIncidentLayer=null,this._trafficMapLayer&&this._trafficMapLayer.dispose(),this._trafficMapLayer=null,this._trafficLegendControl&&this._trafficLegendControl.dispose(),this._trafficLegendControl=null,this._map&&this._trafficLegendOverlay){var t=this._map.getOverlays();t&&t.remove(this._trafficLegendOverlay)}this._trafficLegendOverlay=null;this._perfLog=null},i.prototype._addTrafficLegend=function(){var n=this;this._trafficLegendControl=new gt;this.getIsShowing()||this.hideTrafficLegend();this._trafficLegendOverlay=new ni(this._trafficLegendControl);this._map.getOverlayManager().then(function(){n._map.getOverlays().insert(n._trafficLegendOverlay)})},i.prototype.createTrafficMapLayer=function(){var n=this;this._trafficMapLayer=new fi("Microsoft.Maps.Traffic",t.trafficLayerZIndex,this._trafficLayerOpacity,!1,!0,2,t.trafficTileCacheDuration,this._map.getMapOptions().enableCORS,!0,"TrafficLayer");rt.instance.authenticateClientAndRetrieveSessionId(function(i){var r=t.trafficUriFormat.replace("{credentials}",i);n._trafficMapLayer.addScene(10,new er(n._map,new oi(wi.toLocation(new k(0,0),0,!0)),yi.instance,"TrafficLayerV2",r,"",null),0)})},i.prototype.createTrafficIncidentsLayer=function(){this._trafficIncidentLayer=new s(this._map,this._controlTemplateFactory,this._perfLog,this)},i}(wt),gt=function(t){function i(){var i=t.call(this)||this;return i.setTemplate(new at(tr,{resources:n})),i}return y(i,t),i}(ui),ni=function(n){function t(t){var i=this;return t&&(i=n.call(this,t.getRootElement(),null,null)||this),i}return y(t,n),t}(ci),w=function(){function n(){}return n.saveIncident=function(t){var r,i,u;if(n.getIncidents(),n.recentlyUsed){for(r=-1,i=0;i<n.recentlyUsed.length;i++)if(u=n.recentlyUsed[i],u.description===t.description){r=i;break}r!==-1?n.recentlyUsed.splice(r,1):n.recentlyUsed.length===n.Max_limit&&n.recentlyUsed.splice(0,1);n.recentlyUsed.push(t)}n.commitChanges()},n.commitChanges=function(){var r,i,t,u;if(n.recentlyUsed){for(r="",i=0;i<n.recentlyUsed.length;i++)t=n.recentlyUsed[i],t.usedCount||(t.usedCount=0),u=n.SerializedCameraFormat.replace("{lat}",t.point.coordinates[0].toString()).replace("{long}",t.point.coordinates[1].toString()).replace("{description}",t.description).replace("{usage}",t.usedCount.toString()),i!==n.recentlyUsed.length-1&&(u+="$"),r+=u;vt.setItem(n.TrafficLocalStorageKey,r)}},n.getIncidents=function(){var u,f,r,i,t;if(!n.recentlyUsed&&(u=vt.getItem(n.TrafficLocalStorageKey),n.recentlyUsed=[],u))for(f=u.split("$"),r=0;r<f.length;r++)i=f[r].split("|"),t={},t.point={coordinates:[parseFloat(i[0]),parseFloat(i[1])]},t.description=i[2],t.usedCount=parseInt(i[3]),t.recentlyUsed=!0,n.recentlyUsed.push(t);return n.recentlyUsed},n.removeIncident=function(t){var i,r;if(n.recentlyUsed){for(i=0;i<n.recentlyUsed.length;i++)if(r=n.recentlyUsed[i],r.description===t.description){n.recentlyUsed.splice(i,1);break}n.commitChanges()}},n.removeAllIncidents=function(){n.recentlyUsed&&(n.recentlyUsed.splice(0,n.recentlyUsed.length),n.commitChanges())},n.TrafficLocalStorageKey="TrafficCameras",n.Max_limit=10,n.SerializedCameraFormat="{lat}|{long}|{description}|{usage}",n}(),sr=function(t){function i(r){var u=t.call(this,i._getIncidentTypeTitle(r.type),null)||this;return u.id=r.incidentId,u.point=r.point,u.trafficDescription=r.description,u.end=r.isEndTimeBackfilled?n.L_IncidentEndTimeUnknown_Text:u._getFormattedDateTime(r.end),u.roadClosed=r.roadClosed,u.severity=u._getSeverityTitle(r.severity),u.start=u._getFormattedDateTime(r.start),u.toPoint=r.toPoint,u.incidentType=r.type,u.verified=r.verified,u}return y(i,t),i._getIncidentTypeTitle=function(t){switch(t){case 9:return n.L_TrafficScheduledConstruction_Text;case 6:return n.L_TrafficOtherNews_Text;case 2:return n.L_TrafficCongestion_Text;case 1:return n.L_TrafficAccident_Text;case 3:return n.L_TrafficDisabledVehicle_Text;case 8:return n.L_TrafficRoadHazard_Text;case 10:return n.L_TrafficUnScheduledContruction_Text;case 7:return n.L_TrafficPlannedEvent_Text;case 4:return n.L_TrafficMassTransit_Text;case 11:return n.L_TrafficWeather_Text;case 5:return n.L_TrafficMiscellaneous_Text;default:return""}},i.prototype._getSeverityTitle=function(t){switch(t){case 1:return n.L_TrafficSeverityLowImpact_Text;case 2:return n.L_TrafficSeverityMinor_Text;case 3:return n.L_TrafficSeverityModerate_Text;case 4:return n.L_TrafficSeveritySerious_Text;default:return""}},i.prototype._getFormattedDateTime=function(t){var f="",e,i,r;return t&&(e=/\(([\d]+)\)/,i=e.exec(t),i&&i.length>1&&(r=new Date(parseInt(i[1],10)),f=u._formatString(n.L_TrafficDateTimeFormat,u._formatShortDateString(r),u._formatTimeString(r)))),f},i}(kt),g=function(){function i(t,r,u){this.geometryType=1;this.crs=ei.instance;this.geometry={x:0,y:0,bounds:null};this.geometryType=1;this.layer=r;this._location=new k(t.point.coordinates[0],t.point.coordinates[1]);this._updatePointGeometry(this._location);this.incident=t;this._isDirectionsTrafficPin=u;this.resources=n;this.bucket=i._getBucketId(this.incident.type,this.incident.severity);var f=this.incident.type===12;f?(this.entity=new ot(t),this.entity.collisionBehavior=u?0:2):this.entity=new sr(t);this.entity.poiType=9;v.enableTrafficRefresh&&(f&&(this.entity.poiType=15),this.stylesheetEntryState=this._getStylesheetEntryState(t));this.updatePinIcon(0)}return i.prototype.updatePinIcon=function(n,t){this._isDirectionsTrafficPin&&(this.entity.collisionBehavior=n===1?2:0);n===1?(this.viewState=t!==12&&v.enableTrafficRefresh&&!u._isSmallMapShownOnSerp()?5:2,this.zIndex=1):v.enableTrafficRefresh&&n===2?(this.viewState=u._isSmallMapShownOnSerp()?1:[1,4],this.zIndex=2):(this.viewState=v.enableTrafficRefresh&&!u._isSmallMapShownOnSerp()?4:0,this.zIndex=0);this.entity.changed.invoke()},i.prototype.isTapEnabled=function(){return!0},i.prototype.isHoverEnabled=function(){return!0},i.prototype.getLocation=function(){return this._location},i.prototype.getTemplate=function(){return this._template},i.prototype.select=function(){var n,i;t.trafficCameraV2Enabled&&this.incident&&this.incident.type===12?(b.getInstance().show(this),v.enableTrafficRefresh&&(this.updatePinIcon(1,12),s.selectedPin=this)):t.trafficIncidentV2Enabled&&this.incident&&this.incident.type!==12?(b.getInstance().show(this),v.enableTrafficRefresh&&(this.updatePinIcon(1),s.selectedPin=this)):(n={},n.activateOptions={parentId:l.trafficTaskId},n.type=et.trafficFlipTask,i={},i.incident=this.incident,n.state=i,tt.invokeHandler(nt.taskDataHandlerKey,n),s.selectedPin&&s.selectedPin.updatePinIcon(0),s.selectedPin=this,s.selectedPin.updatePinIcon(1))},i.prototype._updatePointGeometry=function(n){var t=n.latitude,i=n.longitude;this.geometry.x=i;this.geometry.y=t;this.geometry.bounds=[t,i,t,i]},i._getBucketId=function(n,i){var r="344";return n===12&&(r="1441"),v.enableTrafficRefresh||(i===4?(r="1443",t.incidentIconsEnabled&&(n===1?r="999985":n===9&&(r="999982"))):i===3?(r="1442",t.incidentIconsEnabled&&(n===1?r="999984":n===9&&(r="999981"))):t.incidentIconsEnabled&&i===2&&(n===1?r="999983":n===9&&(r="999980"))),r},i.prototype._getStylesheetEntryState=function(n){if(n.type!==12){var t=u._isSmallMapShownOnSerp()?"FeedTrafficIncident;":"";switch(n.severity){case 4:t+="HighSeverity";break;case 3:t+="MediumSeverity";break;default:t+="LowSeverity"}return n.type===1?t+=";Accident":n.type===9?t+=";Construction":n.roadClosed&&(t+=";Closure"),t}},i}(),c=function(i){function r(f,e,s,c){var l=this,a={};return l=i.call(this,a,f,nr)||this,l._map=e,l.resources=n,l._controlTemplateFactory=f,l.modules=new bt,l._maxRecentlyUsedCamerasPreviews=4,a.defineProperty("showCameraNotification",null,null,{defaultValue:!1}),a.defineProperty("hideCamera",function(){s&&s.invoke()},null,{defaultValue:!1}),a.defineProperty("cameraNotification",null,null,{defaultValue:n.L_TrafficsZoomInNotification}),a.defineProperty("ariaChecked",null,null,{defaultValue:!0}),a.defineProperty("camerasToggleUniqueId"),l.setShowCameraNotification(h.getMercatorZoomLevel(e)<=t.minZoomForAllCameras),l.setCamerasToggleUniqueId("camToggle"+c),(u._isLargeMapShownOnSerp()||o.isMapsVertical)&&(r.recentCamerasModule=new ht(l._map,l._maxRecentlyUsedCamerasPreviews,n.L_TrafficRecentCamerasTitle),l.modules.insert(r.recentCamerasModule)),l}return y(r,i),r.prototype.initializeRecentCameras=function(){var n,t,i,f;if(u._isLargeMapShownOnSerp()||o.isMapsVertical){if(r.recentCameraVMs=[],n=w.getIncidents(),n&&n.length)for(t=n.length-1;t>=0;t--)i=n[t],i.type=12,f=new it(this._controlTemplateFactory,i,this._map),f.pin=new g(i),r.recentCameraVMs.push(f);this.updateCameraImages()}},r.prototype.updateRecentCameras=function(){for(var t,n=0;n<l.mostRecentCameras.length;n++)t=r.findExistingRecentCamera(l.mostRecentCameras[n].incidentData),t>=0&&r.recentCameraVMs.splice(t,1),r.recentCameraVMs.unshift(l.mostRecentCameras[n]);r.recentCameraVMs=r.recentCameraVMs.slice(0,w.Max_limit);this.updateCameraImages();l.mostRecentCameras=[]},r.prototype.addCameraToRecentCameras=function(n){var i=r.findExistingRecentCamera(n),t;i>=0&&r.recentCameraVMs.splice(i,1);n.type=12;t=new it(this._controlTemplateFactory,n,this._map);t.pin=new g(n);r.recentCameraVMs.unshift(t);r.recentCameraVMs=r.recentCameraVMs.slice(0,w.Max_limit);this.updateCameraImages()},r.prototype.updateCameraImages=function(){var i,n,t;if(u._isLargeMapShownOnSerp()||o.isMapsVertical){for(r.recentCamerasModule.collection.clear(),i=[],n=0;n<r.recentCameraVMs.length;n++)t=r.recentCameraVMs[n],t.incidentWithinMap()?r.recentCamerasModule.collection.insert(t):i.push(t);r.recentCamerasModule.collection.insertAll(i)}},r.findExistingRecentCamera=function(n){for(var i,t=0;t<r.recentCameraVMs.length;t++)if(i=r.recentCameraVMs[t].pin&&r.recentCameraVMs[t].pin.incident,i&&n.description&&i.description===n.description)return t;return-1},r.prototype.typeToClass=function(n){return n===12?"bm_moduleItem":"bm_moduleItem notificationItem"},r.prototype.incidentTypeToIconClass=function(n){switch(n){case 9:return"notification construction";case 1:return"notification accident";default:return"notification otherincident"}},r.prototype.cameraTypeToDisplay=function(n){return n===12?"":"none"},r.prototype.incidentTypeToDisplay=function(n){return n!==12?"":"none"},r.prototype.onCamerasKeyUp=function(n){var t=n,i=t.keyCode||t.which;i===13&&this._toggleCameras()},r.prototype.onCamerasClick=function(n){n.stopPropagation();this._toggleCameras()},r.prototype._toggleCameras=function(){this.setHideCamera(!this.getHideCamera());this.updateCameraMessage();var n=f("#cameraToggleInput")[0];n.checked=!this.getHideCamera();this.setAriaChecked(!this.getHideCamera())},r.prototype.isCameraAvailable=function(){for(var n,r=this._map.getFrameManager(),u=r.getFrameData(),i=u.getPrimitives(2,!0),t=0;t<i.length;t++)if(n=i[t],n instanceof g&&n.incident.type===12&&this._map.isLocationInView(n.getLocation()))return!0;return!1},r.prototype.updateCameraMessage=function(i){i===void 0&&(i=!1);var r=this.isCameraAvailable();this.getHideCamera()?this.setShowCameraNotification(!1):h.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras?(this.setShowCameraNotification(!0),this.setCameraNotification(n.L_TrafficsZoomInNotification)):i&&!r?(this.setShowCameraNotification(!0),this.setCameraNotification(n.L_TrafficsNoCameraNotification)):this.setShowCameraNotification(!1)},r.recentCameraVMs=[],r}(lt),l=function(i){function r(n,u,f){var e=i.call(this)||this;return e.type=et.trafficTask,e.map=f,e.toggleCameras=new ut,r.controlTemplateFactory=n,e._cameraListenerAdded=!1,e._overlayCloseBtnListenerAdded=!1,(t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled)&&b.getInstance().initialize(f,n),e.displayState={colorIndex:6,groupName:"Traffic"},u.instanceAsync("TrafficLayerV2",function(n){e._trafficLayer=n;e._taskState&&e._trafficLayer.show(3);e._trafficLayer.getCamerasHidden()&&e._trafficLayer.toggleCameras();t.trafficCameraV2Enabled&&e._addRecentCameraListener()}),e.disposables.push(f.viewChanged.add(function(){var n=e.map.getFrameManager();n.frameRendered.addOne(function(){Microsoft.Maps.setTimeout(function(){e._viewModel&&e._viewModel.updateCameraMessage(!0)},0)})})),e.disposables.push(e.toggleCameras.add(function(){e._trafficLayer&&e._trafficLayer.toggleCameras()})),e}return y(r,i),r.prototype.activate=function(f,e){var y=this,l,v,a;r.isCardShowing=!0;this.setTitle(n.L_TrafficTaskTitle_Text);this._taskState=e||{taskTitle:this.getTitle()};i.prototype.activate.call(this,f,e);r.trafficTaskId=this.id;this._viewModel=new c(r.controlTemplateFactory,f,this.toggleCameras,this.id);this.addControl(this._viewModel.getControl());this.map=f;(u._isLargeMapShownOnSerp()||o.isMapsVertical)&&this._viewModel.initializeRecentCameras();this._taskState&&this._trafficLayer&&this._trafficLayer.show(3);this._taskState.description&&this._taskState.location&&(l={},l.point={coordinates:[this._taskState.location.latitude,this._taskState.location.longitude]},l.description=this._taskState.description,l.type=12,v=new g(l),s.selectedPin=v,h.setMapCenter(f,this._taskState.location),v.select());t.trafficCameraV2Enabled&&this._addRecentCameraListener();u._isLargeMapShownOnSerp()&&!this._overlayCloseBtnListenerAdded&&(a=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn"),a.length>0&&a[0].addEventListener&&a[0].addEventListener("click",function(n){return y._overlayCloseButtonHandler(n)}));this.setPercentLoaded(1)},r.prototype.deactivate=function(){i.prototype.deactivate.call(this);this._overlayCloseBtnListenerAdded||this._trafficLayer.hide();var n=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn");n.length>0&&n[0].removeEventListener&&(this._overlayCloseBtnListenerAdded=!1,n[0].removeEventListener("click",this._overlayCloseButtonHandler))},r.close=function(){r.isCardShowing=!1;var n={action:"remove",id:r.trafficTaskId};tt.invokeHandler(nt.taskDataHandlerKey,n)},r.prototype.processCallback=function(){},r.prototype.serialize=function(){return this._taskState},r.prototype.setDisplayState=function(n){i.prototype.setDisplayState.call(this,n);r.trafficTaskId=this.id;n.activationState&&n.prominence&&(this._trafficLayer&&this._trafficLayer.show(3),r.mostRecentCameras&&r.mostRecentCameras.length&&(u._isLargeMapShownOnSerp()||o.isMapsVertical)&&this._viewModel&&this._viewModel.updateRecentCameras());n.prominence===3&&this._trafficLayer.hide(!0)},r.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},r.prototype.isSharable=function(){return!0},r.prototype.hasDefaultFocusElement=function(){return!1},r.prototype._addRecentCameraListener=function(){var n=this;!this._cameraListenerAdded&&this._trafficLayer&&this._viewModel&&t.trafficCameraV2Enabled&&(this._trafficLayer.updateRecentCameras.add(function(t){n._viewModel.addCameraToRecentCameras(t)}),this._cameraListenerAdded=!0)},r.prototype._overlayCloseButtonHandler=function(n){n&&n.preventDefault&&(n.preventDefault(),n.stopPropagation());this._overlayCloseBtnListenerAdded=!0;this._trafficLayer&&this._trafficLayer.hide(!1,n)},r.mostRecentCameras=[],r}(ct),it=function(i){function r(t,r,u){var f=this,e={},o=r.recentlyUsed||r.type===12?bi:gi;return f=i.call(this,e,t,o)||this,f._map=u,f.resources=n,e.defineProperty("cameraImageUrl"),e.defineProperty("cameraVideoUrl"),e.defineProperty("isImageReady"),e.defineProperty("isVideoReady"),f.setIncident(r),e.defineProperty("show",null,null,{defaultValue:!1}),r.type!==12||r.images||f.getCamera(),f}return y(r,i),r.prototype.setIncident=function(i){var r=this;this.incidentType=i.type;this.incidentData=i;this.pin&&(this.pin.incident=i);this.id=i.incidentId;this.point=i.point;this.copyright=i.copyright;this.trafficDescription=i.description;i.recentlyUsed||i.images&&i.images.length>0?(this.incidentTitle=i.description,this.cameraDirection=i.view,i.images&&i.images.length&&(this.videoPreviewId="videoPreview_".concat(this.id),rt.instance.authenticateClientAndRetrieveSessionId(function(t){r.setIsImageReady(!1);r.setIsVideoReady(!1);b.getCameraVisualUrl(i,t,!1,function(n,t,i){return r._onCameraVisualUrlResult(t,i)});r.altDescription=n.L_TrafficPreviewCameraImage_Text.replace("{0}",i.description);r.removeCameraAriaLabel=n.L_TrafficRemoveRecentCameraToolTip_Text.replace("{0}",i.description);r.incidentAriaLabel=n.TrafficCameraAriaLabel.replace("{0}",i.description)})),t.showCameraDisclaimer&&(this.disclaimer=n.L_TrafficCameraDisclaimer_Text)):(this.end=i.isEndTimeBackfilled?n.L_IncidentEndTimeUnknown_Text:this._getFormattedDateTime(i.end),this.roadClosed=i.roadClosed,this.severityType=i.severity,this.severity=this._getSeverityTitle(i.severity),this.start=this._getFormattedDateTime(i.start),this.toPoint=i.toPoint,this.verified=i.verified,this.incidentTitle=this.roadClosed&&i.type===5?n.L_TrafficRoadClosed_Text:this._getIncidentTypeTitle(i.type))},r.prototype.severityTypeToClass=function(n){return r.ConvertSeverityTypeToClass(n)},r.ConvertSeverityTypeToClass=function(n){switch(n){case 4:return"incidentSeverity high";case 3:return"incidentSeverity moderate";default:return"incidentSeverity mild"}},r.prototype.onImageError=function(){this.setIsImageReady(!1);var n={};n.IID=this.incidentData.incidentId;p.logInstrumentationEvent(e.TCF,n)},r.prototype.onBackClick=function(n){n.preventDefault()},r.prototype.onModuleItemClick=function(n){var o;n.preventDefault();var i={},r=this.incidentData.point.coordinates,s=h.getMapBounds(this._map),u=new k(r[0],r[1]);s.contains(u)||(o=Math.max(t.minZoomLevelToShowIncidents,h.getMercatorZoomLevel(this._map)),h.setMapCenter(this._map,u,o));this.pin.select();t.trafficCameraV2Enabled||Microsoft.Maps.setTimeout(function(){var t=f(".trfkTsk.titleIcon"),n;t.length>1&&(n=f(t[1]).get_ancestor(1,0)[0],n.focus(),n.style.border="none")},500);i.IUT=5;i.Z=h.getMercatorZoomLevel(this._map);p.logInstrumentationEvent(e.ID,i)},r.prototype.onRemoveRecentCameraClick=function(n){if(n.preventDefault(),ht.removeCamera(this),this._map&&s&&h.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras){var i=this._map.getFrameManager();i&&i.hackHackSetFrame()}},r.prototype.incidentWithinMap=function(){var n=this.incidentData.point.coordinates,t=h.getMapBounds(this._map);return t.contains(new k(n[0],n[1]))},r.prototype._onCameraVisualUrlResult=function(n,t){if(n)if(t){this.setIsVideoReady(!0);this.setCameraVideoUrl(n);var i=f("#".concat(this.videoPreviewId))[0];i&&(i.muted=!0)}else this.setIsImageReady(!0),this.setCameraImageUrl(n)},r.prototype._getIncidentTypeTitle=function(t){if(t)switch(t){case 9:return n.L_TrafficScheduledConstruction_Text;case 6:return n.L_TrafficOtherNews_Text;case 2:return n.L_TrafficCongestion_Text;case 1:return n.L_TrafficAccident_Text;case 3:return n.L_TrafficDisabledVehicle_Text;case 8:return n.L_TrafficRoadHazard_Text;case 10:return n.L_TrafficUnScheduledContruction_Text;case 7:return n.L_TrafficPlannedEvent_Text;case 4:return n.L_TrafficMassTransit_Text;case 11:return n.L_TrafficWeather_Text;case 5:return n.L_TrafficMiscellaneous_Text;default:return""}return""},r.prototype._getSeverityTitle=function(t){switch(t){case 1:return n.L_TrafficSeverityLowImpact_Text;case 2:return n.L_TrafficSeverityMinor_Text;case 3:return n.L_TrafficSeverityModerate_Text;case 4:return n.L_TrafficSeveritySerious_Text;default:return""}},r.prototype._getFormattedDateTime=function(t){var f="",e,i,r;return t&&(e=/\(([\d]+)\)/,i=e.exec(t),i&&i.length>1&&(r=new Date(parseInt(i[1],10)),f=u._formatString(n.L_TrafficDateTimeFormat,u._formatShortDateString(r),u._formatTimeString(r)))),f},r.prototype.getCamera=function(){var i=this,n=this.incidentData,r=pt.getMapLocationFromLocationHeadingAndDistance(new k(n.point.coordinates[0],n.point.coordinates[1]),Math.PI*3/4,5),u=pt.getMapLocationFromLocationHeadingAndDistance(new k(n.point.coordinates[0],n.point.coordinates[1]),Math.PI*7/4,5),f=r.latitude+","+u.longitude+","+u.latitude+","+r.longitude;rt.instance.authenticateClientAndRetrieveSessionId(function(n){var r=t.cameraByLocationUrlFormat.replace("{bounds}",f).replace("{credentials}",n);st.downloadJsonp(r,"trfcam",function(n,t){return i._processCameraDetails(n,t)},function(n){return i._processErrors(n)},null,!1,{})})},r.prototype._processCameraDetails=function(n){var r=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0].resources||[],u=this.incidentData,f=!1,i,t;if(r.length)for(i=0;i<r.length;i++)if(t=r[i],t.description===u.description){t.recentlyUsed=u.recentlyUsed;this.setIncident(t);this.pin&&(this.pin.incident=t);f=!0;break}f||ht.removeCamera(this)},r.prototype._processErrors=function(){},r}(lt),ht=function(i){function r(t,r,u){var f=this,e={};return f=i.call(this,e)||this,f._map=t,f.resources=n,f.collection=new bt,f.collection.changed.add(function(n){f._onCollectionChanged(n)}),e.defineProperty("showModule",null,null,{defaultValue:!1}),e.defineProperty("showMoreLink",null,null,{defaultValue:!1}),e.defineProperty("moreLinkText",null,null,{defaultValue:n.L_TrafficModuleMoreLink}),e.defineProperty("arrowClass",null,null,{defaultValue:"downArrow trafficArrow"}),f.title=u,f._maxItemsPreviews=r,f}return y(r,i),r.prototype.onMoreClick=function(t){var r,u;t.preventDefault();var i=this.getMoreLinkText()===n.L_TrafficModuleMoreLink,f=this.collection.length>this._maxItemsPreviews,o=i?n.L_TrafficModuleLessLink:n.L_TrafficModuleMoreLink,s=i?"upArrow trafficArrow":"downArrow trafficArrow";if(f)for(this.setMoreLinkText(o),this.setArrowClass(s),r=this._maxItemsPreviews;r<this.collection.length;r++)this.collection[r].setShow(i);this.title===n.L_TrafficRecentCamerasTitle&&(u=1);p.logInstrumentationEvent(e.ML,{M:u,ILM:i})},r.prototype._onCollectionChanged=function(){var i,t;if(this.collection.length)for(this.getShowModule()||this.setShowModule(!0),this.setShowMoreLink(this.collection.length>this._maxItemsPreviews),i=this.getMoreLinkText()===n.L_TrafficModuleMoreLink,t=0;t<this.collection.length;t++)this.collection[t].setShow(!(t>=this._maxItemsPreviews&&i));else this.setShowModule(!1)},r.prototype.onRemoveAllRecentCamerasClick=function(n){if(n.preventDefault(),r.removeAllCameras(),h.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras){var i=this._map.getFrameManager();i&&i.hackHackSetFrame()}},r.removeAllCameras=function(){c.recentCamerasModule.collection.clear();c.recentCameraVMs.splice(0,c.recentCameraVMs.length);w.removeAllIncidents()},r.removeCamera=function(n){var t,i;if(n&&w.removeIncident(n.incidentData),c.recentCameraVMs&&c.recentCamerasModule)for(c.recentCamerasModule.collection.remove(n),t=0;t<c.recentCameraVMs.length;t++)i=c.recentCameraVMs[t],i.id===n.id&&c.recentCameraVMs.splice(t,1)},r}(wt);a.TrafficLegendControl=gt;a.TrafficLegendOverlay=ni;a.TrafficLayerV2=or;a.TrafficTask=l;a.TrafficFlipTask=fr;a.TrafficPinV2=g;a.CameraOverlayEntity=ot;a.IncidentViewModel=it;a.TrafficIncidentPopup=b;a.TrafficLocalStorageHelper=w;a.IncidentPopupTemplate='<div class="bm_trfcIncidentWrapper">    <div data-tag="incidentPopupRoot">        <div>            <div class="incidentTitleRoot">                <div class="incidentTitle" data-tag="incidentTitle">                    <TextBlock Text="{Binding incidentTitle}" />                <\/div>                <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity">                    <span>                        <TextBlock Text="{Binding severity}" />                    <\/span>                <\/p>            <\/div>            <div class="incidentDescriptionRoot">                <p class="incidentDescription" data-tag="trafficDescription">                    <TextBlock Text="{Binding trafficDescription}" />                <\/p>                <p class="incidentTime" data-tag="start" style:display="{Binding start Converter=nullToDisplayNone}">                    <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span><span><TextBlock Text="{Binding start}" /><\/span>                <\/p>                <p class="incidentTime" data-tag="end" style:display="{Binding end Converter=nullToDisplayNone}">                    <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span><span><TextBlock Text="{Binding end}" /><\/span>                <\/p>            <\/div>        <\/div>    <\/div><\/div>'}catch(ti){if(i.logger)i.logger.logCriticalError(ti);else throw ti;}}).call(window)