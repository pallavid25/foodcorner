(function(){var yi,pi,wi,bi,nt,ki,di,gi,ti;try{(function(){var n={L_CloseTask_Text:"Close",L_Landmark_CardsContainer_Aria_Label:"Search results, directions or favorites",L_Landmark_WelcomeContainer_Aria_Label:"Welcome to Bing Maps - explore nearby",L_Menu_Print_Link_Text:"Print",L_Menu_Share_Link_Text:"Share",L_Menu_ListView_Link_Text:"See all cards",L_TaskCardMoreMenuText:"More",L_CardLayoutExpandCollapse_Text:"Expand/Collapse Cards",SearchThisStoreText:"Search this store",HotelCategory:"Hotels",HotelQuery:"Hotels",AttractionsCategory:"Attractions",AttractionsQuery:"Things to do",RestaurantsCategory:"Eat & Drink",RestaurantsQuery:"Restaurants",HouseCategory:"Real Estate",HouseQuery:"Houses for sale",LocalGuideCategory:"Local Guide",L_CollapseButton_Tip:"Collapse to view more map",L_ExpandButton_Tip:"Expand to view more content"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("TaskFramework",n):window.$MicrosoftMaps8.ResourcesObject=n})();var i=window.$MicrosoftMaps8,e=i.Internal,or=e.TaskData,sr=i.Anchor,et=e._Binding,hr=e.BadgeTemplateSelector,ui=i.BasicMapAnimation,fi=i.BasicTemplate,l=e._BaseMapTemplateSelector,wf=i.BitmapImageTemplate,cr=e._BoundsAccumulator,lr=i.BucketPrimitiveTemplateSelector,bf=i.ChildVectorImageTemplate,ar=e._Color,it=e.ContentControl,ei=e.Control,a=e.ControlTemplate,y=i.DataHandlerKeys,kf=i.DefaultTemplateSelector,df=e._EntityHelper,p=i.GlobalDataEventHandler,gf=i.ImageFromCssHelper,k=e._Debug,yt=e._ElementSizeHelper,vr=e._EntryPoints,oi=e._FeatureNames,n=e._Gimme,o=i.GlobalConfig,u=e._Helper,yr=i.HomeOrWorkEnabledLocalSearchEntity,r=e._JSEvent,si=o.features.layerManager,ne=i.LocalGuideTask,pr=i.LocalSearchEntity,wr=i.LocationRect,ot=e._PerfV2Logger,hi=e._LruCache,br=e._MapAuthentication,h=e.MapHelper,kr=e.MapInteractionBehavior,b=i.Location,dr=i.MapMath,w=i.MapTypeId,st=i.MapView,gr=i.MapViewAnimator,ci=e._MercatorTileUtility,pt=e._Network,d=e._Observable,ht=e._ObservableObject,li=e._ObservableCollection,nu=e._ObservableObjectChangedArgs,te=e._OverlayEntity,tu=i.Point,iu=e.PyramidTileSpatialIndex,g=i.ResourceManager.TaskFramework,wt=i.SimplePointPrimitive,ru=i.Size,ie=e.StaticPromise,t=o.features.taskFramework,s=i.TaskTypes,uu=or.TravelAttractionEntity,fu=i.VectorMapLayer,ai=i.VectorImageTemplate,re=i.ZoomAroundLocationAnimator,c=i.ZoomLevel,eu='<div class="{StaticBinding ClassName}" style:display="{StaticBinding OverflowTask Converter=taskExistsToDisplay}">    <ShoppingTaskContainer LayoutMetrics="{StaticBinding LayoutMetrics}" Stack="{StaticBinding Stack}" Task="{StaticBinding OverflowTask}" />    <AutosTaskContainer LayoutMetrics="{StaticBinding LayoutMetrics}" Stack="{StaticBinding Stack}" Task="{StaticBinding OverflowTask}" />    <iframe frameborder="0" id="WoWIFrame" src="{StaticBinding OverflowTask Converter=taskExistsToWoWRequestUrl}" style:display="{StaticBinding ShowWoWIframe Converter=boolToDisplay}"/><\/div>',ou='<div class="bm_scrollbarMask" style:display="{TemplateBinding IsHidden Converter=hideLeftLane}" aria-hidden="{TemplateBinding IsHidden}">    <ContentPresenter />    <div class="collapseSlideout" style:display="{TemplateBinding SlideoutTask Converter=displayExpandCollapse}">        <div style:display="{TemplateBinding ShowExpandButton Converter=boolToDisplay}">            <a class="resizeButton show" href="#" data-tag="toggleButtonShow" title="{TemplateBinding resources.L_ExpandButton_Tip}" aria-label="{TemplateBinding resources.L_CardLayoutExpandCollapse_Text}" role="button" event:click="toggleShowClick"><\/a>        <\/div>        <div style:display="{TemplateBinding IsCardlaneCollapsed Converter=boolToNotDisplay}">            <a class="resizeButton hide" href="#" data-tag="toggleButtonHide" title="{TemplateBinding resources.L_CollapseButton_Tip}" aria-label="{TemplateBinding resources.L_CardLayoutExpandCollapse_Text}" role="button" event:click="toggleHideClick"><\/a>        <\/div>    <\/div><\/div>',su='<div class="autosOverflowContainer" style:display="{TemplateBinding task Converter=isAutosTask}">    <div class="shoppingHeader">        <div class="panelTitleContainer">            <TextBlock Text="{TemplateBinding task.PanelTitle}" />        <\/div>        <div class="bm_cardClose">            <a class="bm_cardCloseButton" href="#" event:click="onCloseOverflowClick" data-tag="{TemplateBinding Stack.OverflowTask.id}" role="button" aria-label="{StaticBinding resources.L_CloseTask_Text}" />        <\/div>        <div class="shoppingSearchControl">            <div class="shoppingSearchboxContainer">                <input class="shoppingSearchbox" value="{TemplateBinding searchText Mode=TwoWay}" event:keydown="onSearchKeyPressed" type="search" role="combobox" placeholder="{StaticBinding resources.SearchThisStoreText}" />                <a class="shoppingSearchButton" href="#" event:click="onProductSearchClick" role="button" aria-label="{StaticBinding resources.SearchThisStoreText}" />            <\/div>        <\/div>    <\/div>    <iframe src="{TemplateBinding autosUrl}" frameborder="0" id="autoDealersIFrame" /><\/div>',hu='<div class="bm_scrollbarMask">    <div class="custom-scroll">        <div class="outer-container">            <div class="positioning">                <div class="custom-scrollbar">                    <div class="custom-scroll-handle">                        <div />                    <\/div>                <\/div>            <\/div>            <div class="inner-container">                <div class="content-wrapper">                    <div class="panelWrapper multi select">                        <div class="bm_waitlayer"><\/div>                        <ItemsControl ItemsSource="{Binding stacks}">                            <ItemsControl.Template>                                <DataTemplate>                                    <div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                                        <ItemsPresenter />                                    <\/div>                                <\/DataTemplate>                            <\/ItemsControl.Template>                            <ItemsControl.ItemTemplate>                                <DataTemplate>                                    <div class="cardWrapper">                                        <!-- The original solution was to use disabled="{Binding $self$ Converter=shouldStackBeDisabled}". But during debugging it turned out that the converter for the special $self$ object is being called on                                        _every_  $self$ property change, not just the one I bind to. Since the converter is heavy I am moving this assignment to the stackChanged event. -->                                        <SelectionTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchend="onTaskClick" ignoreTaskFadeProperty="true">                                            <SelectionTaskCard.Template>                                                <DataTemplate>                                                    <div class="{TemplateBinding cssClass}" data-taskid="{TemplateBinding Stack.id}" style="visibility:hidden">                                                        <div class="cardFace selectionMode sideA front" data-subTaskId="{TemplateBinding sideATask.id}">                                                        <\/div>                                                        <div class="cardFace selectionMode sideB back" data-subTaskId="{TemplateBinding sideBTask.id}">                                                        <\/div>                                                    <\/div>                                                <\/DataTemplate>                                            <\/SelectionTaskCard.Template>                                        <\/SelectionTaskCard>                                    <\/div>                                <\/DataTemplate>                            <\/ItemsControl.ItemTemplate>                        <\/ItemsControl>                        <ContainerControl containerClass="selectionCardClass" controlName="{Binding selectionModeControlName}" controlRef="{Binding selectionControl Mode=TwoWay}" />                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',cu='<div class="panelWrapper multi select">    <div class="bm_waitlayer"><\/div>\t<ItemsControl ItemsSource="{Binding stacks}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">\t\t\t\t\t<ItemsPresenter />\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<div class="cardWrapper">\t\t\t\t\t<!-- The original solution was to use disabled="{Binding $self$ Converter=shouldStackBeDisabled}". But during debugging it turned out that the converter for the special $self$ object is being called on\t\t\t\t\t_every_  $self$ property change, not just the one I bind to. Since the converter is heavy I am moving this assignment to the stackChanged event. -->                    <SelectionTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchend="onTaskClick" ignoreTaskFadeProperty="true" >                        <SelectionTaskCard.Template>                            <DataTemplate>                                <div class="{TemplateBinding cssClass}" data-taskid="{TemplateBinding Stack.id}" style="visibility:hidden">                                    <div class="cardFace selectionMode sideA front" data-subTaskId="{TemplateBinding sideATask.id}">                                     <\/div>                                    <div class="cardFace selectionMode sideB back" data-subTaskId="{TemplateBinding sideBTask.id}">                                    <\/div>                                <\/div>                            <\/DataTemplate>                        <\/SelectionTaskCard.Template>                    <\/SelectionTaskCard>\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>    <ContainerControl containerClass="selectionCardClass" controlName="{Binding selectionModeControlName}" controlRef="{Binding selectionControl Mode=TwoWay}"/><\/div>',lu='<div class="{TemplateBinding task Converter=getAreaClass}" style:display="{TemplateBinding filters Converter=noFiltersToDisplayNone}">    <ContentPresenter content=\'FilterContent\' />    <div class="bm_filterExpando" event:click="onExpandoClick">        <span class="bm_selectedCount" style:display="{TemplateBinding selectedCount Converter=zeroToDisplayNone}">            <TextBlock Text="{TemplateBinding selectedCount}" />        <\/span>        <span class="bm_chevronIcon">        <\/span>    <\/div><\/div>',au='<div class="{Binding primitive.toolTipCssClass}">    <ul>        <ItemsControl ItemsSource="{Binding primitive.titles}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <TextBlock Text="{Binding $self$}"/>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/ul><\/div>',vu='<div class="custom-scroll" style:display="{TemplateBinding task Converter=isShoppingTask}">    <div class="shoppingHeader">        <div class="panelTitleContainer">            <TextBlock Text="{TemplateBinding task.PanelTitle}" />        <\/div>        <div class="bm_cardClose">            <a class="bm_cardCloseButton" href="#" event:click="onCloseOverflowClick" data-tag="{TemplateBinding Stack.OverflowTask.id}" role="button" aria-label="{StaticBinding resources.L_CloseTask_Text}" />        <\/div>        <div class="shoppingSearchControl">            <div class="shoppingSearchboxContainer">                <input class="shoppingSearchbox" value="{TemplateBinding searchText Mode=TwoWay}" event:keydown="onSearchKeyPressed" type="search" role="combobox" placeholder="{StaticBinding resources.SearchThisStoreText}" />                <a class="shoppingSearchButton" href="#" event:click="onProductSearchClick" role="button" aria-label="{StaticBinding resources.SearchThisStoreText}" />            <\/div>            <div class="shop_asbox" style:display="{TemplateBinding ShowAutosuggest Converter=boolToDisplay}">                <ul class="shop_aslist">                <\/ul>            <\/div>        <\/div>    <\/div>    <div class="outer-container">        <div class="positioning">            <div class="custom-scrollbar">                <div class="custom-scroll-handle">                    <div><\/div>                <\/div>            <\/div>        <\/div>        <div class="bm_waitlayer" style:display="{TemplateBinding task.ShowWaitLayer Converter=boolToDisplay}"><\/div>        <div class="inner-container">            <div class="content-wrapper">                <div class="panelWrapper multi noScroll">                    <div class="cardCol slidecard panelContent" data-containerAreaType="cardsContainer" role="complementary" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                        <div class="cardWrapper expand">                            <div class="taskCard overflow focus" data-taskId="{TemplateBinding dataTaskId}" data-subTaskId="{TemplateBinding task.id}">                                <div class="contentRoot" data-containerareatype="taskArea">                                    <ContentPresenter content="cardContent" />                                <\/div>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',yu='<div class="{TemplateBinding cssClass}" data-taskId="{TemplateBinding dataTaskId}" data-subTaskId="{TemplateBinding task.id}" style:width="{TemplateBinding task.CurrentWidth Converter=getWidthString}">    <div class="cardFace front">        <a class="focusDummy" tabindex="-1" title="{TemplateBinding cardTitle}"><\/a>        <div class="cardContent">            <div class="contentRoot" data-containerareatype="taskArea">                <div class="bm_cardClose" style:display="{TemplateBinding isDetailsCard Converter=boolToDisplay}">                    <a class="bm_cardCloseButton" role="button" href="#" data-task="{TemplateBinding task.id Converter=closeTaskById}" data-tag="DetailCardClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" />                <\/div>                <ContentPresenter content="cardContent" />            <\/div>        <\/div>    <\/div><\/div>',pu='<div>    <ResponsiveCardLane Content="{Binding $self$}" IsHidden="{Binding HideLeftLane Mode=TwoWay}" LeftLaneTask="{Binding FocusedStack.FirstTask}" SlideoutTask="{Binding slideoutTask}" LaneWidth="{StaticBinding FocusedStack.FirstTask.CurrentWidth Mode=TwoWay}" OriginalWidth="{StaticBinding FocusedStack.FirstTask.RecommendedWidth}" event:toggleCardLane="onToggleCardLane" Map="{Binding map}">        <ResponsiveCardLane.ContentTemplate>            <DataTemplate>                <div class="{Binding $self$ Converter=customScrollbarRootClass}">                    <div class="stickyFiltersRoot bold" style:width="{StaticBinding FocusedStack.FirstTask.CurrentWidth Converter=getWidthString}">                        <div class="{StaticBinding FocusedStack.FirstTask.HasTitleEnrichment Converter=boolToTitleBarClass}" event:click="onTitleBarClick" style:display="{StaticBinding FocusedStack.FirstTask Converter=displayTitleBar}">                            <div class="cardTitleText">                                <div class="title" tabindex="-1">                                    <h2>                                        <TextBlock Text="{StaticBinding FocusedStack.FirstTask.Title}" />                                    <\/h2>                                <\/div>                            <\/div>                            <TitleEnrichmentControl Task="{StaticBinding FocusedStack.FirstTask}" Enrichment="{StaticBinding FocusedStack.FirstTask.TitleEnrichment}">                            <\/TitleEnrichmentControl>                            <TaskSettingsControl Task="{StaticBinding FocusedStack.FirstTask Mode=TwoWay}" HasCardSettings="{StaticBinding FocusedStack.FirstTask.HasCardSettings Mode=TwoWay}" CardSettings="{StaticBinding FocusedStack.FirstTask.CardSettings Mode=TwoWay}"><\/TaskSettingsControl>                            <a href="#" class="panelClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" role="button" data-task="{StaticBinding FocusedStack.FirstTask.id Converter=closeTaskByIdFromHeader}">                                <div class="icon"><\/div>                            <\/a>                        <\/div>                        <FiltersControl Task="{StaticBinding FocusedStack.FirstTask}" Filters="{StaticBinding FocusedStack.FirstTask.Filters}" Width="{StaticBinding FocusedStack.FirstTask.CurrentWidth}">                        <\/FiltersControl>                    <\/div>                    <div class="{Binding $self$ Converter=customScrollbarOuterContainerClass}">                        <div class="positioning" style:display="{Binding $self$ Converter=customScrollbarPositioningStyle}">                            <div class="custom-scrollbar">                                <div class="custom-scroll-handle">                                    <div />                                <\/div>                            <\/div>                        <\/div>                        <div class="{Binding $self$ Converter=customScrollbarInnerContainerClass}">                            <div class="{Binding $self$ Converter=customScrollbarContentWrapperClass}">                                <div class="panelWrapper multi">                                    <div class="bm_waitlayer"><\/div>                                    <ItemsControl ItemsSource="{Binding stacks}">                                        <ItemsControl.Template>                                            <DataTemplate>                                                <div class="cardCol panelContent" data-containerAreaType="cardsContainer" role="main" aria-label="{StaticBinding FocusedStack.FirstTask.Title}">                                                    <ItemsPresenter />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.Template>                                        <ItemsControl.ItemTemplate>                                            <DataTemplate>                                                <div class="cardWrapper expand taskCardLane" style:width="{StaticBinding FocusedStack.FirstTask.CurrentWidth Converter=getWidthString}">                                                    <SingleTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" Task="{Binding firstTask}" event:click="onTaskCardClick" event:titleMouseEnter="onTitleMouseOver" event:titleMouseLeave="onTitleMouseLeave" />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.ItemTemplate>                                    <\/ItemsControl>                                <\/div>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ResponsiveCardLane.ContentTemplate>    <\/ResponsiveCardLane>    <ResponsiveCardLane Content="{Binding $self$}" IsHidden="{Binding slideoutTask Converter=slideoutToIsHidden}" IsSlideoutLane="true" LeftLaneTask="{Binding FocusedStack.FirstTask}" SlideoutTask="{Binding slideoutTask}" LaneWidth="{StaticBinding slideoutTask.CurrentWidth Mode=TwoWay}" OriginalWidth="{StaticBinding slideoutTask.RecommendedWidth}" event:toggleCardLane="onToggleCardLane" Map="{Binding map}">        <ResponsiveCardLane.ContentTemplate>            <DataTemplate>                <div class="{Binding $self$ Converter=customScrollbarSlideoutRootClass}" style:display="{StaticBinding FocusedStack.OverflowTask Converter=taskExistsToDisplayNone}">                    <div class="stickyFiltersRoot bold slideout" style:width="{StaticBinding slideoutTask.CurrentWidth Converter=getWidthString}" style:display="{StaticBinding slideoutTask Converter=displayTitleBar}">                        <div data-tag="backBtnContainer" class="boldUXBack">                            <a href="#" title="{StaticBinding slideoutTask.BackButtonText}" data-task="{StaticBinding slideoutTask.id Converter=closeTaskByIdFromHeader}" class="commonButton backArrowButton overlayButton" style:display="{StaticBinding slideoutTask Converter=displayBackButton}">                                <div class="overlayBackButtonText">                                    <TextBlock Text="{StaticBinding slideoutTask.BackButtonText}"/>                                <\/div>                            <\/a>                        <\/div>                        <div class="{StaticBinding slideoutTask.HasTitleEnrichment Converter=boolToTitleBarClass}" event:click="onTitleBarClick">                            <div class="cardTitleText">                                <div class="title" tabindex="-1">                                    <h2>                                        <TextBlock Text="{StaticBinding slideoutTask.Title}" />                                    <\/h2>                                <\/div>                            <\/div>                                                        <a href="#" class="panelClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" role="button" style:display="{StaticBinding slideoutTask Converter=hideCloseButton}" data-task="{StaticBinding slideoutTask.id Converter=closeTaskByIdFromHeader}">                                <div class="icon"><\/div>                            <\/a>                        <\/div>                        <FiltersControl Task="{StaticBinding slideoutTask}" Filters="{StaticBinding slideoutTask.Filters}" Width="{StaticBinding slideoutTask.CurrentWidth}">                        <\/FiltersControl>                    <\/div>                    <div class="{Binding $self$ Converter=customScrollbarOuterContainerClass}">                        <div class="positioning" style:display="{Binding $self$ Converter=customScrollbarPositioningStyle}">                            <div class="custom-scrollbar">                                <div class="custom-scroll-handle">                                    <div />                                <\/div>                            <\/div>                        <\/div>                        <div class="{Binding $self$ Converter=customScrollbarInnerContainerClass}">                            <div class="{Binding $self$ Converter=customScrollbarContentWrapperClass}">                                <div class="{Binding $self$ Converter=customScrollbarSlideContainerClass}">                                    <div class="panelWrapper multi leftPanel noScroll slide">                                        <div class="bm_waitlayer"><\/div>                                        <div class="{StaticBinding HideLeftLane Converter=getSlideoutClass}" data-containerAreaType="cardsContainer" role="complementary" aria-label="{StaticBinding SlideoutTask.Title}">                                            <div class="cardWrapper expand">                                                <SingleTaskCard LayoutMetrics="{StaticBinding focusedStack.layoutMetrics}" Stack="{StaticBinding FocusedStack}" Task="{StaticBinding SlideoutTask}" />                                            <\/div>                                        <\/div>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ResponsiveCardLane.ContentTemplate>    <\/ResponsiveCardLane>    <OverflowCard ClassName="bm_scrollbarMask overflowTaskPanel"                  Stack="{StaticBinding FocusedStack}"                  OverflowTask="{StaticBinding FocusedStack.OverflowTask}"                  LayoutMetrics="{StaticBinding FocusedStack.layoutMetrics}" /><\/div>',wu='<div style:display="{Binding HasCardSettings Converter=boolToDisplayNone}" class="bm_taskSettings">    <ContentPresenter content="CardSettings" /><\/div>',bu="<div class=\"bm_titleAugment\">    <ContentPresenter content='TitleAugmentation' /><\/div>",f=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ku=function(n){function i(t,i,r){var u=this;return t||(t={}),u=n.call(this,t)||this,u.controlTemplateFactory=i,u._templateName=r,u.disposables=[],u}return f(i,n),i.prototype.boolToDisplay=function(n){return n?"":"none"},i.prototype.boolToNotDisplay=function(n){return n?"none":""},i.prototype.nullToDisplayNone=function(n){return n?"":"none"},i.prototype.nullToDisplay=function(n){return n?"none":""},i.prototype.boolToVisibility=function(n){return n?"visible":"hidden"},i.prototype.boolToActiveClass=function(n){return n?"active":"inactive"},i.prototype.boolToInactiveClass=function(n){return this.boolToActiveClass(!n)},i.prototype.boolToDisabledClass=function(n){return n?"active":"disabled"},i.prototype.fractionToPercent=function(n){return n*100+"%"},i.prototype.update=function(){throw new Error("update is not implemented");},i.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},i.prototype.getTitle=function(){return""},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._control&&this._control.clear();this._control=null;this._templateName=null;this.controlTemplateFactory=null;u._clearDisposables(this.disposables)},i.prototype._getCardWidth=function(){return t.defaultCardWidth},i}(ht),vi=function(){function n(n,t,i,r){this.sender=n;this.primitive=t;this.oldValue=i;this.newValue=r}return n}(),rt=function(){function n(n,t,i){this._events=[];this._computeBestMapViewOnSetPrimitives=!0;this._computeBestMapViewOnDisplayStateChange=!0;this._computeBestMapViewOnTaskActivate=!1;this._map=n;this.invalidated=new r;this.mapViewChanged=new r;this.labelsRendered=new r;this.poiViewStateChanged=new r;this.primitivesRendered=new r;this._layerName=t;this._poiTemplateSelector=i;i&&i.selectorReady();this._overlayAnchor=new sr(20,-20)}return n._getOverlayTemplate=function(){return n._overlayTemplate||(n._overlayTemplate=new a(au)),n._overlayTemplate},n.prototype._isProminenceDefined=function(){return this._taskDisplayState&&typeof this._taskDisplayState.prominence!="undefined"},n.prototype._isDataDefined=function(){return typeof this._primitives!="undefined"},n.prototype._shouldInvalidate=function(){return this._isProminenceDefined()&&this._isDataDefined()&&this._isDirty&&(!this._invalidateQueued||this._isMapViewFromBackendJustSet)},n.prototype.setPrimitives=function(n,t){n&&(this._isDirty=!0,this._primitives=n,this._updatePrimitivesAndLayerData(this._isPrimaryProminence()&&this._computeBestMapViewOnSetPrimitives&&!t))},n.prototype.suppressViewChangeOnRefreshOnce=function(){this._suppressViewChangeOnRefreshOnce=!0},n.prototype.getPrimitiveAt=function(n){return this._primitives&&n>=0&&n<this._primitives.length?this._primitives[n]:null},n.prototype._setDirtyBasedOnTaskDisplayState=function(n){this._isDirty=typeof n.prominence!="undefined"&&this._taskDisplayState&&this._taskDisplayState.prominence!==n.prominence||typeof n.cardTitleHoveringState!="undefined"||typeof n.isAutoFocused!="undefined"&&this._taskDisplayState&&this._taskDisplayState.isAutoFocused!==n.isAutoFocused||n.activationState===1},n.prototype.setTaskDisplayState=function(n){var t;this._setDirtyBasedOnTaskDisplayState(n);var u=this._taskDisplayState&&this._taskDisplayState.activationState,i=n&&n.activationState,f=this._taskDisplayState&&this._taskDisplayState.prominence,e=n&&n.prominence,r=this._taskDisplayState&&n&&typeof n.isAutoFocused!="undefined"&&!this._taskDisplayState.isAutoFocused&&n.isAutoFocused;this._taskDisplayState=this._taskDisplayState||{};d.mergeProperties(this._taskDisplayState,n);t=(u!==i||f!==e)&&i===1;this._computeBestMapViewOnTaskActivate&&(this._isDirty=t);this._primitives&&(n.prominence&&!this._computeBestMapViewOnTaskActivate||this._computeBestMapViewOnTaskActivate&&t||r)?this._updatePrimitivesAndLayerData(this._isPrimaryProminence()&&this._computeBestMapViewOnDisplayStateChange&&!n.suppressViewChange,r):n.cardTitleHoveringState&&this._updatePrimitivesAndLayerData(!1)},n.prototype.dispose=function(){if(this._primitives=null,this._events){for(var n=this._events.length-1;n>=0;n--)this._events[n].dispose();this._events=null}this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._isDisposed=!0},n.prototype.getPrimitives=function(n,t){t&&t({primitives:this._primitives})},n.prototype.getLayer=function(){return this._layer},n.prototype.refreshMap=function(n,t){var i=this,r;this._suppressViewChangeOnRefreshOnce&&(n=!1,this._suppressViewChangeOnRefreshOnce=!1);this._shouldInvalidate()&&(this._invalidateQueued=!0,(this._isMapViewFromBackendJustSet||n&&!this._taskDisplayState.isAutoFocused)&&(r=this.computeBestMapView(t),r&&this.mapViewChanged.invoke(r)),Microsoft.Maps.setTimeout(function(){i._invalidateQueued=!1;i._initialized?i.invalidated.invoke():i._initialize()},0),this._isDirty=!1)},n.prototype.setPoiState=function(n,t){var i=n,r;this.poiViewStateChanged.invoke(new vi(this,i,i.viewState,t));i.viewState=t;r=i.entity&&i.entity.isPaginationReducedPoi;i.zIndex=t===1?2:this._hasClientPagination&&!r?1:0;this._createEntityChangedEvent(n);n.entity&&n.entity.changed.invoke()},n.prototype.getBestMapView=function(){return null},n.prototype.getZIndex=function(){return this._layer&&this._layer.getZIndex()},n.prototype.getLayerId=function(){return this._layer&&this._layer.getId()},n.prototype.setZIndex=function(n){this._layer&&this._layer.setZIndex(n)},n.prototype.setIconColorFromCard=function(n){var t=this;n&&(this._iconColorFromCard=n,this._primitives&&this._primitives.forEach(function(n){var i=n.entity;i&&i.isPaginationReducedPoi&&!i.iconColorFromCard&&t._iconColorFromCard&&(i.iconColorFromCard=t._iconColorFromCard)}))},n.prototype._setSelectedPrimitive=function(n,t){if(n){if(this.setPoiState(n,2),t)return;this._isDirty=!0;this.refreshMap()}},n.prototype._getTargetMapView=function(){var n,t;if(this._primitives&&(t=this._getLocations(),t=this._cullOutlierLocations(t),n=this._map.getMode().getMapViewForLocationsInView(t),this._prevTaskPrimitive&&this._prevTaskPrimitive.geometryType===1)){var i=this._prevTaskPrimitive.geometry,f=this._map.getBounds(!0,n),r=new b(i.y,i.x);if(!f.contains(r)){var e=c.fromLocation(n.cameraLocation,!0),o=new b(n.cameraLocation.latitude,n.cameraLocation.longitude,c.toAltitude(n.location,Math.floor(e-1),!0),0),u=new st(o),s=this._map.getBounds(!0,u);s.contains(r)&&(n=u)}this._prevTaskPrimitive=null}return n},n.prototype.computeBestMapView=function(){var n=null,f=this._map.getMapType(),t;if(this._primitives&&f.id!==w.birdseyeV2){if(this.disableComputingMapViewForLoadingOnly)return this.disableComputingMapViewForLoadingOnly=!1,n;var r=this._getLocations(),e=this._map.getView(),u=this._getTargetMapView(),o=h.getMapBounds(this._map,!0),i=0;for(t=r.length-1;t>=0;t--)o.contains(r[t])&&++i;i===this._primitives.length?n=this.zoomInIfNeeded(e,u):0===i&&(n=this.findBestViewForPrimitivesNotInView(u))}return n},n.prototype.zoomInIfNeeded=function(n,t){var r=c.fromLocation(n.cameraLocation,!0),i=c.fromLocation(t.cameraLocation,!0);return h.setMapCenter(this._map,t.cameraLocation,i,null,this.getDefaultAnimator(t)),t},n.prototype.zoomOutWithCurrentContext=function(n){var t=this._getTargetMapView(),i=h.getMapCenter(this._map),r=h.getZoomLevelForLocationsToBecomeVisible(this._map,n,i);return h.setMapCenter(this._map,t.cameraLocation,r,null,this.getDefaultAnimator(t)),t},n.prototype.findBestViewForPrimitivesNotInView=function(n){this._storeComputedMapView();var i=c.fromLocation(n.cameraLocation,!0);return i<=t.defaultZoomLevel?h.setMapCenter(this._map,n.cameraLocation,i):h.setMapCenter(this._map,n.cameraLocation,t.defaultZoomLevel)},n.prototype.getDefaultAnimator=function(n){var t=this._map.getView();return new gr(t,n)},n.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(this._initialized=!0,this._createLayer(n._getUniqueId(this._layerName?this._layerName:"PoiManager"),this._poiTemplateSelector),this instanceof ur||this instanceof fr||this instanceof tr?this._layer.setRenderTarget(2):this._layer.setRenderTarget(1),this._setPrimitiveLayer(),this._addLayerToMap(this._layer),this._events.push(this._layer.primitiveTapped.add(function(n){t._onPrimitiveTapped(n)})),this._events.push(this._layer.contextMenuInvoked.add(function(n){t.onContextMenuInvoked(n)})),this._events.push(this._layer.primitiveHoverStarted.add(function(n){t._onPrimitiveHoverStarted(n)})),this._events.push(this._layer.primitiveHoverStopped.add(function(n){t._onPrimitiveHoverStopped(n)})),this._events.push(this._layer.getFrameManager().primitivesRendered.add(function(n){t.primitivesRendered.invoke(n)})),this._events.push(this._map.getFrameManager().labelsRendered.add(function(){t.labelsRendered.invoke()})))},n.prototype._createLayer=function(n,t){this._layer=new fu(n,this,t,ft.foregroundZOrder)},n.prototype._setPrimitiveLayer=function(){var n=this;this._layer&&this._primitives&&this._primitives.forEach(function(t){t.layer=n._layer})},n.prototype._addLayerToMap=function(n){this._map.getLayers().insert(n)},n.prototype._onPrimitiveHoverStarted=function(n){n.primitive&&n.primitive.entity&&n.primitive.viewState!==2&&n.primitive.viewState!==3&&(this.setPoiState(n.primitive,1),sj_evt&&this._primitiveHasRichInfobox(n.primitive)&&sj_evt.fire("pushpinhoverstarted",n.primitive),this._hoverPoi=n.primitive)},n.prototype._onPrimitiveHoverStopped=function(n){(this._hoverPoi===n.primitive||n.primitive&&n.primitive.entity&&n.primitive.viewState!==2&&n.primitive.viewState!==3)&&(sj_evt&&n&&this._primitiveHasRichInfobox(n.primitive)&&sj_evt.fire("pushpinhoverstopped",n.primitive),this.setPoiState(n.primitive,0))},n.prototype._updatePrimitiveForLabeling=function(n){n.viewState!==3&&(n.entity.disablePoiLabel?delete n.bucket:this._isPrimaryProminence()?n.bucket=n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForPoi:n.taskDisplayState&&n.taskDisplayState.cardTitleHoveringState===1?n.bucket=n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForPoi:delete n.bucket)},n.prototype._isPrimaryProminence=function(){return this._isProminenceEqualTo(1)},n.prototype._getLocations=function(){var n=[];return this._primitives&&this._primitives.forEach(function(t){if(1===t.geometryType){var i=t.geometry;n.push(new b(i.y,i.x))}else k.assert(!1,"Only point primitives are supported")}),n},n.prototype._storeComputedMapView=function(){},n.prototype._resetHoveredPoi=function(n){!this._isPrimaryProminence()&&n&&n.primitive&&n.primitive.viewState!==2&&n.primitive.viewState!==3&&this.setPoiState(n.primitive,0)},n._getUniqueId=function(t){var i=n._layerIndex++;return t+"_Layer_"+i},n.prototype._onPrimitiveTapped=function(n){this._resetHoveredPoi(n);this._setSelectedPrimitive(n.primitive)},n.prototype.onContextMenuInvoked=function(n){this._setSelectedPrimitive(null);this._resetHoveredPoi(n)},n.prototype._isProminenceEqualTo=function(n){return this._taskDisplayState&&this._taskDisplayState.prominence===n},n.prototype._setEntityCollisionBehavior=function(n){n.entity.collisionBehavior=2},n.prototype._updatePrimitivesAndLayerData=function(n,t,i){var r=this,u,f;i===void 0&&(i=!0);this._primitives&&(u=this._getPoiToolTipTemplateCssClass(),f=function(){return!0},this._hasClientPagination=!1,this._primitives.forEach(function(n){n.isHoverEnabled||(n.isHoverEnabled=f);var t=n.entity;t&&t.isPaginationReducedPoi&&!t.iconColorFromCard&&r._iconColorFromCard&&(t.iconColorFromCard=r._iconColorFromCard);!r._hasClientPagination&&t&&t.isPaginationReducedPoi&&(r._hasClientPagination=!0);n.layer=r._layer;n.revision=(n.revision||0)+1;r._createEntityChangedEvent(n);r._updatePrimitiveForOverlay(n,n.entity&&[n.entity.getTitle&&n.entity.getTitle()],u);i&&(n.taskDisplayState=r._taskDisplayState,r._updatePrimitiveForLabeling(n),r._setEntityCollisionBehavior(n))}),this.refreshMap(n,t))},n.prototype._createEntityChangedEvent=function(n){n.entity&&!n.entity.changed&&(n.entity.changed=new r)},n.prototype._updatePrimitiveForOverlay=function(t,i,r){t.titles=i;t.toolTipCssClass=r;this._layer&&(this._layer.overlayAnchor=this._overlayAnchor,this._layer.overlayTemplate=n._getOverlayTemplate(),this._layer.overlayEvent=this._isPrimaryProminence()||this._primitiveHasRichInfobox(t)||this._isTransientLensEntity(t)?0:2)},n.prototype._getPoiToolTipTemplateCssClass=function(){var n="bm_poiToolTip",i=this._taskDisplayState&&this._taskDisplayState.colorIndex,t;if(i){t=this._map.getMapType().id===w.aerial?"dark":"light";switch(i){case 1:n+=" "+t+"PoiToolTipAccentColor1";break;case 2:n+=" "+t+"PoiToolTipAccentColor2";break;case 3:n+=" "+t+"PoiToolTipAccentColor3";break;case 7:n+=" "+t+"PoiToolTipTransitColor"}}return n},n.prototype._isTransientLensEntity=function(n){return i&&i.PoiOverlayEntity&&n&&n.entity instanceof i.PoiOverlayEntity},n.prototype._primitiveHasRichInfobox=function(n){var e=["90287","90232","91572","13344","house"],t,u,i,f,r;if(n){if((t=n.entity,t&&t.infoboxHtml)||n.entity instanceof uu)return!0;if(u=t&&t.getPrimaryCategoryPath&&t.getPrimaryCategoryPath(),i=u&&u.split("."),i&&i.length)for(f=i.length,r=0;r<f;++r)if(i[r]&&e.indexOf(i[r].toLowerCase())>-1)return!0}return!1},n.prototype._cullOutlierLocations=function(n){var u=.675,f=7,r,a;if(n.length<15)return n;var t=n.map(function(n){return n.latitude}),i=n.map(function(n){return n.longitude}),e=t.sort()[Math.floor(t.length/2)],o=i.sort()[Math.floor(i.length/2)],s=t.map(function(n){return Math.abs(n-e)}),h=i.map(function(n){return Math.abs(n-o)}),c=s.sort()[Math.floor(s.length/2)],l=h.sort()[Math.floor(h.length/2)];return c===0||l===0?n:(r=n.filter(function(n){var t=u*Math.abs(n.latitude-e)/c<f,i=u*Math.abs(n.longitude-o)/l<f;return t&&i}),a=n.length>20?Math.ceil(n.length/10):2,n.length-r.length>a?n:r)},n._layerIndex=1e4,n._primitiveHoverTimeoutThreshold=200,n}(),bt=function(e){function s(i){var u=this,f={};return u=e.call(this,f)||this,u.serializableObjectChanged=new r,u.primitiveInteracted=new r,u.launchOverflowTask=new r,u.resizeCard=new r,u.resizeCompleted=new r,u.toggleCompleted=new r,f.defineProperty("percentLoaded"),f.defineProperty("title"),f.defineProperty("recommendedWidth"),f.defineProperty("currentWidth",function(n,t){u._onWidthChanged(n,t)}),f.defineProperty("filters"),f.defineProperty("titleEnrichment"),f.defineProperty("hasTitleEnrichment"),f.defineProperty("cardSettings"),f.defineProperty("hasCardSettings"),f.defineProperty("disableExpansion"),f.defineProperty("backButtonText"),f.defineProperty("mapPrimitives",function(n,t){return u._onPrimitivesChanged(t)},null,{defaultValue:[]}),u.panelRoot=n(document.createElement("div")),u.setTitleEnrichment(n(document.createElement("div"))[0]),u.setHasTitleEnrichment(!1),u.setCardSettings(n(document.createElement("div"))[0]),u.setHasCardSettings(!1),u.disposables=[],u.perfLog=i,u._areEventsInitialized=!1,u.setRecommendedWidth(t.defaultCardWidth),u.setCurrentWidth(t.defaultCardWidth),u.setDisableExpansion(!1),u._taskUrlParams=[],u._taskUrlParams.push({param:"cp",paramGetter:function(){return u._getCenterPointParam()}}),u._taskUrlParams.push({param:"lvl",paramGetter:function(){return u._getZoomLevelParam()}}),u}return f(s,e),s.getImpressionGuid=function(n){var r,t,i;return n&&(t=n.select("div[data-ig]"),t&&t.length>0&&(i=t[0].getAttribute("data-ig"),i&&(r=i))),r},s.getMasterImpressionGuid=function(){var n;return o.dynamicProperties&&o.dynamicProperties.mapsIG&&(n=o.dynamicProperties.mapsIG),n},s.prototype.activate=function(n,t){var i=this,r;this.map=n;r=ot.getStartTime("SearchRequest",!0)||Date.now();ot.setStartTime(this.id,r,!0);this._areEventsInitialized||(this.poiManager&&this.disposables.push(this.poiManager.poiViewStateChanged.add(function(n){i._onPoiViewStateChanged(n)})),this._areEventsInitialized=!0);n&&this.map.getTemplateSelector().then(function(n){s._mapTemplateSelector=n;i.changed.invoke({name:"iconClass"})});this._logAdsRLinkUrl(t&&t.adsRLinkUrl)},s.prototype.setDisplayState=function(n){this.displayState=this.displayState||{};d.mergeProperties(this.displayState,n);this._setMapLayerZIndex(ft.getZOrderOfTaskPrimitives(this.displayState));this.poiManager&&this.poiManager.setTaskDisplayState(n);this.changed.invoke(new nu(this,"displayState",null,n));sj_evt&&this.displayState.prominence===1&&n.cardTitleHoveringState!==1&&n.cardTitleHoveringState!==2&&!this.displayState.pendingRemoval&&(u._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this.displayState.stackOrder===1&&sj_evt.fire("TaskActivated",{id:this.id,IG:s.getImpressionGuid(this.panelRoot)}),sj_evt.fire("TaskDisplayed",this.id))},s.prototype.deactivate=function(){this.poiManager&&(this.poiManager.dispose(),this.poiManager=null);u._clearDisposables(this.disposables);u._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("TaskDeactivated",{id:this.id,IG:s.getImpressionGuid(this.panelRoot)})},s.prototype.serialize=function(){throw new Error("serialize not implemented");},s.prototype.deserialize=function(){},s.prototype.canColorFade=function(){return t.canCardColorFade},s.prototype.hasDefaultFocusElement=function(){return!1},s.prototype.getContent=function(){return this.panelRoot&&this.panelRoot[0]},s.prototype.appendControl=function(n){this.panelRoot.append(n);this.changed.invoke()},s.prototype.addControl=function(n){this.panelRoot.clear();this.appendControl(n)},s.prototype.process=function(){},s.prototype.processCallback=function(){},s.prototype.getMenuList=function(){var n=this,r=[],u=i.GlobalConfig.features.sharing;return u&&u.isEnabled&&!u.disableOutboardSharing&&this.isSharable()&&r.push({name:g.L_Menu_Share_Link_Text,handler:function(){return n._share()},cssClass:"menuShareItem",instData:this.getInstData("Share")}),this.hasPrintContent()&&r.push({name:g.L_Menu_Print_Link_Text,handler:function(){p.invokeHandler(y.printDataHandlerKey,{source:2,taskType:n.type,taskId:n.id,data:n.getPrintInstrumentationData()})},cssClass:"menuPrintItem",instData:this.getInstData("Print")}),t.enableListView&&r.push({name:g.L_Menu_ListView_Link_Text,handler:function(){p.invokeHandler(y.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})},cssClass:"menuSeeAllItem",instData:this.getInstData("ListView")}),r},s.prototype.getPrintInstrumentationData=function(){return null},s.prototype.getCardIconInfo=function(){throw new Error("Not implemented");},s.prototype.hasPrintContent=function(){return!1},s.prototype.getPrintContent=function(){return null},s.prototype.getTaskUrlParams=function(){for(var i,r,t="",n=0,u=this._taskUrlParams.length;n<u;n++)i=this._taskUrlParams[n],r=i.paramGetter(),r&&(n>0&&(t+="&"),t+=i.param+"="+r);return t},s.prototype._onPoiViewStateChanged=function(n){if(n&&n.oldValue&&n.newValue===2){var t={action:"focus",id:this.id};p.invokeHandler(y.taskDataHandlerKey,t)}},s.prototype.setCloseButtonClass=function(){var r=this.panelRoot,t,i,e,o,s,h,c,a;if(r.length>0&&(t=n(".bm_cardClose"),t.length>0)){i=r.select(".b_subModule.noborder");i.length===0&&(i=r.select(".wpc_module"));var f=i.length>0&&i.parent(),u=f&&f.length>0&&f[0].firstElementChild,l=!0;u&&u.classList&&(u.classList.contains("b_subModule")||u.classList.contains("wpc_module"))&&i.length>0&&i[0].childElementCount>0&&(e=i.select(".mapActionsModule"),l=!e||e.length===0);l?t.add_class("collage"):t.remove_class("collage");o=n(".sponad-taskpane");s=n(".faketab",r[0]);o&&o.length>0||s&&s.length>0?t.add_class("sponad"):t.remove_class("sponad");h=!1;c=r.select(".b_wftp.overlay-taskpane");c.length>0&&(a=c.select(".b_img_carousel:first-child .cico"),a.length===0&&(h=!0));h?(t.add_class("bm_no-images-layout"),r.add_class("bm_no-images-layout")):(t.remove_class("bm_no-images-layout"),r.remove_class("bm_no-images-layout"))}},s.prototype._onPrimitivesChanged=function(n){this.poiManager&&this.poiManager.setPrimitives(n)},s.prototype._canRenderPrimitives=function(n,t){var r,f;if(n.fromSharing&&t)for(r=0,f=t.length;r<f;r++){var i=t[r],e=i&&i.geometry&&i.geometry.y,o=i&&i.geometry&&i.geometry.x;if(e&&o&&u._shouldDisableShareForPoint(i.geometry.y,i.geometry.x))return!1}return!0},s.prototype.isReportable=function(){return!1},s.prototype.isSharable=function(){return!1},s.prototype._setMapLayerZIndex=function(n){n&&this.poiManager&&this.poiManager.setZIndex(n)},s.prototype.shouldResize=function(){return!1},s.prototype.getSupportedSize=function(){return[]},s.prototype.getSlideoutSupportedSize=function(){return[]},s.prototype._share=function(){p.invokeHandler(y.shareDataHandlerKey,{action:"shareTasks",taskIds:[this.id],entryPoint:vr.TaskCard})},s.prototype.getInstData=function(n){return{logData:{feature:"CD",action:"C",data:{TT:this.type,TID:this.id,MI:n}}}},s.prototype.getCardIcons=function(n){return!this._cardIcons&&s._mapTemplateSelector&&n&&n!==l.FallbackLocalCat&&(this._cardIcons=[this._buildCardIcon(ar.white,n),this._buildCardIcon(null,n),this._buildCardIcon(s._decayedCardIconColor,n),this._buildCardIcon(null,n)]),this._cardIcons},s.prototype.getIconColorAndClassName=function(n){n(null,null)},s.prototype._buildCardIcon=function(n,t,i){var r,f,e,h;return s._mapTemplateSelector&&(f=o.isMobile?40:28,e=o.isMobile?48:36,r=u._createElement("div"),r.set_style({width:f+"px",height:e+"px","padding-top":"4px"}),h=s._mapTemplateSelector.getCategoryIconTemplate(function(n){var t=n&&n.icon,u=n&&n.iconColor;t&&r.append(t.renderIcon());i&&i(u)},t,n,f,e)),r},s.prototype._overrideGlinkPing=function(){s._glinkPingProxy||(s._glinkPingProxy=s._glinkOverride,s._originalglinkPing=window.si_ct);window.si_ct=s._glinkPingProxy},s.prototype._onWidthChanged=function(){},s.prototype._getMainUrlFormCode=function(){var n=u._getUrlParam(window.location,"FORM");return n?n:null},s.prototype.close=function(){var n=this;setTimeout(function(){p.invokeHandler(y.taskDataHandlerKey,{action:"removeStackForTask",id:n.id})},1e3)},s.prototype._createUrlWithMainFormCode=function(n){var t,i;return(n&&n.toLowerCase().indexOf("mcig")<0&&(t=o.dynamicProperties.mapsIG,t&&(n+="&MCIG="+t)),i=this._getMainUrlFormCode(),i&&n&&n.toLowerCase().indexOf("&form")<0)?n+"&FORM="+i:n},s._glinkOverride=function(){for(var t,n=arguments[0],i;n&&n.getAttribute;){if(i=n.getAttribute("data-ig"),i){t=_G.IG;_G.IG=i;break}n=n.parentElement}s._originalglinkPing.apply(this,arguments);t&&(_G.IG=t)},s.prototype._getCenterPointParam=function(){var t="",n;return this.map&&(n=this.map.getMode().getState(),t+=n.centerPoint.latitude.toFixed(6)+"~"+n.centerPoint.longitude.toFixed(6)),t},s.prototype._getZoomLevelParam=function(){var n="",t;return this.map&&(t=this.map.getMode().getState(),n+=t.level),n},s.prototype._logAdsRLinkUrl=function(n){n&&sj_ajax&&sj_ajax(decodeURIComponent(n))},s._unfocusedCardIconColor="rgba(255, 255, 255, 0.8)",s._decayedCardIconColor="#919191",s}(ht),ct=function(t){function i(n){var i=this,u={};return i=t.call(this,u)||this,i._privates=u,i.id=n,i.displayState={},i._handlers={},i.serializableObjectChanged=new r,i.tasksRemoved=new r,i.taskAdded=new r,i.overflowTaskAdded=new r,i.stackSelected=new r,i.onHiddenStateChanged=new r,i._tasks=[],i.flipAnimationCompleted=new r,u.defineProperty("foregroundTask",function(){i.serializableObjectChanged.invoke()},null,{isPrivate:!0,defaultValue:null}),u.defineProperty("isSelected",function(n,t){n!==null&&n!==undefined&&i.stackSelected.invoke({stack:i,isSelected:t})}),u.defineProperty("isLocked",null,null,{defaultValue:!1}),u.defineProperty("overflowTask",function(n,t){i._overflowTaskChanged(n,t)}),i}return f(i,t),i.prototype.addTask=function(n,t,i){var r,u;if(!n){k.throwException("Invalid task passed to TaskStack.addTask");throw 1;}if(this._getTaskIndex(n.id)>=0){k.throwException("Attempt to add task to stack that already contains it");throw 1;}if(r=0,t){if(u=this._getTaskIndex(t),u<0){k.throwException("Invalid parentId passed to TaskStack.addTask");throw 1;}r=u+1;i&&(this._savedSlideoutTask=this._tasks[r],this._tasks[r].isSavedSlideoutTask=!0,this._tasks[r].setDisplayState({activationState:2}))}this._pruneStack(r);this.setTaskAt(n,r);this.setForegroundTask();this.taskAdded.invoke(n)},i.prototype.dispose=function(){t.prototype.dispose.call(this);this._pruneStack(0,!0)},i.prototype.focusTask=function(n){var t,i=this._getTaskIndex(n);i>=0?(this._pruneStack(i+1),this.setForegroundTask()):n===((t=this._savedSlideoutTask)===null||t===void 0?void 0:t.id)&&(this._savedSlideoutTask.isSavedSlideoutTask=!1,this._savedSlideoutTask.setDisplayState({activationState:1}),this._pruneStack(1),this.setTaskAt(this._savedSlideoutTask,1),this.setForegroundTask(),this._savedSlideoutTask=null)},i.prototype.getTask=function(n){var t=this._getTaskIndex(n);return t>=0?this._tasks[t]:null},i.prototype.getAllTasks=function(){return this._tasks},i.prototype.removeAllTasks=function(){this._pruneStack(0);this.setForegroundTask()},i.prototype.removeTask=function(n){var t=this._getTaskIndex(n);this._savedSlideoutTask&&t===1&&n!==this._savedSlideoutTask.id&&(this._savedSlideoutTask.deactivate(),this._savedSlideoutTask=null);t>=0&&(this._pruneStack(t),this.setForegroundTask())},i.prototype.removeChildren=function(n,t){var i=this._getTaskIndex(n);i>=0&&this._pruneStack(i+1,t)},i.prototype.setForegroundTask=function(){var n=this._tasks.length>0?this._tasks[this._tasks.length-1]:null,t=n&&n;t&&this._tasks.length>1&&(n.type===s.feedbackTask||t.getCurrentWidth&&t.getCurrentWidth()===944)&&this._adjustLeftRail(this._tasks.length===3);this._privates.setForegroundTask(n)},i.prototype.setTaskAt=function(n,t){var r=this;this._addSerializationHandlers(n);this._tasks[t]=n;n.stackId=this.id;n instanceof bt&&n.launchOverflowTask.add(function(n){r._createOverflowTask(n)});i.setTaskDisplayState(n,{stackOrder:t+1})},i.prototype.getTasksByType=function(n,t){this._tasks.forEach(function(i){i&&i.type===n&&t.push(i)})},i.prototype.getFirstTask=function(){var n,t;return this._tasks.length!==0?(n=this._tasks.length-1,n>0)?(t=this._tasks[n],t.noSlideout?t:this._tasks[n-1]):this._tasks[0]:null},i.prototype.setDisplayState=function(n,t){var u,r;for(t===void 0&&(t=!0),typeof n.isHidden!="undefined"&&n.isHidden!==this.displayState.isHidden&&this.onHiddenStateChanged.invoke(n.isHidden),d.mergeProperties(this.displayState,n),u=n.activationState===1,u&&(n.activationState=2,n.suppressViewChange=!0),r=0;r<this._tasks.length;r++)u&&r===this._tasks.length-1&&(n.activationState=1,n.suppressViewChange=!1,i.setTaskDisplayState(this._tasks[r],n)),i.setTaskDisplayState(this._tasks[r],n);t&&this.serializableObjectChanged.invoke({magnitude:0})},i.setTaskDisplayState=function(n,t){return n&&(n.displayState=n.displayState||{},d.mergeProperties(n.displayState,t),n.setDisplayState&&n.setDisplayState(t)),!!n},i.prototype.serialize=function(n,t){function e(i,r){var f=!1;return i&&(!r||r&&i.isSharable())&&(u.tasks.push({id:i.id,ds:i.displayState,type:i.type.replace("Task",""),state:i.serialize(n,t)}),f=!0),f}var i=!1,u={id:this.id,ds:this.displayState,tasks:[]},r,f;if(t&&t===2)this._tasks&&this._tasks.length>0&&(i=i||e(this._tasks[this._tasks.length-1],!0));else{for(r=0;r<this._tasks.length;r++)e(this._tasks[r],!1);i=!0}return f=this.getOverflowTask(),f&&(u.overflowTaskOptions=f.getOptions()),i?u:null},i.prototype.deserialize=function(n){if(this.id&&this.id!=n.id){k.throwException("Attempt to deserialize into incorrect task stack");throw 1;}n.overflowTaskOptions&&this._createOverflowTask(n.overflowTaskOptions);this.id=n.id},i.prototype.getTaskUrlParams=function(){for(var r,t,i="",n=0,u=this._tasks.length;n<u;n++)r=this._tasks[n],t=r.getTaskUrlParams(),i+=n===0?t:"&child="+encodeURIComponent(t);return i},i.prototype._addSerializationHandlers=function(n){var t=this;n&&!this._handlers[n.id]&&n.serializableObjectChanged&&(this._handlers[n.id]=n.serializableObjectChanged.add(function(n){t.serializableObjectChanged.invoke(n)}))},i.prototype._removeSerializationHandlers=function(n){var t=n&&this._handlers[n.id];t&&(t.dispose(),delete this._handlers[n.id])},i.prototype._getTaskIndex=function(n){for(var i=-1,t=0,r=this._tasks.length;t<r;t++)if(this._tasks[t].id===n){i=t;break}return i},i.prototype._pruneStack=function(n,t){var u=this,i,r;n>=0&&n<this._tasks.length&&(i=this._tasks.splice(n),i.forEach(function(n){u._removeSerializationHandlers(n)}),t||this.tasksRemoved.invoke(i),r=this.getOverflowTask(),n>0&&r&&(r.deactivate(),this.setOverflowTask(null)))},i.prototype._overflowTaskChanged=function(n,t){this.overflowTaskAdded.invoke(t);!t&&n&&this._removeSerializationHandlers(n)},i.prototype._createOverflowTask=function(n){var t=null;n.taskType===0?t=new lt(n):n.taskType===1&&(t=new gt(n));this.setOverflowTask(t);this._addSerializationHandlers(t)},i.prototype._adjustLeftRail=function(t){var e=t?this._tasks[1]:this._tasks[0],u,i,o,f,r;if(e.getCurrentWidth&&(u=e.getCurrentWidth(),i=n("div[data-subtaskid="+this._tasks[0].id+"]"),i.length>0)){if(this._tasks.length>1)for(o=i.getParent().getParent(),f=o[0].children,r=0;r<f.length;r++)n(f[r]).set_style({width:u+"px"});i.getParent().set_style({width:u+"px"})}},i}(ht),du=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("stack"),i.defineProperty("overflowTask",function(n,i){t._onOverflowTaskChanged(n,i)}),i.defineProperty("layoutMetrics"),i.defineProperty("className"),i.defineProperty("showWoWIframe"),t.setTemplate(new a(eu,t)),t.setShowWoWIframe(!1),t._isNpsSurveyClosed=!1,t._subscribeToWoWIframe(),t}return f(t,n),t.prototype.taskExistsToDisplay=function(n){return n?"":"none"},t.prototype.taskExistsToWoWDisplay=function(n){return o.features.taskFramework.showWoW?this.taskExistsToDisplay(n):"none"},t.prototype.taskExistsToWoWRequestUrl=function(n){return o.features.taskFramework.showWoW?n?this._formatWoWRequestUrl():"about:blank":"about:blank"},t.prototype._formatWoWRequestUrl=function(){var t=o.features.taskFramework.woWRequestUrl,n=o.dynamicProperties;return t.replace("{lang}",n.uiLanguage).replace("{ig}",n.impressionGuid).replace("{isAAD}",n.isAADAuthenticated?"true":"false").replace("{cid}",n.clientId)},t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype._subscribeToWoWIframe=function(){var n=this,t=function(t){t.origin.indexOf("services.bingapis.com")>=0&&t.data.closeNPSSurvey&&(n._isNpsSurveyClosed=!0,n.setShowWoWIframe(!1))};window.addEventListener("message",function(n){t(n)},!1)},t.prototype._onOverflowTaskChanged=function(n,t){o.features.taskFramework.showWoW&&this.setShowWoWIframe(!this._isNpsSurveyClosed&&!!t)},t}(ei);a.registerControl("OverflowCard",du);yi=function(e){function o(){var n=this,t={};return n=e.call(this,t)||this,n._privates=t,t.defineProperty("isHidden"),t.defineProperty("isSlideoutLane",function(t,i){n._onSetSlideout(i)}),t.defineProperty("isSlideoutCollapsed"),t.defineProperty("isCardlaneCollapsed"),t.defineProperty("showExpandButton"),t.defineProperty("useMapPeek"),t.defineProperty("laneWidth"),t.defineProperty("originalWidth"),t.defineProperty("leftLaneTask",function(t,i){n._onLeftLaneTaskChanged(t,i)}),t.defineProperty("slideoutTask",function(t,i){n._onSlideoutTaskChanged(t,i)}),t.defineProperty("map",function(t,i){n._onSetMap(i)}),n.resources=g,n.setLaneWidth(0),n.toggleCardLane=new r,n.setTemplate(new a(ou,n)),n._resizeHandler=function(){n._determineResize()},n._detailsFromListHandler=function(){n._updateDetailsWidth()},n._mapInteractionHandler=function(){n._mapInteracted()},sj_evt.bind("ResultsOverlayActivating",function(){o._updateOverlayLoadedOnNextLeftLaneTaskChange=!0}),sj_evt.bind("LargeMapHidden",function(){o._overlayLoaded=!1;o._updateOverlayLoadedOnNextLeftLaneTaskChange=!1}),n}return f(o,e),o.prototype.hideLeftLane=function(n){return n?"none":""},o.prototype.boolToNotDisplay=function(n){return n?"none":""},o.prototype.displayExpandCollapse=function(n){return n&&this.getIsSlideoutLane()||!n&&!this.getIsSlideoutLane()?"":"none"},o.prototype.toggleShowClick=function(n){var u=this,r,i,t;n.stopPropagation();n.preventDefault();o._wideCardTipCurrentlyShowing&&o._tip.removeTip();this.getIsSlideoutCollapsed()&&!this.getIsCardlaneCollapsed()?(this.setIsSlideoutCollapsed(!1),this.setLaneWidth(this.getOriginalWidth()),o._userPrefersNarrow=!1,i=this.getSlideoutTask(),i?(this._afterResized(!0),i.resizeCard.invoke(),i.toggleCompleted.invoke("EXP")):(this._afterResized(!1),this.getLeftLaneTask().resizeCard.invoke(),this.getLeftLaneTask().toggleCompleted.invoke("EXP"))):(r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("EXP"),i=this.getSlideoutTask(),i&&i.toggleCompleted.invoke("EXP"),r&&r.getRecommendedWidth()===944&&r.getCurrentWidth()===464&&!this.getIsCardlaneCollapsed()?(this.setLaneWidth(944),r.setCurrentWidth(944),this._afterResized(!1),this.setShowExpandButton(!1)):this.toggleCardLane.invoke(),this.setIsCardlaneCollapsed(!1));t=this.getSlideoutTask();t?t.resizeCompleted.addOne(function(){return u._updateMapView(t)}):(t=this.getLeftLaneTask(),(t.getRecommendedWidth()!==t.getCurrentWidth()||t.getCurrentWidth()===944)&&t.resizeCompleted.addOne(function(){return u._updateMapView(t)}));this._updateViewportPadding();this.setShowExpandButton(this._enableExpandButton(t))},o.prototype.toggleHideClick=function(n){var u=this,r,i,t;n&&n.stopPropagation();n&&n.preventDefault();(o._collapseTipShown||this.getLaneWidth()>=944)&&typeof o._updateMapViewInvoked=="undefined"&&(o._updateMapViewInvoked=0);o._wideCardTipCurrentlyShowing&&o._tip.removeTip();this.getLaneWidth()>=944?(this.setIsSlideoutCollapsed(!0),this.setLaneWidth(464),i=this.getSlideoutTask(),this._afterResized(typeof i!="undefined"&&i!==null),o._userPrefersNarrow=!0,r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("CLP"),i&&i.toggleCompleted.invoke("CLP")):(r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("CLP"),i=this.getSlideoutTask(),i&&i.toggleCompleted.invoke("CLP"),this.toggleCardLane.invoke(),this.setIsCardlaneCollapsed(!0));t=this.getSlideoutTask();t?t.resizeCompleted.addOne(function(){return u._updateMapView(t)}):(t=this.getLeftLaneTask(),t.getRecommendedWidth()!==t.getCurrentWidth()&&t.resizeCompleted.addOne(function(){return u._updateMapView(t)}));this._updateViewportPadding();this.setShowExpandButton(this._enableExpandButton(t))},o.prototype.collapseCardLane=function(){this.toggleHideClick(null)},o.prototype._updateViewportPadding=function(){var n=0,i=this.getSlideoutTask(),t;n=this.getIsCardlaneCollapsed()?0:i?i.getCurrentWidth()+o.listingCardPadding+o.detailsCardPadding:this.getLeftLaneTask().getCurrentWidth()+o.detailsCardPadding;t=ut._NavBarPadding;this.getMap().setViewportPadding({left:_G.RTL?t:n,right:_G.RTL?n:t,top:ut._taskbarHeight,bottom:ut._footerHeight})},o.prototype._onLeftLaneTaskChanged=function(n,t){!this.getIsSlideoutLane()&&t&&(t.responsiveCardLane=this,!u._isLargeMapShownOnSerp()||o._overlayLoaded?t.getRecommendedWidth()===944?this._updateSingleEntityBoldCardWidth(t):!t.shouldResize()&&t.getRecommendedWidth()?(this.setLaneWidth(t.getRecommendedWidth()),t.setCurrentWidth(t.getRecommendedWidth())):t.resizeCard.addOne(this._resizeHandler):t.getRecommendedWidth()===944?(o._overlayLoaded=!0,this._updateSingleEntityBoldCardWidth(t)):t.resizeCard.addOne(this._resizeHandler),n&&(o._invokeResizeOnSlideoutChange=!0));t&&(this.setIsCardlaneCollapsed(!1),this.setShowExpandButton(this._enableExpandButton(t)));o._updateOverlayLoadedOnNextLeftLaneTaskChange&&(o._overlayLoaded=!0)},o.prototype._onSlideoutTaskChanged=function(n,t){var h=this,r=!1,f,s,e;this.getIsSlideoutLane()?!n&&t?!u._isLargeMapShownOnSerp()||o._overlayLoaded?(t.resizeCard.addOne(this._detailsFromListHandler),r=!0):(o._overlayLoaded=!0,t.resizeCompleted.addOne(function(){return h._updateMapView(t)}),s=this.getLeftLaneTask(),e=this._getLeftLaneSize(s,t),e===0?(u.setLeftLaneHidden(!0),t instanceof i.Local.LocalDetailsTask&&t.addBackToListBtn(),this._updateCardPrimerPosition(e),this._updateSingleEntityBoldCardWidth(t)):this._updateDetailsWidth()):t&&(t.resizeCard.addOne(this._detailsFromListHandler),r=!0,this.setShowExpandButton(this._enableExpandButton(t))):(n&&n.resizeCard.remove(this._resizeHandler),t&&t.resizeCard.add(this._resizeHandler),!n&&t&&(f=this._getLeftLaneSize(this.getLeftLaneTask(),t),f===0&&(this.setIsHidden(!0),u.setLeftLaneHidden(!0),this._updateCardPrimerPosition(f))));this.getIsSlideoutLane()&&t&&o._invokeResizeOnSlideoutChange&&!r&&(t.resizeCard.invoke(),o._invokeResizeOnSlideoutChange=!1);this.getIsSlideoutLane()&&t&&(t.responsiveCardLane=this);n&&!t&&(this.getIsSlideoutLane()?(this.setIsSlideoutCollapsed(!1),this.setShowExpandButton(!1)):(this.setLaneWidth(this.getOriginalWidth()),this.setIsHidden(!1),u.setLeftLaneHidden(!1)))},o.prototype._enableExpandButton=function(n){if(this.getIsCardlaneCollapsed())return!0;if(n.getDisableExpansion())return!1;if(this.getIsSlideoutLane()&&this.getIsSlideoutCollapsed()||!this.getIsSlideoutLane()){var t=this.getIsSlideoutLane()?this.getSlideoutTask():this.getLeftLaneTask();return t&&t.getRecommendedWidth()>=944&&t.getCurrentWidth()===464}return!1},o.prototype._determineResize=function(){var c=this;o._invokeResizeOnSlideoutChange=!1;var t=this.getSlideoutTask(),i=this.getLeftLaneTask(),r=i.getRecommendedWidth(),f=i.getCurrentWidth();if(r===944)this._updateSingleEntityBoldCardWidth(i);else if(i.setCurrentWidth(r),t){t.resizeCompleted.addOne(function(){return c._updateMapView(t)});var l=n("body")[0].clientWidth,e=l-o.listPlusDetailsMinMapWidth-o.listingCardPadding-o.detailsCardPadding,s=t.getSupportedSize(),h=Math.max.apply(Math,s),a=Math.min.apply(Math,s);if(f+h<e&&h===944)return;f+a<e?t.setDisableExpansion(!0):(t.setDisableExpansion(!0),this.setIsHidden(!0),u.setLeftLaneHidden(!0))}},o.prototype._updateSingleEntityBoldCardWidth=function(t){var u=this,r,i;o._invokeResizeOnSlideoutChange=!1;r=n("body")[0].clientWidth;i=r-o.singleEntityMinMapWidth-o.detailsCardPadding;i<944||o._userPrefersNarrow||t.getDisableExpansion()||t.getRecommendedWidth()<944?(this.setLaneWidth(464),t.setCurrentWidth(464),this._afterResized(!1),t.getDisableExpansion()||t.setDisableExpansion(i<944||t.getRecommendedWidth()<944),this.setShowExpandButton(!t.getDisableExpansion())):(this.setLaneWidth(944),t.setCurrentWidth(944),this._afterResized(!1),this.setShowExpandButton(!1));o._disableMapViewForFirstTimeLoad=t.poiManager&&t.poiManager.disableComputingMapViewForLoadingOnly;t.resizeCompleted.addOne(function(){return u._updateMapView(t)})},o.prototype._updateDetailsWidth=function(){o._invokeResizeOnSlideoutChange=!1;var n=this.getSlideoutTask();n&&(o._userPrefersNarrow||n.getDisableExpansion())&&n.getRecommendedWidth()>=944?(this.setLaneWidth(464),n.setCurrentWidth(464),this._afterResized(!0),this.setIsSlideoutCollapsed(!0),this.setShowExpandButton(!n.getDisableExpansion())):(this.setIsSlideoutCollapsed(!1),this.setShowExpandButton(!1))},o.prototype._getLeftLaneSize=function(t,i){var r=t.getCurrentWidth(),e=n("body")[0].clientWidth,u=e-o.listPlusDetailsMinMapWidth-o.listingCardPadding-o.detailsCardPadding,f=t.getSlideoutSupportedSize(),s=Math.max.apply(Math,f),h=Math.min.apply(Math,f);return r+s<u?r:r+h<u?(i.setDisableExpansion(!0),r):0},o.prototype._afterResized=function(i){var r=i?this.getSlideoutTask():this.getLeftLaneTask(),f=n("#"+r.resizableComponentId),e;f.length>0&&(e=u._getWaterfallResizeEventName(t,r.resizableComponentId),sj_evt.fire(e,f[0]));sj_evt.fire("slideoutScroll",null)},o.prototype._onSetSlideout=function(n){n&&t.isNarrowFirst&&(o._userPrefersNarrow=!0)},o.prototype._onSetMap=function(n){this.disposables.push(n.mapTapped.add(this._mapInteractionHandler),n.mapZoomStarted.add(this._mapInteractionHandler),n.mapPanStarted.add(this._mapInteractionHandler))},o.prototype._mapInteracted=function(){var r=this._getVisibleMapWidth(),i=this.getSlideoutTask(),u=this.getLeftLaneTask(),e=i?i.getCurrentWidth():u?u.getCurrentWidth():0,t,f;!o._wideCardTipCurrentlyShowing&&o._collapseTipShown&&!o._mapTipShown&&r!==-1&&r<300&&e===944&&(t=n(".resizeButton.hide"),t.length>0&&(f=i?t.length-1:0,this._buildTip("L_CollapseButton_Tip",t[f],!1),o._mapTipShown=!0,this.getMap().mapTapped.remove(this._mapInteractionHandler),this.getMap().mapZoomStarted.remove(this._mapInteractionHandler),this.getMap().mapPanStarted.remove(this._mapInteractionHandler)))},o.prototype._updateMapView=function(i){var r,s,u,e,f;o._overlayLoaded=!0;o._invokeResizeOnSlideoutChange=!1;r=i.displayState&&i.displayState.stackOrder===2&&!this.getIsHidden();(r||i.getRecommendedWidth()!==i.getCurrentWidth()||i.getCurrentWidth()===944)&&((i.getRecommendedWidth()===944||i.getCurrentWidth()===484)&&i.poiManager&&(o._disableMapViewForFirstTimeLoad?(o._disableMapViewForFirstTimeLoad=!1,s=i.poiManager._getTargetMapView(),s&&h.setMapCenter(this.getMap(),s.cameraLocation,this.getMap().getMercatorZoomLevel())):(i.poiManager._isDirty=!0,i.poiManager._isMapViewFromBackendJustSet=!0,i.poiManager.refreshMap(!0),i.poiManager._isMapViewFromBackendJustSet=!1)),t&&t.isNarrowFirst&&typeof o._updateMapViewInvoked=="undefined"&&!i.getDisableExpansion()?o._updateMapViewInvoked=1:t&&t.isMapPeek&&o._updateMapViewInvoked===0&&!i.getDisableExpansion()&&(o._updateMapViewInvoked=1),o._collapseTipShown||i.getCurrentWidth()!==944?!o._expandTipShown&&o._updateMapViewInvoked&&i.getCurrentWidth()===464&&i.getRecommendedWidth()===944&&(e=n(".resizeButton.show"),e.length>0&&(f=r?e.length-1:0,this._buildTip("L_ExpandButton_Tip",e[f],!0),o._wideCardTipCurrentlyShowing=!0,o._expandTipShown=!0)):(u=n(".resizeButton.hide"),u.length>0&&(f=r?u.length-1:0,this._buildTip("L_CollapseButton_Tip",u[f],!0),o._wideCardTipCurrentlyShowing=!0,o._collapseTipShown=!0)),typeof o._updateMapViewInvoked!="undefined"&&o._updateMapViewInvoked++)},o.prototype._getVisibleMapWidth=function(){if(!this.getSlideoutTask()||!this.getLeftLaneTask())return-1;var t=n("body")[0].clientWidth,i=u.getVerticalTaskBarWidth()+this.getSlideoutTask().getCurrentWidth()+this.getLeftLaneTask().getCurrentWidth();return t-i-60},o.prototype._buildTip=function(t,i,r){var u=this.getMap().getContainer().instance("UserTipControl",{title:null,messages:[this.resources[t]],noFade:!1,clickAwayToClose:r,isDark:!0,isLinkMessage:!1,tipTemplate:null,tipDisplayTime:7e3}),f,e;u.setShowClose(!1);u.setShowBeak(!0);u.setCustomCssOverride("signinmessage");this.disposables.push(u.tipRemoved.add(function(){o._tip=null;o._wideCardTipCurrentlyShowing=!1}));o._tip&&o._tip.removeTip();o._tip=u;f=n(i).get_absolute_pos();e=u.getRootElement();e.set_style({top:f.y-f.height+10,left:f.x+f.width+10});this.getMap().getRootElement().getParent().append(e);e.select(".tooltipBeak").set_style({transform:"rotate(-90deg)",top:f.height/2+"px",left:-(e.get_size().width+5)+"px"})},o.prototype._updateCardPrimerPosition=function(t){var r=t===0?t:t+32,i=n(".taskLayoutSkeletonContainer.bm_l2NavLeft");i&&i.length>0&&i.set_style({left:r+"px"})},o.listingCardPadding=36,o.detailsCardPadding=24,o.listPlusDetailsMinMapWidth=300,o.singleEntityMinMapWidth=300,o._userPrefersNarrow=!1,o._invokeResizeOnSlideoutChange=!1,o._updateOverlayLoadedOnNextLeftLaneTaskChange=!1,o._overlayLoaded=!1,o}(it);a.registerControl("ResponsiveCardLane",yi);pi=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,t._privates=i,i.defineProperty("task"),i.defineProperty("hasCardSettings"),i.defineProperty("cardSettings"),t.setTemplate(new a(wu,t)),t}return f(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this)},t}(it);a.registerControl("TaskSettingsControl",pi);wi=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,t._privates=i,i.defineProperty("enrichment",function(){t._onEnrichmentChange()}),i.defineProperty("task"),t}return f(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this)},t.prototype._onEnrichmentChange=function(){this.setTemplate(new a(bu,this))},t.prototype.getTitleAugmentation=function(){var n=this.getTask();return n?n.getTitleEnrichment():document.createElement("div")},t}(it);a.registerControl("TitleEnrichmentControl",wi);var kt=function(){function t(t){var i=this,u;this.delayedUpdateTimeForScrollBar=1;this.contentHeight=0;this.visibleHeight=0;this.scrollRatio=0;this.hasScroll=!1;this.scrollHandleHeight=0;this.startDragHandlePos=0;this.startDragMousePos=0;this.scrollbar=null;this.scrollHandle=null;this.innerContainer=null;this.contentWrapper=null;this.scrollElement=null;this.isRtl=_G.RTL;this.defaultScrollHandleHeight=100;this.scrollPos=0;this.scrollTopChanged=new r;this.scrollElement=t[0];this.scrollbar=t.select(".custom-scrollbar")[0];this.scrollHandle=t.select(".custom-scroll-handle")[0];this.innerContainer=t.select(".inner-container")[0];this.contentWrapper=t.select(".content-wrapper")[0];u=t.select(".outer-container")[0];u&&(u.addEventListener("click",function(n){i._onClick(n)}),u.addEventListener("mousedown",function(n){i._onMouseDown(n)}));this.innerContainer&&(this.innerContainer.style[this.isRtl?"marginLeft":"marginRight"]=-this._getScrollbarWidth()+"px",this.innerContainer.addEventListener("scroll",function(n){i._onScroll(n);sj_evt.fire("customScrolled",n)}),this.innerContainer.addEventListener("wheel",function(n){i._onWheel(n)}),this._getScrollbarWidth(),this._scrollbarRenderingOnContent&&this.innerContainer.classList.add("scrollBarRenderingOnContent"));this._windowMouseDragEventHandler=function(n){n.preventDefault();var t=n.pageY-i.startDragMousePos,r=i._getBoundValue(i.startDragHandlePos+t,0,i.visibleHeight-i.scrollHandleHeight),u=i._getScrollValueFromHandlePosition(r);i._updateScrollPosition(u)};this._windowMouseDragEndEventHandler=function(t){t.preventDefault();n(i.scrollbar).remove_class("onScrolling");n(i.scrollElement).remove_class("onScrolling");document.removeEventListener("mousemove",i._windowMouseDragEventHandler);document.removeEventListener("mouseup",i._windowMouseDragEndEventHandler)};sj_be&&sj_be(_w,"resize",function(){i._delayedUpdateScrollBar(100)})}return t.prototype.componentDidMount=function(){this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar)},t.prototype.componentDidUpdate=function(n){n===void 0&&(n=!0);this.contentHeight!==this._getContentHeight()&&this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar,n?0:null)},t.prototype.setScrollPosition=function(n){this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar,n)},t.prototype.scrollToTarget=function(n){var t=this;this.targetTimer&&sb_ct(this.targetTimer);this.targetTimer=sb_st(function(){t._updateScrollBar(null,n)},this.delayedUpdateTimeForScrollBar)},t.prototype._delayedUpdateScrollBar=function(n,t){var i=this;this.timer&&sb_ct(this.timer);this.timer=sb_st(function(){i._updateScrollBar(t)},n)},t.prototype._getScrollbarWidth=function(){if(!this._cachedScrollbarWidth){var n=u._createElement("div"),t=u._createElement("div");n.append(t);n.appendTo(document.body);n.set_style({overflow:"scroll",height:"100px",width:"100px"});t.set_style({height:"100%",width:"100%"});this._cachedScrollbarWidth=n[0].offsetWidth-t[0].offsetWidth;this._cachedScrollbarWidth===0&&(this._scrollbarRenderingOnContent=!0,this._cachedScrollbarWidth=17);n.removeFromParent()}return this._cachedScrollbarWidth},t.prototype._calculateLayoutSizes=function(){if(this.innerContainer){this.contentHeight=this._getContentHeight();var n=this.innerContainer;this.visibleHeight=n.clientHeight;this.scrollRatio=this.contentHeight?this.visibleHeight/this.contentHeight:1}},t.prototype._getContentHeight=function(){if(this.contentWrapper&&this.contentWrapper.firstElementChild){var t=this.contentWrapper.firstElementChild.clientHeight,n=window.getComputedStyle(this.contentWrapper.firstElementChild);return n&&(t+=(parseInt(n.marginTop)||0)+(parseInt(n.marginBottom)||0)),t}return 0},t.prototype._toggleScrollIfNeeded=function(){var t=this.contentHeight-this.visibleHeight>1;this.hasScroll!==t&&(this.hasScroll=t,this.hasScroll?n(this.scrollbar).add_class("hasScroll"):n(this.scrollbar).remove_class("hasScroll"))},t.prototype._updateScrollBar=function(n,t){this._calculateLayoutSizes();this.scrollbar&&(this.scrollbar.style.height=this.visibleHeight+"px");this.innerContainer&&typeof n=="number"?this._setScrollTop(n):this.innerContainer&&t&&this._setScrollTop(this._getNewScrollTop(t));this._toggleScrollIfNeeded();this._render()},t.prototype._updateScrollPosition=function(n){var t=this._getBoundValue(n,0,this.contentHeight-this.visibleHeight);this._setScrollTop(t);this._setScrollBarPosition()},t.prototype._onClick=function(n){if(this.hasScroll&&this._isMouseEventOnCustomScrollbar(n)&&!this._isMouseEventOnScrollHandle(n)){var t=this._calculateNewScrollHandleTop(n),i=this._getScrollValueFromHandlePosition(t);this._updateScrollPosition(i)}},t.prototype._isMouseEventOnCustomScrollbar=function(n){if(!this.scrollbar)return!1;var u=this.scrollElement,t=u.getBoundingClientRect(),r=this.scrollbar.getBoundingClientRect(),i=this.isRtl?{left:t.left,right:r.right}:{left:r.left,width:t.right},f={left:i.left?i.left:t.left,right:i.right?i.right:t.right,top:t.top,height:t.height,width:i.width?i.width:t.width};return this._isEventOnRect(n,f)},t.prototype._isMouseEventOnScrollHandle=function(n){if(!this.scrollHandle)return!1;var t=this.scrollHandle;return this._isEventOnElement(n,t)},t.prototype._calculateNewScrollHandleTop=function(n){var i=this.scrollElement,r=i.getBoundingClientRect(),u=r.top+window.pageYOffset,f=n.pageY-u,t=this._getScrollHandleStyle().top,e=f>t+this.scrollHandleHeight;return e?t+Math.min(this.scrollHandleHeight,this.visibleHeight-this.scrollHandleHeight):t-Math.max(this.scrollHandleHeight,0)},t.prototype._getScrollValueFromHandlePosition=function(n){return n/this.scrollRatio},t.prototype._getScrollHandleStyle=function(){var n=this.scrollPos*this.scrollRatio;return this.scrollHandleHeight=this.visibleHeight*this.scrollRatio,{height:this.scrollHandleHeight,top:n}},t.prototype._onMouseDown=function(t){this.hasScroll&&this._isMouseEventOnScrollHandle(t)&&(this.startDragHandlePos=this._getScrollHandleStyle().top,this.startDragMousePos=t.pageY,n(this.scrollbar).add_class("onScrolling"),n(this.scrollElement).add_class("onScrolling"),document.addEventListener("mousemove",this._windowMouseDragEventHandler),document.addEventListener("mouseup",this._windowMouseDragEndEventHandler))},t.prototype._onScroll=function(n){this.hasScroll||this._updateScrollBar();this.hasScroll&&(this._setScrollTop(n.currentTarget.scrollTop),this._setScrollBarPosition())},t.prototype._onWheel=function(n){this.hasScroll||(this._calculateLayoutSizes(),this._toggleScrollIfNeeded());this.hasScroll||(this._setScrollTop(0),n.preventDefault(),n.stopPropagation())},t.prototype._enforceMinHandleHeight=function(n){var t=this.defaultScrollHandleHeight;if(n.height>=t)return n;var i=t-n.height,r=this.contentHeight-this.visibleHeight>0?this.scrollPos/(this.contentHeight-this.visibleHeight):0,u=i*r,f=n.top-u;return{height:t,top:f}},t.prototype._setScrollBarPosition=function(){if(this.scrollHandle){var n=this._enforceMinHandleHeight(this._getScrollHandleStyle());this.scrollHandle.style.top=this._ensureValidScrollHandleTop(n.top)+"px"}},t.prototype._ensureValidScrollHandleTop=function(n){if(n<0)return 0;var t=this.visibleHeight-this.scrollHandle.clientHeight;return n>t?t:n},t.prototype._getBoundValue=function(n,t,i){return(t=!t&&t!==0?n:t,i=!i&&i!==0?n:i,t>i)?n:n<t?t:n>i?i:n},t.prototype._isEventOnElement=function(n,t){var i=t.getBoundingClientRect();return this._isEventOnRect(n,i)},t.prototype._isEventOnRect=function(n,t){return n.clientX>t.left&&n.clientX<t.right&&n.clientY>t.top&&n.clientY<t.top+t.height},t.prototype._render=function(){this._setScrollHandleStyle()},t.prototype._setScrollHandleStyle=function(){if(this.scrollHandle){var n=this._enforceMinHandleHeight(this._getScrollHandleStyle());this.scrollHandle.style.height=n.height+"px";this.scrollHandle.style.top=n.top+"px"}},t.prototype._getNewScrollTop=function(t){for(var r=t.offsetTop,i=t.offsetParent,u=n(this.innerContainer);u.has(i);)r+=i.offsetTop,i=i.offsetParent;return r},t.prototype._setScrollTop=function(n){this.innerContainer&&(this.innerContainer.scrollTop!==n&&(this.innerContainer.scrollTop=n),this.scrollPos=n,this.scrollTopChanged.invoke(n))},t}(),dt=function(n){function t(t){var i=n.call(this)||this;return i._options=t,i}return f(t,n),t.prototype.getOptions=function(){return this._options},t}(bt),gt=function(n){function t(t){var i=n.call(this,t)||this;return i._privates.defineProperty("panelTitle"),i.id="autosOverflow",i._autosOverflowTaskOptions=t,i.setPanelTitle(t.title),i}return f(t,n),t.prototype.getOptions=function(){return this._autosOverflowTaskOptions},t.prototype.getCardIconInfo=function(){return{iconClass:""}},t}(dt),lt=function(n){function t(t){var i=n.call(this,t)||this;return i._privates.defineProperty("panelTitle"),i._privates.defineProperty("showWaitLayer"),i.id="overflow",i._shoppingOverflowTaskoptions=t,i.setPanelTitle(t.title),i._loadContent(i._getInitialLoadingUrl(),!0),i._requeryHandler=function(n){n&&i.handleShoppingPanelRequery(n)},i._expandHandler=function(n){var t=n&&n.length>1&&n[1];i.heightExpanded.invoke(t)},i.newContentAdded=new r,i.heightExpanded=new r,sj_evt.bind("shoppingPanelRequery",i._requeryHandler),i}return f(t,n),t.prototype.getOptions=function(){return this._shoppingOverflowTaskoptions},t.prototype._loadContent=function(n,t){var i=this,r,u,f;n.indexOf("{0}")!==-1&&(r=this._getFormCode(),n=n.replace("{0}",r));u=function(t){try{i.panelRoot.clear();sj_appHTML(i.panelRoot[0],t);sj_evt.unbind("shoppingPanelRequery",i._requeryHandler);sj_evt.bind("shoppingPanelRequery",i._requeryHandler);sj_evt.unbind("shopexpandopen",i._expandHandler);sj_evt.bind("shopexpandopen",i._expandHandler);sj_evt.unbind("shopexpandclose",i._expandHandler);sj_evt.bind("shopexpandclose",i._expandHandler);sj_evt.fire("onPP");i.newContentAdded.invoke();i.setShowWaitLayer(!1);n!==i._shoppingOverflowTaskoptions.currentUrl&&(i._shoppingOverflowTaskoptions.currentUrl=n,i.serializableObjectChanged.invoke({magnitude:2}))}finally{}};t||this.setShowWaitLayer(!0);f=pt.downloadGeneric(n,"shoppingLayer",u,null,function(){},null,0,null,ot.getLogKeyFromUrl(n))},t.prototype.makeProductsSearch=function(n){if(this._shoppingOverflowTaskoptions.productSearchUrl){var t=this._shoppingOverflowTaskoptions.productSearchUrl.replace("{1}",encodeURIComponent(n));this._loadContent(t)}},t.prototype.getCardIconInfo=function(){return{iconClass:""}},t.prototype.handleShoppingPanelRequery=function(n){n.length>1&&this._loadContent(n[1])},t.prototype._getFormCode=function(){switch(this._shoppingOverflowTaskoptions.entryPoint){case 0:return t._serpDetailsFormCode;case 1:return t._oneMapDetailsFormCode;default:return""}},t.prototype._getInitialLoadingUrl=function(){if(this._shoppingOverflowTaskoptions.currentUrl)return this._shoppingOverflowTaskoptions.currentUrl;if(this._shoppingOverflowTaskoptions.productRootKeyword&&this._shoppingOverflowTaskoptions.productSearchUrl){var n=this._shoppingOverflowTaskoptions.productSearchUrl.replace("{1}",encodeURIComponent(this._shoppingOverflowTaskoptions.productRootKeyword));return k.getFunctionalTestHooksEnabled()&&(n+="&bag=VP_Maps.MapsAnswer.shoppingPanel_pressureCookers"),n}return k.getFunctionalTestHooksEnabled()&&(this._shoppingOverflowTaskoptions.loadingUrl+="&bag=VP_Maps.MapsAnswer.shoppingPanel_bestBuy"),this._shoppingOverflowTaskoptions.loadingUrl},t._serpDetailsFormCode="LTPSHP",t._oneMapDetailsFormCode="MAPSHP",t}(dt),v=function(i){function e(){var n=this,u={};return n=i.call(this,u)||this,n._privates=u,u.defineProperty("stack",function(t,i){return n._onStackChanged(i)}),u.defineProperty("sideATask",function(t,i){return n._onSideAChanged(t,i)},null,{isPrivate:!0}),u.defineProperty("sideBTask",function(t,i){return n._onSideBChanged(t,i)},null,{isPrivate:!0}),u.defineProperty("sideATitle"),u.defineProperty("sideBTitle"),u.defineProperty("cssClass"),u.defineProperty("sideATitleID"),u.defineProperty("sideBTitleID"),u.defineProperty("isListCard"),u.defineProperty("isDetailsCard"),u.defineProperty("layoutMetrics"),n.click=new r,n.touchstart=new r,n.touchmove=new r,n.touchend=new r,n._isNewActionBarButtons=t.enableNewActionBarButtons,n.setIsListCard(!0),n.setIsDetailsCard(!1),n.rendered.add(function(){n._onRendered()}),n.setTemplate(new a("<div><ContentPresenter /><\/div>")),sj_evt.bind("BirdsEyeDeactivated",function(){n._showOrHideContextualTaskBar(n.getSideATask(),n.getSideBTask())}),n}return f(e,i),e.prototype._onClick=function(){return},e.prototype._onTouchstart=function(n){this.touchstart.invoke({event:n,card:this,panel:this._getPanelWrapper()})},e.prototype._onTouchmove=function(n){this.touchmove.invoke({event:n,card:this,panel:this._getPanelWrapper()})},e.prototype._onTouchend=function(n){this.touchend.invoke({event:n,card:this,panel:this._getPanelWrapper()})},e.prototype._getContent=function(n){var t=this.getLayoutMetrics();return n&&t&&n.getContent(t)},e.prototype.getSideAContent=function(){return this._getContent(this.getSideATask())},e.prototype.getSideBContent=function(){return this._getContent(this.getSideBTask())},e.prototype._flipCard=function(){var o=this,r=this.getStack(),i=r&&r.getForegroundTask(),u,a,v,w,y;if(i){if(!this.getSideATask()&&!this.getSideBTask()){this._privates.setSideATask(i);this._setCardFaces(!0);return}u=!this.isSideAFront;u?this._privates.setSideATask(i):this._privates.setSideBTask(i);var p=u?this.getSideBTask():this.getSideATask(),b=p&&p.displayState.stackOrder||0,k=Math.min(Math.max(i.displayState.stackOrder-b,-1),1),f=this.getRootElement(),h=f.select(".cardFace.front"),s=f.select(".cardFace.back"),c=null,l={"backface-visibility":"hidden",visibility:"visible",outline:"none"};if(n.Browser.is_edge&&t.edgeFlipCardAnimationFix&&(l.outline="1px solid transparent"),h.set_style(l),s.set_style(l),c=function(){var c,t,i,n;for(o._setCardFaces(u),u?o._privates.setSideBTask(null):o._privates.setSideATask(null),h.set_style({transform:"",visibility:"visible"}),s.set_style({transform:"",visibility:"","backface-visibility":""}),r.flipAnimationCompleted.invoke(),e.setFocusToTitle(r,f),c=r.getAllTasks(),t=0;t<c.length;t++)i=c[t],n=i&&i.displayState,n&&n.prominence===1&&n.activationState===1&&n.animationState===1&&o._setTaskTitleState(i,!0)},a=d.getValue(i,"percentLoaded"),v=i,v.changed&&typeof a=="number"&&a!==1&&(s.set_style({height:h[0].clientHeight+"px"}),w=v.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&(w.dispose(),s.set_style({height:""}))})),!k||r.displayState.activationState!==1){c();return}if(y=this._getPanelWrapper(),y&&y.has_class("leftPanel")){var g=this._panelWrapper.get_size(),nt=this._panelWrapper.get_scroll_pos(),tt=f.get_relative_pos();f.set_style({"perspective-origin":"50% "+(g.height/2-(tt.y-nt.y))+"px"})}c()}},e.prototype._onStackChanged=function(n){var i=this,t;this._stackChanged&&this._stackChanged.dispose();t=null;n&&(this._stackChanged=n.changed.add(function(n){n.name==="foregroundTask"&&i._flipCard()}),t=n.getAllTasks());this._privates.setSideBTask(null);this._privates.setSideATask(n&&n.getForegroundTask());this._setCardFaces(!0)},e.prototype._showOrHideContextualTaskBar=function(n,t){var i=this.getStack(),e,u,f,r,o,h,c;if(i&&(e=i.displayState&&i.displayState.activationState,e===1)){for(u=i.getAllTasks(),f=!1,r=0,o=u.length;r<o;r++)if(u[r].type===s.localListingTask){f=!0;break}f?(h=n&&n.type===s.localListingTask,c=t&&t.type===s.localListingTask,h||c?sj_evt.fire("ShowContextualTaskbar"):sj_evt.fire("HideContextualTaskbar")):sj_evt.fire("ShowContextualTaskbar")}},e.prototype._onSideAChanged=function(n,t){var i=this;n&&n.changed.remove(this._setSideATaskChanged);t&&(this.disposables.push(t.changed.add(function(n){return i._setSideATaskChanged(t,n)})),this.setSideATitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())));this._showOrHideContextualTaskBar(t,this.getSideBTask())},e.prototype._onSideBChanged=function(n,t){var i=this;n&&n.changed.remove(this._setSideBTaskChanged);t&&(this.disposables.push(t.changed.add(function(n){return i._setSideBTaskChanged(t,n)})),this.setSideBTitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())));this._showOrHideContextualTaskBar(this.getSideATask(),t)},e.prototype._setSideATaskChanged=function(n,t){t&&t.name==="title"&&this.setSideATitle(n.getTitle());this._updateCardClass(t);this._setTaskTitleState(n)},e.prototype._setSideBTaskChanged=function(n,t){t&&t.name==="title"&&this.setSideBTitle(n.getTitle());this._updateCardClass(t);this._setTaskTitleState(n,!0)},e.prototype._updateCardClass=function(n){n&&n.name==="displayState"&&n.newValue&&n.newValue.prominence&&(this.setCssClass(this._getCardClass(this.getStack())),this._showOrHideContextualTaskBar(this.getSideATask(),this.getSideBTask()))},e.prototype._setCardFaces=function(n){var t=this.getRootElement(),i=n?e.SideASelector:e.SideBSelector,r=n?e.SideBSelector:e.SideASelector;t.select(i).swap_class("back","front");t.select(r).swap_class("front","back");this.isSideAFront=n},e.prototype._getPanelWrapper=function(){if(!this._panelWrapper){var n=this.getRootElement();do if(n=n.get_ancestor(1),n.has_class("panelWrapper")){this._panelWrapper=n;break}while(n[0])}return this._panelWrapper},e.prototype._getCardTitle=function(){return this.getRootElement().select(".front .cardTitleText")},e.prototype._getCardCloseButton=function(){return this.getRootElement().select(".cardFace .panelClose")},e.prototype._onRendered=function(){var n=this;this.getRootElement().add_event("click",function(t){n._onClick(t)},!0);this.getRootElement().add_event("touchstart",function(t){n._onTouchstart(t)},!0);this.getRootElement().add_event("touchmove",function(t){n._onTouchmove(t)},!0);this.getRootElement().add_event("touchend",function(t){n._onTouchend(t)},!0);e.setFocusToTitle(this.getStack(),this.getRootElement())},e.prototype._getCardClass=function(n){return n?e._replaceCardClass(n.id,this.getRootElement(),""):""},e._getCardCssClassForTask=function(n,t){var i=t.select("[data-taskId='"+n+"']");return i?i.get_attr("class"):null},e._replaceCardClass=function(n,t,i){var f=e._getCardCssClassForTask(n,t),r=f?f:"taskCard",u=e._taskCardRegex.exec(r);return u&&u.length===1&&(r=r.replace(u[0],i)),r.trim()},e.setFocusToTitle=function(t,i){var r=t&&t.getForegroundTask(),l,h,f,u,o,c;if(r&&(r.type!==s.localGuideTask&&r.type!==s.localGuideL2Task||e.taskHasBeenInitialized)&&(l=r&&r.hasDefaultFocusElement&&r.hasDefaultFocusElement(),!l&&r))if(t.getAllTasks().length>1){if(h=n(".cardCol.slidecard.panelContent"),h.length>0)e._focusDetailCloseBtn(h);else if(i&&i.length>0)for(f=i[0].children,u=0;u<f.length;u++)f[u].classList.contains("front")&&e._focusDetailCloseBtn(n(f[u]))}else r.id.toLowerCase().indexOf("detail")>-1||r.id.toLowerCase().indexOf("poly")>-1?this._focusDetailCloseBtn(i):(o=n(".titleBar",i[0]),o.length===0&&(o=n(".titleBar")),c=n(".title",o[0]),c.length>0&&c[0].focus())},e._focusDetailCloseBtn=function(t){for(var u,r=t.select(".bm_cardCloseButton"),i=0;i<r.length;i++)if(u=n(r[i].parentElement),u.get_style("display")!=="none"){r[i].focus();return}},e.prototype._setTaskTitleState=function(t,i){var e,l,a,v,s,y;if(i===void 0&&(i=!1),t&&t.displayState&&t.displayState.activationState===1&&t.displayState.prominence===1&&t.displayState.animationState===1){var r=t&&t.id,o=n(".taskCard"),f=o;for(e=0;e<o.length;e++)if(o[e].classList.contains("focus")){f=n(o[e]);break}var h=f.select(".cardFace.sideA"),p=f.select(".cardFace.sideB"),c=h.has_class("front")?h:p;r=c.get_attr("data-subtaskid");r.length>0&&(r.indexOf("Feedback")>-1?(l=n(".feedbackBackButton",c[0]),l.length>0?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):r.indexOf("ItineraryDetails")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1),a=t,u&&u.itineraryCloseButtonHandler(a,r)):r.indexOf("Detail")>-1||r.indexOf("TransitLine")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1),v=n(".backArrowButton.overlayButton",f[0]),s=n(".bm_cardClose",f[0]),v.length>0&&s.length>0?s.add_class("itin"):s.remove_class("itin")):r.indexOf("Collections")>-1?(y=n(".collectionBack"),i||y.length>0?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):(this.setIsDetailsCard(!1),this.setIsListCard(!0)))}else this.setIsDetailsCard(!1),this.setIsListCard(!1)},e.GrayedOutStyle="ac9",e.SideASelector=".cardFace.sideA",e.SideBSelector=".cardFace.sideB",e.taskHasBeenInitialized=!1,e._taskCardRegex=new RegExp("ac[0-9]s*"),e}(it);a.registerControl("TaskCard",v);bi=function(n){function t(){var t=n.call(this)||this;return t._privates.defineProperty("disabled",function(n,i){var r=t.getStack();r.displayState.activationState=4;r.setIsLocked(i);t.setCssClass(t._getCardClass(r))},null,{defaultValue:!1}),t._isChangePublicInProgress=!1,t}return f(t,n),t.prototype._clickHandler=function(n){var u=this,r,t;if(n&&n.stopPropagation(),r=this.getStack(),t=r.getForegroundTask(),t.type.toLowerCase()==="collectionstask")if(t.isSharable()){if(t.isPublicCollection&&!t.isPublicCollection()&&!this._isChangePublicInProgress){n.preventDefault();r.setIsLocked(!0);r.setIsSelected(!1);this._isChangePublicInProgress=!0;t.makePublic&&t.makePublic(function(n){u._isChangePublicInProgress=!1;r.setIsLocked(!1);n?(u._flipCheckBox(null,!0),u._showMadePublicPrompt()):(u._flipCheckBox(null,!1),u._showPrompt(i.ResourceManager.Collections.L_MakePublicFail_Text))});return}}else n.preventDefault(),this._showPrompt(i.ResourceManager.Collections.L_ShareOnlySpecificCollection_Text);this.getDisabled()||r.getIsLocked()||this._flipCheckBox(n)},t.prototype._onStackChanged=function(t){n.prototype._onStackChanged.call(this,t);var i=t.getForegroundTask();this.setDisabled(!(i.isSharable&&i.isSharable()))},t.prototype._onRendered=function(){var r=this;n.prototype._onRendered.call(this);var t=this.getRootElement(),u=t.select("input"),i=function(n){r._clickHandler(n)};t.add_event("click",i,!0);u.add_event("pointerdown",i,!0);nt.changeStackFocusState(this.getStack(),1)},t.prototype._getCardClass=function(t){var i=n.prototype._getCardClass.call(this,t),t=this.getStack(),r,u;return this.getDisabled()||!t.getIsSelected()?i=this._getGrayedOutCss(i):(r=t.getForegroundTask(),u=r&&r.canColorFade&&r.canColorFade(),u&&t.displayState.activationState===4&&(i=this._getGrayedOutCss(i))),i},t.prototype._getGrayedOutCss=function(n){return t._styleParsingRegex.test(n)?n.replace(t._styleParsingRegex,v.GrayedOutStyle):n+" "+v.GrayedOutStyle},t.prototype._showMadePublicPrompt=function(){var n=this,t=this.isSideAFront?this.getSideATitle():this.getSideBTitle(),r=i.ResourceManager.Collections.L_MakePublicSuccess_Text.replace("{0}",t);this._showPrompt(r,{undoClick:function(t){t.preventDefault();var r=n.getStack().getForegroundTask();n._isChangePublicInProgress=!0;n._currentPrompt.getRootElement().select(".undoLink").add_class("nonClickable");r&&r.makePrivate&&r.makePrivate(function(t){n._isChangePublicInProgress=!1;t?(n._flipCheckBox(null,!1),n._closeCurrentPrompt()):n._showPrompt(i.ResourceManager.Collections.L_UndoFail_Text)})}},'<a href="#" class="undoLink" event:click="undoClick"><TextBlock text="{StaticBinding resources.L_Undo_Text}" /><\/a>')},t.prototype._showPrompt=function(n,r,u){var l=this,o,e,s,h,w,c;this._closeCurrentPrompt();var y={},f=new ei(y),p={closeClick:function(){l._closeCurrentPrompt()},resources:i.ResourceManager.Collections};if(r)for(o=Object.keys(r),e=o.length-1;e>=0;e--)s=o[e],p[s]=r[s];y.defineProperty("promptText");f.setTemplate(new a(t._promptControlTemplate.replace("{0}",u?u:""),p));h=f.getRootElement();document.body.appendChild(h[0]);w=this.getRootElement().select(this.isSideAFront?v.SideASelector:v.SideBSelector).select("input[type=checkbox]");c=w.get_absolute_pos();h.set_style({top:c.y+"px",left:c.x+30+"px"});f.setPromptText(n);Microsoft.Maps.setTimeout(function(){l._closeCurrentPrompt()},5e3);this._currentPrompt=f},t.prototype._closeCurrentPrompt=function(){this._currentPrompt&&(this._currentPrompt.dispose(),this._currentPrompt.getRootElement().removeFromParent(),this._currentPrompt=null)},t.prototype._flipCheckBox=function(n,t){var u=this.getRootElement().select(this.isSideAFront?v.SideASelector:v.SideBSelector).select("input[type=checkbox]"),i=u[0],r;t!==undefined?this.getStack().setIsSelected(t):n&&n.target!=i&&(r=!i.checked,this.getStack().setIsSelected(r))},t._styleParsingRegex=new RegExp("ac\\d+","gi"),t._promptControlTemplate='<div class="collectionsMakePublicPrompt"><div class="close" event:click="closeClick">X<\/div><div class="prompt"><TextBlock text="{TemplateBinding promptText}" /><span> <\/span>{0}<\/div><\/div >',t}(v);a.registerControl("SelectionTaskCard",bi);nt=function(t){function i(i,u){var f=this,e={},o;return f=t.call(this,e)||this,e.defineProperty("cssClass"),e.defineProperty("task",function(n,t){f._onTaskChanged(n,t)}),e.defineProperty("stack",function(n,t){f._onStackChanged(n,t)}),e.defineProperty("dataTaskId"),e.defineProperty("cardTitle"),e.defineProperty("titleBarRole",null,null,{defaultValue:"button"}),e.defineProperty("isListCard"),e.defineProperty("isDetailsCard"),e.defineProperty("layoutMetrics"),f._emptyCardContent=document.createElement("div"),f.setIsListCard(!0),f.setIsDetailsCard(!1),f.click=new r,f.titleMouseEnter=new r,f.titleMouseLeave=new r,f.rendered.add(function(){f._onRendered()}),i||(i=yu),o={resources:g,stringToDisplay:function(n){return n?"block":"none"},boolToDisplay:function(n){return n?"":"none"},closeTaskById:function(t){return n.Internals.stringify({id:t,action:"removeTaskAndReseatChild"})},onTitleBarClick:function(n){f._onTitleBarClick(n)},onTitleMouseEnter:function(n){f.titleMouseEnter.invoke(n)},onTitleMouseLeave:function(n){f.titleMouseLeave.invoke(n)},getWidthString:function(n){return n?n+"px":""}},u&&(f._ie11ObjectAssignPolyfill(),Object.assign(o,u)),f.setTemplate(new a(i,o)),f}return f(i,t),i.prototype._onRendered=function(){v.setFocusToTitle(this.getStack(),this.getRootElement());var n=this.getTask();this._setTaskTitleState(n)},i.prototype.getCardContent=function(){if(this.getTask()){var n=this.getLayoutMetrics();return this.getTask().getContent(n)}return this._emptyCardContent},i.prototype._getCardClass=function(n){var t,i;if(n)return t=v._replaceCardClass(n.id,this.getRootElement(),""),n&&n.displayState&&(i=n.displayState.prominence,t+=i===1||typeof i=="undefined"?" focus":" collapsed hidden"),t},i.prototype._getCardTitle=function(){return this.getRootElement().select(".front .cardTitleText")},i.changeStackFocusState=function(t,i){if(t&&(t.getIsLocked()||t.getIsSelected())&&(i=1),t){var u=n('[data-taskid="'.concat(t.id,'"]')),r=u.select(".titleBar");i===1?r.add_class("unfocused"):r.remove_class("unfocused")}},i.prototype._onTaskChanged=function(n,t){var r=this;this._setDataTaskId();n&&t&&n.id&&n.id.indexOf("LocalListingTask")===0?!u._getIsSlideCardEnabled()&&t.id&&t.id.indexOf("LocalDetailsTask")===-1&&sj_evt&&sj_evt.fire("HideContextualTaskbar"):n&&t&&t.id&&t.id.indexOf("LocalListingTask")===0&&sj_evt&&sj_evt.fire("ShowContextualTaskbar");t&&(this._taskContentsChanged&&this._taskContentsChanged.dispose(),this.disposables.push(this._taskContentsChanged=t.changed.add(function(n){var f=n&&n.name,u;f==="title"?r.setCardTitle(t.getTitle()):f==="displayState"&&n.newValue&&n.newValue.prominence&&(r.setCssClass(r._getCardClass(r.getStack())),u=n.newValue.prominence,u===1?i.changeStackFocusState(r.getStack(),0):u!==2&&i.changeStackFocusState(r.getStack(),3))})),this.setCardTitle(t.getTitle()),this.setTitleBarRole(this.getRootElement().get_ancestor(2).has_class("slidecard")?"":"button"),this._setTaskTitleState(t))},i.prototype._onStackChanged=function(n,t){this._setDataTaskId();this.setCssClass(this._getCardClass(t))},i.prototype._setDataTaskId=function(){var n=this.getTask(),t=this.getStack();this.setDataTaskId(n&&n.id&&t&&t.id)},i.prototype._onTitleBarClick=function(n){n.preventDefault();return},i.prototype._setTaskTitleState=function(t){var r,f,e,i;t&&t.id&&t.id.length>0&&(r=t.id,t.type===s.itineraryDetailsTask?(this.setIsDetailsCard(!0),this.setIsListCard(!1),f=t,u&&u.itineraryCloseButtonHandler(f,r)):r.indexOf("Detail")>-1||t.type===s.transitLineTask?(this.setIsDetailsCard(!0),this.setIsListCard(!1)):t.type===s.feedbackTask?(e=n("div[data-subtaskid="+r+"]"),i=n(".feedbackBackButton",e[0]),i.length>0&&i.get_style("display").indexOf("none")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1)):i.length>0&&i.get_style("display").indexOf("none")===-1?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):(this.setIsDetailsCard(!1),this.setIsListCard(!0)))},i.prototype._ie11ObjectAssignPolyfill=function(){typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(n){"use strict";var u,i,t,r;if(n===null||n===undefined)throw new TypeError("Cannot convert undefined or null to object");for(u=Object(n),i=1;i<arguments.length;i++)if(t=arguments[i],t!==null&&t!==undefined)for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(u[r]=t[r]);return u},writable:!0,configurable:!0})},i}(it);a.registerControl("SingleTaskCard",nt);ki=function(i){function r(){var n=this,r={onCloseOverflowClick:function(t){n._onCloseOverflowClick(t)},onProductSearchClick:function(t){n._onSearchClick(t)},onSearchKeyPressed:function(t){n._onSearchKeyPressed(t)},isShoppingTask:function(n){return n&&n instanceof lt?"":"none"}},t;return n=i.call(this,vu,r)||this,n._privates.defineProperty("searchText"),n._privates.defineProperty("showAutosuggest",function(t,i){n._setClickAwayHandler(i)}),t=n.getRootElement().select(".shop_aslist"),n._autoSuggestList=t.length>0&&t[0],n._currentSuggestionIndex=-1,n.setShowAutosuggest(!1),n._scrollToTopHandler=function(){n._scrollToTop()},n._updateScrollHandler=function(t){n._updateScrollHeight(t)},n._windowClickEventHandler=function(t){n&&n.rendered&&Microsoft.Maps.setTimeout(function(){if(t){var i=n.getRootElement().select(".shoppingSearchbox");(i.length===0||t.target!==i[0])&&n.setShowAutosuggest(!1)}},1)},n}return f(r,i),r.prototype._onTaskChanged=function(n,t){i.prototype._onTaskChanged.call(this,n,t);var r=null,u=null;n instanceof lt&&(r=n);t instanceof lt&&(u=t);this.setSearchText("");r&&(r.newContentAdded.remove(this._scrollToTopHandler),r.heightExpanded.remove(this._updateScrollHandler));u&&(u.newContentAdded.add(this._scrollToTopHandler),u.heightExpanded.add(this._updateScrollHandler));t instanceof dt?document.body.classList.add("overflowOpen"):document.body.classList.remove("overflowOpen")},r.prototype._initCustomScroll=function(){t.customScrollbar&&!this._customScroll&&(this._customScroll=new kt(this.getRootElement()))},r.prototype._scrollToTop=function(){this._initCustomScroll();this._customScroll&&this._customScroll.componentDidMount()},r.prototype._updateScrollHeight=function(n){this._customScroll&&this._customScroll.scrollToTarget(n)},r.prototype._onCloseOverflowClick=function(n){var t,i,r;n&&(n.preventDefault(),n.stopPropagation(),t=this.getStack(),t&&(i=t.getOverflowTask(),r=i&&i.getOptions(),i&&i.deactivate(),this.setSearchText(""),t.setOverflowTask(null),t.serializableObjectChanged.invoke(),this._logAction("CLS",r&&r.impressionGuid)))},r.prototype._onSearchClick=function(n){n.preventDefault();n.stopPropagation();this.setShowAutosuggest(!1);this._initiateShoppingSearch()},r.prototype._onSearchKeyPressed=function(n){var u=this,t=n.keyCode,r,i;t&&(t===13?(this.setShowAutosuggest(!1),this._initiateShoppingSearch()):t===38?(n.preventDefault(),this._highlightAutoSuggest(!0)):t===40?(n.preventDefault(),this._highlightAutoSuggest(!1)):(r=this.getTask(),i=r&&r.getOptions(),i&&i.autosuggestEndpoint&&Microsoft.Maps.setTimeout(function(){u._sendAutoSuggest(i.autosuggestEndpoint)},1)))},r.prototype._initiateShoppingSearch=function(){var t=this.getSearchText(),n,i;t&&(this._autoSuggestRequest&&this._autoSuggestRequest.abort(),this._autoSuggestRequest=null,n=this.getTask(),n.makeProductsSearch(t),i=n.getOptions(),this._logAction("SRCH",i.impressionGuid))},r.prototype._logAction=function(n,t){var i={logData:{feature:oi.Shopping,action:n},impressionGuid:t};p.invokeHandler(y.instrumentationDataHandlerKey,i)},r.prototype._sendAutoSuggest=function(t){var e=this,u,r,f,i;this._currentSuggestionIndex=-1;u=n(".shoppingSearchboxContainer .shoppingSearchbox");r=this.getSearchText();u.length>0&&(r=u[0].value);r&&t&&t.indexOf("{1}")>-1?(f=t.replace("{1}",encodeURIComponent(r)),i=sj_gx(),i.open("GET",f,!0),i.onreadystatechange=function(){e._processAutosuggestions(i)},i.send(),this._autoSuggestRequest=i):(this._autoSuggestList.innerHTML="",this.setShowAutosuggest(!1))},r.prototype._processAutosuggestions=function(n){var f=this,r,t,i,u;if(n.readyState===4&&n.status===200){this._autoSuggestRequest=null;try{if(r=!1,n.responseText&&n.responseText.length&&(t=sj_ce("div"),t.innerHTML=n.responseText,t.firstChild&&(this._autoSuggestList.innerHTML=t.firstChild.innerHTML,this._autoSuggestList.childElementCount>0))){for(i=0;i<this._autoSuggestList.childElementCount;i++)u=this._autoSuggestList.childNodes[i],u&&(r=!0,u.addEventListener("click",function(n){f._autosuggestClickHandler(n)}));this.setShowAutosuggest(!0)}r||(this._autoSuggestList.innerHTML="",this.setShowAutosuggest(!1))}catch(e){}}},r.prototype._highlightAutoSuggest=function(n){var i,t,u;this._autoSuggestList.childElementCount>0?(this._currentSuggestionIndex>-1&&this._currentSuggestionIndex<this._autoSuggestList.childElementCount&&(i=this._autoSuggestList.childNodes[this._currentSuggestionIndex],i&&i.classList.remove(r._highlightClassName)),n?(--this._currentSuggestionIndex,this._currentSuggestionIndex<-1&&(this._currentSuggestionIndex=this._autoSuggestList.childElementCount-1)):(++this._currentSuggestionIndex,this._currentSuggestionIndex>=this._autoSuggestList.childElementCount&&(this._currentSuggestionIndex=-1)),this._currentSuggestionIndex>-1&&this._currentSuggestionIndex<this._autoSuggestList.childElementCount?(t=this._autoSuggestList.childNodes[this._currentSuggestionIndex],t&&(t.classList.add(r._highlightClassName),this.setSearchText(t.getAttribute("query")||t.innerText||""))):this._currentSuggestionIndex===-1&&(u=this.getSearchText(),this.setSearchText(""),this.setSearchText(u))):this._currentSuggestionIndex=-1},r.prototype._autosuggestClickHandler=function(n){if(n){n.preventDefault();this.setShowAutosuggest(!1);var t=n.currentTarget&&n.currentTarget.getAttribute("query")||n.target&&n.target.innerText||"";this.setSearchText(t);n.currentTarget&&this._initiateShoppingSearch()}},r.prototype._setClickAwayHandler=function(n){var t=this;n?Microsoft.Maps.setTimeout(function(){window.addEventListener("click",t._windowClickEventHandler)},1):window.removeEventListener("click",this._windowClickEventHandler)},r._highlightClassName="sa_hlgt",r}(nt);a.registerControl("ShoppingTaskContainer",ki);di=function(n){function t(){var t=n.call(this,su,{onCloseOverflowClick:function(n){t._onCloseOverflowClick(n)},onProductSearchClick:function(n){t._onSearchClick(n)},onSearchKeyPressed:function(n){t._onSearchKeyPressed(n)},isAutosTask:function(n){return n&&n instanceof gt?"":"none"}})||this;return t._autosPanelClickLogged=!1,t._privates.defineProperty("autosUrl"),t._privates.defineProperty("searchText"),t}return f(t,n),t.prototype._onTaskChanged=function(t,i){if(n.prototype._onTaskChanged.call(this,t,i),this.setSearchText(""),i instanceof gt){var r=i.getOptions();r&&(this._setLoadingUrl(r),this._logInstEventsForAutoPanel())}},t.prototype._onCloseOverflowClick=function(n){var t,i;n&&(n.preventDefault(),n.stopPropagation(),t=this.getStack(),t&&(this._logAction("CLS"),i=t.getOverflowTask(),i&&i.deactivate(),this.setSearchText(""),t.setOverflowTask(null),t.serializableObjectChanged.invoke()))},t.prototype._onSearchClick=function(n){n.preventDefault();n.stopPropagation();this._initiateShoppingSearch()},t.prototype._onSearchKeyPressed=function(n){var t=n.keyCode;t&&t===13&&this._initiateShoppingSearch()},t.prototype._initiateShoppingSearch=function(){var t=this.getSearchText(),i,n,r;t&&(i=this.getTask(),n=i.getOptions(),n&&n.queryTemplateUrl&&(r=n.queryTemplateUrl.replace("{0}",encodeURIComponent(t))+"&FORM=BLMCLS",this._setAutosUrlInternal(r)),this._logAction("SRCH"))},t.prototype._logAction=function(n){var i=this.getTask(),t=i.getOptions(),r={logData:{feature:oi.Autos,action:n},impressionGuid:t&&t.impressionGuid};p.invokeHandler(y.instrumentationDataHandlerKey,r)},t.prototype._setLoadingUrl=function(n){if(n){var i=n.formCode||"BLSTBV",t=null;n.productRootKeyword&&n.queryTemplateUrl?(t=n.queryTemplateUrl.replace("{0}",encodeURIComponent(n.productRootKeyword)),i="BLMCLS"):n.redirectUrl&&(t=n.redirectUrl);t&&this._setAutosUrlInternal(t+"&FORM="+i)}},t.prototype._logInstEventsForAutoPanel=function(){var n=this,i=_d.getElementById("autoDealersIFrame"),t;i&&(this._logAction("AutosPanelShown"),this._autosPanelClickLogged=!1,t=function(t){t&&t.data&&t.data.toLocaleLowerCase&&t.data.toLocaleLowerCase()==="autos panel clicked"&&!n._autosPanelClickLogged&&(n._logAction("AutosPanelClicked"),n._autosPanelClickLogged=!0)},window.addEventListener("message",function(n){t(n)}))},t.prototype._setAutosUrlInternal=function(n){this.setAutosUrl(n+"&wcp=true")},t}(nt);a.registerControl("AutosTaskContainer",di);gi=function(t){function r(){var n=this,i={};return n=t.call(this,i)||this,n._privates=i,i.defineProperty("filters",function(){n._onFiltersChange()}),i.defineProperty("task",function(){n.setIsExpanded(!1);n.setSelectedCount(0)}),i.defineProperty("width",function(t,i){n._widthChanged(t,i)}),i.defineProperty("isExpanded"),i.defineProperty("selectedCount"),n._resetFilterHandler=function(){n._setFilterDisplayClasses()},n._scrollHandler=function(t){t&&n.getIsExpanded()&&n.onExpandoClick(null)},sj_evt.bind("resetFilterDisplay",n._resetFilterHandler),sj_evt.bind("customScrolled",n._scrollHandler),sj_evt.bind("nonCustomScrolled",n._scrollHandler),n}return f(r,t),r.prototype.dispose=function(){sj_evt.unbind("resetFilterDisplay",this._resetFilterHandler);sj_evt.unbind("customScrolled",this._scrollHandler);t.prototype.dispose.call(this)},r.prototype.getFilterContent=function(){var n=this.getFilters();return n&&n.length?n[0]:document.createElement("div")},r.prototype.onExpandoClick=function(){var n=this.getRootElement(),i=n.select(".filterTabBar"),t=i&&i.length?i:n.select(".bm_filterBar"),r=n.select(".bm_filterExpando");this.getIsExpanded()?(n.remove_class("expanded"),r.set_style({order:this._expandoOrder}),this._setSelectedFilterCount()&&this._checkForHiddenExpando(r,t[0],n[0],t[0].children)):(n.add_class("expanded"),t.length>0&&r.set_style({order:t[0].childElementCount}));this.setIsExpanded(!this.getIsExpanded())},r.prototype.zeroToDisplayNone=function(n){return n>0?"inline-block":"none"},r.prototype.noFiltersToDisplayNone=function(n){return!n||n.length===0?"none":""},r.prototype.getAreaClass=function(n){return"bm_filterArea"+(n instanceof i.Local.HouseListingTask?" advanceFilters":"")},r.prototype._setSelectedFilterCount=function(){var s=this.getRootElement(),e=s.select(".bm_filterBar"),r,t,i,u,f,o;if(e.length===0)return!1;for(r=e[0].children,t=0,i=0;i<r.length;i++)(u=r[i],parseInt(u.style.order)<this._expandoOrder)||(f=n(u),(f.has_class("bm_filterSelected")||f.select(".adv_clicked").length>0)&&t++);return o=this.getSelectedCount(),this.setSelectedCount(t),o===0&&t>0},r.prototype._onFiltersChange=function(){this.setTemplate(new a(lu,this));this._filtersClassesSet=!1;var n=this.getTask();n&&n.type===s.localListingTask&&n.registerFilters.invoke()},r.prototype._setFilterDisplayClasses=function(n){var e=this.getTask(),c,f,h,v,r;e&&e.type===s.localListingTask&&(c=this._computeRowCount(e));var t=this.getRootElement(),o=t.select(".filterTabBar"),i=o&&o.length?o:t.select(".bm_filterBar");if(t.length>0&&i.length>0&&t[0].clientHeight>0&&t[0].clientHeight<i[0].clientHeight&&!this._filtersClassesSet){var u=i[0].children,l=0,a=0;for(f=0;f<u.length;f++)if(h=u[f],h.offsetTop>a&&(l++,a=h.offsetTop,l>c)){this._expandoOrder=f;break}this._setFiltersOrders(u);v=i.select(".bm_filterExpando");n||v.removeFromParent();r=t.select(".bm_filterExpando");r.add_class("visible");r.removeFromParent();i.append(r);r.set_style({order:this._expandoOrder});this._checkForHiddenExpando(r,i[0],t[0],u);this.getIsExpanded()?(this.getRootElement().add_class("expanded"),r.set_style({order:i[0].childElementCount})):this._setSelectedFilterCount()&&this._checkForHiddenExpando(r,i[0],t[0],u);this._filtersClassesSet=!0}else this.setSelectedCount(0)},r.prototype._checkForHiddenExpando=function(n,t,i,r){n.length>0&&n[0].offsetTop-t.offsetTop>i.offsetHeight-16&&(this._expandoOrder-=1,n.set_style({order:this._expandoOrder}),this._setFiltersOrders(r))},r.prototype._setFiltersOrders=function(t){for(var i=0;i<t.length;i++)t[i].className.indexOf("bm_filterExpando")===-1&&n(t[i]).set_style({order:i+(i>=this._expandoOrder?1:0)})},r.prototype._computeRowCount=function(n){var r=n.viewModel.getResponseContainer(),u=r.select("div.bm_2col").length>0||r.select("div.bm_cardWidth_360").length>0||r.select("div.bm_cardWidth_416").length>0,t=this.getRootElement();return(t.remove_class("twoRows"),t.remove_class("threeRows"),this._isSingleColumn()&&n instanceof i.Local.HotelsListingTask)?(t.add_class("threeRows"),3):u||n instanceof i.Local.HotelsListingTask?(t.add_class("twoRows"),2):1},r.prototype._widthChanged=function(n,t){if(t&&n&&n!==t){this._filtersClassesSet=!1;var i=this.getRootElement(),r=i.select(".bm_filterExpando");r.remove_class("visible");r.removeFromParent();i.append(r);this.setIsExpanded(!1);i.remove_class("expanded");t<=240?i.add_class("singleCol"):i.remove_class("singleCol");this._setFilterDisplayClasses(!0)}},r.prototype._isSingleColumn=function(){var n=this.getRootElement();return n.has_class("singleCol")},r}(it);a.registerControl("FiltersControl",gi);var gu=function(){function f(n,t,i,u){var f=this;this._suppressSerialization=!1;this._disableLocalGuideAutoActivation=!1;this._container=n;this._map=t;this.secondaryTaskAdded=new r;this.newStackListCreated=new r;this.stackAdded=new r;this.stackFocusing=new r;this.stackFocused=new r;this.stackCollapsed=new r;this.stackRemoved=new r;this.stackRemoving=new r;this.stacksReset=new r;this.deserializationCompleted=new r;this._createStackList();this._stackMap={};this._taskStackMap={};this._taskActivateQueue=[];this._hiddenTasks=[];this._index=0;this._isFocusedStackInCollapsedState=!1;this.isDeserializingTasks=!1;this._isActivatingTask=!1;this.isOverlayClosing=!1;this.serializableObjectChanged=new r;this.serializableObjectChanged.addOne(function(){f._hasSerializableObjectChanged=!0});u&&u.register("TaskManager",this)}return f.prototype.getFocusedStack=function(){return this._focusedStack},f.prototype.activateTask=function(n,t,r,u){var o=this,e,h,s,c,l,a;if(n){if(this._isActivatingTask){this._taskActivateQueue.push({task:n,taskState:t,taskActivateOptions:r});return}if(t&&r&&r.parentId&&(t.parentTaskId=r.parentId),e=this.getStackForTask(r&&r.parentId),h=!e,this.getStackForTask(n.id)){this.focusTask(n.id,t);return}this._isActivatingTask=!0;this._logEntryPointInstrumentationData(t);t&&t.disableHistoryPointCreation||this._newHistoryPoint();n.id=this._parseId(n.id)||this._generateId(n.type);s=this.getFocusedStack();s&&s!==e&&s.displayState.activationState!==4&&s.setDisplayState({activationState:2});try{u||n.activate(this._map,t)}catch(v){c=i.logger;c&&(l={feature:"MC",action:"WRN",data:{errorMessage:"task activation exception: "+v.toString()}},c.logObject(l))}h&&(e=new ct(this._generateId("ts")),this._attachStackEvents(e),this._stacks.insert(e),this._stackMap[e.id]=e);e.addTask(n,!h&&r&&r.parentId,r===null||r===void 0?void 0:r.saveSlideoutTask);this._taskStackMap[n.id]={stack:e,task:n};a={colorIndex:r&&r.taskColorIndex?r.taskColorIndex:this._getColorIndex(e,n),groupName:r&&r.groupName?r.groupName:this._getGroupName(e,n)};e.setDisplayState(a);var y=r&&r.activationState===3,p=t&&t.entryPoint==="Permalink"&&this._getParameterByName("HideTask"),w=function(){var r,t,i;o._setFocusedStack(e);r=f.getTaskType(n.id);sj_evt.fire("focusChanged",r);o._isActivatingTask=!1;t=o._taskActivateQueue.pop();t&&o.activateTask(t.task,t.taskState,t.taskActivateOptions);y&&o.collapseStack(e,n);p&&(i=o._responsiveCardLane,i&&i.collapseCardLane())},b=h?this.stackAdded:this.secondaryTaskAdded;b.invoke({task:n,stack:e,resume:w});this._responsiveCardLane=n.responsiveCardLane;this._logData("A",{TT:n.type,TID:n.id,SID:e.id})}},f.prototype.manageHiddenTask=function(n){n&&(n.id=this._parseId(n.id)||this._generateId(n.type),this._taskStackMap[n.id]={stack:null,task:n})},f.prototype.focusTask=function(n,t){var r=this,i=this.getStackForTask(n),u;i&&(u=function(){var u=r.getFocusedStack(),o,e;u&&u!==i&&u.displayState.activationState!=4&&u.setDisplayState({activationState:2});t&&(o=i.getTask(n),o.activate(r._map,t));i.focusTask(n);r._setFocusedStack(i);r.stackFocused.invoke({stack:i});e=f.getTaskType(n);sj_evt.fire("focusChanged",e);r._logData("F",{TT:e,TID:n,SID:i.id})},this.stackFocusing.hasHandlersRegistered()?this.stackFocusing.invoke({stack:i,resume:u}):u())},f.prototype.toggleStack=function(n){var t,i;n&&(t=n.getForegroundTask(),this._focusedStack!==n?(u._getIsSlideCardEnabled()||(i=n.getForegroundTask()&&n.getForegroundTask().type===s.localDetailsTask,i&&n.getAllTasks().length===2&&sj_evt.fire("HideContextualTaskbar")),this._isFocusedStackInCollapsedState=!1,this.focusTask(t.id)):(this._isFocusedStackInCollapsedState=!0,this.collapseStack(n,t)))},f.prototype.removeStackForTask=function(n){return this._removeStackHelper(this.getStackForTask(n))},f.prototype.removeTaskAndReseatChild=function(t){var i=this.getStackForTask(t),u;if(i)if(i.getAllTasks().length>1){if(u=i.getForegroundTask(),u.id===t){this.removeTask(t);return}if(u.type===s.trafficFlipTask||u.type===s.directionsFlipTask||i!==this.getFocusedStack()){this._removeStackHelper(i);return}i.removeChildren(t,!0);i.removeAllTasks();sj_evt&&sj_evt.fire("OnTaskStackRemoved",i);u.changed=new r;this._taskStackMap[u.id]={stack:i,task:u};i.addTask(u,null);i.FirstTask=u;i.changed.invoke({sender:i,name:"FirstTask",oldValue:null,newValue:u});this._newHistoryPoint();this._stacks.changed.invoke();this._logData("A",{TT:u.type,TID:u.id,SID:i.id});u&&sj_evt&&sj_evt.fire("OnCardFocus",n(document).select("[data-subtaskid='".concat(u.id,"']")))}else this._removeStackHelper(i)},f.prototype.removeTaskStack=function(n){return this._removeStackHelper(this._getStack(n))},f.prototype.collapseStack=function(n,t){t&&n&&(n.setDisplayState({activationState:3}),this.stackCollapsed.invoke({stack:n,task:t}),this._logData("CL",{TT:f.getTaskType(t.id),TID:t.id,SID:n.id}))},f.prototype.removeAllStacks=function(n){var i,t;if(n===void 0&&(n=!0),this._stacks){for(i=[],t=0;t<this._stacks.length;t++)i.push(this._stacks[t]);for(t=0;t<i.length;t++)this._removeStackHelper(i[t],!0);n&&this._clearHistory()}},f.prototype.removeHiddenTasks=function(){var n,t;if(this._hiddenTasks)for(n=this._hiddenTasks.length-1;n>=0;n--)t=this._hiddenTasks.pop(),t.dispose()},f.prototype._raiseSerializationChanged=function(n){this._suppressSerialization||this.serializableObjectChanged.invoke(n)},f.prototype._removeStack=function(n){var u=this,t=n.getFirstTask(),r,i;t&&t.type==s.localGuideTask&&(this._disableLocalGuideAutoActivation=!0);r=sj_cook.get("LGPGLYT","value");!r||r!=="foc"||t&&t.type===s.localGuideL2Task||(this._disableLocalGuideAutoActivation=!0);n.removeAllTasks();this._stacks.remove(n);delete this._stackMap[n.id];i=o.features.localGuide;!i||!i.isEnabled||i.showLessLocalGuide||this.isOverlayClosing||this._disableLocalGuideAutoActivation||this._stacks.length===0&&this._container.instanceAsync(s.localGuideTask,function(n){u.activateTask(n,{taskTitle:n.getTitle()},{activationState:1})})},f.prototype._removeStackHelper=function(n,t){var r=this,f,i,u;n&&(this._suppressSerialization=t,this._newHistoryPoint(),f=n===this._focusedStack,this._findNewFocusedStackOnRemoval(n,!t),f&&(this._focusedStack=null),i=n.getForegroundTask(),u=function(){r._suppressSerialization=t;r._removeStack(n);r.stackRemoved.invoke({stack:n});r._suppressSerialization=!1;i.stackId=null},!this.stackRemoving.hasHandlersRegistered()||i.isHiddenTask||this.isOverlayClosing?u():this.stackRemoving.invoke({stack:n,resume:u}),this._suppressSerialization=!1,this._logData("R",{TT:i.type,TID:i.id,SID:n.id}))},f.prototype.removeTaskOrStackIfNotForeground=function(n){var t=this.getStackForTask(n);t&&t.displayState&&t.displayState.activationState!==1?this.removeTaskStack(t.id):this.removeTask(n)},f.prototype.removeTask=function(n){var t=this.getStackForTask(n),i=t&&t.getTask(n);t&&i&&(this._newHistoryPoint(),this._removeTask(t,i),t.getForegroundTask()?(this.focusTask(t.getForegroundTask().id),this.updateProminences()):(this._findNewFocusedStackOnRemoval(t),this._removeStack(t),this.stackRemoved.invoke({stack:t})),this._logData("D",{TT:i.type,TID:i.id,SID:t.id}))},f.prototype._logEntryPointInstrumentationData=function(n){if(n&&!n.entryPointInstrumented&&n.mapsEntryPointState){var t={logData:{feature:"TM",action:"EntryPointInst",data:n.mapsEntryPointState},impressionGuid:o.dynamicProperties.mapsIG};p.invokeHandler(y.instrumentationDataHandlerKey,t);n.entryPointInstrumented=!0}},f.prototype._getParameterByName=function(n,t){t=t||window.location.search;n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return!i||i.length<=2||!i[2]?"":decodeURIComponent(i[2].replace(/\+/g," "))},f.prototype._hasQuery=function(){var n=this._getParameterByName("q");return n&&n.trim().length>0},f.prototype._removeTask=function(n,t){t&&n.removeTask(t.id)},f.prototype._findNewFocusedStackOnRemoval=function(n,t){if(n.setDisplayState({pendingRemoval:!0},t),n===this._focusedStack){var i=this._stacks.indexOf(n);n=i<this._stacks.length-1?this._stacks[i+1]:i>0?this._stacks[i-1]:null}else this.updateProminences()},f.prototype.getStacks=function(){return this._stacks},f.prototype.getStackById=function(n){for(var i,t=0,r=this._stacks.length;t<r;t++)if(i=this._stacks[t],i.id===n)return i;return null},f.prototype.getTaskById=function(n){var t=this._taskStackMap[n];return t&&t.task},f.prototype.getTaskByType=function(n){for(var i=[],t=0,r=this._stacks.length;t<r;t++)this._stacks[t].getTasksByType(n,i);return i},f.prototype.getHiddenTaskByType=function(n){for(var i=[],t=0;t<this._hiddenTasks.length;t++)this._hiddenTasks[t].type===n&&i.push(this._hiddenTasks[t]);return i},f.prototype.getHiddenTaskById=function(n){for(var i=null,t=0;t<this._hiddenTasks.length;t++)if(this._hiddenTasks[t].id===n){i=this._hiddenTasks[t];break}return i},f.prototype.addHiddenTask=function(n){this._hiddenTasks.push(n);n.isHiddenTask=!0},f.prototype.getPreviousTaskByStack=function(n){var i=this._taskStackMap[n],t,r,u;if(i)for(t=0,r=this._stacks.length;t<r;t++)if(u=this._stacks[t],u===i.stack&&t>0)return this._stacks[t-1].getForegroundTask();return null},f.getTaskType=function(n){if(!n)return null;var t=n.split(f._separator);return t&&t.length>0&&t[0]},f.prototype.serialize=function(n,t,i){var r={stacks:[]},o=0,u,s,f,e,h;if(i)for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],f===this._focusedStack&&(e=f.serialize(n,t),r.stacks.push(e),r.focusedStackIndex=0);else{for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],e=f.serialize(n,t),e?(r.stacks.push(e),f===this._focusedStack&&(r.focusedStackIndex=o),o++):f===this._focusedStack&&(r.focusedStackIndex=o>0?o-1:0);n&&(h=this._responsiveCardLane,h&&h.getIsCardlaneCollapsed()&&(r.isCardLaneCollapsed=!0),r.isFocusedStackInCollapsedState=r.stacks.length>1)}return r},f.prototype.deserialize=function(i){function b(t,i,u,f){var o,e;t.id=f.id;o=t.serialize();n.Internals.stringify(o)!==n.Internals.stringify(f.state)&&(r._logEntryPointInstrumentationData(f.state),t.activate(r._map,f.state,null,f.ds));i.setTaskAt(t,u);w[t.id]={stack:i,task:t};ct.setTaskDisplayState(t,f.ds||{});e=i.displayState;typeof i.displayState.colorIndex!="number"&&(e={colorIndex:r._getColorIndex(i,t,c),groupName:r._getGroupName(i,t)});i.setDisplayState(e)}function d(n,t){return t&&t.state?u._overrideTasktypeBasedOnCategory(n,t.state):n}function g(n,t,i){var e=i.id=r._parseId(i.id),s=i.type=r._parseId(i.type),c=h[e],o,u;if(delete h[e],c&&(o=c.task),o)b(o,n,t,i);else{if(u=f.getTaskType(e),!u)if(s)u=s+"Task",i.id=r._generateId(u);else return;u=d(u,i);l++;ot.setStartTime("SearchRequest",null,!0);r._container.instanceAsync(u,function(r){b(r,n,t,i);l--;l||k()})}}function nt(n){var i=n.id=r._parseId(n.id)||r._generateId("ts"),t=y[i];delete y[i];t&&t.dispose();t=new ct;t.deserialize(n);t.setDisplayState(n.ds);n.tasks&&n.tasks.forEach(function(n,i){return g(t,i,n)});c.push(t);p[i]=t}function k(){var n,t,i,u;for(n in h)if(h.hasOwnProperty(n)){var f=h[n],s=f.stack,o=f.task;o.deactivate()}t=0;c.forEach(function(n){n.setForegroundTask();r._attachStackEvents(n);n.displayState.prominence||t===e.focusedStackIndex||r.updateProminences(null,n,c);t++});r._createStackList(c);i=e.focusedStackIndex?e.focusedStackIndex:0;u=r._stacks.length&&r._stacks[i];i!==0&&r._stacks.length&&r._stacks[0].setDisplayState({activationState:2});r._setFocusedStack(u);e.isFocusedStackInCollapsedState&&(r._isFocusedStackInCollapsedState=e.isFocusedStackInCollapsedState,u.setDisplayState({activationState:3}));r.stacksReset.invoke();r.isDeserializingTasks=!1;r.deserializationCompleted.invoke()}var v=u._isLargeMapShownOnSerp(),e,p,w,l,o,a;if(!v||Microsoft.Maps.GlobalConfig.dynamicProperties.mapsOverlayProcessingPermalink||this._stacks.length!==0){if(e=i||{},v&&!e.stacks){this.isOverlayClosing=!0;this.removeAllStacks();return}var r=this,y=this._stackMap,h=this._taskStackMap,c=[];this._stackMap={};p=this._stackMap;this._taskStackMap={};w=this._taskStackMap;l=0;this.isDeserializingTasks=!0;t.showLoadingSkeleton&&this._addSkeletonMarkerIfListAndDetails(e);e&&e.stacks&&e.stacks.length>0&&e.focusedStackIndex<e.stacks.length&&(o=e.stacks[e.focusedStackIndex],o&&o.tasks&&o.tasks.length>0&&o.tasks[o.tasks.length-1].type!==s.localGuideTask&&(a=n(".nonajaxLGCardPrimer"),a&&a.removeFromParent()));e.stacks&&e.stacks.forEach(nt);l||k()}},f.prototype._attachStackEvents=function(n){var t=this;n.tasksRemoved.add(function(n){t._deactivateTasks(n)});n.serializableObjectChanged.add(function(n){t._raiseSerializationChanged(n)})},f.prototype._addSkeletonMarkerIfListAndDetails=function(t){var i,r;t&&t.stacks&&t.stacks.length>0&&t.focusedStackIndex<t.stacks.length&&(i=t.stacks[t.focusedStackIndex],i&&i.tasks&&i.tasks.length>1&&(r=n(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft .bm_skCombinedWrapper"),r.has_class("bm_skSlideCard")||r.add_class("bm_skSlideCard")))},f.prototype._createStackList=function(n){var t=this;this._stacks=new li(n);this._stacks.changed.add(function(){t._raiseSerializationChanged()});this.newStackListCreated.invoke()},f.prototype._generateId=function(n){if(!n||n.indexOf(f._separator)>=0)throw new Error("Invalid type");var t=this._index++;return n+f._separator+t.toString()},f.prototype._newHistoryPoint=function(){this._raiseSerializationChanged({magnitude:2})},f.prototype._clearHistory=function(){this._raiseSerializationChanged({magnitude:2,clearHistory:!0})},f.prototype._parseId=function(n){if(n){var t=n.split(f._separator);t&&t.length===2&&(this._index=Math.max(~~t[1]+1,this._index))}return n},f.prototype._getStack=function(n){for(var i,r=this._stacks,t=0,u=r.length;t<u;t++)if(i=r[t],i.id===n)return i;return null},f.prototype.getStackForTask=function(n){var t=n&&this._taskStackMap[n];return t&&t.stack},f.prototype._setFocusedStack=function(n,t){var i;n||(i=this._focusedStack);this._focusedStack&&this._focusedStack.displayState.isAutoFocused&&this._focusedStack.setDisplayState({isAutoFocused:!1});this._focusedStack=n;this._isFocusedStackInCollapsedState=!1;t&&this._focusedStack&&this._focusedStack.setDisplayState({isAutoFocused:!0});this._focusedStack&&this._focusedStack.setDisplayState({activationState:1});this.updateProminences(i)},f.prototype.updateProminences=function(n,t,i){function o(n,t,i){return n.displayState.activationState===4?n.setDisplayState({prominence:3}):n.displayState.groupName!==t||n.displayState.pendingRemoval||(n.setDisplayState({prominence:i}),i++),i}var l=this,f=t?t:this.getFocusedStack();if(f&&f.displayState.activationState!==4){var s=f.displayState.groupName,e=i?i:this._stacks,h=e.indexOf(f),r,c,u;for(f.setDisplayState({activationState:1,prominence:1}),r=h-1,u=2;r>=0;r--)u=o(e[r],s,u);for(r=h+1,c=e.length,u=2;r<c;r++)u=o(e[r],s,u)}else n&&o(n,null,null)},f.prototype._getColorIndex=function(n,t,i){var r=this;return this._getDisplayProperty(n,t,"colorIndex",function(){for(var f,n,e=t.displayState.groupName?3:1,o=t.displayState.groupName?t.displayState.groupName:"Default",u=i?0:r._stacks.length-1;i?u<i.length:u>=0;i?u++:u--)if(f=i?i[u]:r._stacks[u],n=f.displayState.colorIndex,n>=1&&n<=3&&f.displayState.groupName===o){e=o==="Default"?n<3?n+1:1:n>1?n-1:3;break}return e})},f.prototype._getDisplayProperty=function(n,t,i,r){var f=n.displayState[i],u=t&&t.displayState&&t.displayState[i];return f===undefined&&((u===null||u===undefined)&&(u=r()),f=u),f},f.prototype._getGroupName=function(n,t){return this._getDisplayProperty(n,t,"groupName",function(){return"Default"})},f.prototype._deactivateTasks=function(n){var t=this;n.forEach(function(n){n.isSavedSlideoutTask||(ct.setTaskDisplayState(n,{activationState:2}),delete t._taskStackMap[n.id],n.deactivate())})},f.prototype._logData=function(n,t){var i={logData:{feature:"TM",action:n,data:t},isMapsAction:n==="A",impressionGuid:o.dynamicProperties.mapsIG};p.invokeHandler(y.instrumentationDataHandlerKey,i)},f._separator="$$",f}(),at=function(){function t(t,i,r,u){var f=this;if(this._layouts={},this._map=t,this._taskManager=i,this._controlTemplateFactory=r,this._coreConfig=u,this._layoutContainer=n("[data-tasklayout]"),this._map.getMapType()&&(this._updateLayoutContainerBackground(this._layoutContainer,this._map.getMapType().id),o.isOnChina&&this._layoutContainer.add_class("bottomBlank")),this._map.mapTypeChanged.add(function(n){return f._updateLayoutContainerBackground(f._layoutContainer,n.newMapTypeId)}),!this._layoutContainer.length)throw new Error("No task layout container defined.");try{this._taskLayoutData=n.Internals.parseJSON(this._layoutContainer.get_attr("data-tasklayout"))}catch(e){this._taskLayoutData={}}this._defaultLayoutName=this._taskLayoutData.defaultLayout||"MultiCardLeftLayout";this.activateLayout(this._defaultLayoutName)}return t.registerLayout=function(n,i){t._registeredLayouts[n]=i},t.prototype._getLayout=function(n){if(!n)return null;if(!this._layouts[n]){var i=t._registeredLayouts[n];i&&(this._layouts[n]=new i(this._controlTemplateFactory))}return this._layouts[n]},t.prototype.activateLayout=function(n){var t=this._getLayout(n);t||(t=this._getLayout("FullMapLayout"));t&&t!==this._layout&&(this._layout&&this._layout.deactivate(),this._layout=t,sj_evt&&sj_evt.fire("layoutChanged",n),t.activate(this._layoutContainer,this._taskManager,this._coreConfig,this._map,this._taskLayoutData.cardPrimerShown))},t.prototype.updateLayout=function(n){this._layout&&this._layout.update&&this._layout.update(n)},t.prototype._updateLayoutContainerBackground=function(n,t){this._layout&&this._layout.update&&this._layout.update({mapTypeId:t});switch(t){case w.road:n.remove_class("Dark");n.add_class("Light");return;case w.birdseye:case w.aerial:n.remove_class("Light");n.add_class("Dark");return;default:n.remove_class("Dark");n.add_class("Light");return}},t._registeredLayouts={},t}(),nf=function(){function n(){}return n.prototype.activate=function(){},n.prototype.deactivate=function(){},n}();at.registerLayout("FullMapLayout",nf);var nr=function(i){function r(n,t,r){var u=this,f={};return u=i.call(this,f)||this,u.stacks=r,u.resources=g,u.layoutMetrics=t,f.defineProperty("focusedStack",function(n,t){u._onFocusedStackChanged(n,t)}),f.defineProperty("slideoutTask",function(n,t){u._onSlideoutTaskChanged(n,t)}),f.defineProperty("hideLeftLane"),u}return f(r,i),r.prototype.closeStackById=function(t){return n.Internals.stringify({id:t,action:"removeStack"})},r.prototype.closeTaskOrStackIfNotForegroundById=function(t){return n.Internals.stringify({id:t,action:"removeTaskOrStackIfNotForeground"})},r.prototype.closeTaskByIdFromHeader=function(t){return n.Internals.stringify({id:t,action:"removeTaskAndReseatChild"})},r.prototype.boolToTitleBarClass=function(n){return n?"titleBar bm_enrichTitle":"titleBar"},r.prototype.displayTitleBar=function(n){var i;if(n&&n.id&&n.id.length>0){var u=n.id,t=n,r=o.features.localSearch;return r&&r.displayWebResultsOnMap&&((i=t===null||t===void 0?void 0:t._taskState)===null||i===void 0?void 0:i.scenarioKey)&&t._taskState.scenarioKey.indexOf("ERR")>-1?"":n.type===s.itineraryDetailsTask?"none":u.indexOf("Detail")>-1||n.type===s.transitLineTask?"none":""}return"none"},r.prototype.displayBackButton=function(n){return n&&u.shouldLeftLaneBeHidden()?"":"none"},r.prototype.hideCloseButton=function(n){return n&&u.shouldLeftLaneBeHidden()?"none":""},r.prototype.hideLeftLane=function(n){return n?"none":""},r.prototype.getSlideoutClass=function(n){return"cardCol slidecard panelContent"+(n?" leftHidden":"")},r.prototype.taskExistsToDisplay=function(n){return n?"":"none"},r.prototype.taskExistsToDisplayNone=function(n){return n?"none":""},r.prototype.slideoutToIsHidden=function(n){return n?!1:!0},r.prototype.boolToDisplayNone=function(n){return n?"none":""},r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.hideOnIconClass=function(n){return n?"none":"block"},r.prototype.customScrollbarRootClass=function(){return t.customScrollbar?"custom-scroll sticky":"stickyContainer bold"},r.prototype.customScrollbarSlideoutRootClass=function(){return t.customScrollbar?"custom-scroll slide":"stickyContainer bold"},r.prototype.customScrollbarOuterContainerClass=function(){return t.customScrollbar?"outer-container":"bold-scroll-container"},r.prototype.customScrollbarPositioningStyle=function(){return t.customScrollbar?"block":"none"},r.prototype.customScrollbarInnerContainerClass=function(){return t.customScrollbar?"inner-container":null},r.prototype.customScrollbarContentWrapperClass=function(){return t.customScrollbar?"content-wrapper":null},r.prototype.customScrollbarSlideContainerClass=function(){return t.customScrollbar?"bm_slideContainer":null},r.prototype.selectSlideoutTask=function(n){var t=null,i;return n&&n.getAllTasks().length>1&&(i=n.getForegroundTask(),i&&!i.noSlideout&&(t=i)),this.setSlideoutTask(t),ni.setIsSecondColumnDisplayed(!!t),!!t},r.prototype._onFocusedStackChanged=function(){var i=this;if(u._getIsSlideCardEnabled()){this.stackChanged&&this.stackChanged.dispose();var r=function(t){var u,r,f;t.name==="foregroundTask"&&(u=i.getSlideoutTask(),i.selectSlideoutTask(t.sender)&&(n(".slidecard .svg").inlineDataSvgs().remove_class("svg"),u||(r=i.getSlideoutTask(),f=r&&r._getTaskState&&r._getTaskState().suppressAnimationWhileSlideOut,n.Transition.run(n(".slidecard"),[{property:_G.RTL?"margin-right":"margin-left",from:"-375px",to:"0",duration:f?0:500}]))))},t=this.getFocusedStack(),f=t&&t.getForegroundTask();r({name:"foregroundTask",oldValue:null,newValue:f,sender:t});this.stackChanged=t&&t.changed.add(r)}},r.prototype._onSlideoutTaskChanged=function(){var n=u.shouldLeftLaneBeHidden();this.setHideLeftLane(n)},r.prototype.dispose=function(){i.prototype.dispose.call(this);this.stackChanged&&this.stackChanged.dispose()},r}(ht),ni=function(){function i(n,t,i){var r=this;this._disposables=[];this._controlTemplateFactory=n;this._controlTemplateText=t;this._layoutMetrics=i;this._animationCount=0;this._hideLayoutOnEmptyTasks=!0;this._overflowTaskAddedHandler=function(n){r._onOverflowTaskAdded(n)}}return i.prototype._onTaskCardClick=function(n){var t=n.stack;this._taskManager.toggleStack(t)},i.prototype._onCloseSlidoutClick=function(n){if(n){var t=n.target,i=t&&t.getAttribute("data-tag");this._taskManager.removeTaskAndReseatChild(i);p.invokeHandler(y.instrumentationDataHandlerKey,{logData:{feature:"TM",action:"C",data:{TID:i,BID:t.classList}}});n.preventDefault();n.stopPropagation()}},i.prototype.refreshStacks=function(){var r=this,u=this._taskManager.getStacks(),t,n,i;this._stacks.clear();sj_evt&&sj_evt.fire("OnAllTaskStacksRemoved");this._stacks.insertAll(u.slice());t=this._cardsContainer.select("[data-taskId]").set_style({visibility:"visible"});this._initTaskCard(t,this._cardsContainer);n=this._taskManager.getFocusedStack();n&&(this.layoutContext.setFocusedStack(n),this._useSlideLayout&&this.layoutContext.selectSlideoutTask(n),n.overflowTaskAdded.add(this._overflowTaskAddedHandler),this._onOverflowTaskAdded(n.getOverflowTask()),i=this._cardsContainer.select("[data-taskId='"+n.id+"']"),this._animateCard(n,i,2,function(){r._scrollToFocusedCard(n,!1)}))},i.prototype._completeAnimation=function(){this._animationCount--;this._animationCount<=0&&(this._animationCount=0,this._layoutSizeHelper.startMonitoring())},i.prototype.onStackAdded=function(n){var f=this,t=n.stack,i,r,u;this.layoutContext.setFocusedStack(t);this._useSlideLayout&&this.layoutContext.selectSlideoutTask(t);t.overflowTaskAdded.add(this._overflowTaskAddedHandler);this._onOverflowTaskAdded(t.getOverflowTask());i=this._taskManager.getStacks().slice().indexOf(t);r=0;this._useSlideLayout&&i!==this._taskManager.getStacks().length-1?(this._stacks.insert(t,i),r=5):(i===0&&(r=5),this._stacks.insert(t));u=this._cardsContainer.select("[data-taskId='"+t.id+"']");this._initTaskCard(u,this._cardsContainer);this._animationCount+=2;this._layoutSizeHelper.stopMonitoring();this._animateCard(t,u,r,function(){f._completeAnimation();f._animationCount<=0&&n.resume()});this._updateViewPortPadding(this._panelWrapper,!0,t)},i.prototype._onStackRemoved=function(n){var f=this,i=n.stack,t,r,u;this._stacks.remove(i);i.overflowTaskAdded.remove(this._overflowTaskAddedHandler);sj_evt&&sj_evt.fire("OnTaskStackRemoved",i);t=this._taskManager.getFocusedStack();t&&(r=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._removingFocusedCard?this._animateCard(t,r,4,function(){f._scrollToFocusedCard(t,!0)}):v.setFocusToTitle(t,r));u=this._taskManager.getStacks();u&&u.length===0&&(this._layoutSizeHelper.startMonitoring(!0),this._currentStack=null,this._currentFirstTask=null,this._currentslideoutTask=null);this._removingFocusedCard=!1},i.prototype._onStackRemoving=function(n){var t=n.stack,f=this._cardsContainer.select("[data-taskId='"+t.id+"']"),u=this._taskManager.getFocusedStack(),i,r;this.focusedStack!==t||this._isCollapsed(t)?n.resume():(this._removingFocusedCard=!0,i=2,r=function(){i--;i||n.resume()},u&&(i++,this._scrollToFocusedCard(u,!1,r)),this._animateCard(t,f,3,r))},i.prototype._onStackFocusing=function(n){var u=this,t=n.stack,i,r;if(this.layoutContext.setFocusedStack(t),this._useSlideLayout&&(this.layoutContext.selectSlideoutTask(t),this._updateViewPortPadding(this._panelWrapper,!0,t)),this._onOverflowTaskAdded(t.getOverflowTask()),i=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._useSlideLayout&&(this.layoutContext.getSlideoutTask()&&this._resetSlideoutLaneScroll(),t===this.focusedStack&&!this._isCollapsed(t))){t.getAllTasks().length>1?(r=this._slideoutCardsContainer.select("[data-subtaskid='"+t.getForegroundTask().id+"']"),v.setFocusToTitle(t,r)):v.setFocusToTitle(t,i);n.resume&&n.resume();return}this._animationCount+=1;this._layoutSizeHelper.stopMonitoring();this._animateCard(t,i,2,function(){u._completeAnimation();n.resume&&n.resume()})},i.prototype._onStackFocused=function(n){var t=n.stack;this._scrollToFocusedCard(t,!0)},i.prototype._onStackCollapsed=function(n){var t=n.stack,i=this._cardsContainer.select("[data-taskId='"+t.id+"']");this.layoutContext.selectSlideoutTask(null);this._onOverflowTaskAdded(null);this._animateCard(t,i,4)},i.prototype._scrollToFocusedCard=function(n,t,i){var r=this.focusedStack,f,u;if(this.focusedStack=n,r&&r!==n&&(f=this._cardsContainer.select("[data-taskid='"+r.id+"']"),f.remove_class("focus"),nt.changeStackFocusState(r,1)),!n||!t&&r===n){i&&i();return}if(u=this._cardsContainer.select("[data-taskid='"+n.id+"']"),u.add_class("focus"),nt.changeStackFocusState(n,0),this._fireOnCardFocusEvent(u),this._useSlideLayout&&this._slideoutCardsContainer.select(".taskCard").add_class("focus"),this._skipNextTaskScroll){this._skipNextTaskScroll=!1;i&&i();return}this._scrollLane(n,t,i)},i.prototype._fireOnCardFocusEvent=function(n){sj_evt&&sj_evt.fire("OnCardFocus",n)},i.prototype.activate=function(n,i,r,u){var f=this,l=this._taskPanel&&this._taskPanel[0],h,c,s,e;this._layoutContainer||(this._map=u,this._taskManager=i,this._stacks=new li,h=o.features.taskBar,c="taskLayoutContainer bm_l2NavLeft",this._layoutContainer=n.add_class(c),s="0",this._layoutContainer.set_style(_G.RTL?{right:s}:{left:s}),h.whiteBackgroundEnable&&(this._layoutContainer.add_class("bm_whitebg"),t.newCardSizingForTCF&&(this._layoutContainer.add_class("bm_phase2"),(t.isSafari||t.isOSx)&&this._layoutContainer.add_class("bm_safari"),t.isTouchDevice&&!t.isOSx&&this._layoutContainer.add_class("bm_touch"),this._layoutContainer.add_class("bm_tcftitlea"))),u.getMapType().id===w.birdseyeV2&&this._layoutContainer.add_class("hideTaskLayout"),this._coreConfig=r,this._hideLayoutOnEmptyTasks&&this._disposables.push(new et(this._stacks,"length",this._layoutContainer[0].style,"display",function(n){return n?"":"none"})),this._hideLayoutOnEmptyTasks&&this._disposables.push(new et(this._map,"Mode",this._layoutContainer[0].style,"z-index",function(n){return n&&n.mapModeType===2?"-1":""})),e=this._createTaskListViewModel(r),this.layoutContext=e,this._disposables.push(e),e.onTaskCardClick=function(n){f._onTaskCardClick(n)},e.getWidthString=function(n){return n?(f._previousWidth=n,sj_evt.fire("CardResize",n),n+"px"):f._previousWidth?(sj_evt.fire("CardResize",f._previousWidth),f._previousWidth+"px"):(sj_evt.fire("CardResize",t.defaultCardWidth),t.defaultCardWidth+"px")},e.onCloseSlideoutClick=function(n){f._onCloseSlidoutClick(n)},this._controlTemplate=this._controlTemplateFactory({templateText:this._controlTemplateText,staticResources:e}),this._panelWrapper=this._controlTemplate.applyDataTemplate(e),this._initializeDomObjects(),this._registerTouchEvent(e));this._disposables.push(i.secondaryTaskAdded.add(function(n){return f._onStackFocusing(n)}),i.stackAdded.add(function(n){return f.onStackAdded(n)}),i.stackFocusing.add(function(n){return f._onStackFocusing(n)}),i.stackCollapsed.add(function(n){return f._onStackCollapsed(n)}),i.stackRemoved.add(function(n){return f._onStackRemoved(n)}),i.stackRemoving.add(function(n){return f._onStackRemoving(n)}),i.stacksReset.add(function(){return f.refreshStacks()}),this._map.mapModeChanged.add(function(n){return f._onMapModeChanged(n)}));this.refreshStacks()},i.prototype.deactivate=function(){for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=[];this._layoutContainer=null},i.prototype._createTaskListViewModel=function(n){return new nr(n,this._layoutMetrics,this._stacks)},i.prototype._animateCard=function(n,t,i,r){r&&r()},i.prototype._getScrollbarThickness=function(){var n=u._createElement("div"),t=u._createElement("div"),i;return n.append(t),n.appendTo(document.body),n.set_style({overflow:"scroll",height:"100px",width:"100px"}),t.set_style({height:"100%",width:"100%"}),i=new ru(n[0].offsetWidth-t[0].offsetWidth,n[0].offsetHeight-t[0].offsetHeight),n.removeFromParent(),i},i.prototype._getScrollTarget=function(n){return n},i.prototype._resetSlideoutLaneScroll=function(){if(this._useSlideLayout){var n=this._slideoutPanelWrapper[0];n&&(n.scrollTop=0)}},i.prototype._scrollLane=function(n,t,i){var o=this,h=this._cardsContainer.select("[data-taskid='"+n.id+"']"),e;this._panelScrollFromFocus=!0;var s=this._panelWrapper.get_scroll_pos(),c=h.get_relative_pos(),r=this._getScrollTarget(s,c),f=this._panelWrapper[0];r.x=u._clamp(r.x,0,f.scrollWidth);r.y=u._clamp(r.y,0,f.scrollHeight);e=function(){o._cardsContainer.set_style({transform:""});f.scrollTop=r.y;f.scrollLeft=r.x;i&&i();Microsoft.Maps.setTimeout(function(){o._panelScrollFromFocus=!1},100)};t?e():this.cardsContainerTransition(f,s,r,e)},i.prototype.cardsContainerTransition=function(t,i,r,u){n.Transition.run(this._cardsContainer,[{property:"transform",to:"translate("+(i.x-r.x)+"px, "+(i.y-r.y)+"px)"}],u)},i.prototype._initPanelWrapper=function(){},i.prototype._initSlideoutPanelWrapper=function(){},i.prototype._initTaskCard=function(){},i.prototype._shouldResetScrollTopOfFirstTask=function(){var n=this._taskManager.getFocusedStack(),t=null,i=!1;return n&&(t=n.getAllTasks()[0]),this._currentStack&&this._currentFirstTask&&(n!==this._currentStack||t!==this._currentFirstTask)&&(i=!0),this._currentStack=n,this._currentFirstTask=t,i},i.prototype._shouldResetScrollTopOfSlideoutTask=function(){var n=this._taskManager.getFocusedStack(),t=null,i=!1;return n&&(t=n.getAllTasks()[1]),this._currentStack&&this._currentslideoutTask&&(n!==this._currentStack||t!==this._currentslideoutTask)&&(i=!0),this._currentStack=n,this._currentslideoutTask=t,i},i.prototype._layoutSizeChanged=function(){var n,t;this._customScroll&&(n=this._shouldResetScrollTopOfFirstTask(),n?this._currentFirstTask&&this._customScroll.setScrollPosition(this._currentFirstTask.displayState&&this._currentFirstTask.displayState.scrollTop||0):this._customScroll.scrollToTarget(null));this._slideoutCustomScroll&&(t=this._shouldResetScrollTopOfSlideoutTask(),this._currentslideoutTask&&(t?this._slideoutCustomScroll.setScrollPosition(this._currentslideoutTask.displayState&&this._currentslideoutTask.displayState.scrollTop||0):this._slideoutCustomScroll.scrollToTarget(null)))},i.prototype._scrollOnCardClick=function(){return!0},i.prototype._updateViewPortPadding=function(){},i.prototype._registerTouchEvent=function(){},i.prototype._isCollapsed=function(){return!1},i.prototype.addScrollHandler=function(n){var t=this;n.getAllTasks().forEach(function(i){i&&i.scrollLane&&!t._taskStackScrollHandlerDictionary[i.id]&&(t._taskStackScrollHandlerDictionary[i.id]=i.scrollLane.add(function(r){t.scrollCardsLaneToElement(n,i,r)}))})},i.prototype.addScrollToTopHandler=function(n){var t=this;n.getAllTasks().forEach(function(i){i&&i.scrollToTop&&!t._taskStackScrollTopHandlerDictionary[i.id]&&(t._taskStackScrollTopHandlerDictionary[i.id]=i.scrollToTop.add(function(r){t.scrollCardsLaneToElement(n,i,r,!0)}))})},i.prototype.scrollCardsLaneToElement=function(n,t,i,r){r===void 0&&(r=!1)},i.prototype.removeScrollHandler=function(n){var t=this;n.getAllTasks().forEach(function(n){var i=t._taskStackScrollHandlerDictionary[n.id];i&&(i.dispose(),delete t._taskStackScrollHandlerDictionary[n.id]);i=t._taskStackScrollTopHandlerDictionary[n.id];i&&(i.dispose(),delete t._taskStackScrollTopHandlerDictionary[n.id])})},i.prototype._cleanupDomObjects=function(){this._layoutSizeHelper.resize=new r},i.prototype._initializeDomObjects=function(){var i=this,e,r,u,f;this._useSlideLayout?(e=this._layoutContainer.clear(),e.append(this._panelWrapper.select(".bm_scrollbarMask")),r=this._layoutContainer.select(".panelWrapper"),this._panelWrapper=n(r[0]),this._slideoutPanelWrapper=n(r[1]),this._initSlideoutPanelWrapper(this._slideoutPanelWrapper),u=".cardCol[data-containerAreaType=cardsContainer]",this._cardsContainer=this._panelWrapper.select(u),this._slideoutCardsContainer=this._slideoutPanelWrapper.select(u)):(f=!(this instanceof ti),this._layoutContainer.clear().append(f?this._panelWrapper.select(".bm_scrollbarMask"):this._panelWrapper),(this._panelWrapper.has_class("bm_scrollbarMask")||f)&&(this._panelWrapper=this._layoutContainer.select(".panelWrapper")),this._cardsContainer=this._panelWrapper.select("[data-containerAreaType=cardsContainer]"));this._taskStackScrollHandlerDictionary={};this._taskStackScrollTopHandlerDictionary={};this._initPanelWrapper(this._panelWrapper);this._layoutSizeHelper=this._useSlideLayout?t.customScrollbar?new yt(n([this._layoutContainer[0],this._cardsContainer[0],this._panelWrapper[0],this._slideoutPanelWrapper[0]]),500):new yt(n([this._layoutContainer[0],this._cardsContainer[0]]),500):new yt(n([this._panelWrapper[0],this._cardsContainer[0]]),500);this._disposables.push(this._layoutSizeHelper.resize.add(function(n){return i._layoutSizeChanged(i._panelWrapper,i._cardsContainer,n)}));this._layoutSizeChanged(this._panelWrapper,this._cardsContainer);this._initCustomScroll(this._layoutContainer)},i.prototype._initCustomScroll=function(i){var r=this,u;t.customScrollbar&&(u=i.select(".custom-scroll"),this._customScroll=new kt(n(u[0])),this._customScroll.scrollTopChanged.add(function(t){var u=r._taskManager.getFocusedStack(),i=u&&u.getAllTasks()[0];i&&i===r._currentFirstTask&&i.displayState&&i.displayState.scrollTop!==t&&n("[data-subtaskid="+i.id+"]").get_style("display")!=="none"&&(i.displayState.scrollTop=t)}),this._customScroll.componentDidMount(),this._useSlideLayout&&(this._slideoutCustomScroll=new kt(n(u[1])),this._slideoutCustomScroll.scrollTopChanged.add(function(t){var u=r._taskManager.getFocusedStack(),i=u&&u.getAllTasks()[1];i&&i===r._currentslideoutTask&&i.displayState&&i.displayState.scrollTop!==t&&n(".custom-scroll.slide .cardWrapper").get_style("display")!=="none"&&n(".custom-scroll.slide").getParent().get_style("display")!=="none"&&(i.displayState.scrollTop=t)}),this._slideoutCustomScroll.componentDidMount()),this._scrollToTopHandler=function(){r._scrollToTop()},sj_evt.bind("scrollToTop",this._scrollToTopHandler),sj_evt.bind("scrollToTarget",function(n){n.length>1&&r._scrollToTarget(n[1])}),sj_evt.bind("slideoutScroll",function(n){n.length>1&&r._slideoutScrollToTarget(n[1])}))},i.prototype._scrollToTop=function(){this._customScroll&&this._customScroll.setScrollPosition(0);this._slideoutCustomScroll&&this._slideoutCustomScroll.setScrollPosition(0)},i.prototype._scrollToTarget=function(n){this._customScroll&&this._customScroll.scrollToTarget(n)},i.prototype._slideoutScrollToTarget=function(n){this._slideoutCustomScroll&&this._slideoutCustomScroll.scrollToTarget(n)},i.prototype._onMapModeChanged=function(n){var t=n.newMode;t===2?(sj_evt.fire("HideContextualTaskbar"),sj_evt.fire("HideCommuteControl")):this._map.getMapType().id!==w.birdseyeV2&&(u._getIsSlideCardEnabled()?sj_evt.fire("ShowContextualTaskbar"):sj_evt.fire("BirdsEyeDeactivated"),sj_evt.fire("ShowCommuteControl"))},i.setIsSecondColumnDisplayed=function(n){i._isSecondColumnDisplayed=n},i.getIsSecondColumnDisplayed=function(){return i._isSecondColumnDisplayed},i.prototype._onOverflowTaskAdded=function(n){n?this._layoutContainer&&this._layoutContainer.add_class("overflowOpen"):this._layoutContainer&&this._layoutContainer.remove_class("overflowOpen")},i}(),ut=function(i){function r(n,t,r){r===void 0&&(r=!0);var f=this,e=r&&u._getIsSlideCardEnabled(),o=pu;return f=i.call(this,n,t?t:o,{horizontalAlignment:1,verticalAlignment:0,orientation:1})||this,f._useSlideLayout=e,f}return f(r,i),r.prototype.activate=function(n,r,u,f,e){var o=this;i.prototype.activate.call(this,n,r,u,f,e);this._scrollHandler=function(n){var i=o._taskManager.getFocusedStack(),t=i&&i.getForegroundTask();t&&t.laneScrolled&&t.laneScrolled.invoke();sj_evt.fire("nonCustomScrolled",n)};t.enableBoldUXChanges&&!t.customScrollbar?n.select(".bold-scroll-container").add_event("scroll",this._scrollHandler):this._panelWrapper.add_event("scroll",this._scrollHandler);r.stackFocusing.add(function(){return o._resetToggleState()});r.secondaryTaskAdded.add(function(){return o._resetToggleState()})},r.prototype.deactivate=function(){var r,n,u;for(t.enableBoldUXChanges||this.removeToggleButton(),this._panelWrapper.remove_event("scroll",this._scrollHandler),r=this._taskManager.getStacks(),n=0,u=r.length;n<u;n++)this._removePrimitiveInteractedHandler(r[n]);i.prototype.deactivate.call(this)},r.prototype.update=function(n){if(n&&this._toggleButton)switch(n.mapTypeId){case w.road:this._toggleButton.remove_class("Dark");this._toggleButton.add_class("Light");return;case w.birdseye:case w.aerial:this._toggleButton.remove_class("Light");this._toggleButton.add_class("Dark");return;default:this._toggleButton.remove_class("Dark");this._toggleButton.add_class("Light");return}},r.prototype.refreshStacks=function(){i.prototype.refreshStacks.call(this);for(var n=0,t=this._stacks.length;n<t;n++)this._addPrimitiveInteractedHandler(this._stacks[n])},r.prototype._createTaskListViewModel=function(n){var u=this,r=i.prototype._createTaskListViewModel.call(this,n);return r.onTitleMouseOver=function(n){u._onMouseOverTitle(n)},r.onTitleMouseLeave=function(n){u._onMouseLeaveTitle(n)},t.enableBoldUXChanges&&(r.onToggleCardLane=function(){u._toggleLayout()},r.map=this._map),r},r.prototype._onTaskCardClick=function(n){var u=n.stack,t;this._taskManager.getFocusedStack()!==u&&p.invokeHandler(y.instrumentationDataHandlerKey,{logData:{T:"CI.SearchCardReactivated",feature:"CD",action:"CI.SearchCardReactivated",data:{entryPoint:"cardheader"}}});t=this._cardsContainer.select("[data-taskId='"+u.id+"']");t.remove_attr("data-cardColor");window.clearTimeout(r._mouseoverDelayHandle);t.get_attr("data-hoverpoi")&&(t.remove_attr("data-hoverpoi"),u.setDisplayState({cardTitleHoveringState:2}));i.prototype._onTaskCardClick.call(this,n)},r.prototype._animateCard=function(n,t,i,r){var f=this,u;this._layoutHidden?(u=function(){f._performAnimation(n,t,i,r)},this._toggleLayout(u)):this._performAnimation(n,t,i,r)},r.prototype._performAnimation=function(t,u,f,e){var h,c=0,o=e,l,s;o&&f!==3&&(o=function(){e();v.setFocusToTitle(t,u)});this._updateTaskPanelHeight(this._taskManager.getFocusedStack(),0);switch(f){case 5:case 0:t.setDisplayState({animationState:0},!1);u.set_style({visibility:"visible"});c=this._updateCardList(t,!0,o);this.addScrollHandler(t);this.addScrollToTopHandler(t);this._addPrimitiveInteractedHandler(t);break;case 3:c=this._updateCardList(t,!1,o);this.removeScrollHandler(t);this._removePrimitiveInteractedHandler(t);break;case 2:t.setDisplayState({animationState:0},!1);c=this._updateCardList(t,!1,o);this.addScrollHandler(t);this.addScrollToTopHandler(t);break;case 4:for(u.set_style({height:r._titleHeight+"px",overflow:"hidden"}),u.add_class("collapsed"),l=u.select(".cardTitleText"),s=0;s<l.length;s++)l[s].setAttribute("aria-expanded","false");this._panelWrapper[0].scrollTop=0;this._updateTaskPanelHeight(t,r._titleHeight);this._useSlideLayout&&this._addTitleMaskToStack(t)}f!==2&&(h&&h.length?n.Transition.run(u,h,o):i.prototype._animateCard.call(this,t,u,f,o))},r.prototype._getScrollTarget=function(n,t){return new tu(n.x,t.y-r._scrollSnapLinePxTCF)},r.prototype._initPanelWrapper=function(n){var i=this,r=this._useSlideLayout,u;r?(this._layoutContainer.add_class("slideout"),this._layoutContainer.remove_class("flipcard")):(this._layoutContainer.add_class("flipcard"),n.getParent().remove_class("slideout"));u=r?this._getScrollbarThickness().width:0;n.add_class("leftPanel noScroll").add_event(r?"mouseenter":"mouseover",function(){i._getLaneContentHeight()>i._panelWrapper[0].clientHeight&&i._updateScrollingOnPanel(n,0,!0)}).add_event(r?"mouseleave":"mouseout",function(){i._updateScrollingOnPanel(n,u,!1)});this._updateScrollingOnPanel(n,u,!1);this._taskPrimitiveInteractedHandlerDictionary={};t.enableBoldUXChanges?this._addStackChangedEvent():this.addToggleButton();this._taskStackChangeHandlerDictionary={}},r.prototype._initSlideoutPanelWrapper=function(n){var t=this,i=this._getScrollbarThickness().width;n.add_event("mouseenter",function(){t._slideoutCardsContainer[0].clientHeight>n[0].clientHeight&&t._updateScrollingOnPanel(n,0,!0)}).add_event("mouseleave",function(){t._updateScrollingOnPanel(n,i,!1)});this._updateScrollingOnPanel(n,i,!1)},r.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight},r.prototype._layoutSizeChanged=function(n,r,u){var s,l,h,c,o,e,a,f;n&&(s=r[0],l=s&&s.lastElementChild,this._updateViewPortPadding(n,l),h=u&&u[0]&&u[0].height,c=u&&u[1]&&u[1].height,h===this._panelHeight&&c===this._cardsHeight&&u||(this._panelHeight=h,this._cardsHeight=c,o=this._taskManager.getFocusedStack(),e=o&&this._cardsContainer.select("[data-taskId='"+o.id+"']"),e&&e.length==0&&(e=null),a=e&&e.get_size().height,t.noStopSizeMonitoring||this._updateTaskPanelHeight(o,a)));t&&t.enableBoldUXChanges&&(f=this.focusedStack&&this.focusedStack.getForegroundTask(),f&&(f.displayState&&f.displayState.stackOrder===2||f.getRecommendedWidth()!==f.getCurrentWidth()||f.getCurrentWidth()===944||f.getCurrentWidth()===484)&&f.resizeCompleted.invoke());i.prototype._layoutSizeChanged.call(this,n,r,u)},r.prototype._updateViewPortPadding=function(n,i,f){var c,p,w,a,b,it,v;if(u._isSmallMapShownOnSerp())this._map.setViewportPadding({left:0,right:0,top:0,bottom:0});else{var k=this._map.getRootElement(),rt=k.parent().select(".taskBar"),l=o.features.localSearch,ut=u.getVerticalTaskBarWidth(),s=0,d=20;if(rt.length===1&&(d+=r._taskbarHeight),i){var ft=f?f:this.focusedStack,g=t.defaultCardWidth,e=ft.getAllTasks(),h=e.length,y=h>1&&u.shouldLeftLaneBeHidden();if(s=h>1&&this._useSlideLayout&&!y&&!e[h-1].noSlideout?2*g+50:g+30,l.enablePoiCentering)if(this._useSlideLayout&&!y){if(h>0&&(c=e[0],s=this._getLeftPadding(c,l)),h>1&&!e[h-1].noSlideout){var c=e[1],nt=c&&c.getCurrentWidth?c.getCurrentWidth():0,tt=l.baseDetailsWidth;s+=(nt>tt?nt:tt)+20}}else h>1?(c=e[1],s=this._getLeftPadding(c,l)):(c=e[0],s=this._getLeftPadding(c,l));else l.doubleWideListEnabled&&(h>0&&(p=e[0].getCurrentWidth?e[0].getCurrentWidth():0,s=(p>t.defaultCardWidth?p:t.defaultCardWidth)+30),h>1&&this._useSlideLayout&&!y&&!e[h-1].noSlideout&&(w=e[1].getCurrentWidth?e[1].getCurrentWidth():0,s+=(w>t.defaultCardWidth?w:t.defaultCardWidth)+20))}s+=ut;a=0;b=r._footerHeight;l.enablePoiCentering||(it=k.select("#MicrosoftNav"),it.length===1&&(a=r._NavBarPadding));u._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(b=a=0);t&&t.enableBoldUXChanges&&(v=this.focusedStack&&this.focusedStack.getForegroundTask(),v&&v.displayState&&v.displayState.stackOrder===2&&(a=r._NavBarPadding));this._map.setViewportPadding({left:_G.RTL?a:s,right:_G.RTL?s:a,top:d,bottom:b})}},r.prototype._isCollapsed=function(n){var t=n&&this._cardsContainer.select("[data-taskId='"+n.id+"']"),i=t&&t.get_size().height;return i===r._titleHeight},r.prototype._changeCategoryIconDisplayState=function(n){var t=n.select(".catIcon");return t.set_style({display:"none"}),!0},r.prototype._resetToggleState=function(){this._layoutHidden&&this._toggleLayout()},r.prototype._onMouseOverTitle=function(t){var u=this._getTitleBar(n(t.target)),o,s;u.add_class("hover");var i=u.get_ancestor(2),f=i.get_attr("data-taskid"),r=this._taskManager.getStackById(f),e=v._getCardCssClassForTask(f,this._cardsContainer),h=e.indexOf(v.GrayedOutStyle)!==-1,c=e.indexOf("focus")!==-1;h&&(o="ac"+r.displayState.colorIndex,i.set_attr("data-cardColor",o),this._replaceCardClass(i,f,e,o+" hovering"));(h||!c)&&this._showHoverPois(i,r);this._changeCategoryIconDisplayState(u,"decayed","hovered")&&(s=r&&r.getForegroundTask(),s&&s.getIconColorAndClassName(function(){}))},r.prototype._replaceCardClass=function(n,t,i,r){var u=v._replaceCardClass(t,this._cardsContainer,r);n.remove_class(i);n.add_class(u)},r.prototype._showHoverPois=function(n,t){window.clearTimeout(r._mouseoverDelayHandle);r._mouseoverDelayHandle=Microsoft.Maps.setTimeout(function(){n&&n.set_attr("data-hoverpoi",1..toString());t&&t.setDisplayState({cardTitleHoveringState:1});var i=t&&t.getForegroundTask();i&&p.invokeHandler(y.instrumentationDataHandlerKey,{logData:{feature:"CD",action:"H",data:{TT:i.type,TID:i.id,SID:t.id,GN:t.displayState.groupName,CI:t.displayState.colorIndex,PR:t.displayState.prominence}}})},r._mouseoverTimeout)},r.prototype._onMouseLeaveTitle=function(t){var u=this._getTitleBar(n(t.target));u.remove_class("hover");var i=u.get_ancestor(2),f=i.get_attr("data-cardColor"),e=i.get_attr("data-taskid"),o=this._taskManager.getStackById(e);f&&(i.remove_attr("data-cardColor"),this._replaceCardClass(i,e,f+" hovering",v.GrayedOutStyle));window.clearTimeout(r._mouseoverDelayHandle);i.get_attr("data-hoverpoi")&&(i.remove_attr("data-hoverpoi"),o.setDisplayState({cardTitleHoveringState:2}));this._changeCategoryIconDisplayState(u,"hovered","decayed")},r.prototype._getTitleBar=function(n){for(var t=n;t&&!t.has_class("titleBar");)t=t.getParent();return t},r.prototype._getStackIndex=function(n){for(var i=this._taskManager.getStacks(),r=i.length,t=0;t<r;t++)if(i[t]===n)return t;return-1},r.prototype._updateTaskPanelHeight=function(n,i){if(t.noStopSizeMonitoring){this._layoutContainer&&this._layoutContainer.set_style({bottom:n&&i===r._titleHeight?"auto":""});return}if(n&&i===r._titleHeight){var u=this._cardsContainer.get_size().height;this._layoutContainer.set_style({height:u+"px"})}else this._layoutContainer.set_style({height:""})},r.prototype._updateScrollingOnPanel=function(i,r,f){var l,o,s,h,e,c;if(!t.customScrollbar){if(l=i.select(".selectionCardClass"),l.length!==0||!u._getIsSlideCardEnabled()||n.Browser.is_safari||t.isOSx)return;this._layoutSizeHelper&&this._layoutSizeHelper.stopMonitoring();o=f?-r:r;s=-o+"px";i.set_style(_G.RTL?{"margin-left":s}:{"margin-right":s});h=this._useSlideLayout?o+"px":f?"0":"";i.select("> *").set_style(_G.RTL?{"padding-left":h}:{"padding-right":h});u.isSlideOutCard(this._taskManager.getFocusedStack())&&n.Browser.is_ie&&n.Browser.ie_version<12&&i.has_class("slide")&&(e=n(".bm_cardClose"),c=f?"0":"",e&&e.length>0&&e.set_style(_G.RTL?{"margin-left":c}:{"margin-right":c}));this._layoutSizeHelper&&this._layoutSizeHelper.startMonitoring(!0)}},r.prototype._scrollLane=function(n,t,r){i.prototype._scrollLane.call(this,n,t,r)},r.prototype._updateCardList=function(n,i,f,e){var p=this,w,l,rt,d,g,b,y,nt;e===void 0&&(e=!0);this._cardFocusTimer&&(this._cardFocusTimerCallback&&(this._cardFocusTimerCallback(),this._cardFocusTimerCallback=null),clearTimeout(this._cardFocusTimer));var tt=this._taskManager.getStacks(),k=tt.length,h,o,c=0,a=0,it="";for(w=0;w<k;w++)if(l=tt[w],l)if(o=this._cardsContainer.select("[data-taskId='"+l.id+"']"),l===n)h=o,this._useSlideLayout&&(rt="[data-taskid='"+l.id+"'] .title",d=this._panelWrapper.select(rt+" .titleMask"),d.length!==0&&d.removeFromParent());else{for(o.set_style({height:r._titleHeight+"px",overflow:"hidden",transition:r._transitionStyleFormat.replace("{duration}","0.3")}),o.swap_class("focus","collapsed hidden"),l.setDisplayState({isHidden:!0}),u._isSlideCardEnabled||o.add_class("hidden"),g=o.select(".cardTitleText"),b=0;b<g.length;b++)g[b].setAttribute("aria-expanded","false");this._useSlideLayout&&this._addTitleMaskToStack(l)}return y=n.getForegroundTask(),!i&&t&&t.enableBoldUXChanges&&y&&y.shouldResize()&&y.getRecommendedWidth()!==null&&y.resizeCard.invoke(),k===1?(c=0,a=0):(c=h?h.select("div.front").get_size().height:0,c&&(a=this._getAnimationDurationForHeight(c))),a=k===1?0:this._getAnimationDurationForHeight(c),it=r._transitionStyleFormat.replace("{duration}",a.toString()),nt=function(){var t={overflow:"hidden",transition:it};c&&(t.height=c+"px");h&&h.set_style(t);o&&o.add_class("collapsed");p._cardFocusTimerCallback=f;p._cardFocusTimer=Microsoft.Maps.setTimeout(function(){var r,i,t;if(h&&(h.set_style({height:"",overflow:""}),h.remove_class("collapsed"),o))for(r=o.select(".cardTitleText"),i=0;i<r.length;i++)r[i].setAttribute("aria-expanded","true");n&&n.setDisplayState({animationState:1},!1);f&&f();p._cardFocusTimerCallback=null;v.taskHasBeenInitialized=!0;t=p._taskManager.getFocusedStack();t&&t.getFirstTask().type===s.localGuideL2Task&&t===n&&t.setDisplayState({activationState:1})},a*1e3)},e?this._scrollToFocusedCard(n,!0,nt):nt(),a},r.prototype._getAnimationDurationForHeight=function(n){return n<r._smallCardMaxHeight?r._smallCardAnimationDuration:n<r._mediumCardMaxHeight?r._mediumCardAnimationDuration:r._largeCardAnimationDuration},r.prototype.scrollCardsLaneToElement=function(n,t,i,r){if(r===void 0&&(r=!1),this._taskManager.getFocusedStack()===n&&(n.getForegroundTask()===t||this._useSlideLayout)){var u=this._map.getViewportPadding();(r||!i.is_element_inView(u.top,u.bottom))&&(i===t.panelRoot?this._scrollLane(n,!0):this._panelWrapper[0].scrollTop=i.get_relative_pos().y)}},r.prototype._addPrimitiveInteractedHandler=function(n){var i=this,r,t,u;if(this._useSlideLayout){for(r=n.getAllTasks(),t=0;t<r.length;t++)this._updatePrimitiveInteractedDictionary(r[t]);this._disposables.push(n.taskAdded.add(function(n){i._updatePrimitiveInteractedDictionary(n)}));this._disposables.push(n.tasksRemoved.add(function(n){for(var t=0,r=n.length;t<r;t++)i._removePrimitiveInteractedHandlerFromTask(n[t])}))}else u=n.getForegroundTask(),this._updatePrimitiveInteractedDictionary(u);this._taskStackChangeHandlerDictionary[n.id]||(this._taskStackChangeHandlerDictionary[n.id]=n.flipAnimationCompleted.add(function(){return i._primitiveInteractedHandlerForFlippedStack(n)}))},r.prototype._primitiveInteractedHandlerForFlippedStack=function(n){var t=n.getForegroundTask();this._updatePrimitiveInteractedDictionary(t)},r.prototype._updatePrimitiveInteractedDictionary=function(n){var t=this;n&&n.primitiveInteracted&&!this._taskPrimitiveInteractedHandlerDictionary[n.id]&&(this._taskPrimitiveInteractedHandlerDictionary[n.id]=n.primitiveInteracted.add(function(n){return t._primitiveInteractedHandler(n)}))},r.prototype._primitiveInteractedHandler=function(n){n&&n.action!==0?n.action===1&&n.element?n.element.appendTo(this._layoutContainer.getParent()):n.action===2?t.noStopSizeMonitoring||this._layoutSizeHelper.stopMonitoring():n.action===3&&(t.noStopSizeMonitoring||this._layoutSizeHelper.startMonitoring(!0)):this._layoutHidden&&this._toggleLayout()},r.prototype._removePrimitiveInteractedHandler=function(n){var t=this;n.getAllTasks().forEach(function(n){t._removePrimitiveInteractedHandlerFromTask(n)});n.flipAnimationCompleted.remove(this._primitiveInteractedHandlerForFlippedStack);this._taskStackChangeHandlerDictionary[n.id].dispose();delete this._taskStackChangeHandlerDictionary[n.id]},r.prototype._removePrimitiveInteractedHandlerFromTask=function(n){var t=this._taskPrimitiveInteractedHandlerDictionary[n.id];t&&(n&&n.primitiveInteracted&&n.primitiveInteracted.remove(this._primitiveInteractedHandler),t.dispose(),delete this._taskPrimitiveInteractedHandlerDictionary[n.id])},r.prototype.addToggleButton=function(){var i=this,t=n(".toggleButton");t.length>0&&t.removeFromParent();this._toggleButton=u._createElement("a");this._toggleButton.add_class("toggleButton hide").add_event("click",function(n){n.stopPropagation();n.preventDefault();i._toggleLayout()}).add_event("keydown",function(t){if(u._isLargeMapShownOnSerp()&&t&&t.keyCode&&t.keyCode===9&&!t.shiftKey){var i=n("#maps_sb");i.length>0&&(t.preventDefault(),t.stopImmediatePropagation(),i[0].focus())}}).set_style({visibility:"hidden"}).set_attr("data-tag","toggleButtonHide").set_attr("href","#").set_attr("role","button").set_attr("aria-expanded","true").set_attr("title",g.L_CardLayoutExpandCollapse_Text);this._toggleButton.appendTo(this._layoutContainer);this.update({mapTypeId:this._map.getMapType().id});this._addStackChangedEvent();this._disposables.push(new et(this._stacks,"length",this._toggleButton[0].style,"visibility",function(n){return n?"":"hidden"}),new et(this._map,"Mode",this._toggleButton[0].style,"z-index",function(n){return n&&n.mapModeType===2?"-1":""}))},r.prototype._addStackChangedEvent=function(){var n=this;this._disposables.push(this._stacks.changed.add(function(t){var f=t.added,r,i,u;if(f)for(r=function(){var r=t.added[i];n._disposables.push(r.onHiddenStateChanged.add(function(t){var i=n._cardsContainer.select("[data-taskId='"+r.id+"']");i&&(t?i.swap_class("focus","hidden"):i.remove_class("hidden"))}))},i=0,u=t.added.length;i<u;i++)r()}))},r.prototype.removeToggleButton=function(){this._toggleButton&&this._toggleButton.removeFromParent()},r.prototype._toggleLayout=function(i){var r=this,s,f=this._taskManager.getFocusedStack(),e=f&&f.getForegroundTask(),o;this._panelWrapper=(s=this._panelWrapper)!==null&&s!==void 0?s:n(".panelWrapper.leftPanel");var u=n(".bm_scrollbarMask"),c={logData:{feature:"CD",action:this._layoutHidden?"EX":"CL",data:{TT:e&&e.type,TID:e&&e.id,SID:f&&f.id}},isMapsAction:!1},h=_G.RTL?"right":"left";this._layoutSizeHelper.stopMonitoring();this._layoutHidden?(this._layoutHidden=!1,this._useSlideLayout&&(this._slideoutPanelWrapper.remove_class("collapsed"),this._animateElement(this._slideoutPanelWrapper,"width",0,this._slideoutPanelWrapperWidth,200,function(){var t,n;r._slideoutPanelWrapper.set_style({width:""});n=(t=r._taskManager.getFocusedStack())===null||t===void 0?void 0:t.getForegroundTask();n&&n.getFilters()&&n.getFilters().get_ancestor(2).set_style({display:""})})),this._panelWrapper.remove_class("collapsed"),u.remove_class("collapsed"),this._animateElement(n(u[0]),"width",0,this._panelWrapperWidth,200,function(){r._panelWrapper.set_style({width:""});n(u[0]).set_style({width:""});r._layoutSizeHelper.startMonitoring(!0);i&&i()}),t.enableBoldUXChanges||this._animateElement(this._toggleButton,h,0,this._panelWrapperWidth,200,function(){var n={};n[h]="";r._toggleButton.set_style(n);r._toggleButton.swap_class("show","hide");r._toggleButton.set_attr("aria-expanded","true")})):(this._layoutHidden=!0,o=10,this._panelWrapperWidth=this._panelWrapper.get_size().width,this._useSlideLayout&&(this._slideoutPanelWrapperWidth=this._slideoutPanelWrapper.get_size().width,this._animateElement(this._slideoutPanelWrapper,"width",this._slideoutPanelWrapperWidth,0,200,function(){var t,n;r._slideoutPanelWrapper.add_class("collapsed");n=(t=r._taskManager.getFocusedStack())===null||t===void 0?void 0:t.getForegroundTask();n&&n.getFilters()&&n.getFilters().get_ancestor(2).set_style({display:"none"})})),this._animateElement(n(u[0]),"width",this._panelWrapperWidth,o,200,function(){r._panelWrapper.add_class("collapsed");n(u[0]).add_class("collapsed");r._layoutSizeHelper.startMonitoring(!0);i&&i()}),t.enableBoldUXChanges||this._animateElement(this._toggleButton,h,this._panelWrapperWidth-o,o,200,function(){r._toggleButton.swap_class("hide","show");r._toggleButton.set_attr("aria-expanded","false")}));p.invokeHandler(y.instrumentationDataHandlerKey,c)},r.prototype._animateElement=function(t,i,r,u,f,e){n.Transition.run(t,[{property:i,from:r,to:u,duration:f}],e)},r.prototype._addTitleMaskToStack=function(n){var i,t,r;n&&n.getForegroundTask()&&(i="[data-taskid='"+n.id+"'] .title",this._panelWrapper.select(i+" .titleMask").length===0&&(t=document.createElement("h2"),t.className="titleMask",t.textContent=n.getForegroundTask().getTitle(),r=this._panelWrapper.select(i),r.insertBefore(t,r.select("h2"))))},r.prototype._getLeftPadding=function(n,t){var i=n&&n.getCurrentWidth?n.getCurrentWidth():0,r=t.baseCardWidth;return(i>r?i:r)+32},r.prototype._onOverflowTaskAdded=function(n){n?(this._layoutContainer&&this._layoutContainer.add_class("overflowOpen"),this._toggleButton&&this._toggleButton.set_style({display:"none"})):(this._layoutContainer&&this._layoutContainer.remove_class("overflowOpen"),this._toggleButton&&this._toggleButton.set_style({display:""}))},r._taskbarHeight=73,r._NavBarPadding=60,r._footerHeight=30,r._scrollSnapLinePxTCF=96,r._smallCardMaxHeight=500,r._mediumCardMaxHeight=1e3,r._smallCardAnimationDuration=.3,r._mediumCardAnimationDuration=.5,r._largeCardAnimationDuration=.6,r._transitionStyleFormat="height {duration}s cubic-bezier(0.445, 0.05, 0.55, 0.95)",r._titleHeight=36,r._mouseoverTimeout=300,r}(ni);at.registerLayout("MultiCardLeftLayout",ut);ti=function(i){function u(n){var r=this,u=t.customScrollbar?hu:cu;return r=i.call(this,n,u,!1)||this,r._hideLayoutOnEmptyTasks=!1,r}return f(u,i),u.prototype._animateCard=function(n,t,r,u){switch(r){case 0:i.prototype._animateCard.call(this,n,t,r,u);break;default:u&&u()}},u.prototype._onTaskCardClick=function(){},u.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight+this._selectionCardContainer[0].clientHeight},u.prototype._updateTaskPanelHeight=function(){if(t.noStopSizeMonitoring){this._panelWrapper.getParent().set_style({bottom:""});return}this._panelWrapper.getParent().set_style({height:""})},u.prototype.activate=function(u,f,e,o){var s=this;this._map=o;this._container=o.getContainer();n(".mapContainer").set_style({"min-height":"0px"});this._taskManager=f;this._container.instanceAsync("BrowserHistoryManager",function(n){s._browserHistoryManager=n;s._browserHistoryManager.setIsCapturing(!1);s._browserHistoryManager.register("MultiCardSelectionLayout",{serialize:function(){},deserialize:function(){p.invokeHandler(y.shareDataHandlerKey,{action:"closeShare"})},serializableObjectChanged:new r});i.prototype.activate.call(s,u,f,e,o);s._layoutContainer.set_attr("style","");s._selectionCardContainer=s._panelWrapper.select(".selectionCardClass");s._currentTaskListViewModel.getSelectionControl().controlUpdated.add(function(){t.customScrollbar&&s._enableScrollbar()});s._currentTaskListViewModel.getSelectionControl().refresh();s._cardsContainer.set_style({display:"none"});t.customScrollbar&&s._initCustomScroll(s._layoutContainer)})},u.prototype.deactivate=function(){var u,t,f,r,e;for(i.prototype.deactivate.call(this),n(".mapContainer").set_style({"min-height":o.features.taskBar.windowMinHeight.toString()+"px"}),this._selectionCardContainer=null,u=this._taskManager.getStacks(),t=this._taskManager.getFocusedStack(),f=0;f<u.length;f++)r=u[f],r&&(r.setIsLocked(!1),r.setIsSelected(!1),r.displayState.activationState===4&&(r.displayState.activationState=3));t||(t=u[0]);t&&(t.displayState.prominence=1,this._taskManager.updateProminences(t));t&&(e=t.getForegroundTask())&&this._taskManager.focusTask(e.id);this._browserHistoryManager.unregister("MultiCardSelectionLayout");this._browserHistoryManager.setIsCapturing(!0);this._map=null;this._container=null;this._taskManager=null;this._browserHistoryManager=null},u.prototype._createTaskListViewModel=function(n){return this._currentTaskListViewModel=new pf(n,this._layoutMetrics,this._taskManager,this._map.getContainer(),this._stacks),this._currentTaskListViewModel},u.prototype._enableScrollbar=function(){var i=n("#b_footer"),r,t,u;i.length>0&&(r=i[0].getBoundingClientRect().top,t=n(".linkBox",this._panelWrapper[0]),t.length>0&&(u=t[0].getBoundingClientRect().bottom,u>=r&&this._customScroll.componentDidUpdate()))},u.prototype.addToggleButton=function(){},u.prototype.removeToggleButton=function(){},u.prototype._fireOnCardFocusEvent=function(){},u.prototype.addScrollHandler=function(){},u.prototype.addScrollToTopHandler=function(){},u.prototype.scrollCardsLaneToElement=function(n,t,i,r){r===void 0&&(r=!1)},u.prototype.removeScrollHandler=function(){},u}(ut);at.registerLayout("MultiCardLeftSelectionLayout",ti);var tr=function(n){function e(t,i){var r=n.call(this,t,"CollectionsPoiManager",i)||this;return r._computeBestMapViewOnTaskActivate=!0,r._currentPrimitivesAreCollections=!0,r._newPrimitive=null,r}return f(e,n),e.prototype._initialize=function(){this._initialized||n.prototype._initialize.call(this)},e.prototype.mapAllEntities=function(){this._primitives&&this._map.setView(n.prototype._getTargetMapView.call(this))},e.prototype.viewThisPrimitive=function(n){var t=this._getMapViewForPrimitive(n);t&&this._map.setView(t)},e.prototype.setPrimitives=function(n,t,u){var o=this,e,f,s;n&&(this._initialize(),e=!0,f=n.length&&n[0]instanceof i.CloudGraphDataManager.SimplePoint,this._newPrimitive=null,this._primitives&&this._primitives.length&&(s=!(this._primitives[0]instanceof i.CloudGraphDataManager.FavoritePoint),e=!(s===f),e||f||this._setNewPrimitive(this._primitives,n)),this._primitives=n,this._currentPrimitivesAreCollections=f,this._isDirty=!0,this._primitives.forEach(function(n){n.isHoverEnabled=function(){return!0};n.layer=o._layer;n.taskDisplayState=o._taskDisplayState;n.entity&&!n.entity.changed&&(n.entity.changed=new r);o._updatePrimitiveForLabeling(n);o._setEntityCollisionBehavior(n)}),t&&this.setTaskDisplayState({activationState:1,prominence:1,stackOrder:1,colorIndex:4}),t&&(this._isDirty=!0),this.refreshMap(this._computeBestMapViewOnSetPrimitives&&this._primitives.length&&(e&&f||!f&&!e)&&!u))},e.prototype.updatePrimitivesState=function(n){var t=this;this._primitives&&this._primitives.length>0&&this._primitives.forEach(function(i){t.setPoiState(i,n)});this._isDirty=!0;this.refreshMap()},e.prototype._getTargetMapView=function(){var i;if(this._currentPrimitivesAreCollections)if(this._primitives.length===1){var r=this._primitives[0],u=h.getMapBounds(this._map,!0),f=new b(r.geometry.y,r.geometry.x);i=u.contains(f)?this._map.getView():this._getMapViewForPrimitive(r,t.defaultZoomLevel)}else i=n.prototype._getTargetMapView.call(this);else if(this._newPrimitive)i=this._getMapViewForPrimitive(this._newPrimitive);else return this._map.getView();return i},e.prototype._getLocations=function(){var t=this,n=[];return this._primitives&&this._primitives.forEach(function(i){var r,u,f;1===i.geometryType?(r=i.geometry,n.push(new b(r.y,r.x))):2===i.geometryType?(u=i.geometry,t._addLocationsFromLine(u,n)):3===i.geometryType&&(f=i.geometry,t._addLocationsFromArea(f,n))}),n},e.prototype._updatePrimitiveForLabeling=function(t){if(t&&t.geometryType===1){var i=t.entity||{},r=i.homeOrWork;t.bucket=e._buckets[r]||e._buckets["default"]}else n.prototype._updatePrimitiveForLabeling.call(this,t)},e.prototype.findBestViewForPrimitivesNotInView=function(t){return this._storeComputedMapView(),this._currentPrimitivesAreCollections?n.prototype.findBestViewForPrimitivesNotInView.call(this,t):t},e.prototype._addLocationsFromLine=function(n,t){for(var i=0;i<n.x.length;i++)t.push(new b(n.y[i],n.x[i]))},e.prototype._addLocationsFromArea=function(n,t){for(var u,i,r=0;r<n.rings.length;r++)for(u=n.rings[r],i=0;i<u.x.length;i++)t.push(new b(u.y[i],u.x[i]))},e.prototype._setNewPrimitive=function(n,t){for(var u,f,r,e,i=0;i<t.length;i++){for(u=t[i],f=!1,r=0;r<n.length;r++)if(e=n[r],u.entity.id===e.entity.id){f=!0;break}if(!f){this._newPrimitive=u;break}}},e.prototype._getMapViewForPrimitive=function(n,t){var i=null,f,r,u;return n&&n.geometryType===1?(t||(t=this._map.getMercatorZoomLevel()),f=c.toLocation(new b(n.geometry.y,n.geometry.x),t,!0),i=new st(f)):n&&n.geometryType===2?(r=[],this._addLocationsFromLine(n.geometry,r),i=this._map.getMode().getMapViewForLocationsInView(r)):n&&n.geometryType===3&&(u=[],this._addLocationsFromArea(n.geometry,u),i=this._map.getMode().getMapViewForLocationsInView(u)),i},e.prototype.getPrimitives=function(t,i){u._isSmallMapShownOnSerp()?i&&i({primitives:[]}):n.prototype.getPrimitives.call(this,t,i)},e._buckets={"default":"353",home:"1370",work:"1371"},e}(rt),tf=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return f(t,n),t.prototype.getTemplates=function(i,r){var e=i,o=null,h,c,v,y;if(e&&e.taskDisplayState)if(e.geometryType===1)o=n.prototype.getTemplates.call(this,i,r,8);else if(e.geometryType===2||e.geometryType===3){var p=e.viewState===1,w=e.viewState===2,s=void 0,l=e,a={strokeStyle:t._defaultStrokeStyle,lineWidth:t._defaultLineWidth,dashes:[]},f=l.polyShapeStyle||a;f.hitTest=1;h=f.strokeStyle+"_"+f.lineWidth+"_"+f.dashes;f.dashes.length===1&&f.dashes[0]===0&&(f.dashes=[]);l.geometryType===3&&(a.fillStyle=t._defaultFillStyle,h=f.fillStyle+"_"+h,f.fillStyle.indexOf("#")===0&&(c=f.fillStyle,f.fillStyle=u._formatString("rgba({0}, {1}, {2}, 0.30)",parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5),16))));o=[];s=t._polyshapeTemplateDictionary[h];s||(s=new fi(f),t._polyshapeTemplateDictionary[h]=s);(p||w)&&(v={strokeStyle:"#000",lineWidth:f.lineWidth+3,dashes:[]},y=new fi(v),o.push(y));o.push(s)}return o},t._polyshapeTemplateDictionary={},t._defaultStrokeStyle="rgba(97, 168, 241, 1)",t._defaultFillStyle="rgba(189, 213, 245, .3)",t._defaultLineWidth=6,t}(lr),vt=function(n){function i(t,i){var u=n.call(this,t,"DetailsPoiManager",i)||this;return u.contextMenuInvoked=new r,u.poiTapped=new r,u.poiHoverStarted=new r,u.poiHoverStopped=new r,u}return f(i,n),i.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer.hasCustomContextMenu=!0,this._events.push(this._map.contextMenuInvoked.add(function(){t.contextMenuInvoked.invoke(null)})))},i.prototype.setPrimitives=function(t,i){this._detailsTaskPrimitive=t[0];this._setDefaultPrimitiveState();n.prototype.setPrimitives.call(this,t,i)},i.prototype.setTaskDisplayState=function(t){n.prototype.setTaskDisplayState.call(this,t);t.prominence&&this._setDefaultPrimitiveState()},i.prototype.setTargetMapView=function(n){n&&n.length===2&&(this.mapViewFromBackend=this._map.getMode().getMapViewForLocationsInView(n))},i.prototype._onPrimitiveTapped=function(t){n.prototype._onPrimitiveTapped.call(this,t);this._handleHotRegionPrimitiveTap(t);this.poiTapped.invoke()},i.prototype._onPrimitiveHoverStarted=function(t){n.prototype._onPrimitiveHoverStarted.call(this,t);this.poiHoverStarted.invoke(t)},i.prototype._onPrimitiveHoverStopped=function(t){n.prototype._onPrimitiveHoverStopped.call(this,t);this.poiHoverStopped.invoke()},i.prototype.onContextMenuInvoked=function(t){n.prototype.onContextMenuInvoked.call(this,t);t.primitive&&t.primitive.entity&&this.contextMenuInvoked.invoke(t)},i.prototype._getTargetMapView=function(){var f,n,u,i,r;return this.mapViewFromBackend?(n=this._detailsTaskPrimitive,n)?(i=c.fromLocation(this.mapViewFromBackend.cameraLocation,!0),r=c.toLocation(new b(n.geometry.y,n.geometry.x),i,!0),new st(r)):this.mapViewFromBackend:(n=this._detailsTaskPrimitive,n&&(u=n.entity,i=t.defaultZoomLevel,u&&u.isApproximateLocation?i=t.approximateLocationZoomLevel:ni.getIsSecondColumnDisplayed()&&(i=t.defaultZoomLevel-1),r=c.toLocation(new b(n.geometry.y,n.geometry.x),i,!0),f=new st(r)),f)},i.prototype.computeBestMapView=function(){var f=null,r=this._detailsTaskPrimitive,o=this._map.getMapType();if(r&&o.id!==w.birdseyeV2){if(this.disableComputingMapViewForLoadingOnly)return this.disableComputingMapViewForLoadingOnly=!1,f;var i=new b(r.geometry.y,r.geometry.x),s=h.getMapBounds(this._map,!0),l=c.fromLocation(this._map.getView().cameraLocation,!0),a=s.contains(i),e=parseInt(u._getUrlParam(window.location,"animduration")),n=this._getTargetMapView();return e?this.computeBestMapViewWithNewAlgo(e,a,i):this._taskDisplayState.stackOrder>1?(this._originalZoomForChildDetailsTask||(this._originalZoomForChildDetailsTask=c.fromLocation(this._map.getView().cameraLocation,!0)),h.setMapCenter(this._map,n.cameraLocation,this._originalZoomForChildDetailsTask,null,this.getDefaultAnimator(n))):h.getMapBounds(this._map,!1).contains(i)&&l>=t.defaultZoomLevel?h.setMapCenter(this._map,i,null,null,this.getDefaultAnimator(n)):this.mapViewFromBackend?(this._map.setView(n,this.getDefaultAnimator(n)),n):(h.setMapCenter(this._map,n.cameraLocation,c.fromLocation(n.cameraLocation,!0),null,this.getDefaultAnimator(n)),n)}return f},i.prototype.computeBestMapViewWithNewAlgo=function(t,i,r){var f=this._getTargetMapView(),w=this._map.getView(),a=c.fromLocation(f.cameraLocation,!0),e=c.fromLocation(w.cameraLocation,!0),v=3,y=parseInt(u._getUrlParam(window.location,"zoomthreshold")),o,s,l,p;return(y&&(v=y),o=3,s=parseInt(u._getUrlParam(window.location,"distancethreshold")),s&&(o=s),Math.abs(a-e)<=v&&(i||(l=n.prototype.zoomOutWithCurrentContext.call(this,[r],e),l!==null&&(p=c.fromLocation(l.cameraLocation,!0),Math.abs(e-p)<=o))))?h.setMapCenter(this._map,f.cameraLocation,a,null,new ui(t),1):(this._map.setView(f),f)},i.prototype._updatePrimitiveForLabeling=function(n){n.entity.disablePoiLabel||(!n.entity.id&&n.entity.getTitle&&(n.entity.id=n.entity.getTitle()),n.viewState!==3&&(n.bucket=n.entity instanceof pr?n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForSelectedPoi:l.bucketIdForPoi))},i.prototype._updatePrimitiveForOverlay=function(){this._layer&&(this._layer.overlayEvent=0)},i.prototype._setDefaultPrimitiveState=function(){var t=this._detailsTaskPrimitive,i;t&&(t.viewState!==3&&(t.alwaysShowOnMap=!0),i=this._taskDisplayState&&this._taskDisplayState.prominence,i&&(this._isPrimaryProminence()&&t.viewState!==3?n.prototype._setSelectedPrimitive.call(this,t):t.viewState===2&&n.prototype._setSelectedPrimitive.call(this,null),this._primitives&&this._primitives.length!=1||n.prototype.setPrimitives.call(this,[t])))},i.prototype._handleHotRegionPrimitiveTap=function(n){var i,t,r,u;n&&n.hitTarget&&n.hitTarget===3&&n.primitive&&n.primitive.entity&&n.primitive.entity instanceof yr&&(i=n.primitive.entity,t=i&&i.getRouteRequestOptions(),t&&(r={entryPoint:11,mode:t.mode,options:t.options,waypoints:t.waypoints},p.invokeHandler(y.taskDataHandlerKey,{type:s.directionsTask,state:r}),u={logData:{feature:"DC",action:"HWC",data:{HW:i.getIsHome()?"H":"W",EP:11}},impressionGuid:this.impressionGuid},p.invokeHandler(y.instrumentationDataHandlerKey,u)))},i._setViewAnimation=null,i}(rt),tt=function(n){function i(t,i,u){var f=n.call(this,t,"ResultsPoiManager",i)||this,e,o;return f._isRealEstateTask=!1,f.iconOnlyLimit=-1,f.refreshResultsRequired=new r,f.contextMenuInvoked=new r,f._setComputedResultsMapView(),e=u?u.getFocusedStack()?u.getFocusedStack().getForegroundTask():null:null,e&&e.poiManager instanceof vt&&(o=e.getMapPrimitives(),f._prevTaskPrimitive=o&&o.length>0?o[0]:null),f}return f(i,n),i.prototype.dispose=function(){n.prototype.dispose.call(this)},i.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer&&this.iconOnlyLimit>-1&&this._layer.setIconOnlyLimit(this.iconOnlyLimit),this._layer.hasCustomContextMenu=!0,this._events.push(this._map.mapPanStarted.add(function(n){return t._waitForFrameRenderedAfterPanStarted(n)})),this._events.push(this._map.mapZoomStarted.add(function(n){return t._waitForFrameRenderedAfterZoomStarted(n)})),this._events.push(this._map.contextMenuInvoked.add(function(){t.contextMenuInvoked.invoke(null)})))},i.prototype.refreshMap=function(t,i){t||this._setComputedResultsMapView();n.prototype.refreshMap.call(this,t,i)},i.prototype._waitForFrameRenderedAfterPanStarted=function(){var n=this;this._map.getFrameManager().frameSet.addOne(function(){n._hasProminenceForRefreshResults()&&n._hasMapMovedOverThreshold()&&(n._mapviewAfterPanZoom=n._map&&n._map.getView(),n._raiseRefreshRequired())})},i.prototype._waitForFrameRenderedAfterZoomStarted=function(){var n=this;this._map.getFrameManager().frameSet.addOne(function(){n._hasProminenceForRefreshResults()&&(n._mapviewAfterPanZoom=n._map&&n._map.getView(),n._raiseRefreshRequired())})},i.prototype._setPrimitiveLayer=function(){n.prototype._setPrimitiveLayer.call(this);this._pivotPrimitive&&(this._pivotPrimitive.layer=this._layer)},i.prototype._updatePrimitivesAndLayerData=function(t,i,r){var u,e,o,f;if(r===void 0&&(r=!0),n.prototype._updatePrimitivesAndLayerData.call(this,t,i,r),this._pivotPrimitive&&(u=this._pivotPrimitive,e=u.entity,u.layer=this._layer,this._updatePrimitiveForOverlay(u,e&&[e.getTitle&&e.getTitle()],this._getPoiToolTipTemplateCssClass()),this._taskDisplayState)){o={};for(f in this._taskDisplayState)f&&this._taskDisplayState.hasOwnProperty(f)&&(o[f]=this._taskDisplayState[f]);u.taskDisplayState=o;u.taskDisplayState.colorIndex=4}},i.prototype.setPivotPrimitive=function(n){if(n){var t=n.entity;n.bucket=i._pivotEntityBucket;t&&(t.alwaysShowLabel=!0);this._createEntityChangedEvent(n);this._setEntityCollisionBehavior(n);n.isHoverEnabled=function(){return!0};this._pivotPrimitive=n}else this._pivotPrimitive=null},i.prototype.setPrimitives=function(t,i){t&&n.prototype.setPrimitives.call(this,t,i)},i.prototype.getPrimitives=function(n,t,i,r){var f,u;if(this._taskDisplayState&&this._primitives&&this._primitives.length&&this._primitives[0].entity&&this._primitives[0].entity.usePricePoi&&(f=this._primitives[0].entity.getPrimaryCategoryPath&&this._primitives[0].entity.getPrimaryCategoryPath(),f&&f.toLowerCase().indexOf("house")>-1&&r<9)){t&&t({primitives:[]});return}if(this._pivotPrimitive&&(this._pivotPrimitive.revision=this._primitives&&this._primitives.length&&this._primitives[0].revision?this._primitives[0].revision:(this._pivotPrimitive.revision||0)+1,this._pivotPrimitive.zIndex=1,this._primitives&&this._primitives.length))for(u=0;u<this._primitives.length;u++)this._primitives[u].zIndex=0;t&&t({primitives:this._pivotPrimitive?this._primitives.concat([this._pivotPrimitive]):this._primitives})},i.prototype._storeComputedMapView=function(){var n=this;this._map.viewChanged.addOne(function(){n._setComputedResultsMapView()})},i.prototype.MapViewFromBackendIsSet=function(){this._isMapViewFromBackendJustSet=!0},i.prototype._getTargetMapView=function(){if(this._primitives&&this._primitives.length&&this._primitives[0].entity&&this._primitives[0].entity.usePricePoi){var t=this._primitives[0].entity.getPrimaryCategoryPath&&this._primitives[0].entity.getPrimaryCategoryPath();if(t&&t.toLowerCase().indexOf("house")>-1){if(this._mapviewAfterPanZoom)return this._mapviewAfterPanZoom;if(this.mapViewFromBackend)return this._isMapViewFromBackendJustSet=!1,this.mapViewFromBackend}else if(u._isHotelsCategory(t)&&this._isMapViewFromBackendJustSet&&this.mapViewFromBackend)return this._isMapViewFromBackendJustSet=!1,this.mapViewFromBackend}return n.prototype._getTargetMapView.call(this)},i.prototype.setIsRealEstateTask=function(n){this._isRealEstateTask=n},i.prototype.setMapViewFromBackend=function(n){this.mapViewFromBackend=n},i.prototype.onContextMenuInvoked=function(t){n.prototype.onContextMenuInvoked.call(this,t);t.primitive&&t.primitive.entity&&this.contextMenuInvoked.invoke(t)},i.prototype.computeBestMapView=function(){var r=!1,u=this._map.getMapType(),i;if(this._primitives&&u.id!==w.birdseyeV2)for(i=0;i<this._primitives.length;i++)if(this._primitives[i]&&this._primitives[i].viewState!==3){r=!0;break}if(r){if(this.disableComputingMapViewForLoadingOnly)return this._isMapViewFromBackendJustSet=!1,this.disableComputingMapViewForLoadingOnly=!1,null;var f=this._getLocations(),e=this._map.getView(),n=this._getTargetMapView(),o=h.getMapBounds(this._map,!0);return this._storeComputedMapView(),c.fromLocation(n.cameraLocation,!0)>t.defaultZoomLevel?h.setMapCenter(this._map,n.cameraLocation,t.defaultZoomLevel,null,this.getDefaultAnimator(n)):this._map.setView(n,this.getDefaultAnimator(n)),n}return null},i.prototype._setComputedResultsMapView=function(){this._computedResultsMapView=this._map.getView();var n=c.fromLocation(this._computedResultsMapView.cameraLocation,!0);this._lastResultsCoord=ci.locationToPixelXY(this._computedResultsMapView.cameraLocation,n)},i.prototype._hasProminenceForRefreshResults=function(){return this._isPrimaryProminence()||this._isProminenceEqualTo(2)?!this._isMapViewChangedSignificantly():!1},i.prototype._raiseRefreshRequired=function(){this._computeBestMapViewOnSetPrimitives=!1;this.refreshResultsRequired.invoke()},i.prototype._hasMapMovedOverThreshold=function(){if(this._extendZoomRefresh())return!0;var n=this._map.getView(),r=c.fromLocation(n.cameraLocation,!0),t=ci.locationToPixelXY(n.cameraLocation,r),u=Math.pow(this._lastResultsCoord.x-t.x,2)+Math.pow(this._lastResultsCoord.y-t.y,2);return u>i._pixelDistanceThreshold},i.prototype._isMapViewChangedSignificantly=function(){if(this._extendZoomRefresh())return!1;var n=this._map.getView(),t=dr.greatCircleDistance(this._computedResultsMapView.cameraLocation,n.cameraLocation);return t>i._mapViewDistanceThresholdInMeters},i.prototype._extendZoomRefresh=function(){if(!this._isRealEstateTask)return!1;var n=c.fromLocation(this._map.getView().cameraLocation,!0);return n>5},i.prototype._canShowOverlay=function(n){return!this._isPrimaryProminence()&&n.viewState===1},i._pivotEntityBucket="353",i._milesToMetersFactor=1609.344,i._mapViewDistanceThresholdInMeters=t.mapViewDistanceThreshold*i._milesToMetersFactor,i.refreshTimeout=t.autoRefreshDelayInMs,i._pixelDistanceThreshold=Math.pow(t.distanceRequiredInPixelsForAutoRefresh,2),i}(rt),rf=function(n){function t(t,i){return n.call(this,t,i)||this}return f(t,n),t.prototype.computeBestMapView=function(){return null},t.prototype.setBestMapView=function(n){var r=this._map.getMapType(),i,t;r.id!==w.birdseyeV2&&n&&n.length&&(i=kr.getLocationsForPrimitivesInView(n),t=this._map.getMode().getMapViewForLocationsInView(i,{left:40,top:30,bottom:30}),n.length===1?h.setMapCenter(this._map,t.cameraLocation,14,null,this.getDefaultAnimator(t)):this._map.setView(t,this.getDefaultAnimator(t)))},t.prototype.setPoiState=function(t,i){var u,r;n.prototype.setPoiState.call(this,t,i);u=o.features.localSearch;u&&!u.enableInfoBox&&(r=t,r&&r.viewState!==0&&(r.viewState=0))},t}(tt),ii=function(){function n(n){var t=this;this._map=n;this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)});this._templateCache=new hi(100)}return n.prototype.selectorReady=function(){var n=this;return!this.baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n.baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n.baseMapTemplateSelector.selectorReady()}):this.baseMapTemplateSelector.selectorReady()},n.prototype.getMarkupStyle=function(n,t,i){var e,c,f;if(i===void 0&&(i=1),n&&this.baseMapTemplateSelector){var o=n&&n.entity,u=o,s=u.usePricePoi,h=this._map.getMercatorZoomLevel(),r=void 0;u.getSelectedCategoryForIcon&&(!o.iconText||s)&&(r=u.getSelectedCategoryForIcon(),r||(r=l.extractCategoryId(u.getPrimaryCategoryPath(!0),!0),u.setSelectedCategoryForIcon(r)));c=h>=si.houseZoomLevelThreshold&&h<=11&&r&&r.toLowerCase().indexOf("house")>-1;f=this._getPoiState(n,c);i===1&&s&&(i=2);e=f&&this.baseMapTemplateSelector.getMarkupStyle(n,t,f,i)}return e},n.prototype._getPoiState=function(n,t){var i=n,r;if(i&&i.taskDisplayState){var f=i.taskDisplayState.prominence,u=i.viewState,e=i.taskDisplayState.cardTitleHoveringState===1;if(u===3)return null;if(e)r=u===2?4:t?5:2;else if(u===1)r=3;else if(u===2||i.alwaysShowOnMap)r=f===1?4:6;else if(u===0||!u)if(f===1)r=t?5:2;else if(f===2)r=5;else return null}return r},n.prototype.getTemplates=function(n){var i=n,t=null,h=i&&i.entity,u=h,e=!!(h.iconText&&h.iconText.length>0),p=u.usePricePoi,b,k,rt,c,a,v,g,ut,et,y,nt,ot;if(u&&u.isPaginationReducedPoi&&(b=this._getReducedPoiTemplates(i),b&&b.length))return b;if(i&&i.taskDisplayState&&this.baseMapTemplateSelector){if(i instanceof wt&&(k=d.getValue(i,"image"),k&&k.records))return[new ai(k)];var tt=i.taskDisplayState.prominence,s=i.viewState,st=i.taskDisplayState.cardTitleHoveringState===1,it=this._map.getMercatorZoomLevel(),r,ft,f,ht=u.getSearchCategory&&u.getSearchCategory();if(u.getSelectedCategoryForIcon&&(!h.iconText||p)&&(f=u.getSelectedCategoryForIcon(),f||(f=l.extractCategoryId(u.getPrimaryCategoryPath(!0),!0),u.setSelectedCategoryForIcon(f))),rt=f&&f.toLowerCase().indexOf("house")>-1,c=it>=si.houseZoomLevelThreshold&&it<=11&&rt,s===3)return t;if(st)r=s===2?4:c?5:2;else if(s===2||i.alwaysShowOnMap)r=tt===1?4:6;else if(s===1||s===0||!s){if(tt===1)r=c?5:2;else if(tt===2)r=5;else return t;ft=s===1}a=void 0;a=p&&!c?2:h.poiType||1;e=e&&!c;p||r!==4&&r!==6||(e=!1);e&&a===2&&(r===5||r===6)&&!rt&&(e=!1);v=void 0;ft?(g=o.features.xsr,v=r===5&&(g===null||g===void 0?void 0:g.stackRetiredHovered)?[r,3]:[3]):v=[r];t=a===12?this.baseMapTemplateSelector.getPoiTemplate(l.microPoiBucket,v,Math.round(this._map.getMercatorZoomLevel()),12,!1,!0,null,l.getPaletteKeyForCategory(f)):this.baseMapTemplateSelector.getPoiVectorImageTemplate(f,v,it,a,e,ht);t&&t[0]&&(ut=u.badgeType,et={x:0,y:0},t=hr.addBadgeTemplate(t,ut,ut===3?et:null,this._map.getMapType().id===w.roadDark))}if(e&&!p){for(y=!1,nt=0,ot=t.length;nt<ot;nt++)if(y=y||t[nt].hasPlaceholderText,y)break;y||(t=t.concat(l.getPushpinTextTemplates(t[t.length-1],null,null,null)))}return t},n.prototype._getReducedPoiTemplates=function(t){var s=null,i,e,r,u,c;if(t&&(t.taskDisplayState&&t.taskDisplayState.prominence===1||t.entity&&t.entity.poiType===3)&&(i=t.taskDisplayState.colorIndex,i>=1&&i<=3)){e=!1;switch(this._map.getMapType().id){case w.aerial:case w.roadDark:e=!0}r=e?n.MicroPoiAerialColors[i]:n.MicroPoiColors[i];t.entity&&(u=t.entity,t.entity.poiType===3?r=n.ItineraryPoiColor:u&&u.isPaginationReducedPoi&&u.iconColorFromCard&&(r=u.iconColorFromCard));var o=t.entity&&t.entity.isPaginationReducedPoi?n._poiRadius+1:n._poiRadius,h=r+","+o,f=n._microPoiTemplateDictionary[h];f||(c={centerX:0,centerY:0,radiusX:o,radiusY:o,vectorType:2,style:{fillStyle:r}},f=new ai({records:[c],hotspotX:0,hotspotY:0,hitTest:1}),n._microPoiTemplateDictionary[h]=f);s=[f]}return s},n.MicroPoiColors=["#4379bc","#AC2290","#00AAB1","#008300","#f9a11b"],n.MicroPoiAerialColors=["#4379bc","#D542C1","#009AAB","#4EB671","#f9a11b"],n.ItineraryPoiColor="#008272",n._microPoiTemplateDictionary={},n._poiRadius=4,n}(),uf=function(n){function t(t){return n.call(this,t)||this}return f(t,n),t.prototype.getTemplates=function(t,i){var u=t,r=t&&t.entity,f,e;return(r||null,t.entity.poiType=3,!r.isActiveDay&&u.taskDisplayState.prominence!==1)?[]:u.taskDisplayState&&!r.isActiveDay?this._getReducedPoiTemplates(u):(e=n.prototype.getTemplates.call(this,t,i),f&&(r.iconText=f),e)},t}(ii),ff=function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u._taskManager=r,u}return f(t,n),t.prototype.getPrimitives=function(t,i){var r=this._taskDisplayState&&typeof this._taskDisplayState.isHidden!="undefined";r?this._taskDisplayState.isHidden?i&&i({primitives:[]}):n.prototype.getPrimitives.call(this,t,i):n.prototype.getPrimitives.call(this,t,i)},t.prototype.setPrimitives=function(t,i){this._isDisposed&&(this._map.getLayers().insert(this._layer),this._isDisposed=!1);n.prototype.setPrimitives.call(this,t,i)},t.prototype.setTaskDisplayState=function(t){var i=t&&typeof t.isHidden!="undefined";n.prototype.setTaskDisplayState.call(this,t);i&&(this._isDirty=!0,this._updatePrimitivesAndLayerData(!0))},t.prototype.dispose=function(){this._primitives=null;this._map.getLayers().remove(this._layer);this._isDisposed=!0},t.prototype.computeBestMapView=function(){return null},t}(tt),ef=function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.isForArticleEntityL2=!1,u._taskManager=r,u._initialMapView=u._map.getView(),u._becameUnfocusedStack=!1,u}return f(t,n),t.prototype.getPrimitives=function(t,i){if(n.prototype.getPrimitives.call(this,t,i),this._taskDisplayState&&this._taskDisplayState.activationState===2&&this._taskManager){var u=this._taskManager.getFocusedStack(),r=u&&u.getFirstTask();r&&(r.type!==s.localGuideL2Task||r.type===s.localGuideL2Task&&r.poiManager&&r.poiManager.isForArticleEntityL2)&&(this._becameUnfocusedStack=!0)}},t.prototype.computeBestMapView=function(){return this.isForArticleEntityL2?n.prototype.computeBestMapView.call(this):this._initialMapView&&this._becameUnfocusedStack?(this._becameUnfocusedStack=!1,this._map.setView(this._initialMapView,this.getDefaultAnimator(this._initialMapView)),null):this._map.getView()},t}(tt),ir=function(){function n(n){this.microPoiClusters=n}return n.prototype.dispose=function(){this.microPoiClusters=[]},n}(),ri=function(){function n(n,t){this.id=n;this.collisionBehavior=1;t&&(this._title=t);this.changed=new r}return n.prototype.getTitle=function(){return this._title},n}(),sf=function(n){function i(t,u,f){var e=n.call(this,t,"MicroPoiManager",f)||this;return e._clusterId=100,e.spatialIndex=i._pyramidSpatialIndex,e._microPoiSelector=f,e._microPoiClusterDictionary={},e._microPoiRequestProcessor=new rr(t),e._retrieveFromCacheOnly=!0,e.zoomChangedOnClusterSelect=new r,e._microPoiPerfLogger=new hf(e._microPoiRequestProcessor,e,u),e}return f(i,n),i.prototype.fetchMicroPois=function(n,t,r,u,f,e){r===void 0&&(r=null);this._isPrimaryProminence()&&(this._microPoiClusterDictionary={},this._query=n,this._localFilters=r,this._resultYpids=i._getYpids(t),this._retrieveFromCacheOnly=!1,this._isDirty=!0,this._listChainId=u,this._listCatId=f||e,this._microPoiSelector.setCategoryId(e?e:f),this.refreshMap())},i.prototype.clearMicropoiData=function(){this._microPoiRequestProcessor.clearMicropoiData()},i.prototype.getPrimitives=function(n,t,i,r,u){var f=this;this._shouldRefreshMicroPoiResults()&&this._query?this._microPoiRequestProcessor.getMicroPois(this._query,n,this._retrieveFromCacheOnly,function(n){var i,r,e;f._buildMicroPoiCluster(n);i=f._updateMicroPoisTaskState(n);u&&(r=new cr,r.accumulate(u.bounds,u.crs),e=r.getBounds(),e.buffer(),i=i.filter(function(n){return e.contains(new b(n.geometry.y,n.geometry.x))}));t({primitives:i})},this._listChainId,this._listCatId):t({primitives:[]})},i.prototype.setPrimitives=function(){},i.prototype.getDataUniquenessKey=function(n){return n.quadKey},i.prototype._isDataDefined=function(){return typeof this._query!="undefined"},i.prototype.setTaskDisplayState=function(n){this._isDirty=typeof n.prominence!="undefined"&&this._taskDisplayState&&this._taskDisplayState.prominence!==n.prominence;this._taskDisplayState=this._taskDisplayState||{};d.mergeProperties(this._taskDisplayState,n)},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._microPoiClusterDictionary=null;this._microPoiRequestProcessor.dispose();this._microPoiPerfLogger&&this._microPoiPerfLogger.dispose()},i.prototype._onPrimitiveHoverStarted=function(n){n.primitive&&this._updateMicroPoiHoverState(n.primitive,1)},i.prototype._initialize=function(){var i=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer.setRenderTarget(t.glMicroPoi&&!o.glPolyline?1:0),this._layer.canBeFiltered=!0,this._events.push(this._map.mapPanStarted.add(function(){i._retrieveFromCacheOnly=!0})),this._events.push(this._map.mapZoomStarted.add(function(){i._retrieveFromCacheOnly=!0})))},i.prototype._addLayerToMap=function(t){t.setZIndex(ft.primaryProminenceZOrder-1);t.hitTestingGraceRadius=9;n.prototype._addLayerToMap.call(this,t)},i.prototype._onPrimitiveHoverStopped=function(n){if(n.primitive){this._updateMicroPoiHoverState(n.primitive,0);var t=o.features.localSearch;t.enableRichInfoBox&&typeof sj_evt!="undefined"&&sj_evt.fire("pushpinhoverstopped",n.primitive)}},i.prototype._setSelectedPrimitive=function(t){var i=this,u,r,f;t&&(u=this._microPoiClusterDictionary[t.clusterId],u.isSingle?n.prototype._setSelectedPrimitive.call(this,t):(r=h.getMercatorZoomLevel(this._map),f=new b(t.geometry.y,t.geometry.x),this._map.constrainView.addOne(function(u){var f=c.fromLocation(u.view.cameraLocation,!0);f===r?n.prototype._setSelectedPrimitive.call(i,t):(i._retrieveFromCacheOnly=!0,i.zoomChangedOnClusterSelect.invoke())}),h.setMapCenter(this._map,f,r+2)))},i.prototype._resetHoveredPoi=function(n){this._updateMicroPoiHoverState(n.primitive,0)},i.prototype._buildMicroPoiCluster=function(n){var i,u,t,f,r,e;if(n&&n.length>0)for(i=0,u=n.length;i<u;i++)if(t=n[i],t.primitives&&t.primitives.length>0){if(f=t.primitives[0].clusterId,this._microPoiClusterDictionary[f])continue;for(this._microPoiClusterDictionary[this._clusterId]=t,r=0,e=n[i].primitives.length;r<e;r++)t.primitives[r].clusterId=this._clusterId;this._clusterId++}},i.prototype._shouldRefreshMicroPoiResults=function(){var n=this._taskDisplayState&&this._taskDisplayState.prominence;return n===1&&!this._taskDisplayState.isAutoFocused&&!this._localFilters?!0:!1},i.prototype._updateMicroPoiHoverState=function(n,t){var i,f;this.poiViewStateChanged.invoke(new vi(this,n,n.viewState,t));var u=this._microPoiClusterDictionary[n.clusterId],r=u&&u.primitives,e=t===1?2:0;if(r){for(i=0,f=r.length;i<f;i++)r[i].viewState=t,r[i].zIndex=e;n.entity.changed.invoke()}},i.prototype._updateMicroPoisTaskState=function(n){var t=this,i=[],u=this._getPoiToolTipTemplateCssClass(),f=function(){return!0};return n.forEach(function(n){n.primitives.forEach(function(e){e.isHoverEnabled=f;e.isMicroPoi=!0;e.taskDisplayState=t._taskDisplayState;e.layer=t._layer;var o=e.entity;o.changed||(o.changed=new r);t._updatePrimitiveForOverlay(e,n.titles,u);t._layer.overlayEvent=0;e.entity.id&&t._resultYpids.indexOf(e.entity.id)!==-1||i.push(e)})}),i},i._getYpids=function(n){var t=[];return n.forEach(function(n){t.push(n.entity.id)}),t},i.prototype._canShowOverlay=function(n){return n.viewState===1},i._pyramidSpatialIndex=new iu(2),i}(rt),hf=function(){function n(t,i,r){var u=this;this._micropoiNetworkLatencyPerfState={};this._micropoiRenderingPerfState={};this._disposables=[];this._disposables.push(t.networkRequestStart.add(function(t){u._micropoiNetworkLatencyPerfState[t]=r.start(n._perfKeyForMicroPoiNetworkLatency)}));this._disposables.push(t.networkResponseReceived.add(function(t){u._micropoiNetworkLatencyPerfState[t].end(t);delete u._micropoiNetworkLatencyPerfState[t];u._micropoiRenderingPerfState[t]=r.start(n._perfKeyForMicroPoiRenderingLatency);i.primitivesRendered.addOne(function(){u._micropoiRenderingPerfState[t].end(t);delete u._micropoiRenderingPerfState[t]})}))}return n.prototype.dispose=function(){this._disposables.forEach(function(n){n.dispose();n=null});this._disposables=[];this._micropoiNetworkLatencyPerfState={};this._micropoiRenderingPerfState={}},n._perfKeyForMicroPoiNetworkLatency="MNT",n._perfKeyForMicroPoiRenderingLatency="MRT",n}(),rr=function(){function n(n){this._map=n;this._microPoiDictionary=new hi(16);this._pendingQuadKeyRequests={};this.networkRequestStart=new r;this.networkResponseReceived=new r}return n.prototype.getMicroPois=function(n,t,i,r,u,f){var o=t.quadKey,e=o,s,h,c,l;i?(s=[],h=this._microPoiDictionary.getInternalDictionary(),Object.keys(h).forEach(function(n){(n.indexOf(o)===0||o.indexOf(n)===0)&&Array.prototype.push.apply(s,h[n].item.microPoiClusters)}),r&&r(s)):this._pendingQuadKeyRequests[e]?this._pendingQuadKeyRequests[e].push(r):(c=this._microPoiDictionary.getItem(e),l=c?c.microPoiClusters:null,l?r&&r(l):(this._pendingQuadKeyRequests[e]=[],this._pendingQuadKeyRequests[e].push(r),this._sendMicroPoiRequest(n,e,u,f)))},n.prototype.clearMicropoiData=function(){this._microPoiDictionary.clear()},n.prototype.dispose=function(){this._microPoiDictionary.clear();this._pendingQuadKeyRequests={}},n.prototype._sendMicroPoiRequest=function(n,r,f,e){var o=this,s,h;f=f?f:"";e=e?e:"";s=t.newMicroPoiEnabled?t.newMicroPoiRequestUrlFormat:t.microPoiRequestUrlFormat;h=i.GlobalConfig;s=s.replace("{quadkey}",r).replace("{query}",n).replace("{subdomain}",u._getTileSubDomain(r)).replace("{appid}",h.dynamicProperties.appId).replace("{chainId}",f).replace("{categoryId}",e);this.networkRequestStart.invoke(r);t.newMicroPoiEnabled?pt.downloadJson(s,"micropoi",function(n){var i,u,f;if(o.networkResponseReceived.invoke(r),i=null,o._pendingQuadKeyRequests&&o._pendingQuadKeyRequests[r]&&(i=o._pendingQuadKeyRequests[r],delete o._pendingQuadKeyRequests[r]),u=[],n&&n.results)for(f=0;f<n.results.length;f++){var t=n.results[f],e=t.name,s=new ri("ypid:"+t.id,t.name),h=new wt(new b(t.geo.latitude,t.geo.longitude),s);u.push({titles:[e],isSingle:!0,primitives:[h]})}o._microPoiDictionary.addItem(r,new ir(u));i&&i.forEach(function(n){n&&n(u)})},function(){o._pendingQuadKeyRequests&&delete o._pendingQuadKeyRequests[r]},null,!1,null,!1):pt.downloadJsonp(s,"micropoi",function(n){var s,c,a,e,u,v;if(o.networkResponseReceived.invoke(r),s=null,o._pendingQuadKeyRequests&&o._pendingQuadKeyRequests[r]&&(s=o._pendingQuadKeyRequests[r],delete o._pendingQuadKeyRequests[r]),n&&n.hrs){var t=null,h=null,i=null,l=[],f=!1;for(c=0,a=n.hrs.length;c<a;c++)if(t=n.hrs[c],i=null,e=[],f=!0,t&&t.brs){for(i=[],t.type==="mpcluster"?(e=t.names.toString().split(",").slice(0,5),t.brs.length>5&&e.push("..."),f=!1):e.push(t.name),u=0,v=t.brs.length;u<v;u++)if(h=t.brs[u],h){var p=new b(h.y,h.x),w=f?t.ypid:t.ypids[u],k=f?t.name:t.names[u],d=new ri("ypid:"+w,k),y=new wt(p,d);y.isHoverEnabled=function(){return!0};i.push(y)}i&&i.length>0&&l.push({titles:e,isSingle:f,primitives:i})}o._microPoiDictionary.addItem(r,new ir(l));s&&s.forEach(function(n){n&&n(l)})}},function(){o._pendingQuadKeyRequests&&delete o._pendingQuadKeyRequests[r]})},n}(),cf=function(){function n(n){this._map=n}return n.prototype.setCategoryId=function(n){n!==this._localCatId&&(this._localCatId=n)},n.prototype._readyOnBucket=function(n){var t=this;return new Promise(function(i){t._map.getTemplateSelector().then(function(r){t._selector=r;r.selectorReady().then(function(){r.prefetchImages([n]).then(function(){i(t)})})})})},n.prototype.selectorReady=function(){return this._ready||(this._ready=this._readyOnBucket(l.microPoiBucket)),this._ready},n.prototype._getPoiState=function(n){var t=n.viewState;return t===1?3:2},n.prototype.getTemplates=function(n){var t=null;return n&&this._selector&&(t=this._selector.getPoiTemplate(l.microPoiBucket,this._getPoiState(n),Math.round(this._map.getMercatorZoomLevel()),12,!1,!0,null,"PointStateMicroPoi;".concat(l.getPaletteKeyForCategory(this._localCatId)))),t},n}(),lf=function(n){function t(t,i){var u=n.call(this,t,i)||this;return u.poiTapped=new r,u}return f(t,n),t.prototype._initialize=function(){this._isDisposed||(n.prototype._initialize.call(this),this._layer.hasCustomContextMenu=!1)},t.prototype._onPrimitiveTapped=function(n){this._resetHoveredPoi(n);this.poiTapped.invoke(n)},t}(tt),ur=function(n){function i(i,r){var u=n.call(this,i,r)||this;return u._geoEntityApiHasData=!0,u.maxZoomLevelForPolygonData=t.maxPolygonZoomLevel,u}return f(i,n),i.prototype.getPrimitives=function(n,t){var i=this,r;if(!this._canShowPrimitives()){t&&t({primitives:[]});return}r=this._upcomingMapView?Math.floor(c.fromLocation(this._upcomingMapView.cameraLocation,!0)):this._map.getMercatorZoomLevel();this._useBoundaryDataSource&&this._geoEntityApiHasData?this._boundaryPolygons||this._noBoundaryData?t&&t({primitives:this._primitives&&this._canShowPrimitives()?this._noBoundaryData?this._primitives:this._boundaryPolygons.primitives:[]}):this._map.getContainer().instanceAsync("GeoDataAPIManager",function(){br.instance.authenticateClientAndRetrieveSessionId(function(n){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getEntityDetails(i._entityVDPId,{lod:1,getEntityMetadata:!1,entityType:null},n,function(n){n.hasGeoPoliticalIssues?(i._noBoundaryData=!0,t&&t({primitives:i._primitives})):(i._boundaryPolygons={primitives:n.results&&n.results.length>0&&n.results[0]?n.results[0].Polygons:[]},i._boundaryPolygons.primitives.length===0?(i._initializeSpatialDataSource(!0),i._noBoundaryData=!0):(i._boundaryPolygons.primitives.forEach(function(n){n.bucket=l.cityPolygonBucket;n.taskDisplayState=i._primitives&&i._primitives.length&&i._primitives[0].taskDisplayState;n.viewState=2}),i._boundaryPolygons.primitives=i._primitives&&i._boundaryPolygons.primitives.concat(i._primitives.slice(1)),i._updateDisplayProperties(),t&&t({primitives:i._primitives&&i._canShowPrimitives()?i._noBoundaryData||!i._useBoundaryDataSource?i._primitives:i._boundaryPolygons.primitives:[]})))},null,function(){i._noBoundaryData=!0;t&&t({primitives:i._primitives})})})}):this._useBoundaryDataSource&&!this._noBoundaryData&&n?this._boundaryDataSource.getPrimitives(n,function(n){i._primitives&&i._canShowPrimitives()?(n.primitives.forEach(function(n){n.taskDisplayState=i._primitives&&i._primitives.length&&i._primitives[0].taskDisplayState;n.viewState=i._primitives&&i._primitives.length&&i._primitives[0].viewState}),n.primitives=i._primitives&&n.primitives.concat(i._primitives.slice(1)),t&&t(n)):t&&t({primitives:[]})},this._map.getConfig().cityPolygonLayerId,r):t&&t({primitives:this._primitives})},i.prototype.dispose=function(){this._primitives=null;this._boundaryPolygons=null;this._boundaryDataSource=null;n.prototype.dispose.call(this)},i.prototype.setPrimitives=function(t,i){this._boundaryDataSource?n.prototype.setPrimitives.call(this,t,i):(this._entityVDPId=t[0].entity.getVdpId(),this._useBoundaryDataSource=!0,this._initialize(),n.prototype.setPrimitives.call(this,t,i))},i.prototype.setTargetMapView=function(t){if(n.prototype.setTargetMapView.call(this,t),!this.mapViewFromBackend){this._noBoundaryData=!0;this._alwaysShowPoi();return}this._backendZoomLevel=this._backendZoomLevel||this._getBackendZoomLevel();this._maxZoomLevel=Math.min(this._backendZoomLevel+i._zoomInThreshold,this.maxZoomLevelForPolygonData);this._minZoomLevel=Math.min(this._backendZoomLevel-i._zoomOutThreshold,this.maxZoomLevelForPolygonData)},i.prototype.setTaskDisplayState=function(t){var i=this;t&&t.prominence&&this._primitives&&this._primitives.length&&this._isPrimaryProminence()&&n.prototype._setSelectedPrimitive.call(this,this._primitives[0],t.prominence?!0:!1);n.prototype.setTaskDisplayState.call(this,t);t&&t.prominence&&this._checkDataLoadedOnceOnSettingProminence&&(this._checkDataLoadedOnceOnSettingProminence=!1,this._events.push(this._layer.getFrameManager().dataLoaded.addOne(function(n){return i._onDataLoaded(n)})))},i.prototype.computeBestMapView=function(n){var i,r;return!this._canChangeMapView()&&!n?null:(i=this._canShowPrimitives(),this.mapViewFromBackend&&i)?this.disableComputingMapViewForLoadingOnly?(this.disableComputingMapViewForLoadingOnly=!1,null):(this._noBoundaryData?this._alwaysShowPoi():(this._primitives&&(this._primitives[0].alwaysShowOnMap=!1,this._primitives[0].viewState=3,delete this._primitives[0].bucket),this._useBoundaryDataSource=!0,this.spatialIndex=this._boundaryDataSource&&this._boundaryDataSource.spatialIndex),r=this._getTargetMapView(),this._backendZoomLevel=this._backendZoomLevel||this._getBackendZoomLevel(),h.setMapCenter(this._map,r.cameraLocation,this._backendZoomLevel,null,this.getDefaultAnimator(r))):i&&this._primitives?(this._alwaysShowPoi(),h.setMapCenter(this._map,this._primitives[0].entity.getLocation(),t.defaultZoomLevel)):null},i.prototype.onContextMenuInvoked=function(){},i.prototype._initialize=function(){var t=this;this._initialized||(n.prototype._initialize.call(this),this._events.push(this._map.mapZoomStopped.add(function(){return t._updateDisplayProperties()})),this._events.push(this._layer.getFrameManager().dataLoaded.addOne(function(n){return t._onDataLoaded(n)})),this._events.push(this.mapViewChanged.add(function(n){return t._onPoiManagerMapViewChanged(n)})),this._events.push(this._map.viewChanged.add(function(n){return t._onMapViewChanged(n)})))},i.prototype._initializeSpatialDataSource=function(t,i,r){var u=this,f=this._map.getConfig().cityPolygonUrlFormat.replace("{entityId}",this._entityVDPId);this._map.getContainer().instanceAsync("LandmarksDataSource",function(f){u._boundaryDataSource=f.getLayerDataSource(u._map.getConfig().cityPolygonVectorLayerId);u._useBoundaryDataSource=!0;u._geoEntityApiHasData=!1;u.spatialIndex=u._boundaryDataSource.spatialIndex;t?u.invalidated.invoke():(u._initialize(),n.prototype.setPrimitives.call(u,i,r))},{vectorTileUrlFormat:f,landmarksMinZoom:this._minZoomLevel,landmarksMaxZoom:this._maxZoomLevel,useSheetBasedLandmarks:!0,landmarksVectorLayerId:this._entityVDPId,landmarksDataSourceLayersOfInterest:this._map.getConfig().cityPolygonDataSourceLayersOfInterest,jsonsoSuffix:this._entityVDPId})},i.prototype._updateDisplayProperties=function(){if(!this._noBoundaryData){var n=this._map.getMercatorZoomLevel();this._canShowPrimitives()&&this._primitives&&this._primitives.length?(n<this._minZoomLevel?(this._primitives[0].viewState=2,this._primitives[0].bucket=l.bucketIdForSelectedPoi,this._useBoundaryDataSource=!1,this.spatialIndex=null):n<=this._maxZoomLevel&&n>=this._minZoomLevel?(this._primitives[0].viewState=3,delete this._primitives[0].bucket,this._useBoundaryDataSource=!0,this.spatialIndex=this._boundaryDataSource&&this._boundaryDataSource.spatialIndex):(this._primitives[0].viewState=3,delete this._primitives[0].bucket,this._useBoundaryDataSource=!1,this.spatialIndex=null),this._primitives[0].revision=(this._primitives[0].revision||0)+1,this.invalidated.invoke()):this._useBoundaryDataSource=n<=this._maxZoomLevel&&n>=this._minZoomLevel?!0:!1}},i.prototype._onDataLoaded=function(){var n,t,i;if(!this._canShowPrimitives()){this._checkDataLoadedOnceOnSettingProminence=!0;return}if(this._geoEntityApiHasData){if(this._boundaryPolygons&&this._boundaryPolygons.primitives.length>0)return}else if(n=this._layer.getFrameManager().getFrameData().getPrimitives(1,!1),n&&n.length>0&&n[0].geometryType===2)return;t=this._map.getBounds(!0);i=this._map.getBounds(!0,this.mapViewFromBackend);t.intersects(i)&&!this._upcomingMapView&&(this._noBoundaryData=!0,this._alwaysShowPoi())},i.prototype._alwaysShowPoi=function(){this._useBoundaryDataSource=!1;this.spatialIndex=null;this._primitives&&(this._primitives[0].viewState=2,this._primitives[0].bucket=l.bucketIdForSelectedPoi,this._primitives[0].revision=(this._primitives[0].revision||0)+1,this.invalidated.invoke())},i.prototype._canShowPrimitives=function(){return this._taskDisplayState&&this._taskDisplayState.prominence!==undefined},i.prototype._canChangeMapView=function(){var n=this._map.getMapType();return this._taskDisplayState&&this._taskDisplayState.activationState===1&&n.id!==w.birdseyeV2},i.prototype._getCornerForLocationInMapView=function(n,t){var f=this._map.getViewport(),i=this._map.getViewportPadding(),o=f.pixelWidth-i.left-i.right,s=f.pixelHeight-i.top-i.bottom,e=this._map.getMode().tryLocationToPoint(n,t),r=e.x-i.left>o/2,u=e.y-i.top<s/2;return u&&r?1:u&&!r?0:!u&&r?3:2},i.prototype._getBackendZoomLevel=function(){var t=this,n=null;return this.mapViewFromBackend&&(n=Math.floor(c.fromLocation(this.mapViewFromBackend.cameraLocation,!0)),n>this.maxZoomLevelForPolygonData&&(n=this.maxZoomLevelForPolygonData,this.mapViewChanged.addOne(function(){if(t._primitives){var n=t._primitives[0].entity,i={logData:{feature:"BD",action:"WRN",data:{title:n&&n._title,type:n&&n._locationType}}};p.invokeHandler(y.instrumentationDataHandlerKey,i)}}))),n},i.prototype._onPoiManagerMapViewChanged=function(n){this._upcomingMapView=n},i.prototype._onMapViewChanged=function(){this._upcomingMapView=null},i._zoomInThreshold=10,i._zoomOutThreshold=2,i}(vt),fr=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return f(t,n),t.prototype._createLayer=function(n){var t=Microsoft.Maps.Internal.SDKPrimitiveTemplateSelector,i=Microsoft.Maps.Layer;this._layer=new i(n,ft.foregroundZOrder);this._layer.setTemplateSelector(new t(this._map))},t.prototype._setPrimitiveLayer=function(){for(var t,s,r=this,n=[],i=0,u=this._primitives;i<u.length;i++)t=u[i],t.geometryType!==1||t.metadata.polygon||n.push(t);this._layer.metadata?this._layer.metadata.pushpinPostCodes=n:this._layer.metadata={pushpinPostCodes:n};var f=this._map.getMercatorZoomLevel(),e=this._map.getConfig(),o=e.postCodeMinPushpinZoom;f<o&&n.forEach(function(n){var t=r._primitives.indexOf(n);t>=0&&r._primitives.splice(t,1)});s=Microsoft.Maps.Layer;this._primitives&&this._layer&&this._layer.add(this._primitives)},t.prototype._updatePrimitivesAndLayerData=function(t,i){n.prototype._updatePrimitivesAndLayerData.call(this,t,i,!1)},t.prototype._onPrimitiveHoverStarted=function(){return null},t.prototype._getLocations=function(){var n=[];return this._primitives&&this._primitives.forEach(function(t){var i,r;t.geometryType===3?(i=wr.fromShapes(t),n.push(i.getSoutheast()),n.push(i.getNorthwest())):t.geometryType===1&&(r=t.geometry,n.push(new b(r.y,r.x)))}),n},t}(tt),af=function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u._taskManager=r,u}return f(t,n),t.prototype.getPrimitives=function(t,i){var r=this._taskDisplayState&&typeof this._taskDisplayState.isHidden!="undefined";r?this._taskDisplayState.isHidden?i&&i({primitives:[]}):n.prototype.getPrimitives.call(this,t,i):n.prototype.getPrimitives.call(this,t,i)},t.prototype.setPrimitives=function(t,i){n.prototype.setPrimitives.call(this,t,i)},t.prototype.setTaskDisplayState=function(t){var i=t&&typeof t.isHidden!="undefined";n.prototype.setTaskDisplayState.call(this,t);i&&(this._isDirty=!0,this._updatePrimitivesAndLayerData(!0))},t.prototype.dispose=function(){this._primitives=null;this._map.getLayers().remove(this._layer);this._isDisposed=!0},t}(tt),vf=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._computeBestMapViewOnDisplayStateChange=!1,r}return f(t,n),t.prototype._initialize=function(){n.prototype._initialize.call(this);this._layer.hasCustomContextMenu=!1},t.prototype.computeBestMapView=function(){if(this._taskDisplayState.activationState===1)return n.prototype.computeBestMapView.call(this)},t}(vt),yf=function(n){function t(t){return n.call(this,t)||this}return f(t,n),t.prototype.getTemplates=function(t,i){var r=t,u=null,e;if(r&&r.taskDisplayState&&this.baseMapTemplateSelector){var f=r.viewState,o=r.taskDisplayState.colorIndex,s=r.taskDisplayState.prominence;if(r.bucket===l.cityPolygonBucket||r.bucket===l.xsrPolygonBucketId)e=f===2?4:s===1||r.taskDisplayState.cardTitleHoveringState===1?2:5,u=this.baseMapTemplateSelector.getCityPolygonTemplates(r.bucket,o-1,e,i);else{if(f===3)return u;u=n.prototype.getTemplates.call(this,t,i)}}return u},t}(ii),ft=function(){function n(){}return n.getZOrderOfTaskPrimitives=function(t){var i;return t&&(t.cardTitleHoveringState===1?i=n.cardHoverZOrder:t.activationState===1?i=n.foregroundZOrder:t.prominence===1?i=n.primaryProminenceZOrder:t.prominence===2?i=n._secondaryProminenceZOrder:t.prominence===3&&(i=n._tertiaryProminenceZOrder),t.stackOrder&&i&&(i+=t.stackOrder)),i},n.cardHoverZOrder=8900,n.foregroundZOrder=8700,n.primaryProminenceZOrder=8500,n._secondaryProminenceZOrder=8300,n._tertiaryProminenceZOrder=8100,n}(),pf=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,f)||this,h,o,s,c;for(e._taskManager=r,e._container=u,e._currentSelectionControlBindings=[],e._disposables=[],e._disabledStackCollection={},e._disposables.push(f.changed.add(function(n){var t,i;if(e._currentSelectionControl&&n.added&&n.added.length>0)for(t=0;t<n.added.length;t++)if(e._disabledStackCollection[n.added[t].id]===undefined){i=n.added[n.added.length-1];i&&i.getForegroundTask()&&e._taskManager.focusTask(i.getForegroundTask().id);e._exitSelectionMode();break}})),h=r.getStacks(),o=0;o<h.length;o++)s=h[o],e._disposables.push(s.stackSelected.add(function(n){var t=n.stack;e._disabledStackCollection[t.id]||(n.isSelected||e.disableStack(t),e._currentSelectionControl&&e._currentSelectionControl.onSelectionChanged(t.getForegroundTask().id,n.isSelected))})),c=s.getForegroundTask(),e._disabledStackCollection[s.id]=!(c.isSharable&&c.isSharable());return e}return f(t,n),t.prototype.getSelectionControl=function(){return this._currentSelectionControl},t.prototype.setSelectionControl=function(n){var t=this;n&&(this._disposeCurrentSelectionControl(),this._currentSelectionControl=n,n.setInitialData({container:this._container}),this._currentSelectionControlBindings.push(n.controlUpdated.add(function(n){switch(n.state){default:t._changeStacksLockStatus(!0);break;case 2:case 0:t._changeStacksLockStatus(!1)}})))},t.prototype._exitSelectionMode=function(){this._disposeCurrentSelectionControl();p.invokeHandler(y.shareDataHandlerKey,{action:"closeShare"})},t.prototype.getSelectionModeControlName=function(){return"SharePanel"},t.prototype.dispose=function(){n.prototype.dispose.call(this);for(var t=0;t<this._disposables.length;t++)this._disposables[t]&&this._disposables[t].dispose();this._disposeCurrentSelectionControl()},t.prototype._changeStacksLockStatus=function(n){var r=this.stacks,t,i;for((this.stacks==null||this.stacks.length==0)&&(r=this._taskManager.getStacks()),t=0;t<this.stacks.length;t++)i=this.stacks[t],this._disabledStackCollection[i.id]||i.setIsLocked(n)},t.prototype.disableStack=function(n){n.displayState.activationState=4;var t=this._taskManager.getStackById(n.id);t.displayState.activationState=4;n.displayState.activationState=4;this._taskManager.updateProminences(t)},t.prototype._findNonDisabledStack=function(n,t,i){var r=null;do if(n+=i,r=t[n],r)r.displayState.activationState===4&&(r=null);else break;while(!r);return r},t.prototype._disposeCurrentSelectionControl=function(){if(this._currentSelectionControl&&this._currentSelectionControl.dispose(),this._currentSelectionControl=null,this._currentSelectionControlBindings&&this._currentSelectionControlBindings.length>0){for(var n=0;n<this._currentSelectionControlBindings.length;n++)this._currentSelectionControlBindings[n].dispose();this._currentSelectionControlBindings.length=0}},t}(nr);e.BaseTask=bt;e.BaseTaskViewModel=ku;e._MicroPoiEntity=ri;i.CollectionsTaskPoiManager=tr;i.CollectionsXsrPoiTemplateSelector=tf;i.DetailsTaskPoiManager=vt;i.ItineraryTaskPoiManager=rf;i.ItineraryTemplateSelector=uf;i.LayoutManager=at;i.LocalGuideTaskPoiManager=ff;i.LocalGuideL2TaskPoiManager=ef;i.MicroPoiManager=sf;i.MicroPoiRequestProcessor=rr;i.MicroPoiResultsPoiTemplateSelector=cf;i.NearbyTransitTaskPoiManager=lf;i.PoiManager=rt;i.PolygonBoundaryManager=ur;i.PolygonListingTaskPoiManager=fr;i.ResultsTaskPoiManager=tt;i.TaskManager=gu;i.TaskPrimitivesZOrderManager=ft;i.TopicSearchPoiManager=af;i.TransitStopTaskPoiManager=vf;i.XsrBoundaryTemplateSelector=yf;i.XsrPoiTemplateSelector=ii}catch(er){if(i.logger)i.logger.logCriticalError(er);else throw er;}}).call(window)