var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForMapOverlay=function(n){function t(t,i){var r=n.call(this,t)||this,u;return r._slimHeaderClass="b_slimHead",r._savedIdentityLoginMode=0,r._detailsCardWidth=380,r._detailsCardWidthWC=464,r._overlayPageName="o",r._isAttractionOverlay=!1,r.padding={left:390,right:75,top:70,bottom:30},r._mapOptions.showScalebar=!0,r._mapOptions.showBreadcrumb=!0,r._mapOptions.showLocateMeButton=!0,r._mapOptions.showLandmarks=!0,r._navigateToMapsVertical=!1,r._taskBar=null,r._mapchangedListener=null,r._streetsideLaunchedDirectly=!1,r._largeMapOverlayAttribute=i,r._internalNS=Microsoft.Maps.Internal,r._gimme=r._internalNS._Gimme,r._mapsGlobalConfig=Microsoft.Maps.GlobalConfig,u=r._mapOptions&&r._mapOptions.searchQueryCategory,u&&(r._isAttractionOverlay=u.toLowerCase().indexOf("attraction")>-1),sj_evt.bind("TaskDisplayed",function(n){r._onTaskDisplayed(n[1])}),r._subscribeForCacheIdAndMapBoundsChangedEventForHotels(),r}return __extends(t,n),t.prototype.bootstrap=function(t,i,r,u){n.prototype.bootstrap.call(this,t,i,r,u);this._initOverlayScenario();sj_evt.fire("mapOverlayLoaded",this)},t.prototype._getExploreMoreElement=function(t){var i=n.prototype._getExploreMoreElement.call(this,t);return i?(i.style.display="block",i.parentElement):null},t.prototype._getSpecificElementForGroup=function(n,t){var i,r;return(n===void 0&&(n=null),t===void 0&&(t=null),n)?(i="div["+n+"]",t&&(i+='[data-groupindex="'+t+'"]'),r=this._gimme(i),r.length>0?r[0]:null):null},t.prototype._initOverlayScenario=function(){var f=this,t=document.getElementsByClassName("dynMap"),n,r,u,i;if(t&&t.length>1)for(r=0;r<t.length;r++)if(u=t[r],u&&u.getAttribute("id")===this._mapOptions.id){n=this._dynamicMapDiv=u;break}n||(n=this._dynamicMapDiv=t[0]);i=document.createElement("div");i.setAttribute("data-tasklayout",'{ "defaultLayout": "MultiCardLeftLayout", "cardPrimerShown": true }');i.style.display="block";i.className="Light taskLayoutContainer";n.appendChild(i);n.className=n.className+" MicrosoftMap";n.setAttribute("data-global","{}");this._originalNextSibling=n.nextSibling;this._originalParent=n.parentNode;this._originalHeight=n.style.height;this._originalWidth=n.style.width;this.serializableObjectChanged=new this._internalNS._JSEvent;this._dynamicProperties.mapOverlayInSerpEnabled=!0;sj_evt.bind("dynMapRendered",function(){var n=f._map.getV8Map().getContainer();n.downloadDependencyAsync("LocalSearchTask");n.downloadDependencyAsync("MapsFeedback")});this._trackMapPanOrZoom();this._removeGLinkPingLinks()},t.prototype.getContentArea=function(){return document.getElementById("b_content")},t.prototype.getDynamicMapDiv=function(){return this._dynamicMapDiv},t.prototype.serialize=function(){return{}},t.prototype.deserialize=function(){this._dynamicProperties.largeMapShownOnSerp&&this._taskManager.getStacks().length===0&&(this._logBackButtonClick(),this._showOrHideLargeMap(!1))},t.prototype.replaceNextHistoryPoint=function(){this._browserHistoryManager&&this._browserHistoryManager.nextHistoryPointReplace()},t.prototype.updateAddressBarPathOnOverlayOpen=function(){var n=this;this._browserHistoryManager&&sj_evt.bind("ajaxReady",function(){n._browserHistoryManager.updateAddressBar("/maps")},1)},t.prototype.updateAddressBarPathOnOverlayClose=function(){this._browserHistoryManager&&this._browserHistoryManager.updateAddressBar("/search",!0)},t.prototype.hasUserChangedMapView=function(){return this.userChangedMapView},t.prototype.getOriginIG=function(){return this._dynamicProperties.serpIG},t.prototype.getLargeMapLinkPermalinkState=function(n,t,i){n===void 0&&(n=null);t===void 0&&(t=null);i===void 0&&(i=null);var r=t||this._largeMapOverlayAttribute,u=i?this._getSpecificElementForGroup(r,i):this._getExploreMoreElement(n);return u&&r?u.getAttribute(r):null},t.prototype.getLargeMapSize=function(){return this._largeMapSize},t.prototype.getPadding=function(){var n=Microsoft.Maps.GlobalConfig.features.localSearch;if(n&&this.padding){if(n.enablePoiCentering){var c=Microsoft.Maps.GlobalConfig.features.taskFramework,i=c.newCardSizingForTCF,r=i?32:30,u=i?64:0,f=i?0:this.padding.right,e=i?0:this.padding.top;if(n.doubleWideListEnabled&&this._isAttractionOverlay){var t=n.threeColumnListSegmentsEnabled,s=t&&t.length&&t.indexOf("Attraction")>-1,h={left:n.defaultListPlusDetailsCardWidth+r+u,right:f,top:e,bottom:this.padding.bottom};return s&&this._gimme("body")[0].clientWidth>n.threeColumnMinBrowserWidth&&(h={left:n.threeColumnListPlusDetailsCardWidth+r+u,right:f,top:e,bottom:this.padding.bottom}),h}return this.padding.left=n.baseCardWidth+r+u,this.padding.right=f,this.padding.top=e,(this._mapOptions.polygonConfig&&this._mapOptions.scenario&&(this._mapOptions.scenario.toLowerCase().indexOf("citytravel")>-1||this._mapOptions.scenario.toLowerCase().indexOf("nptravel")>-1)||this._mapOptions.searchQueryCategory&&this._mapOptions.searchQueryCategory.toLowerCase().indexOf("city")>-1)&&(this.padding.left=n.placeCardWidth+r+u),this.padding}if(n.doubleWideListEnabled&&this._isAttractionOverlay&&this.padding){var o=Microsoft.Maps.GlobalConfig.features.localSearch,t=o.threeColumnListSegmentsEnabled,s=t&&t.length&&t.indexOf("Attraction")>-1;return{left:(s?o.threeColumnListPlusDetailsCardWidth:o.defaultListPlusDetailsCardWidth)+30,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}}}return this.padding},t.prototype.getDetailsCardWidth=function(){return Microsoft.Maps.GlobalConfig.features.localSearch.enablePoiCentering?this._detailsCardWidthWC:this._detailsCardWidth},t.prototype.getV8Map=function(){return this._map.getV8Map()},t.prototype._trackMapPanOrZoom=function(){var n=this;this.userChangedMapView=!1;this._map&&(this._map.getV8Map().mapPanStarted.addOne(function(){n.userChangedMapView=!0}),this._map.getV8Map().mapZoomStarted.addOne(function(){n.userChangedMapView=!0}))},t.prototype._logBackButtonClick=function(){var n={logData:{feature:"Browser",action:t.Clicked,data:{overlay:InstrumentationBase.getOverlayType(),CN:"BackButton"}}},i=Microsoft.Maps.logger;i.logObject(n.logData)},t.prototype._removeGLinkPingLinks=function(){var t=_ge("mv_lm"),n,i;t&&(n=t.querySelector("[h]"),n&&(i=n.getAttribute("h"),n.removeAttribute("h"),n.setAttribute("data-h",i)))},t.prototype._initializeScrollButtonForAttractionFilterBar=function(){this._isAttractionOverlay&&typeof FilterBar!="undefined"&&typeof FilterBar.initializeScrollButton!="undefined"&&FilterBar.initializeScrollButton()},t.prototype._changeLargeMapLinkVisibility=function(n){var t=this._gimme(".mv_lm")[0];t&&(t.style.display=n?"none":"block",n?this._map.setOptions({supressLargerMapClick:!0}):this._map.setOptions({supressLargerMapClick:this._smallMapState.supressLargeMapClick}))},t.prototype._changeStreetsideImageVisibility=function(n){var t=this._gimme("#dm_street")[0];t&&!t.classList.contains("b_hide")&&(t.style.display=n?"none":"block")},t.prototype.setBestMapView=function(n,t){var i,r,o,u,h,c,f,s,l,a;if(!this.userChangedMapView||this._mapOptions.pushpins&&this._mapOptions.pushpins.length>1){if(this._mapOptions.vectorDataPipelineId&&!t){if(this._mapOptions.bestMapViewBasedOnMapEntities){var e=this._mapOptions.bestMapViewBasedOnMapEntities,v=parseFloat(e.nwLatitude),y=parseFloat(e.nwLongitude),p=parseFloat(e.seLatitude),w=parseFloat(e.seLongitude);i=Microsoft.Maps.LocationRect.fromEdges(v,y,p,w)}else i=this._map.getBounds();this._map.getV8Map().setView(this._getUpdatedView(i,n))}else if((this._mapOptions.pushpins&&this._mapOptions.pushpins.length===1||this._mapOptions.scenarioType===3)&&!t){if(this._mapOptions.scenarioType===3){for(o=this._mapOptions.pushpins,u=0,h=o.length;u<h;u++)if(parseInt(o[u].IconStyle)===118){r=o[u];break}}else r=this._mapOptions.pushpins[0];r&&(c=new Microsoft.Maps.Location(r.Location.Latitude,r.Location.Longitude),this._map&&this._map.setView({zoom:16}),this._internalNS.MapHelper.setMapCenter(this._map.getV8Map(),c,undefined,undefined,undefined,undefined,undefined,this.padding,n))}else if(this._mapOptions.pushpins&&this._mapOptions.pushpins.length>1||t){if(!t)for(t={},t.mapBounds=[],f=0;f<this._mapOptions.pushpins.length;f++)s=this._mapOptions.pushpins[f],t.mapBounds[f]=new Microsoft.Maps.Location(s.Location.Latitude,s.Location.Longitude);t.mapBounds?(l=this._map.getV8Map().getMode().getMapViewForLocationsInView(t.mapBounds,this.getPadding(),n),this._map.getV8Map().setView(l)):t.mapCenter&&t.mapZoom&&(a=t.customPadding?t.customPadding:this.padding,this._map.setView({zoom:t.mapZoom}),this._internalNS.MapHelper.setMapCenter(this._map.getV8Map(),t.mapCenter,undefined,null,null,null,undefined,a,n))}}else i=this._map.getBounds(),this._map.getV8Map().setView(this._getUpdatedView(i,n))},t.prototype.changeMapLayoutOnSerp=function(n,t,i){var u=this._gimme,f=document.getElementById("b_header"),l,a,v,o,r,s,h;if(n){var c=0,e=null;f&&(l=document.getElementsByTagName("body")[0],a=this._mapsGlobalConfig.features.taskBar,l.style.minWidth=a.windowMinWidth.toString()+"px",l.style.minHeight=a.windowMinHeight.toString()+"px",u("#b_content").add_class("v8OverlayMap"),e=u("#b_footer"),e&&e.length>0&&e.add_class("b_slimFoot"),this._showOrHideIdControls(!0));typeof Identity!="undefined"&&(this._savedIdentityLoginMode=Identity.headerLoginMode,Identity.headerLoginMode=1);this._largeMapSize=this._getLargeMapSize(c);e&&e.length>0&&(this._largeMapSize.height=this._largeMapSize.height-30,c=30);v=this.getBestMapViewForOverlay(t);this.setBestMapView(this._largeMapSize,v);r=this._dynamicMapDiv;this._serpScrollYPos=window.scrollY;window.scrollTo(0,0);o=this.getContentArea();o&&o.firstChild&&o.insertBefore(r,o.firstChild);r.style.top="0px";r.style.height="calc(100% - "+c+"px)";r.style.width="100vw";this._map.getV8Map().getSizeHelper().pollSize();this.adjustOverlayScroll(!0);u(r).add_class("noMapTypeBuffer");f&&f.classList&&f.classList.contains("b_slimHead")&&(f.style.minWidth=this._mapsGlobalConfig.features.taskBar.windowMinWidth.toString()+"px")}else{if(r=this._dynamicMapDiv,u(r).remove_class("noMapTypeBuffer"),this._originalNextSibling?this._originalNextSibling.parentNode.insertBefore(r,this._originalNextSibling):this._originalParent.appendChild(r),document.getElementsByTagName("body")[0].removeAttribute("style"),this._showOrHideIdControls(!1),s=u(".id_button",f),s.length&&s[0].hasAttribute("styles"))for(h=0;h<s.length;h++)u(".id_button",f)[h].removeAttribute("style");u("#b_content").remove_class("v8OverlayMap");u("#b_footer").remove_class("b_slimFoot");typeof Identity!="undefined"&&(Identity.headerLoginMode=this._savedIdentityLoginMode);i||(f.style.display="block");r.style.top="0px";r.style.height=this._originalHeight;r.style.width=this._originalWidth;this._map.getV8Map().getSizeHelper().pollSize();window.scrollTo(0,this._serpScrollYPos);this.adjustOverlayScroll(!1)}},t.prototype.adjustOverlayScroll=function(n){var i=this._gimme,t=i(document.getElementById("b_header"));document.body.style["overflow-y"]=document.getElementsByTagName("html")[0].style["overflow-y"]=n?"hidden":"auto";document.body.style["overflow-x"]=document.getElementsByTagName("html")[0].style["overflow-x"]=n?"hidden":"auto";n?(t.add_class(this._slimHeaderClass),t.add_class("bm_oneMap")):(t.remove_class(this._slimHeaderClass),t.remove_class("bm_oneMap"))},t.prototype.setDirectStreetsideLaunch=function(){this._streetsideLaunchedDirectly=!0},t.prototype.getBestMapViewForOverlay=function(n){return n&&n.getBestMapView(this._largeMapSize,this.getPadding(),this.getDetailsCardWidth(),this._mapBoundsForHotelPricePois)},t.prototype.attachOrRemoveOverlayCloseButtonHandler=function(n){var t=this,r=this._gimme,i=r(".overlayCloseBtn");n?(this._closeButtonClickHandler||(this._closeButtonClickHandler=function(n){n&&n.preventDefault&&(n.preventDefault(),n.stopImmediatePropagation());var i=r(".streetsideExit");i&&i.length>0&&i[0].click();t._taskManager&&(t._taskManager.isOverlayClosing=!0);t._removeAllStacks();t._showOrHideLargeMap(!1)}),i.length>0&&i.add_event("click",this._closeButtonClickHandler)):i.length>0&&this._closeButtonClickHandler&&(i.remove_event("click",this._closeButtonClickHandler),this._closeButtonClickHandler=null)},t.prototype.showOrHideCorpFeedback=function(n){var i=this._gimme("#fbpgbt"),t;i&&(n?i.set_style({display:"none"}):(i.set_style({display:""}),this._mapsFeedback&&this._mapsFeedback.onDisabled.invoke(),t=this._gimme(".feedbackPopOut .hidePopoutButton"),t&&t.length>0&&t.set_style({display:"none"})))},t.prototype._showOrHideNewBingNotification=function(n){var t=document.getElementById("b_opalpers");t&&(t.style.display=n?"none":"")},t.prototype._adjustScope=function(n){for(var o,e,i=this._gimme,t=i(".b_scopebar ul li a"),r=-1,u=-1,f=0;f<t.length;f++)o=t[f],e=o.getAttribute("href"),r==-1&&e.indexOf("scope=web")!=-1&&(r=f),u==-1&&(e.indexOf("/maps?")!=-1||e.indexOf("/maps/")!=-1)&&(u=f);r!=-1&&u!=-1&&(n?(i(t[r].parentElement).remove_class("b_active"),i(t[u].parentElement).add_class("b_active")):(i(t[u].parentElement).remove_class("b_active"),i(t[r].parentElement).add_class("b_active")))},t.prototype._saveOrRestoreLargeMapState=function(n){n===1&&(this._map&&this._map.getV8Map().setViewportPadding({left:0,top:0,right:0,bottom:0}),this._cityPolygonManager&&this._cityPolygonManager.removeLayer(),this._mapOptions.pushpins&&this._map.entities.setVisible(!1),this._childrenBoundariesLayer&&this._childrenBoundariesLayer.setVisible(!1))},t.prototype._saveOrRestoreSmallMapState=function(n){var t=this;n===0?this._smallMapState={center:this._map.getCenter(),zoom:this._map.getZoom(),viewportPadding:this._map.getV8Map().getViewportPadding(),mapStyleSelectorShown:this._mapOptions.showMapTypeSelector,disableScrollWheelZoom:this._mapOptions.disableScrollWheelZoom,supressLargeMapClick:this._mapOptions.supressLargerMapClick,showDashboard:this._mapOptions.showDashboard,disableZooming:this._mapOptions.disableZooming,disablePanning:this._mapOptions.disablePanning}:Microsoft.Maps.setTimeout(function(){t._map.getV8Map().getFrameManager().frameRendered.addOne(function(){t._smallMapState&&(t._smallMapState.viewportPadding&&t._map.getV8Map().setViewportPadding(t._smallMapState.viewportPadding),t._smallMapState.center&&t._smallMapState.zoom&&t._map.setView({center:t._smallMapState.center,zoom:t._smallMapState.zoom}),t._map.setOptions({showMapTypeSelector:t._smallMapState.mapStyleSelectorShown}))});t._mapOptions.childrenBoundaryNames?t._bootstrapChildrenBoundariesScenario():t._mapOptions.vectorDataPipelineId&&t._bootstrapBoundaryScenario();t._mapOptions.pushpins&&t._map.entities.setVisible(!0);t._mapOptions.showTraffic&&t._trafficManager&&t._trafficManager.show()},100)},t.prototype._enableOrDisableScrollForSafari=function(n){var i=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),t;i&&(t=window,t.stopScrolling=t.stopScrolling||function(){t.scrollTo(0,0)},n?window.removeEventListener("scroll",t.stopScrolling):window.addEventListener("scroll",t.stopScrolling))},t.prototype._showOrHideLargeMap=function(n,t,i){var r=this,u,f;i===void 0&&(i=!0);u=this._internalNS._PerfV2Logger;u&&u.tryFlush();this._isTaskLoadStarted=!1;n?(this._isResultsWithDetailsOverlay=t&&t instanceof BootstrapMapsAnswerForResultsWithDetailsOverlay,u&&u.setStartTime("Maps_SOPLT"),Microsoft.Maps.logger.logObject({feature:"OverlayExpansion",T:"CI.ExpandContent",FID:"OverlayExpansion"},_G.IG),this._setOverlayType(!0),f=new this._internalNS._ExternalPromise,this._taskManager&&(this._taskManager.isOverlayClosing=!1),this._loadComponentsForSearchPrefetch(function(){r._dynamicProperties.prefetchingResultsOnSerp=!0;r._showOrHideTasklayoutContainer(!1);r.injectOrRemoveSkeleton(!0);r._processPermalinkState(t.getPermalinkState(r._dynamicProperties.serpIG),i);f.resolve()}),this._loadComponentsForMapsVertical(function(){r._saveOrRestoreLargeMapState(1);var n=r._map.getV8Map().getFrameManager(),i=function(){n.disable();r._enableOrDisableScrollForSafari(!1);r._showMapTypeSelector();r._changeScrollWheelZoomOption(!0);r._changezorderOfMap(!0);r._showOrHideStaticImage(!0);r._addOrRemoveMapModeChangeListener(!0);r._addOrRemoveMapTypeChangeListener(!0);r.changeMapLayoutOnSerp(!0,t);r._changeLargeMapLinkVisibility(!0);r._changeStreetsideImageVisibility(!0);r._changeMapOverlayElementsVisibility(!0);r._turnOnOrOffStreetSideLayer(!0);r._setGlobalStates(!0);r._changeNavBarOrientation(!0);r._changeStreetSideOverlayMapMode(!0);r._changeCopyrightOrientation(!0);r._changeMapContainerClassName(!0);r._storeOrRestoreMapType(!0);n.frameRendered.addOne(function(){r._showOrHideBetaFeedback()});r._hookUpKeypressListeners();r.updateAddressBarPathOnOverlayOpen();r.serializableObjectChanged.invoke({magnitude:2});r._saveOrRestoreLargeMapState(0);r._showOrHideTasklayoutContainer(!0);r.injectOrRemoveSkeleton(!0);r._dynamicProperties.prefetchingResultsOnSerp=!1;r.attachOrRemoveOverlayCloseButtonHandler(!0);r.showOrHideCorpFeedback(!0);r._showOrHideNewBingNotification(!0);r.attachOrRemoveBrowserPrintMessage(!0);r._addRemoveBannerContainer(!0);r.showOrHideFabControlOnSerp(!0);r.showOrHideSydney(!0);r._logPerfCounters();r._setOverlayClassOverrides(!0);r._hideWallpaperLink(!0);_w.clarity&&_w.clarity("set","answers","MapOverlayExpansion");sj_evt.fire("LargeMapShown",r);n.enable();InstrumentationBase.SendInstrumentationToServer("",r._overlayPageName);r._setMouseWheelPropogation(!1)};f.then(i)})):(this._dynamicProperties.mapsOverlayClosing=!0,this.adjustOverlayScroll(!1),Microsoft.Maps.setTimeout(function(){r._saveOrRestoreSmallMapState(1);r._enableOrDisableScrollForSafari(!0);r._changeScrollWheelZoomOption(!1);r._changezorderOfMap(!1);r._showOrHideStaticImage(!1);r._addOrRemoveMapModeChangeListener(!1);r._addOrRemoveMapTypeChangeListener(!1);r._addRemoveBannerContainer(!1);r.changeMapLayoutOnSerp(!1);r._changeLargeMapLinkVisibility(!1);r._changeStreetsideImageVisibility(!1);r._changeMapOverlayElementsVisibility(!1);r._turnOnOrOffStreetSideLayer(!1);r._setGlobalStates(!1);r._setOverlayType(!1);r._setOverlayClassOverrides(!1);r._changeNavBarOrientation(!1);r._changeStreetSideOverlayMapMode(!1);r._changeCopyrightOrientation(!1);r._changeMapContainerClassName(!1);r._storeOrRestoreMapType(!1);r._showOrHideBetaFeedback();r._unHookKeypressListeners();r._trackMapPanOrZoom();r.injectOrRemoveSkeleton(!1);r._showOrHideTasklayoutContainer(!1);r.attachOrRemoveOverlayCloseButtonHandler(!1);r.showOrHideCorpFeedback(!1);r._showOrHideNewBingNotification(!1);r.attachOrRemoveBrowserPrintMessage(!1);r.showOrHideFabControlOnSerp(!1);r.showOrHideSydney(!1);r.updateAddressBarPathOnOverlayClose();r._initializeScrollButtonForAttractionFilterBar();r._hideWallpaperLink(!1);sj_evt.fire("LargeMapHidden",r);r._dynamicProperties.mapsOverlayClosing=!1;r._setMouseWheelPropogation(!0)},100))},t.prototype.attachOrRemoveBrowserPrintMessage=function(n){var e=this._gimme,u=e(this.getContentArea()),o=u.getParent(),i,f,r,t;n?(u.add_class("mapOverlayOnSerp"),t=this.createElement("div","MicrosoftMap defaultPrintMessage showPrintErrorMessage"),t.set_attr("data-tag","defaultPrintMessage"),t.set_attr("id","defaultPrintMessage"),i=this.createElement("span","printErrorMessage"),f=this._dynamicProperties.defaultPrintMessage,i.set_attr("data-text",f),i.appendText(f),r=this.createElement("img","printErrorImage rms_img"),r.set_attr("data-tag","printErrorImage"),r.set_attr("src",this._dynamicProperties.defaultPrintImage),t.append(i),t.append(r),o.insertBefore(t,this.getContentArea())):(u.remove_class("mapOverlayOnSerp"),t=e(o).select(".defaultPrintMessage"),t&&t.length>0&&t.removeFromParent())},t.prototype.createElement=function(n,t,i,r,u){var f=this._gimme(document.createElement(n));return t&&f.add_class(t),i&&f.set_attr("role","button"),r&&f.set_attr("target","_blank"),u&&f.set_attr("href",u),f},t.prototype._removeAllStacks=function(){Microsoft.Maps.GlobalDataEventHandler.invokeHandler(Microsoft.Maps.DataHandlerKeys.taskDataHandlerKey,{action:"removeAllStacks"})},t.prototype._adjustIdHeightBaseOnOutingsBanner=function(){var u=this._gimme,e=u(".bm_outingsBase"),t,f,n,i,r;e.length!==0&&(t=e[0].clientHeight,f=u("#b_header"),f.length>0&&(n=u("#id_h",f[0]),n.length>0&&(i=Number(n.get_style("top").substr(0,n.get_style("top").indexOf("px"))),i>=t?(r=i-t,n.set_style({top:r+"px"})):(r=t-i,n.set_style({top:r+"px"})))))},t.prototype._showOrHideIdControls=function(n){var u=this._gimme,e=u("#b_header"),r=u("#id_h",e[0]),t,i,f;r.length>0&&(t=u("#id_l",r[0]),i=u("#id_rh",r[0]),n?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),i.length>0&&!i.has_class("hide")&&i.add_class("hide"),this._adjustIdHeightBaseOnOutingsBanner()):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),i.length>0&&i.has_class("hide")&&i.remove_class("hide")),n||(f=r.get_style("top"),f&&f.indexOf("px")>0&&r.set_style({top:"0px"})))},t.prototype._showOrHideTasklayoutContainer=function(n){var t=this._gimme(".MicrosoftMap .taskLayoutContainer");n?t.remove_class("hideTaskLayout"):t.add_class("hideTaskLayout")},t.prototype.injectOrRemoveSkeleton=function(n){var e=this._gimme,u=this._internalNS._Helper,i=Microsoft.Maps.GlobalConfig.features.taskFramework,t,o,f,h,r;if(i&&i.showLoadingSkeleton)if(t=e(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft"),o=t&&t.length>0,n){if(o){i.suppressSkeleton&&!t.has_class("bm_suppressSkeleton")&&t.add_class("bm_suppressSkeleton");return}var c=this._dynamicMapDiv,l=Microsoft.Maps.GlobalConfig.features.taskBar,s="bm_loadSkeleton taskLayoutSkeletonContainer bm_l2NavLeft";i.suppressSkeleton&&(s+=" bm_suppressSkeleton");f=u.createElementWithClassName("div",s);h=e(f);h.set_style({display:"none","z-index":"1000"});r=u.createElementWithClassName("div","bm_skCombinedWrapper");r.appendChild(u.buildSkeletonCardContainer("bm_skeletonResults"));r.appendChild(u.buildSkeletonCardContainer("bm_skeletonDetails"));f.appendChild(r);this._isResultsWithDetailsOverlay&&e(r).add_class("bm_skSlideCard");c.appendChild(f)}else i.suppressSkeleton&&t.has_class("bm_suppressSkeleton")&&t.remove_class("bm_suppressSkeleton"),o&&this._dynamicMapDiv.removeChild(t[0])},t.prototype._showMapTypeSelector=function(){this._map.setOptions({showMapTypeSelector:!0})},t.prototype._logPerfCounters=function(){var n=this,t=this.getV8Map();this._frameRenderedListener&&this._frameRenderedListener.dispose();this._frameRenderedListener=t.getFrameManager().frameRendered.add(function(){var t,i;if(n._isTaskLoadStarted){n._frameRenderedListener.dispose();t=n._internalNS._PerfV2Logger;i=Date.now()-t.getStartTime("Maps_SOPLT");sj_evt.fire("v8OverlayPLT",i);var r=n._internalNS._Helper,u=n._mapOptions.searchQueryCategory,f=r._isHotelsCategory(u)?"Maps_SOHPLT":r._isRestaurantCategory(u)?"Maps_SORPLT":r._isHouseCategory(u)?"Maps_SOREPLT":r._isAttractionCategory(u)?"Maps_SOAPLT":typeof BootstrapMapsAnswerForTravelOverlay!="undefined"&&n instanceof BootstrapMapsAnswerForTravelOverlay?"Maps_SOTPLT":"";f&&t.record(f,i);t.record("Maps_SOPLT",i)}})},t.prototype._onTaskDisplayed=function(n){(!this._isResultsWithDetailsOverlay||n.indexOf("DetailsTask")>-1)&&(this._isTaskLoadStarted=!0)},t.prototype._addOrRemoveMapModeChangeListener=function(n){var r=this,u=this._gimme,t,i;this._map&&(t=this._map.getV8Map().mapModeChanged,i=this.getDynamicMapDiv(),n?!this._mapchangedListener&&t&&(this._mapchangedListener=t.add(function(n){if(n&&n.newMode===2&&r._streetsideLaunchedDirectly)u(i).add_class("streetside");else{var t=!(n&&n.newMode===2);r._turnOnOrOffOverlayComponents(t)}})):(this._mapchangedListener&&t&&(u(i).remove_class("streetside"),t.remove(this._mapchangedListener),this._mapchangedListener=null),this._streetsideLaunchedDirectly=!1))},t.prototype._addOrRemoveMapTypeChangeListener=function(n){var i=this,u=this._gimme,t,r;this._map&&(t=this._map.getV8Map().mapTypeChanged,r=this.getDynamicMapDiv(),n?!this._mapTypeChangedListener&&t&&(this._mapTypeChangedListener=t.add(function(n){var t=!(n&&n.newMapTypeId==="be2");i._turnOnOrOffOverlayComponents(t)})):this._mapTypeChangedListener&&t&&(t.remove(this._mapTypeChangedListener),this._mapTypeChangedListener=null))},t.prototype._turnOnOrOffStreetSideLayer=function(n){this._streetSideAutoEntryBehavior&&(n?this._streetSideAutoEntryBehavior.showStreetSideOverlay(this._map.getZoom()):this._streetSideAutoEntryBehavior.hideStreetSideOverlay())},t.prototype._hideWallpaperLink=function(n){var t=document.getElementById("id_h"),i=t!=null?t.querySelector('[id^="bnp.nid"]'):null;i&&(i.style.display=n?"none":"")},t.prototype._turnOnOrOffOverlayComponents=function(n){var i=n?"block":"none",r=this._gimme,t=r(".overlayCloseBtn ")[0];t&&(t.style.display=i)},t.prototype._getOverlayType=function(){return this._isAttractionOverlay?"attractionOverlay":"mapsOverlay"},t.prototype._setOverlayType=function(n){var t=this._getOverlayType()+"OnSerp";this._dynamicProperties[t]=n?{visible:!0,isNearbyScenario:this._mapOptions.scenarioType===3?!0:!1}:{visible:!1,isNearbyScenario:undefined};this._dynamicProperties[t].searchQueryCategory=this._mapOptions.searchQueryCategory},t.prototype._updateClassOverrides=function(n,t,i){var f=this._gimme,r=t,l=i?i:r,u=f(".taskBar"),o=f(".taskLayoutContainer"),s=f(".toggleButton"),h=f(".overlayCloseBtn"),v=l+"OnSerp",a=f("#b_notificationContainer"),c=f(this.getDynamicMapDiv()),e;n?(c.add_class(l),u.length>0&&(u[0].classList.add(r),u[0].classList.contains("bm_oneMap")&&u[0].classList.remove("bm_oneMap"),u[0].classList.add("bm_oneMap"),document.getElementsByTagName("body")[0].style.minWidth=this._mapsGlobalConfig.features.taskBar.windowMinWidth.toString()+"px"),o.length>0&&o[0].classList.add(r),s.length>0&&s[0].classList.add(r),h.length>0&&h[0].classList.add(r),a.set_style({display:"none"}),c[0].style.position="fixed",e=this._gimme("#b_footer")[0],e&&(e.style.position="fixed")):(c.remove_class(l),u.length>0&&(u[0].classList.remove(r),u[0].classList.contains("bm_oneMap")&&u[0].classList.remove("bm_oneMap")),f("id_h").set_style({display:""}),o.length>0&&o[0].classList.remove(r),s.length>0&&s[0].classList.remove(r),h.length>0&&h[0].classList.remove(r),c[0].style.position="",e=this._gimme("#b_footer")[0],e&&(e.style.position=""))},t.prototype._setOverlayClassOverrides=function(n){this._updateClassOverrides(n,"mapsOverlay")},t.prototype._setGlobalStates=function(n){var i=this._mapsGlobalConfig,t=this._mapOptions,r=i.features,f=r.traffic,u=r.labels;n?(_w.dOSBVC=!0,i.isMapsVertical=!0,this._dynamicProperties.largeMapShownOnSerp=!0,this._dynamicProperties.impressionGuid=this._dynamicProperties.mapsIG,t.disableBirdseye=!1,t.disableStreetside=!1,t.disableStreetsideAutoCoverage=!1,u.dynamicLandmarks=!0,t.enableInteractiveLandmarks=!0,_G.IG=this._dynamicProperties.mapsIG):(_w.dOSBVC=!1,i.isMapsVertical=!1,this._dynamicProperties.largeMapShownOnSerp=!1,t.disableBirdseye=!0,t.disableStreetside=!0,t.disableStreetsideAutoCoverage=!0,u.dynamicLandmarks=!1,t.enableInteractiveLandmarks=!1,_G.IG=this._dynamicProperties.serpIG)},t.prototype._getLocalListingTaskState=function(n){var r,t,i;if(n&&n.stacks)for(r=0;r<n.stacks.length;r++)if(t=n.stacks[r].tasks,t)for(i=0;i<t.length;i++)if(t[i].type==="LocalListing")return t[i].state;return n},t.prototype._processPermalinkState=function(n,t){var r,u,i;t===void 0&&(t=!0);r=n&&n[0]&&n[0].data;r&&(u=JSON.parse(r),i=this._getLocalListingTaskState(u),i.hotelPrimerPois=i.primerPois,i.originalQuery=i.query,t&&(this._cacheIdForHotelPricePois||this._mapBoundsForHotelPricePois)&&(i.cacheId=this._cacheIdForHotelPricePois,this._mapBoundsForHotelPricePois&&(i.mapBounds=this._mapBoundsForHotelPricePois,i.disableComputingMapViewForLoadingOnly=!0)),!t&&i.primerPois&&(i.primerPois=null),n[0].data=JSON.stringify(u));this._permalinkProcessor&&(this._dynamicProperties.mapsOverlayProcessingPermalink=!0,this._permalinkProcessor.processSharedStates(n,this._map.getV8Map()),this._dynamicProperties.mapsOverlayProcessingPermalink=!1)},t.prototype._changeCopyrightOrientation=function(n){var r=this._gimme(".bm_bottomLeftOverlay")[0],t=this._gimme(".bm_bottomRightOverlay")[0],i=this._gimme(".CopyrightContainer")[0];r&&t&&i&&(n?(t.style.bottom="0px",t.appendChild(i)):r.appendChild(i))},t.prototype._changeNavBarOrientation=function(n){var i=this._gimme,t;n?(this._map.setOptions({showDashboard:!0,disableZooming:!1,disablePanning:!1}),t=this._map.getV8Map().getNavigationBar(),t!=null&&(t.setNavigationBarOrientation(0),t.setNavigationBarMode(0),t.setRotateButtonVisible(!1),t.setBirdseyeV2InfoExitControlVisible(!1),i("#MicrosoftNav").remove_class("OnSerp"))):(this._map.setOptions({showDashboard:this._smallMapState.showDashboard,disableZooming:this._smallMapState.disableZooming,disablePanning:this._smallMapState.disablePanning}),t=this._map.getV8Map().getNavigationBar(),t!=null&&(t.setNavigationBarOrientation(1),t.setNavigationBarMode(2),t.setRotateButtonVisible(!1),t.setBirdseyeV2InfoExitControlVisible(!1),i("#MicrosoftNav").add_class("OnSerp")))},t.prototype._changeMapContainerClassName=function(n){var t=this._gimme(this._dynamicMapDiv)[0];t&&(n?(t.classList.remove("dynMap"),t.classList.add("largeMap")):(t.classList.add("dynMap"),t.classList.remove("largeMap")))},t.prototype._subscribeForCacheIdAndMapBoundsChangedEventForHotels=function(){var n=this;sj_evt.bind("hotelsPricepoiDataUpdate",function(t){n._cacheIdForHotelPricePois=t&&t[1]&&t[1].cacheId;n._mapBoundsForHotelPricePois=t&&t[1]&&t[1].mapBounds&&t[1].mapBounds.split(",").map(Number)})},t.prototype._storeOrRestoreMapType=function(n){n?(this._previousMapType=this._map.getV8Map().getMapType(),this._previousMode=this._map.getV8Map().getMode()):(this._map.getV8Map().setMapType(this._previousMapType),this._map.getV8Map().setMode(this._previousMode))},t.prototype._changezorderOfMap=function(n){var t=this._gimme(this._dynamicMapDiv)[0];t&&(t.style["z-index"]=n?1e3:1)},t.prototype._changeScrollWheelZoomOption=function(n){n?this._map.setOptions({disableScrollWheelZoom:!1}):this._map.setOptions({disableScrollWheelZoom:this._smallMapState.disableScrollWheelZoom})},t.prototype._showOrHideStaticImage=function(n){var t=this._gimme("#mv_baseMap");t&&t.for_each(function(t){t.style.display=n?"none":"block"})},t.prototype._changeStreetSideOverlayMapMode=function(n){var t=this._map.getV8Map().getMapOptions().streetsideOptions=this._map.getV8Map().getMapOptions().streetsideOptions||{};t.overviewMapMode=n?0:2},t.prototype._getUpdatedView=function(n,t){var i=this._map.getV8Map();return i.getMode().getMapViewForLocationsInView([n.getNorthwest(),n.getSoutheast()],this.padding,t)},t.prototype._getLargeMapSize=function(n){var t=window,i=document,r=i.documentElement,u=i.body,f=t.innerWidth||r.clientWidth||u.clientWidth,e=t.innerHeight||r.clientHeight||u.clientHeight;return{width:f,height:e-n}},t.prototype._loadComponentsForSearchPrefetch=function(n){var i=this,r,t;this._permalinkProcessorAlreadyLoaded?n&&n():(this._permalinkProcessorAlreadyLoaded=!0,r=this._gimme,t=this._map.getV8Map().getContainer(),t.instanceAsync("TaskActivator",function(){t.instanceAsync("Permalink",function(t){i._permalinkProcessor=t;n&&n()})}))},t.prototype._loadComponentsForMapsVertical=function(n){var t=this;if(this._componentsAlreadyLoaded)n&&n();else{this._componentsAlreadyLoaded=!0;var u=this._gimme,f=this._map.getV8Map().getContainer(),i=[{name:"BrowserHistoryManager"},{name:"MapModeStateHistory"},{name:"LayoutManager"},{name:"TaskBar"},{name:"MapsFeedback",args:{footerFeedback:u("#sb_feedback")}},{name:"TaskManager"},{name:"StreetsideAutoEntryBehavior"}],r=this._mapsGlobalConfig.features.transientLens;r&&r.isEnabled&&i.push({name:"TransientLens"});f.instanceAsyncAll(i,function(i){t._streetSideAutoEntryBehavior=i.StreetsideAutoEntryBehavior;t._taskManager=i.TaskManager;t._browserHistoryManager=i.BrowserHistoryManager;t._mapsFeedback=i.MapsFeedback;var r=i.TaskBar;r&&(t._taskBar=r);i.BrowserHistoryManager.register("BootstrapMapsAnswer",t);r&&t._mapsGlobalConfig.features.autosuggest.focusInSearchBox&&r.setSearchBoxFocus();Microsoft.Maps.setTimeout(function(){return r.initializeAutosuggest()},0);n&&n()})}},t.prototype._hookUpKeypressListeners=function(){var n=this._gimme("#mapsFeedback"),t=this._gimme(".MicrosoftMap .b_logoArea"),i,r;n.length!==0&&t.length!==0&&(i=n[0],r=t[0],this._feedbackBtnListener=function(n){n.keyCode!==9||n.shiftKey||(n.preventDefault(),r.focus())},this._bingLogoListener=function(n){n.keyCode===9&&n.shiftKey&&(n.preventDefault(),i.focus())},n.add_event("keydown",this._feedbackBtnListener),t.add_event("keydown",this._bingLogoListener))},t.prototype._unHookKeypressListeners=function(){var n=this._gimme("#mapsFeedback"),t=this._gimme(".MicrosoftMap .b_logoArea");n.remove_event("keydown",this._feedbackBtnListener);t.remove_event("keydown",this._bingLogoListener)},t.prototype._getSearchQuery=function(n){var t="";return n&&n.length>0?(n.forEach(function(n){if(n.featureType==="taskFramework"){t="";return}(n.featureType==="localSearch"||n.featureType==="localDetails"||n.featureType==="localListing")&&(t=JSON.parse(n.data).query)}),t):""},t.prototype.completeBootstrapping=function(){this._saveOrRestoreSmallMapState(0);n.prototype.completeBootstrapping.call(this)},t.prototype._changeMapOverlayElementsVisibility=function(n){var i=this._gimme,r=n?"block":"none",t=i(".ScaleBar");t&&t.length>0&&(t[0].style.display=r);this._setStyle(i(".taskBar"),r)},t.prototype._setStyle=function(n,t){n&&n.length>0&&(n[0].style.display=t)},t.prototype._showOrHideBetaFeedback=function(){this._mapsFeedback&&this._mapsFeedback.showOrHideBetaButton()},t.prototype.showOrHideFabControlOnSerp=function(n){var i=this._gimme,r=n?"none":"",t=i("#mfa_root");t.length>0&&t.set_style({display:r})},t.prototype.showOrHideSydney=function(n){var i=this._gimme,r=n?"none":"",t=i("#ev_talkbox_wrapper");t.length>0&&t.set_style({display:r})},t.prototype._addRemoveBannerContainer=function(n){var u=this._gimme,f,i,t,r;n?(f=u("#b_content"),t=document.createElement("div"),t&&(t.className="bm_mapBannerContainer",i=u(".taskBar",f[0]),i.length>0&&i[0].insertAdjacentElement("beforebegin",t))):(t=document.getElementsByClassName("bm_mapBannerContainer"),t&&t.length>0&&(t[0].remove?t[0].remove():(r=t[0].parentElement,r&&r.removeChild(t[0]))))},t.prototype._setMouseWheelPropogation=function(n){var t=this.getDynamicMapDiv();t&&(n?(t.removeEventListener("mousewheel",this._handleMouseWheelEvent),t.removeEventListener("touchmove",this._handleMouseWheelEvent)):(t.addEventListener("mousewheel",this._handleMouseWheelEvent),t.addEventListener("touchmove",this._handleMouseWheelEvent)))},t.prototype._handleMouseWheelEvent=function(n){n&&n.stopPropagation()},t.Clicked="C",t}(BootstrapMapsAnswer)