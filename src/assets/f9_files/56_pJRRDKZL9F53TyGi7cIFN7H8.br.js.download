(function(){var a,ir,ui,lt,rr,fi,pt;try{(function(){var n={L_Link_Generating_Text:"Creating the link â€¦",L_Link_GenerationFailed_Text:"There was a problem creating the link. Try again.",L_Permalink_Prompt:"Share this map",L_TaskBar_Label_SearchBox:"Add a search",L_TaskBar_Label_Clear:"Clear Search Term",L_TaskBar_Label_Search:"Search",L_TaskBar_Label_Directions:"Directions",L_TaskBar_Label_Traffic:"Traffic",L_TaskBar_Label_Favorites:"My Places",L_TaskBar_Label_More:"More",L_SearchNearbyTransit:"Nearby Transit",L_SearchNearbyParking:"Parking",L_Permalink_Email_Button_Tooltip:"Email link",L_Print_Submit:"Print",L_PrintPreview:"Print Preview",L_PrintMapAndText:"Map & Text",L_PrintMapOnly:"Map only",L_PrintTextOnly:"Text only",L_PermalinkCopy_Text:"Copy",L_PermalinkEmail_Text:"Email",L_Permalink_Email_Button_Text:"Email",L_PermalinkFacebook_Text:"Facebook",L_PermalinkTwitter_Text:"Twitter",L_Twitter_Tag_Text:"on #BingMaps",L_PermalinkHeaderPrompt_Text:"Share",ShareHeaderTitle:"Select what to share",L_PermalinkLink_Text:"Link",L_PermalinkPrompt_Text:"Select the cards that you would like to share",L_Link_TooManyItemsSelected_Text:"Unable to share. Please unselect some items and try sharing in smaller groupings (5-10 items at a time).",L_Link_EmailTitleManyCards_Text:"Bing Maps session shared with you",L_Link_EmailFooter_Text:"Shared from Bing Maps",L_LengthenButton_Text:"Show full URL",L_ShortenButton_Text:"Shorten",L_EditMapDone_Text:"Done",L_EditMap_Text:"Move or zoom map",L_SlideOutMenu_MapType:"Map",L_SlideOutMenu_MapType_Road:"Road View",L_SlideOutMenu_MapType_Aerial:"Aerial View",L_SlideOutMenu_MapType_Birdseye:"Birds View",L_SlideOutMenu_SeeAllCards:"See all card",L_SlideOutMenu_BingHome:"Bing Home",L_SlideOutMenu_Feedback:"Feedback",L_SlideOutMenu_ExitPreview:"Exit preview",L_PrintNotes:"Notes",L_PrintNotesWatermark:"Type your notes here",L_PermalinkEmbed_Text:"Embed",L_Menu_Exit_Text:"Previous Version",L_Menu_Feedback_Text:"Feedback",L_TaskBar_Label_Print:"Print",L_TaskBar_Label_Embed:"Embed a map",L_TaskBar_Label_Share:"Share",L_Menu_Tips_Text:"Tips",L_TaskBar_Label_Fullscreen:"Full Screen",Taskbar_Label_ExitFullScreen:"Exit Full Screen",TaskBarLogoTitle:"Back to Bing search",BEV2DetailsInstruction:"1. In cards",BEV2Introduction:"New and crisp Bird's Eye imagery is available in many metropolitan areas.",BEV2TransientLensInstruction:"2. Right-click on the map",BEV2WelcomeText:"Bird's Eye has changed",BEV2ImageIntroduction:"There are two ways of viewing the new Bird's Eye.",BEV2TipNote:"Note: Bird's Eye may not be available in your area as outdated imagery is no longer available.",L_CategoryLayerDropdownButton:"All {0}",L_CategoryLayerDropdownTitle:"Show on map",L_CategoryLayer_Schools:"Schools",L_CategoryLayer_Transit:"Transit",L_CategoryLayer_Commutability:"Commute",ShareEmailToolTip:"Send in email",ShareFBToolTip:"Share to Facebook",ShareTwitterToolTip:"Post to Twitter",L_CmtControlTitleText:"Enter your location to see a 15 min commute range.",L_CmtControlAddLocationText:"Add location",L_CmtControlCommuteTime30Text:"30 min",L_CmtControlCommuteTime45Text:"45 min",L_CmtControlCommuteTime60Text:"1 hr",L_CmtControlCommuteTime15Text:"15 min",L_CmtControlCommutePeak_Text:"Peak",L_CmtControlCommuteOffPeak_Text:"Off Peak",L_CmtControlPushpinTitle:"A",L_CmtControlPushpinTwoTitle:"B",L_CmtEditText:"Options",L_CmtDoneText:"Done",L_CmtPlaceHolderText:"Commute to (e.g. work, home, school)",L_CmtTitle:"{time} min commute to {addresses} in {trafficCondition} traffic",L_CmtTooltipTitle:"{time} min drive time",L_CmtTooltipDescription:"click to change address or drag to new location",L_CmtTitleAddresses:"both {addr1} and {addr2}",L_CmtErrorMessage:"Can't retrieve boundary, please try again later",ShareClose:"Close",ShareUrlLabel:"Copy URL",L_CategoryUserTip_Header:"Show on map",L_CategoryUserTip_Message1:"We've turned on the map layers you selected",L_CategoryUserTip_Message2:"Pan and Zoom to see more results",L_ZoomInUserTip_Message:"Zoom in or use filters to narrow your search",L_Tooltip_Itinerary_Saved_Text:"Itinerary saved to My Places",L_Tooltip_Rename_Button:"Rename",L_Tooltip_Update_Button:"Update",SearchGhostText:"Search Bing Maps",ViewAllSearches:" View all your searches",L_MoreSearchTip:"Search for more businesses",L_RemoveFromMap:"Remove from map",L_EditYourSearch:"Edit your search",BingMapsLogo:"Bing Maps logo",AddAnotherSearchGhostText:"Add another search",PrintMiniMapAltText:"Mini map",ShareActionsTitle:"Choose where to share",OrSeparatorText:"Or",OverflowActivateSearchText:"Select a search to activate",OverflowClearAllText:"Clear All",ClearSearch:"Clear search",ClearText:"Clear text",CloseMapView:"Close the map view",LocalGuide_Title:"Local Guide",L_TaskBar_Label_LocalGuide:"Local",L_TaskBar_Label_MyContributions:"My Contributions",TaskBar_Banner_New:"*",FlyoverFeedbackTitle:"What did you think of City Flyover?",Landmarks3DFeedbackTitle:"What did you think of 3D landmark experience?",Landmark3D_Flyout_Text_Format:"View {name} in 3D",UnableToLoadMediaPlayer:"There was a problem loading the player. Please try again in a few minutes.",L_Flywheel_Button_Text:"Edit Maps",L_3DLandmark_Copy_Link_Success:"Successfully copied.",L_3DLandmark_Feedback_Button_Tooltip:"Feedback",L_3DLandmark_Share_Button_Tooltip:"Share",L_3DLandmark_Feedback_Button_Aria_Label:"Give feedback for 3D landmarks",L_3DLandmark_Share_Button_Aria_Label:"Share 3D landmark",L_3DLandmark_Share_Panel_Close:"Close",L_Flywheel_Banner_Intro_Text:"Want to improve the map? Suggest edits using Map builder",L_Flywheel_Banner_NotInterested_Text:"I'm not interested",L_Flywheel_Banner_RemindMe_Text:"Remind me later",L_Flywheel_Banner_TryItOut_Text:"Try it out",CommuteRewards_FlyoutDescription:"All you need to do is save your home and work addresses for better traffic updates.",CommuteRewards_FlyoutTitle:"Earn <strong>{0}<\/strong> points towards <strong>gift cards!<\/strong>",CommuteRewards_EarnButton:"Earn points",CommuteRewards_DismissButton:"Not now"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("InternalControls",n):window.$MicrosoftMaps8.ResourcesObject=n})();var i=window.$MicrosoftMaps8,u=i.Internal,sr=u.TaskData,kf=i.Anchor,si=i.GlobalConfig.features.autosuggest,hr=i.CommonControls.AutosuggestViewModel,cr=i.CommonControls.AutosuggestV2,lr=u._BaseMapTemplateSelector,df=u.BaseTask,at=u.BaseTaskViewModel,gf=i.BitmapImageTemplate,hi=sr.CollectionActions,nt=i.GlobalConfig.features.collections,ut=u.Control,it=u.ControlTemplate,h=i.DataHandlerKeys,ci=u._Debug,ar=i.DefaultTemplateSelector,ne=i.GlobalConfig.features.directions,te=i.CommonControls.DropdownItem,v=u._EntryPoints,vr=u._ExternalPromise,l=u._FeatureNames,ie=i.GlobalConfig.features.feedback,re=i.FiltersBarModuleViewModel,ue=i.FiltersBar,fe=i.FiltersBarItem,ee=i.FiltersBarItemData,oe=u.GeolocationProvider,n=u._Gimme,r=i.GlobalConfig,c=i.GlobalDataEventHandler,e=u._Helper,se=i.CommonControls.IDropDownListData,li=i.ImageFromCssHelper,kt=i.ImageryMapLayer,ai=i.Infobox,o=u._JSEvent,yr=u._LatLonEncoder,vi=i.Layer,yi=i.LocationRect,he=i.LocalSearchTask,ce=u._LocalStorageCache,ht=u._LruCache,dt=u._MapAuthentication,le=u.MapInteractionBehavior,k=u.MapHelper,rt=i.Location,ae=i.MapsFeedback,p=i.MapTypeId,pr=i.MapView,ct=i.CommonControls.ModalDialogViewModel,ve=i.MoveableSimplePointPrimitive,ot=u._Network,ye=i.GlobalConfig.features.notification,gt=u._ObservableObject,ni=u._ObservableCollection,pe=u._OverlayEntity,pi=u._Overlay,wr=u._PerfV2Logger,tt=i.Point,br=i.CommonControls.PopOutButtonViewModel,we=r.features.parking,g=u.Permalink,be=i.PrimitiveOverlayHelper,ft=i.GlobalConfig.features.print,kr=u.PrintContent,dr=i.Pushpin,t=i.ResourceManager.InternalControls,ti=u.ReverseGeocoder,gr=i.CommonControls.SearchBoxAutosuggestDataModel,ke=u.SDKPrimitiveTemplateSelector,de=i.SimplePointPrimitive,wi=i.SignInState,bi=i.Size,d=i.GlobalConfig.features.sharing,et=u.SharingInstrumentationAction,nu=u.TaskData.TimeTypes,ki=i.LabelVisibility,ge=u._StreetsidePerfConstants,no=i.GlobalConfig.features.streetside,s=i.GlobalConfig.features.taskBar,to=u._TaskDataHandlerHelper,tu=i.CommonControls.TaskBarDropdownViewModel,di=i.GlobalConfig.features.taskFramework,f=i.TaskTypes,io=r.features.traffic,ro=u._Url,uo=i.MouseEventArgs,vt=i.VectorMapLayer,fo=i.VenueMaps,gi=u.TaskData.Waypoint,yt=i.ZoomLevel,iu='<div>    <div class="sliBack" event:click="clickBackgroundHandler"><\/div>    <div class="sliMenu">        <ItemsControl ItemsSource="{Binding menuItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul class="sliMenuList"><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding type}" >                        <a href="#" id="{Binding htmlId}" class="{Binding cssClass}" event:click="clickHandler">                            <TextBlock text="{Binding name}" />                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <\/div>  <\/div>',ru='<div class="bm_BirdsEyeV2Dialog">    <div class="bm_BEMessageTitleContainer" data-tag="BEMessageTitleContainer">        <div class="BEV2TitleText" title="{TemplateBinding resources.BEV2WelcomeText}">            <TextBlock Text="{TemplateBinding resources.BEV2WelcomeText}" />        <\/div>    <\/div>    <div class="bm_BEMessageContainer" data-tag="BEMessageContainer">        <div class="bm_BEV2Introduction" title="{TemplateBinding resources.BEV2Introduction}">            <TextBlock Text="{TemplateBinding resources.BEV2Introduction}" />        <\/div>    <\/div>    <div class="bm_BEImageIntroContainer" data-tag="BEImageIntroContainer">        <div class="bm_ImageIntroText" title="{TemplateBinding resources.BEV2ImageIntroduction}">            <TextBlock Text="{TemplateBinding resources.BEV2ImageIntroduction}" />        <\/div>    <\/div>    <div class="bm_BEImagesContainer" data-tag="BEImagesContainer">        <div class="bm_DetailsImageContainer" data-tag="DetailsImageContainer">            <div class="bm_DetailsInstructionText" title="{TemplateBinding resources.BEV2DetailsInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2DetailsInstruction}" />            <\/div>            <img src="" class="bm_DetailsBEV2Image" data-tag="DetailsBEV2Image"/>        <\/div>        <div class="bm_TransientImageContainer" data-tag="TransientImageContainer">            <div class="bm_TransientInstructonText" title="{TemplateBinding resources.BEV2TransientLensInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2TransientLensInstruction}" />            <\/div>            <img src="" class="bm_TransientBEV2Image" data-tag="TransientBEV2Image" />        <\/div>    <\/div>    <div class="bm_BEv2TipNoteContainer" data-tag="BEv2TipNoteContainer">        <div class="bm_BEv2NoteText" title="TemplateBinding resources.BEV2TipNote">            <TextBlock Text="{TemplateBinding resources.BEV2TipNote}"/>        <\/div>    <\/div><\/div>',ii='<div id="cmt_container" class="cmt_container collapsed" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>        <button id="cmt_edit" class="cmt_button" event:click="onEditClicked" event:touchstart="onEditClicked">{editText}<\/button>        <button id="cmt_done" class="cmt_button hidden" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_body" class="cmt_body hidden">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />                <div id="cmt_delete_1" class="cmt_delete hidden" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>            <div class="cmt_addressDiv hidden" id="cmt_addressDivTwo">                <input type="text" class="cmt_address" id="cmt_addressTwo" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressTwoValue Mode=TwoWay}" />                <div id="cmt_delete_2" class="cmt_delete" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>        <div id="cmt_BtmArea" class="cmt_BtmArea" event:click="onAddLocClicked" event:touchstart="onAddLocClicked">            <div id="cmt_addIcon" class="cmt_addIcon"><\/div>            <div id="cmt_addAdr" class="cmt_addAddr">{commuteAddLoc}<\/div>        <\/div>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',ri='<div id="cmt_container" class="cmt_container cmt_v2" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>    <\/div>    <div id="cmt_body" class="cmt_body">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>    <\/div>    <div id="cmt_btm" class="cmt_btm">        <span id="cmt_err" class="cmt_err hidden">{errorMessage}<\/span>        <button id="cmt_done" class="cmt_button disabled" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',nr='<div id="cmt_infobox">    <b id="cmt_infoboxTitle">{title}<\/b>    <div id="cmt_infoboxDescription">{description}<\/div><\/div>',uu='<div class="bm_flyoverButton">    <div class="bm_videoLinks"         style:display="{TemplateBinding VideoListVisibility Converter=boolToDisplay}"         style:top="{TemplateBinding ListOffset}"         event:mouseover="onFlyoverButtonHover"         event:mouseout="onFlyoverButtonHover"         event:click="onFlyoverListItemClick">        <ItemsControl ItemsSource="{TemplateBinding VideoItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <div data-url="{Binding url}"><TextBlock Text="{Binding name}" /><\/div>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="bm_flyoverBtnContent"         event:click="onFlyoverButtonClick"         event:mouseover="onFlyoverButtonHover"         event:mouseout="onFlyoverButtonHover"         event:mousemove="onMouseMove">        <span class="bm_flyoverBadge" style:display="{TemplateBinding BadgeVisibility Converter=boolToDisplay}">            <TextBlock Text="{TemplateBinding NumVideoItems}" />        <\/span>    <\/div><\/div>',fu='<div class="bm_flyoverVideo">    <p class="bm_flyover_message" style:display="{TemplateBinding ShowError Converter=boolToDisplay}">        <TextBlock Text="{TemplateBinding resources.UnableToLoadMediaPlayer}" />    <\/p>    <button class="bm_flyoverFeedback" event:click="onFlyoverFeedbackClick" style:display="{TemplateBinding feedbackDisplay Converter=boolToDisplay}"><\/button>    <video id="{TemplateBinding VideoID}" width="100%" height="100%" class="azuremediaplayer amp-default-skin"><\/video><\/div>',eu='<div class="bm_flywheelBanner" data-tag="Flywheel.Banner">    <div class="bm_flywheelBannerContentContainer">        <div class="bm_flywheelBannerLeft"><\/div>        <div class="bm_flywheelBannerCenter">            <div class="bm_flywheelBannerIcon"><\/div>            <div class="bm_flywheelBannerIntroText" id="bm_flywheelBannerIntroText" tabindex="0">                <TextBlock Text="{TemplateBinding resources.L_Flywheel_Banner_Intro_Text}" />            <\/div>            <button class="bm_flywheelBannerTryItOutButton" event:click="onTryItOutClick">                <div class="bm_flywheelBannerTryItOutText">                    <TextBlock Text="{TemplateBinding resources.L_Flywheel_Banner_TryItOut_Text}" />                <\/div>            <\/button>        <\/div>        <div class="bm_flywheelBannerRight">            <button class="bm_flywheelBannerDismissText" event:click="onRemindMeClick">                <TextBlock Text="{TemplateBinding resources.L_Flywheel_Banner_RemindMe_Text}" />            <\/button>            <button class="bm_flywheelBannerDismissText" id="bm_flywheelBannerNotInterested" event:click="onNotInterestedClick">                <TextBlock Text="{TemplateBinding resources.L_Flywheel_Banner_NotInterested_Text}" />            <\/button>            <button class="bannerClose" event:click="onNotInterestedClick" aria-label="{TemplateBinding resources.L_Flywheel_Banner_NotInterested_Text}">                <div class="icon"><\/div>            <\/button>        <\/div>    <\/div><\/div>',ou='<div class="bm_flexWrapper">    <div class="bm_flywheelButton" data-tag="Flywheel.Button" style:display="{TemplateBinding IsDisplayed Converter=boolToDisplay}">        <a class="bm_flywheelButtonLink" event:click="onEditMapsClick" href="#" role="button">            <div class="bm_flywheelButtonContentContainer">                <div id="bm_flywheelButtonIcon"><\/div>                <div id="bm_flywheelButtonText">                    <TextBlock Text="{TemplateBinding resources.L_Flywheel_Button_Text}" />                <\/div>            <\/div>        <\/a>    <\/div><\/div>',su='<div class="bm_3dLandmarksViewer">    <div class="bm_3dlmkShare">        <button class="bm_3dlmkShareBtn"                event:click="onLandmarksShareClick"                title="{TemplateBinding resources.L_3DLandmark_Share_Button_Tooltip}"                style:display="{TemplateBinding enableShare Converter=boolToDisplay}"                tabindex="0"                aria-label="{TemplateBinding resources.L_3DLandmark_Share_Button_Aria_Label}"><\/button>        <div class="bm_3dlmkSharePnl" style:display="{TemplateBinding lmk3DShareVisibility Converter=boolToDisplay}" event:keydown="onEscapePressed">            <div class="bm_sharePnlInput" style:display="{TemplateBinding lmk3DShareInputVisibility Converter=boolToDisplay}">                <input class="bm_3dlmkShareUrl" type="text" value="{TemplateBinding landmarksViewerPermalink}" />                <div class="bm_pnlBtns">                    <button class="bm_3dlmkShareUrlBtn" event:click="onShareCopyClick">                        <TextBlock Text="{TemplateBinding resources.L_PermalinkCopy_Text}" />                    <\/button>                    <button class="bm_3dlmkShareUrlBtn" event:click="onShareCloseClick">                        <TextBlock Text="{TemplateBinding resources.L_3DLandmark_Share_Panel_Close}" />                    <\/button>                <\/div>                            <\/div>            <div class="bm_sharePnlMsg" style:display="{TemplateBinding lmk3DShareMsgVisibility Converter=boolToDisplay}">                <span>                    <TextBlock Text="{TemplateBinding resources.L_3DLandmark_Copy_Link_Success}" />                <\/span>                <button class="bm_3dlmkShareUrlBtn" event:click="onShareCloseClick">                    <TextBlock Text="{TemplateBinding resources.L_3DLandmark_Share_Panel_Close}" />                <\/button>            <\/div>        <\/div>    <\/div>    <button class="bm_3dlmkFeedback"            title="{TemplateBinding resources.L_3DLandmark_Feedback_Button_Tooltip}"            event:click="onLandmarksFeedbackClick"            style:display="{TemplateBinding feedbackDisplay Converter=boolToDisplay}"            tabindex="0"            aria-label="{TemplateBinding resources.L_3DLandmark_Feedback_Button_Aria_Label}"><\/button>    <iframe src="{TemplateBinding landmarksViewerUrl}" scrolling="no" frameborder="no" align="center" allowfullscreen="true"  tabindex="-1"><\/iframe><\/div>',hu='<div class="taskBar" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="logo" data-tag="TaskBar.Logo"><\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" data-tag="TaskBar.SearchBox"><\/input>                    <a href="#" class="clrSb" title="{Binding resources.L_TaskBar_Label_Clear}" role="button" data-tag="TaskBar.SearchBoxCancel"><\/a>                <\/div>            <\/div>            <div class="searchButton">                <a href="#" class="searchIcon" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="#" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>        <div class="clear"><\/div><\/div>',cu='<div class="bm_l2OverlayCloseBtn">    <a href="#" class="l2OverlayClose" role="button" aria-label="{Binding ariaLabel}">        <div class="icon svg"><\/div>    <\/a><\/div>',lu='<div class="printDialog" data-tag="printDialog" role="dialog">    <p class="printDlgHdr">        <div class="printPreviewTitle">            <TextBlock Text="{TemplateBinding resources.L_PrintPreview}" />        <\/div>        <div class="mapAndTextPrint">            <ul>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapAndText}" class="printMapAndText mapTextOptions selected" data-tag="printMapAndText" event:click="onMapTextClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapAndText}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapOnly}" class="printMapOnly mapTextOptions" data-tag="printMapOnly" event:click="onMapOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapOnly}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintTextOnly}" class="printTextOnly mapTextOptions" data-tag="printTextOnly" event:click="onTextOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintTextOnly}" />                    <\/a>                <\/li>            <\/ul>        <\/div>    <\/p>    <div>        <div class="printContent" data-tag="printContent" event:mousewheel="onMouseWheel">            <div class="printHeader" style:display="block">                <img class="bingMapsLogo" alt="{TemplateBinding resources.BingMapsLogo}" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATCAMAAADS32EkAAAAP1BMVEX///9RUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFAbX/lHAAAAFHRSTlMAECAwQFBgcHSAkKCwuMDQ4Obw8rSbhEIAAAGTSURBVHhe1ZLdjtwwCEY/DHbqn2KX8v7P2mGSrLKNVrPSqBc9F8jGcGQh4KMk/AP8gfznXi8IkIa85+WEK14RgH17z1t8bnz3vj+H5e6ryYc31QKAhMD8OFNkuVZhRiCQeOd9lVKORmKkshtypsO7+ROrCHzGeYO4QJc9yEB9FuhRsJrxXOoSD9oXQbTbsElINoYfXrJdfLR5JZ6enl6vRDbBrkL1LOhAsQ7UAcSnW4H4IJB21HrZB6rr4l0Aim9PrwHojuoJwDq8DKQIst+ROyTuKIbaL17kq7ch+urTG6nqGB4CPbxnIAW4T58KmYiEI+mU0yv6aQ59X7Krt33670dQJN8SysULbFbDW06rr4zADUBzvnqLF4D97o0RY+g5hyhAcrj/6H5Q6dy91ZYPXL00fXS/eyGLUCy8mlAsIxNo4fdP34n0gW7DrRFYGa0dv+BuVvXuRbc1s0K0u3kFmunM+HUZwWvWwB1KEUWRhBBwJPs5ghdkjtqCrxD9u8FiBC/xoOP7XqSM7yDbxvgabrjwB0awHHyuA7RgAAAAAElFTkSuQmCC" />            <\/div>            <div class="baseMapPrint" data-tag="baseMapPrint">                <div>                        <ul>                            <li data-tag="baseMapNotes" class="baseMapNotes">                                <div id="printNotesLabel">                                    <TextBlock Text="{TemplateBinding resources.L_PrintNotes}" />                                <\/div>                                <div class="baseMapTextArea screenNotes">                                    <textarea rows="9" cols="45" id="baseMapNotes" role="textbox" aria-label="{TemplateBinding resources.L_PrintNotesWatermark}" class="baseMapNotes" style:color="black" placeholder="{TemplateBinding resources.L_PrintNotesWatermark}" maxlength="{TemplateBinding notesMaxCharSize}"> <\/textarea>                                <\/div>                                <div class="printedNotes">                                <\/div>                            <\/li>                            <li data-tag="baseMapMiniMap" class="baseMapOverviewMap">                                <img src="{TemplateBinding overviewContextMap}" alt="{TemplateBinding resources.PrintMiniMapAltText}"/>                            <\/li>                        <\/ul>                        <div>                                <div class="printArea" data-tag="printArea">                                    <div class="printMap" data-tag="printMap">                                    <\/div>                                <\/div>                        <\/div>                <\/div>            <\/div>            <div class="taskPrintContent" data-tag="taskPrintContent">            <\/div>        <\/div>            <div class="printFooter" style:display="block">            <p class="printDlgFoot printButton">                <a class="textButton" aria-label="{TemplateBinding resources.L_Print_Submit}" event:click="onPrintClick" href="#" role="button" data-tag="printButton">                    <TextBlock Text="{TemplateBinding resources.L_Print_Submit}" />                <\/a>            <\/p>        <\/div>    <\/div><\/div>',au='<div class="bm_sharePanel" data-tag="Share.SharePanel">    <div class="shareHeader" data-tag="Share.Header">        <div class="shareTextTitle">            <TextBlock text="{Binding titleText}" />        <\/div>        <a href="#" class="panelClose" title="{StaticBinding resources.ShareClose}" role="button" data-tag="Share.CloseButton" data-share=\'{ "action": "closeShare" }\'><div class="icon svg"><\/div><\/a>    <\/div>    <div class="content">        <div class="body">            <div class="textAndEmbed" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <div class="text">                    <TextBlock text="{StaticBinding resources.L_PermalinkPrompt_Text}" />                <\/div>            <\/div>            <div class="taskList" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <ul class="taskListContainer" role="list">                <\/ul>            <\/div>            <div class="actions">                <div class="actionTitle">                    <span>                        <TextBlock text="{StaticBinding resources.ShareActionsTitle}" />                    <\/span>                <\/div>                <div class="actionsContainer">                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="facebookIcon" data-tag="Share.Facebook" event:click="openFacebook" role="button" title="{StaticBinding resources.ShareFBToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkFacebook_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="twitterIcon" data-tag="Share.Twitter" event:click="openTwitter" role="button" title="{StaticBinding resources.ShareTwitterToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkTwitter_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="emailIcon" data-tag="Share.Email" event:click="openEmail" role="button" title="{StaticBinding resources.ShareEmailToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_Permalink_Email_Button_Text}" />                            <\/div>                        <\/a>                    <\/div>                <\/div>            <\/div>            <div class="orSeparator">                <hr class="separator" />                <div class="orText">                    <TextBlock text="{StaticBinding resources.OrSeparatorText}" />                <\/div>                <hr class="separator" />            <\/div>            <div class="copyAndLinkText">                <div class="inputContainer">                    <input class="text urlBox" data-tag="Share.UrlBox" type="text" role="textbox" readonly="readonly" aria-readonly="true" value="{Binding permalinkString}" event:click="urlBoxClick" aria-label="{StaticBinding resources.ShareUrlLabel}" />                    <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" role="button" id="copyButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" data-tag="Share.Copy" event:click="copyToClipboard" >                        <TextBlock text="{StaticBinding resources.L_PermalinkCopy_Text}" />                    <\/a>                <\/div>            <\/div>            <div class="linkBox">                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="linkStyleButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.ToggleLinkLength" event:click="toggleLinkLength" role="button">                    <TextBlock text="{Binding isShortPermalinkDisplayed Converter=displayStateToLinkText}" />                <\/a>            <\/div>            <div class="errorMessage" data-tag="Share.ErrorMessage" style:visibility="{Binding errorMessage Converter=errorMessageToVisibility}">                <TextBlock text="{Binding errorMessage}" />            <\/div>        <\/div>    <\/div><\/div>',vu='<div class="sharePrompt">    <TextBlock text="{TemplateBinding resources.L_Permalink_Prompt}" /><\/div><input class="shareUrlBox" data-tag="Share.UrlBox" type="text" value="{TemplateBinding permalinkString}" readonly="readonly" /><a href="#" class="shareUrlShortenLink" data-tag="Share.ShortenButton" event:click="shortenClick"><TextBlock text="{TemplateBinding shortenButtonText}" /><\/a><a href="#" class="submitBtn padded" data-tag="Share.EmailButton" event:click="emailClick" role="button">    <TextBlock text="{TemplateBinding resources.L_Permalink_Email_Button_Text}" /><\/a>',yu='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <div id="as_screenreader" aria-live="assertive"><\/div>    <ul>        <li class="sbElement">            <a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">                <h1 class="b_logo b_taskLogo"><\/h1>            <\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <a class="bm_overflowCountContainer" href="#" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" role="button" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut" event:touchend="overflowClick" event:keydown="overflowKeyDown" data-tag="TaskBar.overflowContainer" aria-label="{StaticBinding resources.ViewAllSearches}" aria-expanded="{Binding overflowExpanded}">                        <div class="bm_overflowCounter">                            <div class="bm_overflowBox">                                <div class="bm_overflowLink" aria-label="{StaticBinding resources.ViewAllSearches}" data-tag="TaskBar.overflowButton">                                    <TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />                                    <div class="bm_overflowDropDown">                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                    <\/a>                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-autocomplete="both" aria-controls="sb_as_container" aria-owns="sb_as_container" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox" placeholder="{Binding searchboxPlaceHolderText}"><\/input>                    <div class="inPrivateIcon" style:display="{Binding displayInPrivate}"><\/div>                    <div class="searchButton">                        <a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.SearchGhostText}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />                    <\/div>                <\/div>                <div class="bm_outsideBeak"><\/div>                <div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler" data-tag="TaskBar.overflowPopout">                    <div class="bm_popoutTop1">                        <div class="bm_clearallSection">                            <span class="bm_selectToActivateSection">                                <TextBlock Text="{Binding resources.OverflowActivateSearchText}" />                            <\/span>                            <a class="bm_clearAllLink" role="button" href="#" event:click="clearAllClickHandler" event:touchend="clearAllClickHandler" event:keydown="clearAllKeyDownHandler">                                <TextBlock Text="{Binding resources.OverflowClearAllText}" />                            <\/a>                        <\/div>                        <div class="bm_popOutInner1">                            <ItemsControl ItemsSource="{Binding OverflowCapsuleList}">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <div class="bm_overflowItem" id="{Binding id}">                                            <a class="bm_overflowCardText" role="button" href="#" event:mouseover="overflowTitleMouseoverHandler" event:mouseout="overflowTitleMouseoutHandler" event:click="overflowTitleClickHandler" event:touchend="overflowTitleTouchHandler" event:keydown="overflowTitleKeyDownHandler" aria-label="{Binding title}" data-tag="TaskBar.overflowPopLink">                                                <div class="{Binding imageClass}" style:background-color="{Binding backgroundColor}" />                                                <span id="bm_overflowText">                                                    <TextBlock Text="{Binding title}" />                                                <\/span>                                            <\/a>                                            <a class="bm_overflowCardClose" role="button" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" event:keydown="cardCloseKeyDownHandler" title="{Binding closeTitle}" />                                        <\/div>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                    <\/div>                <\/div>                <div class="sb_as_container" id="sb_as_container" aria-expanded="{Binding showSuggestionPanel}" role="combobox" aria-hidden="{Binding asExpanded Converter=invertBoolean}" style:display="{Binding asExpanded Converter=boolToDisplay}">                    <div class="as_container" id="as_containerSearch_maps_sb" style:visibility="hidden" data-tag="as_container">                    <\/div>                <\/div>            <\/div>        <\/li>    <\/ul>    <div id="PreviousSearchTip">        <TextBlock Text="{Binding resources.ViewAllSearches}" />    <\/div>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding altName}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}" aria-haspopup="{Binding ariaHasPopout}" aria-controls="{Binding ariaControls}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                        <span style:display="{Binding isNew Converter=boolToDisplay}" class="bm_newBanner">                            <TextBlock Text="{Binding banner}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <!-- The following is the close button for local overlay on serp -->    <div class="overlayCloseBtn">        <a role="button" class="overlayCloseLink" href="#" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked" event:keydown="onOverlayCloseKeydown">            <div class="icon svg"><\/div>        <\/a>    <\/div>    <div id="rewardsFlyout" class="rewardsFlyout" event:click="onCommuteRewardsEarnClick" style:visibility="{Binding showCommuteFlyout Converter=boolToVisibility}">        <div class="{Binding upsellImageClass}">            <div class="pointValue">                <TextBlock Text="{StaticBinding commutePointValue}" />            <\/div>        <\/div>        <div class="text">            <h6 class="title">                <FormattedTextBlock Formattedtext="{Binding commuteRewardsFlyoutTitle}" />            <\/h6>            <p class="description">                <TextBlock Text="{StaticBinding resources.CommuteRewards_FlyoutDescription}" />            <\/p>        <\/div>        <div class="flyoutActions">            <button class="earn" event:click="onCommuteRewardsEarnClick" aria-label="{StaticBinding resources.CommuteRewards_EarnButton}" title="{StaticBinding resources.CommuteRewards_EarnButton}" data-action="earn">                <TextBlock Text="{StaticBinding resources.CommuteRewards_EarnButton}" />            <\/button>            <button class="dismiss" event:click="onCommuteRewardsDismissClick" aria-label="{StaticBinding resources.CommuteRewards_DismissButton}" title="{StaticBinding resources.CommuteRewards_DismissButton}">                <TextBlock Text="{StaticBinding resources.CommuteRewards_DismissButton}" />            <\/button>        <\/div>    <\/div><\/div>',pu='<div class="bm_tooltips saveOnSerpConfirmation" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <div class="toolTipTitle">            <div class="tooltipsIcon">            <\/div>            <div class="tooltipsIconText">                <TextBlock Text="{TemplateBinding IconText}" />            <\/div>        <\/div>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding PreLink}" />            <a href="#" event:click="onLinkClicked" class="tooltipsLink">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',wu='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">        <\/a>        <div class="tooltipsMessage">            <TextBlock Text="{TemplateBinding resources.L_Tooltip_Itinerary_Saved_Text}" />        <\/div>        <div class="tooltipsMessage secondLine" style:display="{TemplateBinding showEditName Converter=boolToNotDisplay}">            <TextBlock Text="{TemplateBinding Name}" />            <TextBlock Text="{TemplateBinding separator}" />            <a class="bm_renameLink" href="#" event:click="renameClicked"><TextBlock Text="{TemplateBinding resources.L_Tooltip_Rename_Button}" /><\/a>        <\/div>        <div class="nameInputContainer" style:display="{TemplateBinding showEditName Converter=boolToDisplay}">            <input type="text" class="nameEditBox" maxlength="100" value="{StaticBinding Name Mode=TwoWay}" event:keydown="onKeyPressed" />            <a href="#" class="bm_tooltipSaveButton" event:click="onSaveLinkClick" event:touchend="onSaveLinkClick">                <TextBlock Text="{TemplateBinding resources.L_Tooltip_Update_Button}" />            <\/a>        <\/div>    <\/div><\/div>',bu='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">    <\/a>    <div class="tooltipsText">        <div class="tooltipsHeader" style:display="{TemplateBinding Title Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding Title}" />        <\/div>        <ItemsControl ItemsSource="{TemplateBinding MessageLines}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="tooltipsMessage">                        <TextBlock Text="{Binding $self$}" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <span>                <TextBlock Text="{TemplateBinding PreLink}" />            <\/span>            <a href="{TemplateBinding linkUrl}" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <span>                <TextBlock Text="{TemplateBinding PostLink}" />            <\/span>        <\/div>        <div style:display="{TemplateBinding SignInTitle Converter=nullToDisplayNone}">            <SignInPopUpControl SignInMessage="{TemplateBinding SignInTitle}" event:signedIn="onSignedIn" />        <\/div>    <\/div><\/div>',y=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),tr=function(n){function i(){var i=this,r=t;return i=n.call(this,ru,"bm_BirdsEyeV2DialogContainer",{onCloseClick:function(n){return i._onCloseClick(n)}},{},r)||this}return y(i,n),i.prototype.showBEDialog=function(){this.OpenDialog()},i.prototype._onCloseClick=function(n){n&&n.preventDefault();this.CloseDialog();this.dispose()},i}(ct),ku=function(u){function f(n,e,o){var s=u.call(this,o)||this;return ii=ii.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteAddLoc}",t.L_CmtControlAddLocationText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{editText}",t.L_CmtEditText).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText),s.setTemplate(new it(ii,{stopEvent:function(n){return s._stopEvent(n)},onAddLocClicked:function(){return s._onAddLocClicked()},onDeleteClicked:function(n){return s._onDeleteClicked(n)},onTimeClicked:function(n){return s._onTimeClicked(n)},onPeakClicked:function(n){return s._onPeakClicked(n)},onEditClicked:function(){return s._onEditClicked()},onDoneClicked:function(){return s._onDoneClicked()}})),s._map=n,s._cmtFeatureConfig=r.features.commutability,s.defineProperty("addressValue"),s.defineProperty("addressTwoValue"),s._secondAddrEnabled=!1,s._time=f._defaultSelectedTime,s._departureTime=s._cmtFeatureConfig.peakTime,s._location=s._map.getBounds(!0).center,s._pushpinLayer=new vi("Commutability_Layer"),s._pushpin=new i.Pushpin(s._location,{icon:f._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle}),s._pushpinLayer.add(s._pushpin),i.Events.addHandler(s._pushpin,"dragend",function(n){return s._pushpinDragEnd(s._pushpin,n)}),s._isochroneOptions={intersectionOptions:{fillColor:s._cmtFeatureConfig.intersectFillColor,strokeColor:s._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:s._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:s._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:s._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!s._cmtFeatureConfig.showIntersection,showUnion:!!s._cmtFeatureConfig.showUnion,showIsochrones:!!s._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof s._cmtFeatureConfig.applyCardinalSpline=="boolean"?s._cmtFeatureConfig.applyCardinalSpline:!1},s._isochroneLayer=e,s._isochroneLayer.attachMap(s._map),s._isochroneLayer.setOptions(s._isochroneOptions),s._updateCompleteHandler=function(){return s._updateIsochroneCompleted()},s._isochroneLayer.downloadCompleted.add(s._updateCompleteHandler),s._isochroneLayers=[],i.loadModule("Microsoft.Maps.AutoSuggest",function(){var r=s._cmtFeatureConfig.autoSuggestMaxResult||5,n={maxResults:r,map:s._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},t=i.AutosuggestManager;s._asManagerOne=new t(n);s._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){s._processAutoSuggestResult(n.location,n.formattedSuggestion,!0);w.logAddressChange(v.Autosuggest,!1)});s._asManagerTwo=new t(n);s._asManagerTwo.attachAutosuggest("#cmt_addressTwo","#cmt_addressDivTwo",function(n){s._processAutoSuggestResult(n.location,n.formattedSuggestion,!1);w.logAddressChange(v.Autosuggest,!0)});s.disposables.push(s._asManagerOne,s._asManagerTwo)}),s}return y(f,u),f.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);w.logColtrolActivation()},f.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);w.logColtrolDeactivation()},f.prototype.dispose=function(){var n,t,i;for(this.detachIsochrone(),n=0,t=this._isochroneLayers;n<t.length;n++)i=t[n],i.dispose();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer.dispose();u.prototype.dispose.call(this);e._clearDisposables(this.disposables);e._nullifyClass(this)},f.prototype.postInit=function(){var u=this,e,r,t;if((this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._addAddressButton=n("#cmt_BtmArea"),this._addressesSection=n("#cmt_addresses"),this._address=n("#cmt_addressOne"),this._addressOneClose=n("#cmt_delete_1"),this._addressTwo=n("#cmt_addressTwo"),this._addressTwoContainer=n("#cmt_addressDivTwo"),this._editButton=n("#cmt_edit"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1),this._cmtFeatureConfig.prefetch))for(e=i.IsochroneLayer,r=0;r<f._times.length;r++){if(f._times[r]===this._time){this._isochroneLayers.push(this._isochroneLayer);this._isochroneLayer.downloadError.add(function(n){return u._handleIsochroneError(n)});continue}t=new e;t.setOptions(this._isochroneOptions);t.attachMap(this._map);t.downloadError.add(function(n){return u._handleIsochroneError(n)});this._isochroneLayers.push(t)}},f.prototype._stopEvent=function(n){n.stopPropagation()},f.prototype._onEditClicked=function(){var r=n("#cmt_body"),t,i;r.remove_class("hidden");this._cmtContainer.remove_class("collapsed");this._editButton.add_class("hidden");this._doneButton.remove_class("hidden");this._adjustAutosuggestWidth();t=this._map.getNavigationBar().getLocateMeControl();i=t&&t.getGeochainControl();i&&i.setIsCollapsed(!0);w.logButtonClick(this._editButton.get_attr("id"))},f.prototype._onDoneClicked=function(){var t=n("#cmt_body");t.add_class("hidden");this._cmtContainer.add_class("collapsed");this._doneButton.add_class("hidden");this._editButton.remove_class("hidden");w.logButtonClick(this._doneButton.get_attr("id"))},f.prototype._onAddLocClicked=function(){var n=this;this._downloadingIsochrone||this._addAddressButton.has_class("hidden")||(this._addAddressButton.add_class("hidden"),this._addressOneClose.remove_class("hidden"),this._addressTwoContainer.remove_class("hidden"),this._secondAddrEnabled=!0,this.setAddressTwoValue(""),this._addressTwo.set_attr("value",""),this._locationTwo=this._map.getBounds(!0).center,this._pushpinTwo=new dr(this._locationTwo,{icon:f._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTwoTitle}),this._pushpinLayer&&this._pushpinLayer.add(this._pushpinTwo),i.Events.addHandler(this._pushpinTwo,"dragend",function(t){return n._pushpinDragEnd(n._pushpinTwo,t)}),this._cmtContainer.add_class("expanded"),this._addressesSection.add_class("expanded"),this._adjustAutosuggestWidth(),w.logButtonClick(this._addAddressButton.get_attr("id")))},f.prototype._onDeleteClicked=function(n){if(!this._downloadingIsochrone){var t=n.target,i=t.id;i==="cmt_delete_1"&&(this._location=this._locationTwo,this._pushpin.setLocation(this._location),this.setAddressValue(this.getAddressTwoValue()),this._address.set_attr("value",this.getAddressValue()));this._addAddressButton.remove_class("hidden");this._addressOneClose.add_class("hidden");this._addressTwoContainer.add_class("hidden");this._cmtContainer.remove_class("expanded");this._addressesSection.remove_class("expanded");this._pushpinLayer.remove(this._pushpinTwo);this._secondAddrEnabled=!1;this._updateMapView();this._updateIsochrone();this._updateTitle();this._adjustAutosuggestWidth()}},f.prototype._onTimeClicked=function(t){var u=t.target,i=u.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=f._timeButtonIds.indexOf(i),this._changeSelectedTime(r),w.logButtonClick(i))},f.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),this._updateIsochrone(),this._updateTitle(),w.logButtonClick(i))},f.prototype._processAutoSuggestResult=function(n,t,i){var r=i?this._location:this._locationTwo;rt.areEqual(r,n,!0)||(i?(this._location=n,this.setAddressValue(t),this._pushpin.setLocation(n)):(this._locationTwo=n,this.setAddressTwoValue(t),this._pushpinTwo.setLocation(n)),this._updateMapView(),this._updateIsochrone(),this._updateTitle())},f.prototype._updateIsochrone=function(){var i,n,t,u,r,e;for(this._resetTimeButtons(),this.getAddressValue()||this._reverseGeocode(this._location,1),this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue()),this._secondAddrEnabled&&this._addressTwo.set_attr("value",this.getAddressTwoValue()),i=null,(!this._peakButton||this._peakButton.has_class("selected"))&&(i="timeWithTraffic"),n=0;n<f._times.length;n++)(t=f._times[n],this._cmtFeatureConfig.prefetch||t===this._time)&&(u=this._buildRequest(t,i,1),r=[u],this._secondAddrEnabled&&this.getAddressTwoValue()&&(e=this._buildRequest(t,i,2),r.push(e)),t===this._time?(this._setControlBusy(!0),this._isochroneLayer.setRequests(r)):this._isochroneLayers&&this._isochroneLayers.length>n&&this._isochroneLayers[n]&&this._isochroneLayers[n].setRequests(r))},f.prototype._buildRequest=function(n,t,i){var u=this._location,f=this._cmtFeatureConfig.isochroneOneFillColor,r;return i===2&&(u=this._locationTwo,f=this._cmtFeatureConfig.isochroneTwoFillColor),r={maxTime:n,startPoint:u,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:f,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}},r.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,r.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,r.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,r},f.prototype._updateMapView=function(){var i=[this._location];this._locationTwo&&!rt.areEqual(this._location,this._locationTwo)&&i.push(this._locationTwo);var n=this._map.getMode().getMapViewForLocationsInView(i),r=yt.fromLocation(n.cameraLocation,!1),u=this._map.getMercatorZoomLevel();if(r>u){var t=this._map.getViewportPadding(),f=this._map.getViewport(),e=new tt(t.left,t.top),o=new tt(f.pixelWidth-t.right,f.pixelHeight-t.bottom),s=new tt((e.x+o.x)/2,(e.y+o.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,u-r)}this._map.setView(n)},f.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}});this._asManagerTwo.setOptions({serpOptions:{width:n}})},f.prototype._pushpinDragEnd=function(n,t){n===this._pushpin?(this._location=t.location,this._reverseGeocode(t.location,1),w.logAddressChange(v.POI,!1)):n===this._pushpinTwo&&(this._locationTwo=t.location,this._reverseGeocode(t.location,2),w.logAddressChange(v.POI,!0));this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateTitle=function(){var u=this.getAddressValue(),i=u&&u.split(",")[0],n,r,f;this._secondAddrEnabled&&this.getAddressTwoValue()&&(n=this.getAddressTwoValue(),n&&(n=n.split(",")[0]),i!==n&&(i=t.L_CmtTitleAddresses.replace("{addr1}",i).replace("{addr2}",n)));r=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text;r=r.toLowerCase();f=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",i).replace("{trafficCondition}",r);this._title.set_text(f);var e=parseInt(this._title.get_style("height")),o=parseInt(this._title.get_style("lineHeight")),s=Math.round(e/o);s===1?this._title.set_style({padding:"9px 0px"}):this._title.set_style({padding:"0px"})},f.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},f.prototype._handleIsochroneError=function(t){var u=t.isochroneLayer,i,e,r;if(u&&(i=0,i=this._cmtFeatureConfig.prefetch?this._isochroneLayers.indexOf(u):f._times.indexOf(this._time),e=f._timeButtonIds[i],r=n("#"+e),(r&&r.has_class("selected")||!this._cmtFeatureConfig.prefetch)&&(this._setControlBusy(!1),this._changeSelectedTime(0)),!r.has_class("disabled")))while(i<f._timeButtonIds.length)this._enableTimeButton(i,!1),i++},f.prototype._changeSelectedTime=function(n){if(this._selectTimeButton(n),this._cmtFeatureConfig.prefetch){this._isochroneLayer.downloadCompleted.remove(this._updateCompleteHandler);var t=this._map.getLayers();t.remove(this._isochroneLayer);this._isochroneLayer=this._isochroneLayers[n];this._isochroneLayer.downloadCompleted.add(this._updateCompleteHandler);t.insert(this._isochroneLayer);this._isochroneLayer.downloading||this._isochroneLayer.getIsochrones().length!==0||this._updateIsochrone()}else this._updateIsochrone();this._isochroneLayer.downloading&&this._setControlBusy(!0);this._updateTitle()},f.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=f._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=f._times[t]}},f.prototype._resetTimeButtons=function(){for(var u,r,t=0,i=f._timeButtonIds;t<i.length;t++)u=i[t],r=n("#"+u),r&&r.remove_class("disabled")},f.prototype._enableTimeButton=function(t,i){var r=n("#"+f._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},f.prototype._reverseGeocode=function(n,t){var i=this,r=new ti;r.reverseGeocode(n,function(r){var u="";u=r&&r.success&&r.addressList&&r.addressList.length>0&&r.addressList[0].formattedAddress?r.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t===1?(i.setAddressValue(u),i._address.set_attr("value",u)):(i.setAddressTwoValue(u),i._addressTwo.set_attr("value",u));i._updateTitle()})},f._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],f._defaultSelectedTime=15,f._times=[15,30,45,60],f._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',f}(ut),du=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new tt(0,0);i=n.call(this,r,1,u)||this}return i}return y(t,n),t}(pi),gu=function(u){function f(n,e,s){var h=u.call(this,s)||this;return ri=ri.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{errorMessage}",t.L_CmtErrorMessage),h.setTemplate(new it(ri,{stopEvent:function(n){return h._stopEvent(n)},onTimeClicked:function(n){return h._onTimeClicked(n)},onPeakClicked:function(n){return h._onPeakClicked(n)},onDoneClicked:function(){return h._onDoneClicked()}})),h._map=n,h._cmtFeatureConfig=r.features.commutability,h.defineProperty("addressValue"),h._time=f._defaultSelectedTime,h._departureTime=h._cmtFeatureConfig.peakTime,h._location=h._map.getBounds(!0).center,h._pushpinLayer=new vi("Commutability_Layer"),h._isochroneOptions={intersectionOptions:{fillColor:h._cmtFeatureConfig.intersectFillColor,strokeColor:h._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:h._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:h._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:h._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!h._cmtFeatureConfig.showIntersection,showUnion:!!h._cmtFeatureConfig.showUnion,showIsochrones:!!h._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof h._cmtFeatureConfig.applyCardinalSpline=="boolean"?h._cmtFeatureConfig.applyCardinalSpline:!1},h._isochroneLayer=e,h._isochroneLayer.attachMap(h._map),h._isochroneLayer.setOptions(h._isochroneOptions),h._updateCompleteHandler=function(){return h._updateIsochroneCompleted()},h._isochroneLayer.downloadCompleted.add(h._updateCompleteHandler),h._isochroneLayer.downloadError.add(function(n){return h._handleIsochroneError(n)}),h.disposables.push(h.doneClickedEvent=new o),h.disposables.push(h.pushpinClickedEvent=new o),i.loadModule("Microsoft.Maps.AutoSuggest",function(){var n=h._cmtFeatureConfig.autoSuggestMaxResult||5,t={maxResults:n,map:h._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},r=i.AutosuggestManager;h._asManagerOne=new r(t);h._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){h._processAutoSuggestResult(n.location,n.formattedSuggestion);w.logAddressChange(v.Autosuggest,!1)});h._adjustAutosuggestWidth();h.disposables.push(h._asManagerOne)}),h}return y(f,u),f.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);w.logColtrolActivation()},f.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);w.logColtrolDeactivation()},f.prototype.dispose=function(){this.detachIsochrone();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer&&this._pushpinLayer.dispose();this._pushpin&&this._pushpin.dispose();u.prototype.dispose.call(this);e._clearDisposables(this.disposables);e._nullifyClass(this)},f.prototype.postInit=function(){(this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._address=n("#cmt_addressOne"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._error=n("#cmt_err"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1))},f.prototype._stopEvent=function(n){n.stopPropagation()},f.prototype._onDoneClicked=function(){if(!this._doneButton.has_class("disabled")){if(this._pushpin){this._pushpin.setLocation(this._location);var n=t.L_CmtTooltipTitle.replace("{time}",this._time),i=t.L_CmtTooltipDescription;this._infobox.setHtmlContent(nr.replace("{title}",n).replace("{description}",i));this._infobox.setLocation(this._location)}else this._showPinAndInfobox();this._updateIsochrone();this._updateTitle();this.doneClickedEvent.invoke();w.logButtonClick(this._doneButton.get_attr("id"))}},f.prototype._onTimeClicked=function(t){var u=t.target,i=u.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=f._timeButtonIds.indexOf(i),this._changeSelectedTime(r),w.logButtonClick(i))},f.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),w.logButtonClick(i))},f.prototype._processAutoSuggestResult=function(n,t){this._doneButton.remove_class("disabled");var i=this._location;this._pushpin&&rt.areEqual(i,n,!0)||(this._location=n,this.setAddressValue(t),this._hideInfobox(0),this._updateMapView())},f.prototype._updateIsochrone=function(){var n,t,i;this._resetTimeButtons();this._hideInfobox(0);this._error.add_class("hidden");this.getAddressValue()||this._reverseGeocode(this._location);this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue());n=null;(!this._peakButton||this._peakButton.has_class("selected"))&&(n="timeWithTraffic");t=this._buildRequest(this._time,n);i=[t];this._setControlBusy(!0);this._isochroneLayer.setRequests(i)},f.prototype._buildRequest=function(n,t){var r=this._location,u=this._cmtFeatureConfig.isochroneOneFillColor,i={maxTime:n,startPoint:r,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:u,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}};return i.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,i.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,i.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,i},f.prototype._updateMapView=function(){var o=[this._location],n=this._map.getMode().getMapViewForLocationsInView(o),i=yt.fromLocation(n.cameraLocation,!1),r=this._map.getMercatorZoomLevel();if(i>r){var t=this._map.getViewportPadding(),u=this._map.getViewport(),f=new tt(t.left,t.top),e=new tt(u.pixelWidth-t.right,u.pixelHeight-t.bottom),s=new tt((f.x+e.x)/2,(f.y+e.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,r-i)}this._map.setView(n)},f.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}})},f.prototype._pushpinDragEnd=function(n,t){this._location=t.location;this._reverseGeocode(t.location);this._hideInfobox(0);w.logAddressChange(v.POI,!1);this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateTitle=function(){var i=this.getAddressValue(),u=i&&i.split(",")[0],n=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text,r;n=n.toLowerCase();r=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",u).replace("{trafficCondition}",n);this._title.set_text(r)},f.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},f.prototype._handleIsochroneError=function(){this._setControlBusy(!1);this._error.remove_class("hidden")},f.prototype._changeSelectedTime=function(n){this._selectTimeButton(n);this._isochroneLayer.downloading&&this._setControlBusy(!0)},f.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=f._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=f._times[t]}},f.prototype._resetTimeButtons=function(){for(var u,r,t=0,i=f._timeButtonIds;t<i.length;t++)u=i[t],r=n("#"+u),r&&r.remove_class("disabled")},f.prototype._enableTimeButton=function(t,i){var r=n("#"+f._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},f.prototype._reverseGeocode=function(n){var t=this,i=new ti;i.reverseGeocode(n,function(i){var r="";r=i&&i.success&&i.addressList&&i.addressList.length>0&&i.addressList[0].formattedAddress?i.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t.setAddressValue(r);t._address.set_attr("value",r);t._updateTitle()})},f.prototype._showPinAndInfobox=function(){var u=this,n,r;this._pushpin=new i.Pushpin(this._location,{icon:f._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle});this._attachPushpinEventHandlers();this._pushpinLayer.add(this._pushpin);n=t.L_CmtTooltipTitle.replace("{time}",this._time);r=t.L_CmtTooltipDescription;this._infobox=new ai(this._location,{htmlContent:nr.replace("{title}",n).replace("{description}",r),visible:!0,closeDelayTime:f._closeDelayTime,offset:f._tooltipAnchorOffset});this._infobox.setMap(this._map);this._infobox.mouseleave.addOne(function(){u._hideInfobox(0)})},f.prototype._hideInfobox=function(n){this._infobox&&this._infobox.getVisible()&&this._infobox.setOptions({closeDelayTime:n,visible:!1})},f.prototype._attachPushpinEventHandlers=function(){var n=this;this._pushpin.mouseover=new o;this._pushpin.mouseout=new o;this._pushpin.dragstart=new o;this._pushpin.dragend=new o;this._pushpin.click=new o;this.disposables.push(this._pushpin.mouseout.add(function(){return n._hideInfobox(0)}),this._pushpin.mouseover.add(function(){n._infobox.setOptions({visible:!0})}),this._pushpin.dragstart.add(function(){return n._hideInfobox(0)}),this._pushpin.dragend.add(function(t){n._infobox.setLocation(n._pushpin.getLocation());n._pushpinDragEnd(n._pushpin,t)}),this._pushpin.click.add(function(){n.pushpinClickedEvent&&n.pushpinClickedEvent.invoke()}))},f._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],f._defaultSelectedTime=15,f._times=[15,30,45,60],f._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',f._closeDelayTime=5e3,f._tooltipAnchorOffset=new tt(15,-15),f}(ut),nf=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new tt(0,0);i=n.call(this,r,1,u)||this}return i}return y(t,n),t}(pi),w=function(){function n(){}return n.logAddressChange=function(t,i){var r={logData:{feature:l.Commutability,action:n.AddressChange,data:{METHOD:t,IS:i}}};c.invokeHandler(h.instrumentationDataHandlerKey,r)},n.logButtonClick=function(n){var t={logData:{feature:l.Commutability,action:"C",data:{BID:n}}};c.invokeHandler(h.instrumentationDataHandlerKey,t)},n.logColtrolActivation=function(){var n={logData:{feature:l.Commutability,action:"A",data:{EP:v.ContextMenu}}};c.invokeHandler(h.instrumentationDataHandlerKey,n)},n.logColtrolDeactivation=function(){var n={logData:{feature:l.Commutability,action:"D",data:{EP:v.ContextMenu}}};c.invokeHandler(h.instrumentationDataHandlerKey,n)},n}(),a;(function(n){var t,i,r;(function(n){n[n.success=0]="success";n[n.userMappingNotFound=5]="userMappingNotFound"})(t=n.AcceptableRewardsErrorCodes||(n.AcceptableRewardsErrorCodes={})),function(n){n.ShownIneligibleKey="CommuteRewardsShownIneligible";n.FlyoutDismissKey="CommuteRewardsFlyoutDismiss";n.FlyoutDismissCountKey="CommuteRewardsFlyoutDismissCount";n.FlyoutNotNowActionKey="CommuteRewardsNotNowActionCount";n.FlyoutImpressionCountKey="CommuteRewardsFlyoutImpressionCount"}(i=n.StorageKeys||(n.StorageKeys={})),function(n){n.AwardPoints="AP";n.JoinRewardsClick="JRC";n.LocationsTooFar="LTF";n.CommuteErrorCode="CEC";n.DismissClick="FD";n.ImplicitDismiss="IMD";n.FlyoutEarnClick="FEC";n.FlyoutClick="FC";n.FlyoutImpression="FI";n.RewardsUpsellImpression="RUI";n.RewardsIneligibleImpression="RII";n.RewardsJoinImpression="RJI";n.CommuteRegionExcluded="CRE"}(r=n.CommuteRewardsLogActionName||(n.CommuteRewardsLogActionName={}))})(a||(a={})),function(n){function u(n){var t,i;return n.success&&((t=n.addressList)===null||t===void 0?void 0:t.length)>0&&(i=n.addressList[0]),i}function f(){return typeof t=="undefined"?new Promise(function(n){ot.downloadGeneric(nt.rewardsCommutePromotionUrl,"commuteRewards",function(i){var r;i&&(r=JSON.parse(i),t=r);n(r)},undefined,function(){n(undefined)})}):Promise.resolve(t)}function e(t){return t in n.AcceptableRewardsErrorCodes}function o(n){var t=new vr,i=nt.commuteRewardsExcludedCountries,f=nt.commuteRewardsExcludedUSStates;return r.reverseGeocode(n,function(n){var e,s=!0,r=u(n),o=(e=r===null||r===void 0?void 0:r.countryRegionIso2)===null||e===void 0?void 0:e.toUpperCase();o&&(o==="US"&&f.some(function(n){var t;return n===((t=r.adminDistrict)===null||t===void 0?void 0:t.toUpperCase())})||i.some(function(n){return n===o}))&&(s=!1);t.resolve(s)},undefined,undefined,0),t}var i=new wi,t,r=new ti;i.notifySignedInStarted.add(function(){t=undefined});n.getPromotionAvailableCommuteResponse=f;n.isPromotionErrorCodeExpected=e;n.isCommuteRewardsAllowed=o}(a||(a={}));ir=function(){function n(n){var e=n.getRootElement(),i=e.select(".bm_bottomRightOverlay");if(i.length>0){var u=new rr(n),f=u.getRootElement(),t=i[0];t.prepend?t.prepend(f[0]):t.insertBefore(f[0],t.firstChild);u.onButtonClick.add(function(t){var f=r.features.flyover,i,u;f&&(i=n.getMapOptions(),u=i&&i.enableFlyoverFeedback,lt.downloadMediaPlayerResources().then(function(){if(lt.downloadComplete=!0,t){var i=f.videoUrlFormat.replace("{fileLocation}",t),n=new fi(u,i,t);n.OpenDialog();n.LoadVideo()}},function(){var n=new fi(u);n.OpenDialog()}))})}}return n}(),function(n){n.data=[{name:"Seattle",coordinate:[47.60357,-122.32945],url:"a7284c88-c77d-442f-a2a4-fe240bf8f9a9/Seattle-1080-H264.ism"},{name:"San Francisco",coordinate:[37.77986,-122.42905],url:"3f9cc4ca-afdd-4364-a629-7c5be72db437/SanFrancisco-1080-H264.ism"},{name:"Salt Lake City",coordinate:[40.76031,-111.88822],url:"2d513d9d-81c6-4bf4-8406-5c341f902ff4/Salt%20Lake%20City-1080-H264.ism"},{name:"Atlanta",coordinate:[33.74831,-84.39111],url:"fe57aed1-3107-4a2c-a404-9c02bb68c45c/Atlanta%201080-H264.ism"},{name:"Chicago",coordinate:[41.88425,-87.63245],url:"dc7f7928-e99b-44d6-ada4-1751a24b4761/Chicago-1080p-H264.ism"},{name:"Columbus",coordinate:[39.96199,-83.00275],url:"73b06167-f587-4c22-b299-e9b217f4fc0f/Columbus%201080-H264.ism"},{name:"Dallas",coordinate:[32.77815,-96.7954],url:"a9a5c257-5883-4dfd-971c-e305bc249771/Dallas%201080-H264.ism"},{name:"Houston",coordinate:[29.76045,-95.36978],url:"730fa943-f5d5-4279-affc-dc4343809845/Houston-1080p-H264.ism"},{name:"Las Vegas",coordinate:[36.17191,-115.13997],url:"880c4017-370b-4f17-8d01-38979242f144/Las%20Vegas%201080-H264.ism"},{name:"Los Angeles",coordinate:[34.05349,-118.24532],url:"27311a28-304d-479d-819d-e5496bbbaccf/Los%20Angeles-1080p-H264.ism"},{name:"Miami",coordinate:[25.775084,-80.1947],url:"6b2e5295-b55f-4d31-9f9c-73f5652b33ee/Miami%201080-H264.ism"},{name:"Minneapolis",coordinate:[44.977486,-93.264366],url:"a04ae743-0d55-4b81-894b-cd987717a143/Minneapolis%201080-H264.ism"},{name:"Philadelphia",coordinate:[39.95228,-75.16245],url:"23f1e786-89f2-41a2-8fa0-39d2de3542e7/Philadelphia%201080-H264.ism"},{name:"Phoenix",coordinate:[33.44277,-112.072754],url:"96e399bc-2dfa-4154-9fba-ab09e17e8f4e/Phoenix-1080p-H264.ism"},{name:"Portland",coordinate:[45.51179,-122.67563],url:"d3890c3b-ca26-43d8-bcf2-a0d57b025c99/Portland%201080-H264.ism"},{name:"San Antonio",coordinate:[29.42458,-98.49461],url:"cf127e1f-7519-420e-b8a9-153fd33ae4d8/San%20Antonio%201080-H264.ism"},{name:"San Diego",coordinate:[32.715,-117.1625],url:"a5443b04-8137-4091-ac55-2fed9a74ae97/san_diego.ism"},{name:"Tampa",coordinate:[27.947424,-82.45878],url:"6ab3ab65-1996-479e-9ec7-c7621734a482/Tampa%201080-H264.ism"},{name:"Washington",coordinate:[38.89037,-77.03196],url:"6579cc36-72d6-4f6f-a1fc-85d09796d517/Washington%20DC%201080-H264.ism"},{name:"New York",coordinate:[40.71455,-74.00712],url:"2a56f9f8-643c-4dd4-a043-adce04ca6b73/New%20York-1080p-H264.ism"},{name:"St. Louis",coordinate:[38.635357,-90.20099],url:"9d7bcc7b-533d-45f9-8902-fe3fd03407cc/st_louis.ism"},{name:"Sioux Falls",coordinate:[43.54535,-96.73128],url:"fd02d1a3-003e-45c0-9ff4-950321492af9/sioux_falls.ism"},{name:"Oklahoma City",coordinate:[35.481766,-97.54105],url:"9eef9ed6-344a-4ec6-9663-ad6356a6e2da/oklahoma_city.ism"},{name:"New Orelans",coordinate:[29.951763,-90.074615],url:"441c5dcb-b74a-4ea7-8740-3a34d8c844df/new_orelans.ism"},{name:"Myrtle Beach",coordinate:[33.693913,-78.88645],url:"7de6909d-d35c-4233-ad27-172bb98f21da/myrtle_beach.ism"},{name:"Memphis",coordinate:[35.14976,-90.04925],url:"246f742b-f8aa-4d46-b223-a3001eebff91/memphis.ism"},{name:"Long Beach",coordinate:[33.771736,-118.193375],url:"67262366-c68d-48b6-9afd-9a0ce834b2bc/long_beach.ism"},{name:"Little Rock",coordinate:[34.746483,-92.289597],url:"1f20f230-677c-4968-b876-0050a688a7d5/little_rock.ism"},{name:"Kansas City",coordinate:[39.102116,-94.5762],url:"2ce2a0da-6a4c-4f0d-b6ca-5a2fb6032e08/kansas_city.ism"},{name:"Jersey City",coordinate:[40.719074,-74.050552],url:"f1405fd0-1736-4243-a8e0-f098bcd76896/jersey_city.ism"},{name:"Huntington Beach",coordinate:[33.659775,-117.99931],url:"c1933bdf-306c-482e-870f-22f54dc9db30/huntington_beach.ism"},{name:"Green Bay",coordinate:[44.513287,-88.01326],url:"6b90994f-53d8-4e0b-9335-390233048aaa/green_bay.ism"},{name:"Grand Rapids",coordinate:[42.96546,-85.67017],url:"6e1035a9-568c-488d-9d88-d29708065056/grand_rapids.ism"},{name:"Fort Worth",coordinate:[32.75095,-97.33086],url:"c091e47f-deaa-43c3-b5e1-47102e2c7a37/fort_worth.ism"},{name:"Fort Lauderdale",coordinate:[26.124163,-80.143585],url:"1513d851-a51b-4116-810d-fb52299cf0a7/fort_lauderdale.ism"},{name:"El Paso",coordinate:[31.75916,-106.48749],url:"12189c85-777e-47f6-a336-ff4a01dbc821/el_paso.ism"},{name:"Des Moines",coordinate:[41.58976,-93.61565],url:"1b501136-f2e1-45c8-b4d7-7d06906cf575/des_moines.ism"},{name:"Corpus Christi",coordinate:[27.76688,-97.40815],url:"fa27e556-3f34-4322-bc0c-0dd67b997259/corpus_christi.ism"},{name:"Winston Salem",coordinate:[36.09626,-80.24374],url:"03e6a8fb-f1cd-4657-88c1-5a32e2033c38/winston-salem.ism"},{name:"Wilmington",coordinate:[34.22148,-77.94469],url:"de11acfd-73e9-4d3a-bbab-a442d17681e6/wilmington.ism"},{name:"Tucson",coordinate:[32.22155,-110.96976],url:"f3c6b089-9b49-46bc-8c97-6e4b81f9e879/tuscon.ism"},{name:"Tulsa",coordinate:[36.15226,-95.99098],url:"f9d43764-dc72-448a-b1fa-af5b23aa16a5/tulsa.ism"},{name:"Trenton",coordinate:[40.21788,-74.7594],url:"d0e9e968-ccba-468f-8a26-5656e4a9c316/trenton.ism"},{name:"Toledo",coordinate:[41.655296,-83.53571],url:"5c1f5217-5228-4530-8e04-fb2d2b261326/toledo.ism"},{name:"Tacoma",coordinate:[47.267418,-122.4673],url:"b0d6155d-b285-4578-a4e8-acebe624a9d3/tacoma.ism"},{name:"Spokane",coordinate:[47.663933,-117.400856],url:"d0103fd4-7cc6-491f-a2f1-f65fa83be63c/spokane.ism"},{name:"Scottsdale",coordinate:[33.494907,-111.92606],url:"9b481271-c92a-4688-9406-8a8bac4a59c0/scottsdale.ism"},{name:"Sacramento",coordinate:[38.57933,-121.4909],url:"992fb3f4-fa0b-4517-aab5-73b9162f6efd/sacramento.ism"},{name:"Rochester",coordinate:[43.161663,-77.62053],url:"7b033ad0-b31f-4680-b333-b5121beddda0/rochester.ism"},{name:"Richmond",coordinate:[37.5407,-77.43365],url:"2dd57ffe-40e5-4b7a-8fcc-5ddbab78fc58/richmond.ism"},{name:"Raleigh",coordinate:[35.78551,-78.64267],url:"ae3645a8-9423-42f5-bdce-0cf786f0919e/raleigh.ism"},{name:"Queens",coordinate:[40.75,-73.86667],url:"9f4360a2-a769-4f41-9fd1-8608991907cd/queens.ism"},{name:"Plano",coordinate:[33.028477,-96.69542],url:"334039c0-4654-47e8-bbf8-fc22e756034b/plano.ism"},{name:"Pasadena",coordinate:[34.14641,-118.13511],url:"f311bfc7-23b6-4a32-b4ad-b0142868136a/pasadena.ism"},{name:"Omaha",coordinate:[41.26067,-95.94056],url:"39512eba-1de1-4af6-8d16-ef7b1e0faffd/omaha.ism"},{name:"Oakland",coordinate:[37.80483,-122.27248],url:"8f2d31f9-0c93-4a1c-92de-4fd11eabcd50/oakland_new.ism"},{name:"Newark",coordinate:[40.731506,-74.174385],url:"92784453-c7c0-46af-80f8-98a210ee972d/newark.ism"},{name:"Nashville",coordinate:[36.16784,-86.77816],url:"aea5d9b0-63da-452b-87f4-47a8c2ec4893/nashville.ism"},{name:"Naples",coordinate:[26.141727,-81.799194],url:"1ae1ca07-ccf8-42e6-b7c5-2f124082581c/naples.ism"},{name:"Montgomery",coordinate:[32.361668,-86.279167],url:"39f39ff0-c8fa-4069-a094-7c181d4d9da7/montgomery.ism"},{name:"Milwaukee",coordinate:[43.04181,-87.90684],url:"5cf3249c-cfc6-4c0d-9949-6ae1d04fc881/milwaukee.ism"},{name:"Manchester",coordinate:[42.990925,-71.46309],url:"ce2b1c3f-beee-417f-b9a9-c32499eaec2c/manchester.ism"},{name:"Madison",coordinate:[43.07295,-89.38669],url:"c615b1c2-b4f6-4f3c-ac3a-566cee9ea5e3/madison.ism"},{name:"Louisville",coordinate:[38.24158,-85.77353],url:"8dd834d5-ccb7-4608-b235-5726c364bad0/louisville.ism"},{name:"Lexington",coordinate:[38.04859,-84.50032],url:"1f102915-2b80-47f4-a68a-6b2af1733c27/lexington.ism"},{name:"Lansing",coordinate:[42.73194,-84.55225],url:"2d31fd86-39e4-4e77-924d-438c0bf04a68/lansing.ism"},{name:"Knoxville",coordinate:[35.962643,-83.916725],url:"922e0804-c3e5-47a0-9db1-5671aa63e1d3/knoxville.ism"},{name:"Jackson",coordinate:[43.47962,-110.76235],url:"af5b3a37-d9e0-410e-9ed4-eda2c891b1c6/jackson.ism"},{name:"Indianapolis",coordinate:[39.76691,-86.14996],url:"053ccb3b-a84a-4260-ac27-08ebfecb33a3/indianapolis.ism"},{name:"Harrisburg",coordinate:[40.26006,-76.88251],url:"17d0cd79-c183-4c54-8de8-551f96e5f5d2/harrisburg.ism"},{name:"Greenville",coordinate:[34.856384,-82.403915],url:"edf6b968-997b-486d-ae5f-e581895fe954/greenville.ism"},{name:"Greensboro",coordinate:[36.0744,-79.81155],url:"85c4c0ae-2b58-43c8-aa47-be14bca8e7a3/greensboro.ism"},{name:"Glendale",coordinate:[34.148136,-118.24644],url:"7c7061f5-cb5f-41ac-add3-11fb2453969c/glendale.ism"},{name:"Georgetown",coordinate:[38.90813,-77.06372],url:"5d7143f1-1033-4b6c-b1ee-cffe3518b1b4/georgetown.ism"},{name:"Everett",coordinate:[47.97913,-122.19589],url:"096ce1b4-a1e1-4ccc-a7ad-561b1e776ae8/everett.ism"},{name:"Detroit",coordinate:[42.33168,-83.048],url:"312727e4-9e10-430e-b6c1-c6901542f587/detroit.ism"},{name:"Dayton",coordinate:[39.760983,-84.1922],url:"b1dc12cb-43d5-4ae8-80c3-bce111d61efb/dayton.ism"},{name:"Concord",coordinate:[43.20725,-71.5366],url:"851ec5b7-a151-48f6-841f-9e747c68fab6/concord.ism"},{name:"Columbia",coordinate:[34.0007104,-81.0348144],url:"9e78253e-2ec9-4547-9d57-7001c110cf53/columbia.ism"},{name:"Cleveland",coordinate:[41.50108,-81.673584],url:"b4802aed-bea5-4147-9aad-0f81a7c67ac6/cleveland.ism"},{name:"Cincinatti",coordinate:[39.1037,-84.51361],url:"5b483a39-02ed-4dc7-98bf-fc676e85af1e/cincinatti.ism"},{name:"Chattanooga",coordinate:[35.037468,-85.30949],url:"de51c9d9-ec37-4439-b7d5-b4b12cc407e3/chattanooga.ism"},{name:"Charleston",coordinate:[32.783062,-79.93444],url:"f5dce87e-4e00-499c-ae4a-b4b91057a727/charleston.ism"},{name:"Buffalo",coordinate:[42.88544,-78.87846],url:"88be5693-295d-42ce-a1e6-9fa9cc750d63/buffalo.mov.ism"},{name:"Bronx",coordinate:[40.826153,-73.920265],url:"99d8ee29-149a-4f29-9fcc-5484ce167ce7/bronx.ism"},{name:"Boise",coordinate:[43.60761,-116.1934],url:"897a6bdd-2850-43b9-93e1-5870f6cb030a/boise.ism"},{name:"Birmingham",coordinate:[33.522858,-86.80771],url:"65374ee6-50b7-4d5f-8e77-60cad48e2439/birmingham.ism"},{name:"Bellevue",coordinate:[47.6137,-122.19093],url:"876b979f-edf1-4b03-94f3-c8c7a658f18e/bellevue.ism"},{name:"Baltimore",coordinate:[39.29058,-76.60926],url:"1829d442-9f0d-446f-b207-f8926a4c8162/baltimore.ism"},{name:"Augusta",coordinate:[44.340664,-69.749664],url:"df6bb442-8b83-42fc-8c31-246d4c2878e3/augusta.ism"},{name:"Anchorage",coordinate:[61.21753,-149.85825],url:"e7f24318-8e6c-418d-add2-73b1b41264b7/anchorage.ism"},{name:"Amarillo",coordinate:[35.202614,-101.83963],url:"cb0464a4-1b01-41fa-be14-cafdf008b24f/amarillo.ism"},{name:"Allentown",coordinate:[40.613953,-75.477791],url:"595ffd68-a39f-418f-9d83-26387c3ff5e0/allentown.ism"},{name:"Albuquerque",coordinate:[35.0844909,-106.6511367],url:"1ccd14c3-25e4-41fb-8931-5bd8d9f20911/albuquerque.ism"},{name:"Albany",coordinate:[42.65155,-73.75521],url:"93f854fc-9b3c-40c0-bb2d-dc833ced1475/albany.ism"},{name:"Akron",coordinate:[41.0772,-81.534744],url:"58a72d3e-1a5b-42e2-bbb0-20f848071e32/akron.ism"},{name:"Boston",coordinate:[42.35866,-71.05674],url:"8b9e75d4-a759-48f4-a038-a3018507b1bf/boston.ism"},{name:"Honolulu",coordinate:[21.30485,-157.85776],url:"c83784a0-a9ff-418b-b690-e89aeaaab293/honolulu.ism"},{name:"Virginia Beach",coordinate:[36.86314,-76.015778],url:"8b142571-ee71-4945-b4af-44d3c0709468/virginia_beach.ism"},{name:"Tallahassee",coordinate:[30.43977,-84.28065],url:"62563c5b-3b50-4532-885c-a43fa825a7f3/tallahassee.ism"},{name:"St. Paul",coordinate:[44.94382,-93.09332],url:"e1727ab6-4b56-4f15-afe9-622be6c590c5/st_paul.ism"},{name:"Franklin",coordinate:[39.4805556,-86.055],url:"9d059ba0-67b5-4738-858e-d0999e0f8d55/franklin.ism"},{name:"Amsterdam",coordinate:[52.373165130615234,4.890659809112549],url:"3ebe612d-4e16-454e-b2e0-331e5ffe4b3d/amsterdam.ism"},{name:"Auckland",coordinate:[-36.85361099243164,174.76498413085938],url:"07d12f14-0489-46e1-bfe0-3c6567f347b3/auckland.ism"},{name:"Bangkok",coordinate:[13.753957748413086,100.50224304199219],url:"8234edf1-fd23-4e78-b740-ca1d9c2e1ecc/bangkok.ism"},{name:"Beijing",coordinate:[39.907806396484375,116.3975830078125],url:"3ad45d6c-6db2-455c-a82d-b3d559a4b719/beijing.ism"},{name:"Bengaluru",coordinate:[12.976746559143066,77.57527923583984],url:"531acfd5-6b35-43f8-8c14-077742e8c81a/bengaluru.ism"},{name:"Berlin",coordinate:[52.50147247314453,13.40231704711914],url:"4217d441-2129-459e-a187-20eb120187c7/berlin.ism"},{name:"MedellÃ­n",coordinate:[6.230819,-75.57383],url:"21892abd-f5d8-4fe7-82bc-f83891d5a67a/bogota.ism"},{name:"Brisbane",coordinate:[-27.4677791595459,153.02610778808594],url:"2ae4cb82-3b54-49bc-96fb-d321f500707a/brisbane.ism"},{name:"Buenos Aires",coordinate:[-34.607566833496094,-58.43708801269531],url:"2ac46e1c-9342-4165-94da-caa85c194688/buenos_aires.ism"},{name:"Cairo",coordinate:[30.043487548828125,31.235292434692383],url:"c74e522f-de61-47b0-8dd9-d8bb656e1300/cairo.ism"},{name:"Cape Town",coordinate:[-33.92710876464844,18.420061111450195],url:"4f84b5a8-8705-4da8-9778-92b530d07b81/cape_town.ism"},{name:"Central HK",coordinate:[22.302711,114.177216],url:"8e85bd5b-54d3-4ee5-981b-5b6de4ec910d/central.ism"},{name:"Chengdu",coordinate:[30.5722599029541,104.06651306152344],url:"81df5b01-2389-4381-b721-5e5019a25524/chengdu.ism"},{name:"Chongqing",coordinate:[29.5627498626709,106.55180358886719],url:"4477f81f-9037-4d18-bf52-2ba2328e6951/chongqing.ism"},{name:"Dhaka",coordinate:[23.707305908203125,90.41548156738281],url:"b5ba3aa4-00a1-43f4-a2c6-b38888bf7d2b/dhaka.ism"},{name:"Dublin City",coordinate:[53.34409713745117,-6.267486095428467],url:"8ac0cb07-63c0-4178-b479-99cb5b12d98e/dublin.ism"},{name:"Frankfurt",coordinate:[50.11088562011719,8.679491996765137],url:"c34304af-7dd1-4022-aeda-a5b010b5c611/frankfurt.ism"},{name:"Guangzhou",coordinate:[23.129079818725586,113.26435852050781],url:"6652dc04-ea96-4891-9c18-7b9e895b47bc/guangzhou.ism"},{name:"Hangzhou",coordinate:[30.245920181274414,120.2107925415039],url:"fa5afcfa-6c87-483e-b172-2a7f1ff4c406/hangzhou.ism"},{name:"Hefei",coordinate:[31.820430755615234,117.2271499633789],url:"3343d4eb-abce-4600-9be7-61675de651e2/hefei.ism"},{name:"Jakarta",coordinate:[-6.17475700378418,106.82707214355469],url:"fb77c4aa-ca06-4763-a0db-bbb03375ba9d/jakarta.ism"},{name:"Johannesburg",coordinate:[-26.201452255249023,28.045488357543945],url:"82fb72e6-29d1-4059-8f63-a0fd1c3c8e91/johannesburg.ism"},{name:"Lagos",coordinate:[6.4627580642700195,3.4123919010162354],url:"58f12b38-b527-4f8e-98ea-a59af48da232/lagos.ism"},{name:"Lima",coordinate:[-12.062106132507324,-77.0365219116211],url:"090a54cc-1540-4883-9e6f-5ad9af814371/lima.ism"},{name:"London",coordinate:[51.500152587890625,-.12623600661754608],url:"ee936ead-05dd-4e01-864a-56c1a08139c8/london.ism"},{name:"Madrid",coordinate:[40.416690826416016,-3.700345993041992],url:"11aa88d7-d519-4290-832e-f8baf662aa62/madrid.ism"},{name:"Manchester",coordinate:[53.480712890625,-2.2343759536743164],url:"0c59282a-e9ee-4e04-97f7-0c34020b64df/manchester_uk.ism"},{name:"Melbourne",coordinate:[-37.815460205078125,144.9671630859375],url:"30ac4508-074e-41eb-9b0a-ffa7919e51b9/melbourne.ism"},{name:"Mexico City",coordinate:[19.43267822265625,-99.13420867919922],url:"d94039da-e08d-4abb-883c-cc99b5f257eb/mexico_city.ism"},{name:"Milan",coordinate:[45.463619232177734,9.188116073608398],url:"0bc9e0e4-d75b-41b8-a884-d5314b381ec2/milan.ism"},{name:"Montreal",coordinate:[45.509063720703125,-73.55335998535156],url:"4618d5fe-e942-4b7c-b5c0-392f30a4c504/montreal.ism"},{name:"Moscow",coordinate:[55.75654220581055,37.61492156982422],url:"7cf4fafe-b3e7-4a86-8ed5-d3bfc1691a79/moscow.ism"},{name:"Mumbai",coordinate:[18.96904754638672,72.82118225097656],url:"bde6058e-a6ef-4a05-90de-c21906c93b7f/mumbai.ism"},{name:"Munich",coordinate:[48.13912582397461,11.580219268798828],url:"2ab7e46c-bee3-49d7-a15e-6c56a424efc5/munich.ism"},{name:"Nairobi",coordinate:[-1.3455660343170166,36.74247741699219],url:"fe8cd034-8d08-46d1-a8e6-650f0930ba5d/nairobi.ism"},{name:"Nanchang",coordinate:[28.682676315307617,115.85816955566406],url:"3c99c7f0-f2ab-4115-a10c-eba67b3c1877/nanchang.ism"},{name:"Nanjing",coordinate:[32.058380126953125,118.79647064208984],url:"8fd4d2bd-89de-487f-be7f-4e611d0eaf46/nanjing.ism"},{name:"Nassau",coordinate:[25.046588897705078,-77.37660217285156],url:"54a8388f-a5d5-434c-8799-96be80385c4c/nassau.ism"},{name:"Delhi",coordinate:[28.643390655517578,77.115478515625],url:"c39fb4de-2746-48ac-bf83-57293fe0073a/new_delhi.ism"},{name:"Ottawa",coordinate:[45.4204216003418,-75.69242858886719],url:"8fbdbfbe-89cc-41fa-bae1-c8afc3a86875/ottawa.ism"},{name:"Paris",coordinate:[48.856895446777344,2.350848913192749],url:"507013d1-2a0e-4d9a-9dca-0c38965c90c6/paris.ism"},{name:"Rio de Janeiro",coordinate:[-22.911014556884766,-43.209373474121094],url:"66fdc2a5-bb20-49ed-ba3f-025378eceb78/rio_de_janeiro.ism"},{name:"Rome",coordinate:[41.89055633544922,12.494267463684082],url:"e8c3145a-5b11-4fbe-9369-dc1becc16659/rome.ism"},{name:"Santiago",coordinate:[-33.437774658203125,-70.65045166015625],url:"4c38474d-b4fa-4703-b8c9-cbf2627f4532/santiago.ism"},{name:"SÃ£o Paulo",coordinate:[-23.55065155029297,-46.63338088989258],url:"861b5c52-5c3f-4396-8c0a-fbf6fbf6c7da/sao_paulo.ism"},{name:"Shanghai",coordinate:[31.08266258239746,121.4192886352539],url:"a13bf5c3-b15f-48c4-b1b2-ea51aec4c56a/shanghai.ism"},{name:"Shenzhen",coordinate:[22.54368019104004,114.05790710449219],url:"cd6ed98b-ff76-4e1e-ad06-50f582143a08/shenzhen.ism"},{name:"Singapore",coordinate:[1.2894359827041626,103.84998321533203],url:"1ed13a14-f624-4fbc-9b59-43707366663a/singapore.ism"},{name:"Stockholm",coordinate:[59.332786560058594,18.06448745727539],url:"e9d6a1fd-6476-4a70-91eb-b643473ac696/stockholm.ism"},{name:"Suzhou",coordinate:[33.64704895019531,116.96343231201172],url:"457374a7-7267-409e-9161-953f383117de/suzhou.ism"},{name:"Sydney",coordinate:[-33.873199462890625,151.2095947265625],url:"da1f92cf-f90f-4314-a343-6de61c5e479c/sydney.ism"},{name:"Tokyo",coordinate:[35.68696212768555,139.7494659423828],url:"7f4dde4e-1f66-4961-bfba-978ae9722e49/tokyo.ism"},{name:"Toronto",coordinate:[43.651893615722656,-79.3817138671875],url:"86140a4f-40e8-4198-8c57-48ca6f235d1b/toronto.ism"},{name:"Vienna",coordinate:[48.20844650268555,16.37789535522461],url:"b9b2c3f7-8c31-44aa-a5f1-863431ca908f/vienna.ism"},{name:"Warsaw",coordinate:[52.23497772216797,21.00849151611328],url:"063e4648-3267-466e-b362-19c55865ac57/warsaw.ism"},{name:"Wuhan",coordinate:[30.59276008605957,114.30525207519531],url:"ded00e24-a9c0-47f6-94ff-af84cc15722c/wuhan.ism"},{name:"Yokohama",coordinate:[35.4600944519043,139.5775604248047],url:"e4ef161b-7c4f-49d4-a989-74105454e41f/yokohama.ism"},{name:"Zurich",coordinate:[47.367000579833984,8.550000190734863],url:"967b26f1-f9dd-4c2f-8906-c253b70f8ab3/zurich.ism"}]}(ui||(ui={})),function(n){n.downloadComplete=!1;var t=function(){var n=[];return ui.data.forEach(function(t){t.coordinate&&t.coordinate.length===2&&n.push([new rt(t.coordinate[0],t.coordinate[1]),t])}),n}();n.getVideoItems=function(n){for(var r,u=[],i=0,f=t;i<f.length;i++)r=f[i],n.contains(r[0])&&u.push(r[1]);return u};n.downloadMediaPlayerResources=function(){var t,i,u;return n.downloadComplete?Promise.resolve():(t=r.features.flyover,t?(i=new Promise(function(n,i){var r=document.createElement("script");r.src=t.azureMediaPlayerJSUrl;r.crossOrigin="anonymous";r.onload=function(){n()};r.onerror=function(){i()};document.head.append(r)}),u=new Promise(function(n,i){var r=document.createElement("link");r.href=t.azureMediaPlayerStyleUrl;r.rel="stylesheet";r.onload=function(){n()};r.onerror=function(){i()};document.head.append(r)}),Promise.all([u,i])):void 0)}}(lt||(lt={}));rr=function(n){function r(i){var u=n.call(this)||this;return u.defineProperty("badgeVisibility"),u.defineProperty("numVideoItems"),u.defineProperty("videoListVisibility"),u.defineProperty("videoItems"),u.defineProperty("listOffset"),u.resources=t,u.onButtonClick=new o,u.setTemplate(new it(uu,{onFlyoverListItemClick:function(n){var f=n.srcElement,t=f.getAttribute("data-url");r.log(t,i.getMercatorZoomLevel(),i.getBounds().bounds.toString());u.onButtonClick.invoke(t)},onFlyoverButtonClick:function(){r.log(u.videoUrl,i.getMercatorZoomLevel(),i.getBounds().bounds.toString());u.onButtonClick.invoke(u.videoUrl)},onFlyoverButtonHover:function(n){if(n.type.toLowerCase()==="mouseover"){clearTimeout(u.timerHandle);var t=u.getNumVideoItems()>1;u.setVideoListVisibility(t)}else u.timerHandle=setTimeout(function(){u.setVideoListVisibility(!1)},250)},boolToDisplay:function(n){return u.boolToDisplay(n)},onMouseMove:function(n){return n.stopPropagation()}})),u.disposables.push(i.viewChanged.add(function(n){n.isInAnimation||u.setVisibility(i)})),u.setVisibility(i),u}return y(r,n),r.log=function(n,t,r){var u=i.logger,f={feature:l.Flyover,action:"C",data:{component:"FOBTN",boundingBox:r,zoom:t,videoUrl:n}};u.logObject(f)},r.prototype.setVisibility=function(n){var f=n.getBounds(!0),c=n.getMercatorZoomLevel(),a=new yi(f.center,f.width,f.height),t=lt.getVideoItems(a),e=t.length,o,u,s,h;this.videoUrl=t[0]&&t[0].url;this.setNumVideoItems(e);this.setBadgeVisibility(e>1);this.setVideoItems(t);this.setListOffset(e*r.FlyoverLinkItemHeight*-1+"px");o=t&&t.length>0;u=o&&c>=r.MinLODToShowButton;u&&!this.isVisible&&(s=i.logger,h={feature:l.Flyover,action:"I",data:{component:"FOBTN",boundingBox:n.getBounds().bounds.toString(),zoom:n.getMercatorZoomLevel(),videoUrl:this.videoUrl}},s.logObject(h));this.isVisible=u;this.setVisible(u)},r.MinLODToShowButton=11,r.FlyoverLinkItemHeight=30,r}(ut);fi=function(n){function u(i,r,u){var f=n.call(this,fu,"bm_flyoverVideoContainer",{onFlyoverFeedbackClick:function(n){f.activateFeedbackActivity(n)},boolToDisplay:function(n){return f.boolToDisplay(n)}})||this;return f.defineProperty("videoID"),f.defineProperty("showError"),f.defineProperty("feedbackDisplay"),f.resources=t,f.videoSourceUrl=r,f.fileLocation=u,f.setVideoID("flyoverVid_"+Date.now()),f.setShowError(r===undefined),f.setFeedbackDisplay(i),f}return y(u,n),u.prototype.CloseDialog=function(){n.prototype.CloseDialog.call(this);var t=i.logger,r={feature:l.Flyover,action:"CLSM",data:{component:"FOPLR",videoUrl:this.fileLocation}};t.logObject(r)},u.prototype.LoadVideo=function(){var n,t;typeof amp!="undefined"&&amp&&this.videoSourceUrl&&(n=r.features.flyover,amp.options.flashSS.swf=n.flashSsUrl,amp.options.silverlightSS.xap=n.silverlightSsUrl,t=amp(this.getVideoID(),{techOrder:["azureHtml5JS","html5","flashSS","html5FairPlayHLS","silverlightSS"],autoplay:!0,controls:!0}),t.src([{src:this.videoSourceUrl,type:"application/vnd.ms-sstr+xml"}]),t.ready(function(){var n=this;n.play()}))},u.prototype.activateFeedbackActivity=function(){this.CloseDialog();var n={title:t.FlyoverFeedbackTitle,activeTaskId:"",feedbackTaskType:2,entryPoint:8,queryables:{keywords:["flyOver"]}};c.invokeHandler(h.taskDataHandlerKey,{type:f.feedbackTask,state:n})},u}(ct),function(n){n._isWithinBounds=function(n,t){for(var e,i,r=!1,o=k.getMapBounds(n),u=0,f=t;u<f.length;u++){if(e=f[u],i=e.split(":"),i.length===5){var s=i[1],h=i[2],c=i[3],l=i[4],a=new rt(s,h),v=new rt(c,l),y=yi.fromCorners(a,v);r=y.intersects(o)}if(r)break}return r}}(pt||(pt={}));var tf=function(n){function u(i){var f=n.call(this)||this,o,e,s,h;return f.flywheelFeatureConfig=r.features.flywheel,f.localStorage=window.localStorage,f.map=i,f.resources=t,f.localStorage.setItem(u.displayCurrentName,"true"),f.disposables.push(f.map.viewChanged.add(function(){return f._setDisplay()},!0)),o=f.getRootElement(),e=document.querySelector(".bm_mapBannerContainer"),e.prepend?e.prepend(o[0]):e.insertBefore(o[0],e.firstChild),f.setTemplate(new it(eu,{onTryItOutClick:function(){var n=k.getMapCenter(f.map),t=n.latitude,i=n.longitude,r=k.getMercatorZoomLevel(f.map),e=f.flywheelFeatureConfig.flywheelURL.replace("{zoomLevel}",r.toString()).replace("{latitude}",t.toString()).replace("{longitude}",i.toString());window.open(e);f.localStorage.setItem(u.displayCurrentName,"false");f.localStorage.setItem(u.displayNextName,"false");f.localStorage.setItem(u.viewCountName,"0");f._setDisplay();u._log("C",{B:"TIO"})},onRemindMeClick:function(){f.localStorage.setItem(u.displayCurrentName,"false");f.localStorage.setItem(u.displayNextName,"true");f.localStorage.setItem(u.viewCountName,"0");f._setDisplay();u._log("C",{B:"RML"})},onNotInterestedClick:function(){f.localStorage.setItem(u.displayCurrentName,"false");f.localStorage.setItem(u.displayNextName,"false");f.localStorage.setItem(u.viewCountName,"0");f._setDisplay();u._log("C",{B:"IMI"})},boolToDisplay:function(n){return f.boolToDisplay(n)}})),f._setDisplay(),s=document.querySelector(u.taskContainerSelector),f._mutationObserver=new MutationObserver(function(){f._setDisplay()}),h={attributes:!0,childList:!0,subtree:!0},f._mutationObserver.observe(s,h),f}return y(u,n),u.prototype.dispose=function(){this._mutationObserver.disconnect();e._nullifyClass(this);n.prototype.dispose.call(this)},u._log=function(n,t){var r=i.logger,u={feature:l.FlywheelBanner,action:n,data:t||{}};r.logObject(u)},u.prototype._getViewCount=function(){var n=parseInt(this.localStorage.getItem(u.viewCountName));return isNaN(n)?0:n},u.prototype._shouldDisplay=function(){var n=this.localStorage.getItem(u.displayCurrentName),t=n!=="false",i=this.localStorage.getItem(u.displayNextName),r=i!=="false",f=this._getViewCount(),e=this.flywheelFeatureConfig.minZoomLevel,o=k.getMercatorZoomLevel(this.map);return t&&r&&f<4&&o>=e&&pt._isWithinBounds(this.map,this.flywheelFeatureConfig.boundsList)},u.prototype._setDisplay=function(){var e=this._getViewCount(),t=document.querySelector(".bm_mapBannerContainer"),n=document.querySelector("div#mapContainer div.MicrosoftMap"),i=document.querySelector("#id_h"),r=document.querySelector(u.taskContainerSelector),f=document.querySelector(".MicrosoftMap #taskBarPopoput"),o=this._shouldDisplay();if(o){if(!u.bannerDisplayed&&(u.bannerDisplayed=!0,u._log("C"),e+=1,this.localStorage.setItem(u.viewCountName,e.toString()),e===4))return;t&&(t.style.display="block");n&&(n.style.top=u.bannerHeight,n.style.height="calc(100% - "+u.bannerHeight+")");i&&(i.style.top=u.bannerHeight);r&&(r.style.top=u.newTaskContainerTopPosition);f&&(f.style.marginTop=u.bannerHeight)}else t&&(t.style.display="none"),n&&(n.style.top="0px",n.style.height="100%"),i&&(i.style.top=""),r&&(r.style.top=""),f&&(f.style.marginTop="");this.setVisible(o)},u.bannerHeight="57px",u.newTaskContainerTopPosition="129px",u.displayCurrentName="flywheel_displayCurrentInstance",u.displayNextName="flywheel_displayNextInstance",u.viewCountName="flywheel_viewCount",u.bannerDisplayed=!1,u.taskContainerSelector=".MicrosoftMap .taskLayoutContainer.bm_tcftitlea.slideout",u}(ut),rf=function(n){function u(i){var f=n.call(this)||this,h,o,s,e;return f.flywheelFeatureConfig=r.features.flywheel,f.defineProperty("isDisplayed"),f.map=i,f.resources=t,f.disposables.push(f.map.viewChanged.add(function(){return f._setDisplay()},!0)),sj_evt.bind("LargeMapShown",function(){f._setDisplay()}),sj_evt.bind("LargeMapHidden",function(){f._setDisplay()}),h=f.map.getRootElement(),o=h.select(".bm_bottomRightOverlay"),o.length>0&&(s=f.getRootElement(),e=o[0],e.prepend?e.prepend(s[0]):e.insertBefore(s[0],e.firstChild)),f._setDisplay(),f.setTemplate(new it(ou,{onEditMapsClick:function(n){n.preventDefault();var t=k.getMapCenter(f.map),i=t.latitude,r=t.longitude,e=k.getMercatorZoomLevel(f.map),o=f.flywheelFeatureConfig.flywheelURL.replace("{zoomLevel}",e.toString()).replace("{latitude}",i.toString()).replace("{longitude}",r.toString());u._log();window.open(o)},boolToDisplay:function(n){return f.boolToDisplay(n)}})),f}return y(u,n),u._log=function(){var n=i.logger,t={feature:l.Flywheel,action:"C",data:{}};n.logObject(t)},u.prototype._setDisplay=function(){var o=this.flywheelFeatureConfig.minZoomLevel,s=k.getMercatorZoomLevel(this.map),t=!e._isSmallMapShownOnSerp()&&s>=o&&pt._isWithinBounds(this.map,this.flywheelFeatureConfig.boundsList),n,r,f;this.setIsDisplayed(t);n=document.querySelector(".bm_flyoverButton");t?(n&&(n.style.top=u.NewFlyoverButtonTopPosition),r=i.logger,f={feature:l.Flywheel,action:"I",data:{}},r.logObject(f)):n&&(n.style.top="")},u.NewFlyoverButtonTopPosition="-160px",u}(ut),uf=function(){function n(t,i){var w=this,s,f,h,u;if(this._map=t,this._coreConfig=i,this._infoboxOptions={showCloseButton:!1,showPointer:!1,visible:!1,htmlContent:null,location:null,autoAlignment:!1,offset:new tt(-12,13)},this._htmlElement=document.querySelector("html"),f=r.features.landmarks3D,f.enableShare&&window.location.search.indexOf("lmk3d=")>=0&&(h=e._getUrlParam(window.location,"lmk3d",!1),h&&(u=h.split("|"),u.length===n.Landmark3dPropsLength||u.length===n.Landmark3dPropsLengthWithYpid))){var o=parseFloat(u[0]),b=parseFloat(u[1]),c=parseFloat(u[2]),l=parseFloat(u[3]),a=parseFloat(u[4]),v=u[5],p=(s=u[6])!==null&&s!==void 0?s:v,y=rt.normalizeLongitude(b);o>=-90&&o<=90&&!isNaN(y)&&!isNaN(c)&&!isNaN(l)&&!isNaN(a)&&(f.viewerUrlFormatWithVersion?ot.downloadGeneric(f.viewerVersionUrl,null,function(n){w._openViewerDialog(o,y,c,l,a,v,p,n)}):this._openViewerDialog(o,y,c,l,a,v,p))}}return n.prototype.addLayer=function(n){var i=this,f,t,u;this.layer||(f=this._coreConfig.landmarksLayerZIndex+1,t=new vt(this._coreConfig.landmarks3DVectorLayerId,n,new ar(this._map),f),t.setRenderTarget(1),t.setVisible(!0),n.setLayer(t),this.layer=t,this._disposables=[t.primitiveTapped.add(function(n){i._onPrimitiveTapped(n)}),t.primitiveHoverStarted.add(function(n){i._onPrimitiveHoverStarted(n)}),t.primitiveHoverStopped.add(function(n){i._onPrimitiveHoverStopped(n)}),this.layer,this._infoBox],r.isMapsAnswer&&sj_evt&&(u=this._overlayUpdated=function(){return i._updateLayerVisibility()},sj_evt.bind("LargeMapHidden",u),sj_evt.bind("LargeMapShown",u),u()),this._map.getLayers().insert(t))},n.prototype.dispose=function(){e._clearDisposables(this._disposables);this._overlayUpdated&&(sj_evt.unbind("LargeMapHidden",this._overlayUpdated),sj_evt.unbind("LargeMapShown",this._overlayUpdated),this._overlayUpdated=null)},n.prototype._updateLayerVisibility=function(){if(this.layer){var n=e._isSmallMapShownOnSerp()?!1:!0;this.layer.setVisible(n)}},n._log=function(n,t){var r=i.logger,u={feature:l.Landmark3D,action:n,data:{LN:t}};r.logObject(u)},n.prototype._openViewer=function(t,i){this._openViewerDialog(t.pivotLat,t.pivotLong,t.elevation,t.radius,t.pitch,t.name,t.ypid,i);n._log("C",t.ypid)},n.prototype._openViewerDialog=function(n,t,i,r,u,f,e,o){var h=dt.instance,s=this._map.getMapOptions(),c=s?s.enable3dLandmarkFeedback:!1,l=new ff(h.getSessionId(),n,t,i,r,u,f,e,c,o);l.OpenDialog();this._htmlElement.style["overscroll-behavior"]="none"},n.prototype._onPrimitiveTapped=function(n){var i=this,u=n.primitive,o,s;if(u){var h=u.entity,t=r.features.landmarks3D,f=h.ypid,e=t.backendUrlFormat.replace("{ypid}",f);t.viewerUrlFormatWithVersion?(o=new Promise(function(n){ot.downloadGeneric(t.viewerVersionUrl,null,function(t){n(t)})}),s=new Promise(function(n){ot.downloadJson(e,null,function(t){t.ypid=f;n(t)})}),Promise.all([o,s]).then(function(n){var t=n[0],r=n[1];i._openViewer(r,t)})):ot.downloadJson(e,null,function(n){i._openViewer(n)})}},n.prototype._onPrimitiveHoverStarted=function(i){var r=i.primitive;if(r){r.image=li.getImageFromCss("bm_3dLandmarkIconHover");this._infoBox||(this._infoBox=new ai(i.location,this._infoboxOptions),this._infoBox.setMap(this._map));var u=r.geometry,f=r.crs,e=r.entity,o=e.name,s=t.Landmark3D_Flyout_Text_Format.replace("{name}",o);this._infoboxOptions.location=new rt(f.toLatitude(u.x,u.y),f.toLongitude(u.x,u.y));this._infoboxOptions.htmlContent='<div class="bm_3dlandmark_flyout">'+s+"<\/div>";this._infoboxOptions.visible=!0;this._infoBox.setPrimitive(r);this._infoBox.setOptions(this._infoboxOptions);r.entity.changed.invoke();n._log("H",e.ypid)}},n.prototype._onPrimitiveHoverStopped=function(n){var t=n.primitive;t&&(t.image=li.getImageFromCss("bm_3dLandmarkIconNormal"),this._infoBox&&(this._infoboxOptions.visible=!1,this._infoBox.setOptions(this._infoboxOptions)),t.entity.changed.invoke())},n.Landmark3dPropsLength=6,n.Landmark3dPropsLengthWithYpid=7,n}(),ff=function(u){function o(n,i,f,o,s,h,c,l,a,v){var y=u.call(this,su,"bm_3dLandmarksViewerContainer",{onLandmarksFeedbackClick:function(n){y.activateFeedbackActivity(n)},onLandmarksShareClick:function(n){y.toggelShareLandmark3DPanel(n)},onShareCopyClick:function(){y.onShareCopyClick()},onShareCloseClick:function(){y.hideSharePanel()},boolToDisplay:function(n){return y.boolToDisplay(n)}})||this,p,b,w,d,k,g,nt;return y.defineProperty("lmk3DShareVisibility"),y.defineProperty("lmk3DShareInputVisibility"),y.defineProperty("lmk3DShareMsgVisibility"),y.feedbackDisplay=a,y.resources=t,p=r.features.landmarks3D,y.enableShare=p.enableShare,b=r.dynamicProperties,w=p.viewerUrlFormat,p.viewerUrlFormatWithVersion&&v&&(d=e._getUrlParam(window.location,"lmk3dver",!1),v=d||v,w=p.viewerUrlFormatWithVersion,w=w.replace("{version}",v)),k=encodeURIComponent(c),y.landmarksViewerUrl=w.replace("{sessionid}",n).replace("{latitude}",""+i).replace("{longitude}",""+f).replace("{elevation}",""+o).replace("{radius}",""+s).replace("{pitch}",""+h).replace("{name}",k).replace("{lang}",b.uiLanguage).replace("{rtl}",""+e._isRtl()),y._landmarkYpid=l,g=[i,f,o,s,h,k,l],nt=g.join("|"),y.landmarksViewerPermalink=p.shareLinkFormat.replace("{origin}",b.origin).replace("{latitude}",""+i).replace("{longitude}",""+f).replace("{props}",nt),y.hideSharePanel(),y}return y(o,u),o.prototype.CloseDialog=function(){u.prototype.CloseDialog.call(this);o.log("CLSM",this._landmarkYpid);document.querySelector("html").style["overscroll-behavior"]=""},o.log=function(n,t,r){var u=i.logger,f={feature:l.Landmark3D,action:n,data:{LN:t,CTX:r}};u.logObject(f)},o.prototype.activateFeedbackActivity=function(){this.CloseDialog();var n={title:t.Landmarks3DFeedbackTitle,activeTaskId:"",feedbackTaskType:2,entryPoint:9,queryables:{keywords:["3dlandmarks"]}};c.invokeHandler(h.taskDataHandlerKey,{type:f.feedbackTask,state:n})},o.prototype.toggelShareLandmark3DPanel=function(t){t.preventDefault();t.stopPropagation();var i=this.getLmk3DShareVisibility();i?this.hideSharePanel():(this.setLmk3DShareVisibility(!0),n(".bm_3dlmkShare .bm_sharePnlInput .bm_3dlmkShareUrlBtn")[0].focus())},o.prototype.onShareCopyClick=function(){var r=this,u=function(){setTimeout(function(){r.setLmk3DShareInputVisibility(!1);r.setLmk3DShareMsgVisibility(!0);n(".bm_3dlmkShare .bm_sharePnlMsg .bm_3dlmkShareUrlBtn")[0].focus()},500)},t=n("div.bm_3dlmkShare input.bm_3dlmkShareUrl")[0],i,f;t.focus();t.select();i=navigator.clipboard;i?i.writeText(t.value).then(u):(f=document.execCommand("copy"),f&&u());o.log("C",this._landmarkYpid,"Share")},o.prototype.hideSharePanel=function(){this.setLmk3DShareVisibility(!1);this.setLmk3DShareInputVisibility(!0);this.setLmk3DShareMsgVisibility(!1)},o}(ct),ei;(function(i){function g(t,u){var v=this,c,h;a||(a=!0,s=u,l=t,r=n("#b_TriviaOverlay"),e=0,i.serializableObjectChanged=new o,c=l.getContainer(),c.instanceAsync("BrowserHistoryManager",function(n){if(f=n,f)try{f.register("MktTourHelper",v)}catch(t){}},null,!0),h=r.select(".ulcSlides .slideImage"),h&&h.length>0&&(h.for_each(function(n){var i=n.getAttribute("data-task"),t;i&&(t=n.getAttribute("data-serpquery"),t||n.addEventListener("click",function(n){return nt(n)}))}),ut(),ft()),sj_cook.set("_SS","BTQID","-",!1,"/"),h&&k(h),ot(),sj_evt.bind("ovlShow",st))}function nt(n){var t=n.currentTarget,i,u,f;t.classList.contains("sldShown")||t.classList.contains("inactive")||(t.classList.add("sldShown"),e=Number(t.getAttribute("data-slideid")),p(),k(r.select(".ulcSlides .slideImage")),w(),b(t),y(),i=JSON.parse(t.getAttribute("data-task")),u=i&&i.state,c.invokeHandler(h.taskDataHandlerKey,i),f=u.query||u.taskTitle||u.title,v(f),d())}function tt(t){if(t!==null&&t.activeSlideId!=="undefined"&&t.activeSlideId>-1){var i=t.activeSlideId,u=r.select(".ulcSlides .slideImage");u.length>0&&(u.for_each(function(t){var r=Number(t.getAttribute("data-slideId"));r<=i?n(t).add_class("sldShown"):(n(t).remove_class("sldShown"),r>i+1&&n(t).add_class("inactive"))}),w(i),i>0&&y(),b(u[i]));e=i}}function it(){return{activeSlideId:e}}function rt(n){tt(n)}function ut(){var n=r.select(".nextULC .slideImage.btSINext");n&&n.length>0&&n.add_event("click",function(t){var f=_w.btULCinfo,o=n.get_attr("data-slideid"),s=Number(o),i,u;s===f.totalSlide?(t.preventDefault(),t.stopImmediatePropagation(),e=0,i=JSON.parse(n.get_attr("data-task")),i&&(p(),f.summaryPageUrl="",n.set_attr("data-url",""),c.invokeHandler(h.taskDataHandlerKey,i),v(""),et()),r.select("#rqCloseBtn").fireEvent("click")):(u=r.select(".btsImg"+n.get_attr("data-slideid")),u&&u.fireEvent("click"))})}function ft(){var n=r.select("#rqCloseBtn");n&&n.length>0&&n.add_event("click",function(){f&&f.unregister("MktTourHelper")})}function et(){var n=document.getElementById("maps_sb");n&&(n.placeholder=t.SearchGhostText,n.focus())}function v(n){var t=document.getElementById("maps_sb");t&&(t.value=n)}function y(){var n="_SS";sj_cook.set(n,"BTQID","-",!1,"/");sj_cook.set(n,"BTSID","-",!1,"/");sj_cook.set(n,"BTSlClk","-",!1,"/");sj_cook.set(n,"BTOID","-",!1,"/");sj_cook.set(n,"BTMC","-",!1,"/");sj_cook.set(n,"BTULCTtl","-",!1,"/")}function p(){s.removeAllStacks(!1)}function w(n){var i=r.select(".slideImage.btSINext"),f,t,e,u;i.length>0&&(n=n===null||n===undefined?Number(i.get_attr("data-slideid")):n,f=n+1,t=_w.btULCinfo,t&&(t.currentSlide=n,e=r.select(".btsImg"+f),u=r.select(".btULCTeaser"),i.set_attr("data-slideId",f.toString()),f===t.totalSlide?(u.length>0&&u.set_text(i.get_attr("data-title")),t.summaryPageUrl=i.get_attr("data-Url"),t.slideCompleted=!0):e.length>0&&u.length>0&&u.set_text(e.get_attr("title"))))}function b(n){var i=r.select(".bt_title"),t;i.set_text(n.getAttribute("data-title"));t=r.select(".bt_desc");t.set_text(n.getAttribute("data-description"))}function ot(){var t,i;r.select(".ulcSlides").set_style({width:"calc(100% - 280px)"});t=n("#b_footer");t&&t.length>0&&(i=n("ul",t[0]),i&&i.length>0&&t.insertBefore(r,i[0]));d()}function k(n){if(n.length!==0){var t=-1;n.for_each(function(n){n.classList.contains("sldShown")?t=Number(n.getAttribute("data-slideid")):Number(n.getAttribute("data-slideid"))-t>1?n.classList.contains("inactive")||n.classList.add("inactive"):n.classList.contains("inactive")&&n.classList.remove("inactive")})}}function d(){var t=n(".overlayPanel",r[0]),i;t&&t.length>0&&(t.set_style({"margin-top":"0","background-color":"#fafafa"}),u=t.get_style("height"),r.set_style({height:u}),i=n(".btOverlay",r[0]),i&&i.length>0&&i.set_style({bottom:"auto",height:u}))}function st(){var t,r,i,f;if(u&&(t=n(".ent_ovlc"),t&&t.length>0))for(r=0;r<t.length;r++)i=n(".ovl",t[r]),i&&i.length>0&&(i.set_style({bottom:u}),f=n("ovlbg",i[0]),f&&f.length>0&&f.set_style({bottom:u}))}var r,s,l,f,e,u,a;i.initialize=g;i.serialize=it;i.deserialize=rt})(ei||(ei={}));var b=function(){function n(){}return n.log=function(t,i,r){c.invokeHandler(h.instrumentationDataHandlerKey,{logData:{feature:n.Feature,action:t,data:i},flush:r})},n.Feature="PRT",n.Submit="S",n.Activate="A",n.Deactivate="D",n.TaskBar="T",n.Filter="FLTR",n.TaskCardHeader="H",n.TaskType="TYP",n.MapOnly="MO",n.TextOnly="TO",n.MapAndText="MAT",n}(),ef=function(u){function f(i){var r=this,e={},s=t,f={};return r=u.call(this,lu,"PrintContainer",f,e,s)||this,r._poiLayers=[],r._map=i,r._window=n(window),r.resources=s,r._printMapReady=!1,r._printDisplayOption=0,r.onPrintDialogClose=new o,r.onPrintDialogOpen=new o,r.generateContextMapUrl(),f.onPrintClick=function(n){return r._onPrintClick(n)},f.onCloseClick=function(n){return r._onCloseClick(n)},f.onMouseWheel=function(n){return r._onMouseWheel(n)},f.onMapTextClick=function(n){n.preventDefault();n.stopImmediatePropagation();r._toggleMapAndText(!0,!0,r.getRootElement().select(".printMapAndText"))},f.onMapOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();r._toggleMapAndText(!0,!1,r.getRootElement().select(".printMapOnly"))},f.onTextOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();r._toggleMapAndText(!1,!0,r.getRootElement().select(".printTextOnly"))},r.notesMaxCharSize=ft.notesMaxChars,e.defineProperty("printContentList"),r.setPrintContentList(new ni),r}return y(f,u),f.prototype.loadPrintMap=function(){var t=this,r,f;u.prototype.OpenDialog.call(this);r=this.getRootElement();f=r.getParent().select(".defaultPrintMessage");f.swap_class("showPrintErrorMessage","hidePrintErrorMessage");r.select(".PrintContainer").set_attr("data-tag","PrintContainer");this._hasPrintableTasks=this._getPrintTasksAvailable();this._hasPrintableTasks&&(n(".PrintContainer .baseMapPrint").removeFromParent(),this._addPrintPreviewContent());this._mapHolder=n(".PrintContainer .printMap");dt.instance.authenticateClientAndRetrieveSessionId(function(n){var r={mapType:t._map.getMapType().id===p.roadDark?p.road:t._map.getMapType().id,zoom:t._map.getMercatorZoomLevel(),sessionKey:n,credentials:"",navigationOptions:{lockCameraAltitude:!1,lockCameraHeading:!0},enableInertia:!1,disableDiffFrame:!0,showLandmarks:!0,disableRetiredLandmarks:!0,isPrintMode:!0,showLogo:!0,showLocateMeButton:!1,disableStreetside:!0,disableStreetsideAutoCoverage:!0,labelOptions:{labelVisibility:t._map.getLabelController().getIsLabelsEnabled()?ki.visible:ki.hidden},heading:t._map.getView().heading};i.loadMap({element:t._mapHolder,mapOptions:r},function(n){return t._finishPrintMapSetup(n)},!0)})},f.prototype.addPrintContent=function(n){n&&this.getPrintContentList().insert(n)},f.prototype.setDialogSize=function(n){if(n.height&&n.width){var t=this.getRootElement();t.select(".printContent").set_style({height:(n.height>f.BaseMapHeaderFooterPadding?n.height-f.BaseMapHeaderFooterPadding:0)+"px"})}},f.prototype.onWindowResize=function(){this.setDialogSize(new bi(window.innerWidth,window.innerHeight))},f.prototype._onMouseWheel=function(n){this._mapEditOn&&n.preventDefault();n.stopPropagation()},f.prototype._toggleMapAndText=function(n,t,i){var r=this.getRootElement(),u;r.select(".isMap").swap_class(n?"hideMap":"showMap",n?"showMap":"hideMap");r.select(".isText").swap_class(t?"hideText":"showText",t?"showText":"hideText");u=n&&!t;r.select(".taskMapPrint").swap_class(u?"taskMapPrintPageBreak":"taskMapPrintNoPageBreak",u?"taskMapPrintNoPageBreak":"taskMapPrintPageBreak");this.getRootElement().select(".mapTextOptions").remove_class("selected");i.add_class("selected");this._printDisplayOption=n?t?0:1:2;b.log(b.Filter,{CLK:n?t?b.MapAndText:b.MapOnly:b.TextOnly})},f.prototype._finishPrintMapSetup=function(t){var r=this,h,f,e,s,c,o,u;this._printMiniMap=t;h=k.getMapCenter(this._map);f=k.getMercatorZoomLevel(this._map);this._map.getMapType().id!==p.birdseye&&(f=f>2&&this._hasPrintableTasks?f-1:f);this._printMiniMap=t;this.disposables.push(this._printMiniMap);this._printMiniMap.setDesiredSize({width:-1,height:-1});this._printMiniMap.setView(new pr(i.ZoomLevel.toLocation(h,f,!0),this._map.getView().heading),null);this._showMiniMapNavigationBar(!1);e=this.getRootElement();s=this._hasPrintableTasks?"taskMap":"baseMap";e.select(".printMap").add_class(s);e.select(".printArea").add_class(s);this.setDialogSize(new bi(window.innerWidth,window.innerHeight));this._windowSizeHandler=function(){return r.onWindowResize()};this._window.add_event("resize",this._windowSizeHandler);e.select(".printContent")[0].scrollTop=0;n(".mapAndTextPrint").set_style({display:this._hasPrintableTasks?"inline":"none"});c=t.getContainer();c.instanceAsync("MapInteraction",function(n){r._mapInteraction=n;n.setOptions({disableAllInteractions:!0});n.disableInteractionModes(704)});n(".taskPrintContent").add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0});this._printMiniMap.getOverlayManager().then(function(){var e,o,t,i,u,n,f;for(r._updateLandmarkClickBehavior(),e=r.getPrintContentList(),o=r.getRootElement().select(".taskPrintContent"),t=0;t<e.length;t++){for(i=e[t],r._hasPrintableTasks||r._addContentToDom(i,o,t),u=i.getLayers(),n=0;u&&n<u.length;n++)r._addLayer(u[n]);for(f=i.getLayerIds(),n=0;f&&n<f.length;n++)r.addLayerPois(f[n])}r.onPrintDialogOpen.invoke();r._printMapReady=!0;r._addEditButton();r._isPrinted=!1});this._hasPrintableTasks?(o=n(".printMapAndText"),o&&o.length>0?o[0].focus():(u=n(".waypointNotes")?n(".waypointNotes"):n(".searchNotes")?n(".searchNotes"):n("#baseMapNotes"),u&&u.length>0&&u[0].focus())):(u=n("#baseMapNotes"),u&&u.length>0&&u[0].focus())},f.prototype.generateContextMapUrl=function(){var i=ft.printImgOverviewMapUrlFormat,t=k.getMapCenter(this._map),u=dt.instance.getSessionId(),n=k.getMercatorZoomLevel(this._map);n=n>4?n-2:ft.minZoomLevel;this.overviewContextMap=i.replace("{credentials}",u).replace("{zoom}",n.toString()).replace("{lat}",t.latitude.toString()).replace("{lon}",t.longitude.toString()).replace("{cmnPltParam}",r.platformCommonParam)},f.prototype._addEditButton=function(){var u=this,r=this.getRootElement().select(".printArea"),t,n,i;r&&(t=e._createElement("div"),t.add_class("bm_mapEditButton"),t.set_attr("data-tag","mapEditButton"),n=e._createElement("a"),n.add_class("textButton"),n.set_attr("href","#"),n.set_attr("role","button"),n.set_attr("data-tag","editButton"),n[0].innerHTML=this.resources.L_EditMap_Text,t.append(n),i=this.getRootElement().select(".printMap"),i&&i.length>0?r[0].insertBefore(t[0],i[0]):r.append(t),n.add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0;u._toggleEditMap(n)}))},f.prototype._toggleEditMap=function(n){this._mapEditOn=n.target.innerHTML===this.resources.L_EditMap_Text;n.target.innerHTML=this._mapEditOn?this.resources.L_EditMapDone_Text:this.resources.L_EditMap_Text;this._mapInteraction.setOptions({disableAllInteractions:!this._mapEditOn});this._showMiniMapNavigationBar(this._mapEditOn)},f.prototype._addPrintPreviewContent=function(){for(var i=this.getPrintContentList(),r=this.getRootElement().select(".taskPrintContent"),t=0;t<i.length;t++)this._addContentToDom(i[t],r,t);n(".svg",this.getRootElement()[0]).inlineDataSvgs().remove_class("svg")},f.prototype._addContentToDom=function(n,t,i){var u=n&&n.getHtmlContent(),f=n&&n.getCssScope(),r;u&&(r=e._createElement("div"),r.add_class(i==0?"bm_firstTaskContent":"bm_taskContent"),r.set_attr("data-tag","taskContent-"+i),f&&r.add_class(f),r[0].innerHTML=u,t.append(r))},f.prototype._getPrintTasksAvailable=function(){for(var t=this.getPrintContentList(),n=0;n<t.length;n++)if(t[n].getHtmlContent()!=null)return!0;return!1},f.prototype._updateLandmarkClickBehavior=function(){this._printMiniMap.getLandmarksManager().then(function(n){n.removePrimitiveTapped();n.removePrimitiveHover()})},f.prototype._addLayer=function(n){if(n){var t=this._printMiniMap.getLayers();t.insert(n);this._poiLayers.push(n)}},f.prototype.addLayerPois=function(n){var r=this._printMiniMap.getLayers(),t=wt.getMapLayerById(n,this._map),s=t.getZIndex(),u,o,h,e,i;if(t.getVisible()&&n!=="Microsoft.Maps.StreetsideCoverage")if(t instanceof vt){for(u=0;u<r.length;u++)if(o=r[u],o&&o.getId()===n)return;h=t;e=new vt(f.PrintLayerPrefix+t.getId(),h.getDataSource(),t.getTemplateSelector(),s);e.setRenderTarget(t.getRenderTarget());r.insert(e);this._poiLayers.push(e)}else if(t instanceof kt){var a=t,c=this._map.getView(),l=a.getScene(null,k.getMapCenter(this._map),yt.toScale(c.cameraLocation,yt.fromLocation(c.cameraLocation,!0),!0),0);l!=null&&(i=new kt(f.PrintLayerPrefix+t.getId(),s),i.setRenderTarget(t.getRenderTarget()),i.addScene(10,l,0),r.insert(i),this._poiLayers.push(i))}},f.prototype._removeLayerPois=function(){for(var t=this._printMiniMap.getLayers(),n=this._poiLayers.pop();n;)t.remove(n),n.dispose(),n=this._poiLayers.pop()},f.prototype._showMiniMapNavigationBar=function(n){var r=this,t=this._printMiniMap.getNavigationBar(),i;t?n?(t.setVisible(!0),t.setRotateButtonVisible(!1),t.setMapStyleSelectorControlVisible(!1),t.setLocateMeButtonVisible(!1),i=t.getZoomControl()?t.getZoomControl().zoomInButton:null,i&&i.getRootElement()[0].focus()):t.setVisible(!1):this._printMiniMap.navigationBarLoaded.addOne(function(){return r._showMiniMapNavigationBar(n)})},f.prototype._onPrintClick=function(n){(n.preventDefault(),this._printMapReady)&&(this.prepareForPrint(),window.print(),b.log(b.Submit,{NUM_TASKS:this.getPrintContentList().length,FLTR:this._printDisplayOption==2?b.TextOnly:this._printDisplayOption==1?b.MapOnly:b.MapAndText}),ft.dialogOpenAfterPrint?this._isPrinted=!0:(this.revertPrintSetup(),this._closeDialog()))},f.prototype._onCloseClick=function(n){if(n.preventDefault(),b.log(b.Deactivate),this._isPrinted&&ft.dialogOpenAfterPrint&&(this._isPrinted=!1,this.revertPrintSetup()),ft.dialogOpenAfterPrint){var t=document.getElementsByName("viewport")[0];t&&t.setAttribute("content","user-scalable=no, width=device-width, maximum-scale=1.0")}this._closeDialog()},f.prototype._closeDialog=function(){var n=this.getRootElement(),t=n.getParent().select(".defaultPrintMessage");t.swap_class("hidePrintErrorMessage","showPrintErrorMessage");this._mapInteraction.setOptions({disableAllInteractions:!1});n&&(n.select(".printMap").clear(),n.select(".taskPrintContent").clear());this.onPrintDialogClose.invoke();this.CloseDialog();this.dispose()},f.prototype.prepareForPrint=function(){var t=this.getRootElement(),i=t.select(".screenNotes textarea")[0],r=t.select(".printedNotes")[0];i&&r&&(r.innerHTML=n.Internals.HTMLEncode(i.value).replace(/\n/g,"<BR>"));this._printDisplayOption==2&&(this._removeLayerPois(),t.select(".isMap").removeFromParent());n("#bingLogo").inlineDataSvgs().remove_attr("height").remove_attr("width").set_attr("viewBox","50 0 92 92")},f.prototype.revertPrintSetup=function(){var t=this.getRootElement(),n=t.select(".printedNotes")[0];n&&(n.innerHTML="")},f.prototype.dispose=function(){this._printMiniMap.dispose();this._windowSizeHandler&&(this._window.remove_event("resize",this._windowSizeHandler),this._windowSizeHandler=null);u.prototype.dispose.call(this)},f.BaseMapHeaderFooterPadding=136,f.PrintLayerPrefix="Print_",f}(ct),wt=function(){function t(i,r){this._map=i;this._taskManager=r;t.onPrintDialogClose=new o;t.onPrintDialogOpen=new o;n(window).add_event("keydown",function(n){n.keyCode===27&&t.onPrintDialogClose.invoke()})}return t.prototype.showPrintDialog=function(n){var u,r,i;n&&(u=window.matchMedia("(orientation: portrait)"),ft.dialogOpenAfterPrint&&u&&(r=document.getElementsByName("viewport")[0],r&&r.setAttribute("content","user-scalable=no, maximum-scale=1.0")),i=new ef(this._map),i.onPrintDialogClose.addOne(function(){return t.onPrintDialogClose.invoke()}),i.onPrintDialogOpen.addOne(function(){return t.onPrintDialogOpen.invoke()}),this._createPrintContent(i,n),i.loadPrintMap(),b.log(b.Activate,{EP:n.source==1?b.TaskBar:b.TaskCardHeader,TYP:n.taskType?n.taskType:"",CD:n.data}))},t.getMapLayerById=function(n,t){for(var r=t.getLayers(),i=0;i<r.length;i++)if(n===r[i].getId())return r[i]},t.prototype._createPrintContent=function(n,t){var r,f,i;if(t.source==2&&t.taskId)r=this._taskManager.getTaskById(t.taskId),r&&r.hasPrintContent()&&n.addPrintContent(r.getPrintContent());else{var u=null,h=this._taskManager.getFocusedStack(),e=h&&h.getForegroundTask();e&&e.hasPrintContent()&&(u=e.getPrintContent(),n.addPrintContent(u));var o=new ni,c=this._map.getLayers(),s=u&&u.getLayerIds();for(f=0;f<c.length;f++)if(i=c[f],i instanceof vt||i instanceof kt){if(s&&s.length>0&&s[0]===i.getId()||i.getId().indexOf("TrafficIncidents")>=0)continue;o.insert(i.getId())}o.length>0&&n.addPrintContent(new kr(null,o))}},t}(),sf=function(n){function t(t,i,r){var f=this,u={};return f=n.call(this,u)||this,u.defineProperty("name"),u.defineProperty("isSelected"),u.defineProperty("taskAriaLabel"),u.defineProperty("index"),u.defineProperty("icon"),f.setName(t),f.setIsSelected(i),f.setTaskAriaLabel(r),f}return y(t,n),t}(gt),hf=function(i){function r(){var r=this,u={},f;return r=i.call(this,u)||this,r._privates=u,u.defineProperty("sharingLinkAvailable",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("permalinkString",null,null,{defaultValue:t.L_Link_Generating_Text,isPrivate:!0}),u.defineProperty("isShortPermalinkDisplayed",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("errorMessage",null,null,{defaultValue:"",isPrivate:!0}),u.defineProperty("enableSharingVisibility",null,null,{defaultValue:d.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),u.defineProperty("hasAtLeastOneSharableStack",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("enableSocialSharing",null,null,{defaultValue:d.isEnableSocialSharing,isPrivate:!0}),u.defineProperty("taskList"),u.defineProperty("titleText",null,null,{defaultValue:t.L_Permalink_Prompt}),r.setTaskList([]),r.controlUpdated=new o,f={availableToLinkClass:function(n){return n?"":"nonClickable"},availableToShareButtonClass:function(n){return n?"shareButton":"shareButton nonClickable"},availableToButtonClass:function(n){return n?"textButton":" textButton nonClickable"},displayStateToLinkText:function(n){return n?t.L_LengthenButton_Text:t.L_ShortenButton_Text},errorMessageToVisibility:function(n){return n&&n.length>0?"visible":"hidden"},errorMessageToNotDisplay:function(n){return n&&n.length>0?"none":""},boolToDisplay:function(n){return n?"":"none"},boolToNotDisplay:function(n){return n?"none":""},boolToVisibility:function(n){return n?"visible":"hidden"},onDlgKeydown:function(n){var t=n,i=t.keyCode||t.which;i===27&&r._rootElement.select("*[data-tag='Share.CloseButton']")[0].click()},resources:t},r.setTemplate(new it(au,f)),r._keydownEventHandler=function(n){return r._onKeydownEvent(n)},n(".taskLayoutContainer").add_event("keydown",r._keydownEventHandler),r.rendered.addOne(function(n){var i=n||r,t;r._rootElement=i.getRootElement();t=document.execCommand&&typeof document.execCommand("copy")=="boolean";t||r._rootElement.select("a[data-tag='Share.Copy']").set_style({visibility:"hidden"})}),r.dataContext=r,r._lvlParam="",r._cpParam="",r._setTwitterUrl(""),r._setFacebookUrl(""),r}return y(r,i),r.prototype.toggleLinkLength=function(n){this._isDisposed||(n.preventDefault(),this.getIsShortPermalinkDisplayed()?this._updateLongPermalink():this._updateShortPermalink())},r.prototype.titleTextSelection=function(n){return n&&n.length>0?t.ShareHeaderTitle:t.L_Permalink_Prompt},r.prototype.copyToClipboard=function(n){this._isDisposed||(n.preventDefault(),this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select(),document.execCommand("copy"))},r.prototype.urlBoxClick=function(n){n.preventDefault();this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()},r.prototype.openEmbedPage=function(n){if(!this._isDisposed){n.preventDefault();var t=d.embedPageUrl;this._lvlParam.length>0&&(t+="&"+this._lvlParam);this._cpParam.length>0&&(t+="&"+this._cpParam);t+="&form=LMLTEW";window.open(t,"EmbeddedMap");this._logEmbed(t)}},r.prototype.openEmail=function(n){var u=this,o,s,e,p,h,c,l,a;if(!this._isDisposed){n.preventDefault();o=t.L_Link_EmailTitleManyCards_Text;s=this._getOneCardShared();s!=null&&(o="Bing Maps: "+s.getTitle());var i="{0}\n",v=this._taskManager.getStacks(),f,r,y=0;for(e=0,p=v.length;e<p;e++)f=v[e],f&&f.getIsSelected()&&(r=f.getForegroundTask())&&(i+="{bullet}{0}\n".replace("{0}",r.getTitle()),(r.type==="LocalDetailsTask"||r.type==="PolygonEntityDetailsTask")&&(h=r.getOriginalName(),h&&(i+="{bullet}{0}\n".replace("{0}",h)),c=r.getNotes(),c&&(i+="{bullet}{0}\n".replace("{0}",c))),y++);i=i.replace(/{bullet}/g,y>1?" - ":"");i+="\n "+t.L_Link_EmailFooter_Text;l="mailto:?subject={0}&body={1}".replace("{0}",encodeURIComponent(o));a=function(){u._permalink.getCurrentLink(u._map,function(n){u._openEmail(n,l,i)},function(){window.console.log("Could not update permalink on the server, hence not showing email popup for stale content.")})};this.getIsShortPermalinkDisplayed()?this._permalink.shorten(function(n){u._openEmail(n,l,i)},a):a()}},r.prototype.openFacebook=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getFacebookUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,1))}},r.prototype.openTwitter=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getTwitterUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,2))}},r.prototype.setInitialData=function(n){var t=this;n.container&&(this._container=n.container,this._container&&!this._taskManager&&this._container.instanceAsyncAll([{name:"TaskManager"}],function(n){t._taskManager=n.TaskManager}))},r.prototype.onSelectionChanged=function(n,t){if(!this._isDisposed&&this._selectedPermalinkParts&&this._selectedPermalinkParts[n]){if(this._selectedPermalinkParts[n].isEnabled=t,this._updateTaskListData(),d.isShorteningEnabled){var i=this._permalink.isShorteningAvailable();this._privates.setEnableSharingVisibility(i?"visible":"hidden");this._privates.setEnableSocialSharing(d.isEnableSocialSharing)}this._updateLongPermalink()}},r.prototype.refresh=function(){var n=this;if(!this._container)throw new Error("SharePanel cannot work without access to container");this._setState(1);this._permalink&&this._taskManager?this._recomputePanelDataAndUX():this._container.instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"},{name:"Map"},{name:"ShareDataHandler"}],function(t){n._permalink=t.Permalink;n._taskManager=t.TaskManager;n._map=t.Map;n._currentSharingOptions=t.ShareDataHandler.currentSharingOptions;t.ShareDataHandler.currentSharingOptions=null;n._permalink.getGeneralPermalink(n._map,function(){return n._recomputePanelDataAndUX()},function(){n._resetSharePanelUX();n._setState(3)},n._currentSharingOptions.entryPoint)})},r.prototype._addTaskListData=function(){var n,f,e,i,o,r,u;if(this._taskManager&&(n=this._taskManager.getStacks(),n&&n.length>0)){for(f=[],e=-1,i=0,o=n.length;i<o;i++)r=n[i].getForegroundTask(),r&&r.isSharable()&&(r.type!=="CollectionsTask"||r.isPublicCollection&&r.isPublicCollection())&&(e+=1,u=new sf(r.getTitle(),n[i].getIsSelected(),n[i].getIsSelected()?t.ClickToUnselect:t.ClickToSelect),u.stackId=n[i].id,u.setIcon(r.getCardIconInfo()),u.taskId=n[i].getFirstTask().id,u.setIndex(e),f.push(u));f.length>0&&(this.setTaskList([]),this.setTaskList(f),this._buildTaskList(this.getTaskList()))}},r.prototype._buildTaskList=function(t){var a=this,u,v,h,i,r,f,o,b,p,w,s;if(t.length>0&&(u=n(".taskListContainer"),u.length>0)){if(u[0].childNodes.length>0)for(v=u[0].childNodes,h=v.length-1;h>=0;h--)u[0].removeChild(v[h]);for(i=0;i<t.length;i++){var y=t[i],c=y.getIsSelected(),l=e._createElement("li");l.add_class("taskCheckListItem"+i);l.set_attr("data-index",y.getIndex().toString());r=e._createElement("div");r.add_class("taskItem");r.add_class(c?"selected":"unselected");f=e._createElement("div");o=y.getIcon();o.iconElements?(f.append(o.iconElements[0]),f.add_class("catIcon")):(b="titleIcon",f.add_class(o.iconClass?o.iconClass:"srcTsk"),f.add_class(b));p=this._taskManager.getStackById(t[i].stackId);p&&this._setIconBackgroundColor(p,r,n(".taskList"));w=e._createElement("label");w.add_class("taskItemLabel").set_text(t[i].getName());s=e._createElement("input");s.add_class("taskItemCheckbox").add_class(c?"checked":"").set_attr("type","checkbox").set_attr("role","checkbox").set_attr("aria-label",t[i].getTaskAriaLabel()).set_attr("aria-checked",c?"true":"false");s[0].defaultChecked=c;s.add_event("change",function(t){var f,s,v,u,c,h,e;if(t&&a._taskManager){t.preventDefault();t.stopPropagation();var l="taskCheckListItem",i=n(t.target),r=i.get_ancestor(2),o=r.length>0&&r[0].className;if(o&&o.indexOf(l)>-1){if(f=Number(r.get_attr("data-index")),isNaN(f)&&(s=o.slice(l.length,o.length),f=s.indexOf(" ")>0?Number(s.split(" ")[0]):Number(s),isNaN(f)))return;v=a.getTaskList();u=v[f];u.setIsSelected(!u.getIsSelected());c=a._taskManager.getStackById(u.stackId);c&&(h=u.getIsSelected(),c.setIsSelected(u.getIsSelected()),e=n(r[0].childElementCount>0?n(r[0].children[0]):r),h&&e.has_class("unselected")?(n.Browser.is_ie&&n.Browser.ie_version<12?i[0].setAttribute("checked","checked"):i[0].checked=!0,e.remove_class("unselected").add_class("selected")):!h&&e.has_class("selected")&&(e.add_class("unselected").remove_class("selected"),n.Browser.is_ie&&n.Browser.ie_version<12?i[0].removeAttribute("checked"):i[0].checked=!1),i.set_attr("aria-checked",h?"true":"false"))}}});r[0].appendChild(f[0]);r[0].appendChild(w[0]);r[0].appendChild(s[0]);l[0].appendChild(r[0]);u[0].appendChild(l[0])}}},r.prototype._updateTaskListData=function(){var n=this;this.setTaskList([]);this._addTaskListData();Microsoft.Maps.setTimeout(function(){n.controlUpdated.invoke({state:n._currentState,control:n})},100)},r.prototype._setIconBackgroundColor=function(n,t,i){var u=this,r=n.getForegroundTask();r&&r.getIconColorAndClassName&&r.getIconColorAndClassName(function(f,e){var o=u._getCardClass(n),s;f&&e&&e!==o&&(s=r.getCardIconInfo(),o&&u.getRootElement().select(".taskItem").remove_class(o),o=e,t.add_class(u._appendCssForBackground(e,f,s&&s.iconClass?s.iconClass:"srcTsk",i)))})},r.prototype._getCardClass=function(t){var u=n(".PanelWrapper"),i=u&&u.select("[data-taskId='"+t.id+"']")[0].className,r;return t&&t.displayState&&(r="ac"+t.displayState.colorIndex,i.indexOf(r)===-1&&(i+=" "+r)),i},r.prototype._appendCssForBackground=function(n,t,i,r){if(n&&t){var u=this._createCssForBackground(n,t,i);return r.length>0?r[0].appendChild(u):this.getRootElement().append(u),n}},r.prototype._createCssForBackground=function(n,t,i){var r=document.createElement("style"),u,f;return r.type="text/css",u=".MicrosoftMap .bm_sharePanel .taskItem.",f="".concat(u).concat(n," .catIcon,\n                    ").concat(u).concat(n," .").concat(i,".titleIcon\n                    {background-color:").concat(t,"}"),r.innerHTML=f,r},r.prototype._setTwitterUrl=function(n){this._twitterUrl=n},r.prototype._getTwitterUrl=function(){return this._twitterUrl},r.prototype._setFacebookUrl=function(n){this._facebookUrl=n},r.prototype._getFacebookUrl=function(){return this._facebookUrl},r.prototype._onKeydownEvent=function(t){var i=t,f=i.keyCode||i.which,r,u;f===9&&(r=this.getFirstTabbableChild(n(".taskLayoutContainer")[0]),u=this._rootElement.select("*[data-tag='Share.Email']")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},r.prototype._trimEmailBodyIfNecessary=function(n,i,r){var u=i.replace("{0}",r),f=n.length+encodeURIComponent(u).length-3,e;return f>=g.maxIeUrlLength&&(e=f+t.L_Link_EmailFooter_Text.length+10-g.maxIeUrlLength,u=u.substr(0,u.length-e)+(" ...\n\n "+t.L_Link_EmailFooter_Text)),u},r.prototype._getOneCardShared=function(){for(var n,r=this._taskManager.getStacks(),t=null,i=0,u=r.length;i<u;i++)if(n=r[i],n&&n.getIsSelected()){if(t!=null)return null;t=n.getForegroundTask()}return t},r.prototype._recomputePanelDataAndUX=function(){var n=this;this._setState(1);this._recomputeDataModel(function(){n._resetSharePanelUX();d.isShorteningEnabled?n._updateShortPermalink():n._updateLongPermalink();var t=n._rootElement.select("*[data-tag='Share.UrlBox']")[0];t.focus();t.select()})},r.prototype.dispose=function(){i.prototype.dispose.call(this);n(".taskLayoutContainer").remove_event("keydown",this._keydownEventHandler);var t=Microsoft.Maps.GlobalConfig.features.taskBar,r=n(".bm_searchBoxNavLeft");this._selectedPermalinkParts=null;this._taskManager=null;this._permalink=null;this._isDisposed=!0},r.prototype._recomputeDataModel=function(n){function h(n,t,i){n._permalink.getCurrentLink(n._map,function(u){var c,e,o,f,l,a,s;if(u&&u.length>=g.maxAllowedSharingLinkLength){c=n._findFarthestTaskId();n._selectedPermalinkParts[c].isEnabled=!1;h(n,!0,i);return}for(e=n._taskManager.getStacks(),o=n._taskManager.getFocusedStack(),f=0,l=e.length;f<l;f++)a=e[f].getForegroundTask().id,s=n._selectedPermalinkParts[a],e[f].setIsSelected(s&&s.isEnabled);o&&n._taskManager.focusTask(o.getForegroundTask().id);t==!0&&r.logError(u,3);i&&i()},function(){n._setState(3)})}var u,e,t,f,i,o;if(this._selectedPermalinkParts=this._permalink.getPermalinkParts(),this._currentSharingOptions&&this._currentSharingOptions.taskIds&&this._currentSharingOptions.taskIds.length>0)for(var s=Object.keys(this._selectedPermalinkParts),f=s.length,t=0;t<f;t++)u=s[t],this._currentSharingOptions.taskIds.indexOf(u)<0&&u!=g.osidQueryParamName&&(this._selectedPermalinkParts[u].isEnabled=!1);for(e=this._taskManager.getStacks(),t=0,f=e.length;t<f;t++)i=e[t].getForegroundTask(),!i||i.isSharable()&&(i.type!=="CollectionsTask"||i.isPublicCollection())||(o=this._selectedPermalinkParts[i.id],o&&(o.isEnabled=!1));h(this,!1,n)},r.prototype._findFarthestTaskId=function(){for(var u,n=this._taskManager.getStacks(),o=this._taskManager.getFocusedStack(),e=0,t=0,s=n.length;t<s;t++)if(n[t]===o){e=t;break}for(var i=n.length-1,r=0,f=n[i].getForegroundTask().id;i>=e&&!this._selectedPermalinkParts[f]||!this._selectedPermalinkParts[f].isEnabled;)i--,f=n[i].getForegroundTask().id;for(u=n[r].getForegroundTask().id;r<=e&&!this._selectedPermalinkParts[u]||!this._selectedPermalinkParts[u].isEnabled;)r++,u=n[r].getForegroundTask().id;return t-r>i-t?u:f},r.prototype._resetSharePanelUX=function(){var f,r,i,e,u,t;if(this._privates.setHasAtLeastOneSharableStack(!1),this._rootElement.select(".svg").inlineDataSvgs().remove_class("svg"),this._setLightOrDark(this._map.getMode().mapModeType),f=this._map.getMode(),f.mapModeType===0)for(r=this._taskManager.getStacks(),i=0,e=r.length;i<e;i++)if(u=r[i],u&&(t=u.getForegroundTask())&&t.isSharable())if(t.type!=="CollectionsTask"||t.isPublicCollection&&t.isPublicCollection()){this._privates.setHasAtLeastOneSharableStack(!0);break}else this._privates.setHasAtLeastOneSharableStack(!1);this._updateTaskListData();this._showOrHideScroll();this.setTitleText(this.titleTextSelection(this.getTaskList()));n(".taskLayoutContainer").select(".cardTitleText").set_attr("tabindex","-1")},r._getStackIndex=function(n,t,i){for(var u,r=0,f=t.length;r<f;r++)if(u=t[r],u&&(n!==null&&n===u.id||i!==null&&u.getForegroundTask().id===i))return r;return-1},r.prototype._updateLongPermalink=function(){var n=this;if(this._setState(1),this._selectedPermalinkParts===null){this.refresh();return}this._permalink.getCurrentLink(this._map,function(t){t.length>=g.maxAllowedSharingLinkLength?(n._setState(2),r.logError(t,2)):(ci.getFunctionalTestHooksEnabled()?n._privates.setPermalinkString("Test result"):(n._privates.setPermalinkString(t),n._setTempParamValues(t),n._createSocialMediaLink(t)),n._privates.setIsShortPermalinkDisplayed(!1),n._setState(0))},function(){ci.getFunctionalTestHooksEnabled()?n._privates.setPermalinkString("Test result"):(n._setState(3),r.logError("",4))})},r.prototype._updateShortPermalink=function(){var n=this;this._currentState!=2&&(this._setState(1),this._permalink.shorten(function(t,i){n._privates.setEnableSharingVisibility("visible");n._privates.setIsShortPermalinkDisplayed(!0);n._privates.setPermalinkString(t);n._createSocialMediaLink(t);i&&n._setTempParamValues(i);n._setState(0)},function(){n._privates.setEnableSharingVisibility("hidden");n._updateLongPermalink();r.logError("",1)}))},r.prototype._setState=function(n){this._currentState=n;switch(n){case 0:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!0);this._privates.setEnableSocialSharing(d.isEnableSocialSharing);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select();break;case 1:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString(t.L_Link_Generating_Text);break;case 2:this._privates.setSharingLinkAvailable(!1);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setPermalinkString("");this._privates.setErrorMessage(t.L_Link_TooManyItemsSelected_Text);this._privates.setEnableSocialSharing(!1);break;default:this._privates.setErrorMessage(t.L_Link_GenerationFailed_Text);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString("");this._privates.setEnableSocialSharing(!1);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()}this.controlUpdated.invoke({state:n,control:this})},r.prototype._logEmail=function(n){var t={PL:n};g.instLog(et.EC,t)},r.prototype._logEmbed=function(n){var t={PL:n};g.instLog(et.EMC,t)},r.prototype._logSocialMedia=function(n,t){var i={PL:n},r=t==1?et.FB:et.TW;g.instLog(r,i)},r.logError=function(n,t){var i={PL:n,ERR:t};g.instLog(et.SEW,i)},r.prototype._setLightOrDark=function(n){var i=!0,r=this._rootElement.select(".header"),u="dark",t;n===0&&(t=this._map.getMapType().id,i=t===p.aerial||t===p.birdseye);i?r.add_class(u):r.remove_class(u)},r.prototype._setTempParamValues=function(n){var t=/lvl=([^&]*)/ig.exec(n),i=/cp=([^&]*)/ig.exec(n),r=/style=[o|b]&/ig.exec(n);t&&t.length&&(this._lvlParam=t[0]);i&&i.length&&(this._cpParam=i[0])},r.prototype._createSocialMediaLink=function(n){var t,i;n?(t=d.twitterShareUrl.replace("{text}","").replace("{related}",encodeURIComponent("BingMaps,Bing")),this._setTwitterUrl(t.replace("{url}",encodeURIComponent(n))),i=d.facebookShareUrl.replace("{facebookpage}",encodeURIComponent(d.facebookRedirectUrl)),this._setFacebookUrl(i.replace("{url}",encodeURIComponent(n)))):this._privates.setEnableSocialSharing(!1)},r.prototype._getPopUpOptions=function(){var n=(screen.availWidth-r._popupWidth)/2,t=(screen.availHeight-r._popupHeight)/2;return"width="+r._popupWidth+",height="+r._popupHeight+",screenX="+n+",screenY="+t+",left="+n+",top="+t+",status,scrollbars,resizable"},r.prototype._openEmail=function(n,t,i){i=this._trimEmailBodyIfNecessary(t,i,n);this._logEmail(n);window.location.href=t.replace("{1}",encodeURIComponent(i))},r.prototype._showOrHideScroll=function(){var i=n("#b_footer"),u;if(i.length>0){var f=i[0].getBoundingClientRect().top,r=n(".linkBox",this.getRootElement[0]),t=n(".panelWrapper");if(r.length>0&&t.length>0){if(u=r[0].getBoundingClientRect().bottom,u>=f){t.set_style({"overflow-y":"auto"});return}t.set_style({"overflow-y":""})}}},r._minEmbedHeight=530,r._minEmbedWidth=800,r._popupWidth=550,r._popupHeight=420,r}(ut);it.registerControl("SharePanel",hf);var cf=function(t){function i(n,i,r,u){var f=this,e={};return f=t.call(this,vu,"shareContainer",{emailClick:function(n){return f._onEmailClick(n)},shortenClick:function(n){return f._onShortenClick(n)}},e)||this,e.defineProperty("permalinkString"),e.defineProperty("shortenButtonText"),f._permalink=u,f._map=n,f._taskManager=r,f.setPermalinkString(f.resources.L_Link_Generating_Text),f.setShortenButtonText(f.resources.L_ShortenButton_Text),f._isShortLinkDisplayed=!1,f.getRootElement().set_attr("data-tag","Share.Container"),f}return y(i,t),i.prototype._onPermalinkSuccess=function(t){d.isShorteningEnabled&&t.queryParameters?(n(".shareUrlShortenLink").add_class("visible"),this._permalinkResponse=t,this._makeShortenRequest(t)):this.setPermalinkString(t.permalink)},i.prototype._onPermalinkFail=function(){this.setPermalinkString(this.resources.L_Link_GenerationFailed_Text)},i.prototype._makeShortenRequest=function(n){var t=this,i=n.queryParameters,r;i.charAt(0)==="?"&&(i=n.queryParameters.substr(1));r=g.getShortenServiceUrl(i);ot.downloadJson(r,"sharedlg",function(n){t._shortPermalink=n.d;t._onShortenClick(null)},function(){t.setShortenButtonText(t.resources.L_ShortenButton_Text);t.setPermalinkString(t._permalinkResponse.permalink);t._isShortLinkDisplayed=!1})},i.prototype._onEmailClick=function(n){n&&n.preventDefault&&n.preventDefault();var t=this.getPermalinkString(),i={PL:t};window.location.href="mailto:?body="+encodeURIComponent(t);g.instLog(et.EC,i)},i.prototype._onShortenClick=function(n){n&&n.preventDefault&&n.preventDefault();this._isShortLinkDisplayed?(this.setPermalinkString(this._permalinkResponse.permalink),this.setShortenButtonText(this.resources.L_ShortenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):this._shortPermalink?(this.setPermalinkString(this._shortPermalink),this.setShortenButtonText(this.resources.L_LengthenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):(this.setPermalinkString(this.resources.L_Link_Generating_Text),this._makeShortenRequest(this._permalinkResponse))},i.prototype.show=function(n){var t=this;this.OpenDialog();this._permalink.getGeneralPermalink(this._map,function(n){return t._onPermalinkSuccess(n)},function(){return t._onPermalinkFail()},n)},i}(ct),ur=function(){function n(){}return n}(),lf=function(i){function r(n,t,r,u,f){var e=this;return e=i.call(this,{},f,u)||this,e._slideOutMenu=n,e._container=t,e._map=r,e._initializeMenuItems(),e}return y(r,i),r.prototype.showMenu=function(){this._initMapTypeSelector();this.getControl().add_class("opened")},r.prototype.hideMenu=function(){this.getControl().remove_class("opened")},r.prototype.clickBackgroundHandler=function(){this.hideMenu()},r.prototype._clickHandler=function(){this.hideMenu()},r.prototype._initializeMenuItems=function(){this.menuItems=[];this._createAndAddDirectionsMenu();this._createAndAddTrafficMenu();this._createAndAddMapTypeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddSeeAllCardsMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddBingHomeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddFeedbackExitPreivewMenu()},r.prototype._createMenuSeparater=function(){var n=new ur;return n.type="menuSeparater",n},r.prototype._createMenuItem=function(n,t,i,r){var f=this,u;return i===void 0&&(i=undefined),r===void 0&&(r=!1),u=new ur,u.type="menuItem",u.name=n,u.cssClass=t,u.clickHandler=function(n){n.preventDefault();i&&i();r||f._clickHandler()},u},r.prototype._createAndAddMenuItem=function(n,t,i,r){i===void 0&&(i=undefined);r===void 0&&(r=!1);var u=this._createMenuItem(n,t,i,r);return this.menuItems.push(u),u},r.prototype._createAndAddDirectionsMenu=function(){this._createAndAddMenuItem(t.L_TaskBar_Label_Directions,"directionsMenu",function(){var n={type:f.directionsTask,state:{entryPoint:8}};c.invokeHandler(h.taskDataHandlerKey,n)})},r.prototype._createAndAddTrafficMenu=function(){var n=this;this._container.instanceAsync("TrafficLayerV2",function(t){n._trafficLayer=t;t&&n._showTrafficLayerAfterInstantiation&&t.show(4)});this._createAndAddMenuItem(t.L_TaskBar_Label_Traffic,"trafficMenu",function(){n._map.getMapType().id!==p.birdseye&&(n._trafficLayer?n._trafficLayer.toggle(4):n._showTrafficLayerAfterInstantiation=!0)})},r.prototype._createAndAddMapTypeMenu=function(){var n=this;this._createAndAddMenuItem(t.L_SlideOutMenu_MapType,"mapMenu",null,!0);this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Road,"mapTypeItem",function(){n._changeMapType(p.road)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Aerial,"mapTypeItem",function(){n._changeMapType(p.aerial)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Birdseye,"mapTypeItem",function(){n._changeMapType(p.birdseye)})},r.prototype._createAndAddSeeAllCardsMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_SeeAllCards,"allCardsMenu",function(){c.invokeHandler(h.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})})},r.prototype._createAndAddBingHomeMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_BingHome,"homeMenu",function(){window.location.href="/"})},r.prototype._createAndAddFeedbackExitPreivewMenu=function(){var i=this,r=this._createAndAddMenuItem(t.L_SlideOutMenu_Feedback,"feedbackMenu",function(){var n={type:f.feedbackTask,state:{entryPoint:5,feedbackTaskType:2,activeTaskId:null,title:t.L_SlideOutMenu_Feedback}};c.invokeHandler(h.taskDataHandlerKey,n)}),n;r.htmlId="sli_feedback";n=this._createAndAddMenuItem(t.L_SlideOutMenu_ExitPreview,"exitMenu",function(){i._slideOutMenu.exitPreview.invoke()});n.htmlId="sli_exit"},r.prototype._changeMapType=function(n){this._map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n);var t=this._map.getMapTypes()[n];if(t)this._map.setBaseLayers(t);else throw new Error("Invalid map type id"+n);},r.prototype._initMapTypeSelector=function(){var t=this._map.getMapType().id,n=-1,i;t===p.road?n=0:t===p.aerial?(i=this._map.getNavigationBar(),n=i&&i.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()?2:1):t===p.birdseye&&(n=2);n>=0&&this._selectMapType(n)},r.prototype._selectMapType=function(t){var i=n(".mapTypeItem");i.length==3&&(i.remove_class("selected"),n(i[t]).add_class("selected"))},r}(at),fr=function(){function n(n,t,i){this._viewModel=new lf(this,n,t,iu,i);this.exitPreview=new o;var u=this._viewModel.getControl(),r=t.getRootElement();r.getParent().insertBefore(u,r);typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_exit",!1,!0,!1))}return n.prototype.showMenu=function(){this._viewModel.showMenu()},n}(),af=function(i){function r(n,r){var f=this,u={};return f=i.call(this,u)||this,u.defineProperty("title"),u.defineProperty("imageClass"),u.defineProperty("id"),u.defineProperty("canvas"),u.defineProperty("closeTitle"),u.defineProperty("backgroundColor"),f.setTitle(n),f.setId(r),f.setCanvas(null),f.setCloseTitle(t.L_RemoveFromMap),f}return y(r,i),r.prototype.insertIcon=function(){var r=this.getCanvas(),i,t;r&&(i=n(document.getElementById(this.getId())),i&&i.length>0&&(t=n(".bm_cardImage",i[0]),t&&t.length>0&&(t.clear(),t.append(r))))},r}(gt),vf=function(){function t(n){this._rootElement=n;this.animationCompleted=new o}return t.prototype.startAnimation=function(n,t){var i=this;Microsoft.Maps.setTimeout(function(){i._startAnimationInternal(n,t)},1)},t.prototype._startAnimationInternal=function(t,i){this._cardList=n(".bm_cardItem",this._rootElement[0]);this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]);this._onCardChanged(t,i);this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i){t&&t.length>0&&this._cardList.length>=1&&n(this._cardList[0]).add_class("animatedOpen");i>0&&(this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),er=function(){function i(t,u,f,e){var o=this,s;this._capsuleClicked=!1;this._taskBarViewModel=t;this._searchBoxViewModel=e;this._taskManager=u;this._map=f;this._taskbarConfigs=r.features.taskBar;this._taskFrameworkConfigs=r.features.taskFramework;this._nonXSRCategories=[i._categoryIdForDefaultSearchTask,i._categoryIdForAddressTask,i._categoryIdForPlaceTask,i._categoryIdForDirectionsTask,i._categoryIdForTrafficTask,i._categoryIdForMyPlacesTask,i._categoryIdForFeedbackTask,i._categoryIdForTransitTask,i._categoryIdForMeasureTask,i._categoryIdForItineraryTask];this._cardsList=new ht(50);this._map&&(this._map.viewChanged.add(function(){o._map.isPanning()||o._showOrHidePopout(!1)}),this._map.mapTapped.add(function(){return o._showOrHidePopout(!1)}),this._map.mapZoomStarted.add(function(){return o._showOrHidePopout(!1)}),this._map.primitiveTapped.add(function(){return o._showOrHidePopout(!1)}));this._taskManager.newStackListCreated.add(function(){o._onNewStacksAddedFromBrowserHistory(o._taskManager.getStacks())});this._taskManager.stackAdded.add(function(n){o._onStackAdded(n.stack,n.task)});this._taskManager.stackRemoved.add(function(n){var r=n&&n.stack,u,f,e,i,s,t;if(r)if(o._stackIdToBeRemovedDueToSearchFromSearchBox)for(o._stackIdToBeRemovedDueToSearchFromSearchBox=null,i=o._cardsList.convertToArray(),o._cardsList=new ht(50),s=i.length,t=s-1;t>=0;t--)i[t].getId()!==r.id&&o._cardsList.addItem(i[t].getId(),i[t]);else{if(u=o._entrypointForCloseFromCapsule?"closeFromCapsule":"closeFromCard",o._entrypointForCloseFromCapsule)for(f=1,i=o._cardsList.convertToArray(),t=0,e=i.length;t<e;t++)if(i[t].getId()===r.id){t>f&&(u="closeFromOverflow");break}o._updateCardsList(r.id,null,1,u);o._entrypointForCloseFromCapsule=!1}});this._taskManager.secondaryTaskAdded.add(function(n){var t=n&&n.stack,i;t&&(i=o._cardsList.convertToArray(),i&&i.length>0&&i[0].getId()!==t.id&&(t.setDisplayState({isHidden:!1}),o._updateCardsList(t.id,o._getCardItem(t.id),2)))});this._taskManager.stackFocused.add(function(n){var r=n&&n.stack,t,i,u;r&&(t=o._getCardItem(r.id),i=o._cardsList.convertToArray(),i&&i.length>0&&t&&i.indexOf(t)!==0&&(u=o._taskManager.getStackById(i[0].getId()),u&&u.setDisplayState({isHidden:!0}),r&&r.setDisplayState({isHidden:!1}),o._updateCardsList(t.getId(),t,2)))});window.addEventListener("click",function(t){var i=n(t.target),r=o._taskBarViewModel.getOverflowCapsuleListCount();i.has_class("bm_overflowCardClose")&&r>0||o._showOrHidePopout(!1)});s=this._taskBarViewModel.getControl();this._cardsAnimationSearchInsideManager=new vf(s);n(window).add_event("keyup",function(n){o._onEscapeEvent(n)})}return i.prototype._onEscapeEvent=function(t){var i,u,r;this._searchTermInsertedIntoSearchBoxFromCapsule&&(i=t,i&&i.keyCode&&i.keyCode===27&&(u=this._taskBarViewModel.getControl(),r=n("#maps_sb",u[0]),this._taskBarViewModel.setOverflowExpanded(!1),r&&r[0].blur()))},i.prototype._onNewStacksAddedFromBrowserHistory=function(n){var r=this,t,o,i,s;if(n&&n.length>0){this._previousSearchTooltipShown=!0;this._reactivateTooltipShown=!0;var u=[],f=0,e=function(t){var e,i,f;if(t===n.length){for(r._cardsList=new ht(50),i=0;i<u.length;i++)u[i].dispose();for(e=void 0,i=0;i<n.length;i++)f=n[i],f&&f.displayState&&!f.displayState.isHidden?e=i:r._onStackAdded(f,f.getFirstTask());typeof e!="undefined"&&r._onStackAdded(n[e],n[e].getFirstTask())}};for(t=0;t<n.length;t++)o=n[t],i=o.getFirstTask(),i?i.getPercentLoaded()===1?e(++f):(s=i.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&e(++f)}),u.push(s)):e(++f)}else this._cardsList=new ht(50),this._updateOverflowListOnTaskBar()},i.prototype._onStackAdded=function(r,u){var f=this,e=function(){var t,o,e;f._taskManager.getStackById(r.id)&&(f._stackIdToBeRemovedDueToSearchFromSearchBox&&f._taskManager.removeTaskStack(f._stackIdToBeRemovedDueToSearchFromSearchBox),t=f._getCardItem(r.id),t||(o=f._searchTermFromSearchBox?f._searchTermFromSearchBox:u._taskState&&u._taskState.originalQuery?u._taskState.originalQuery:u.getTitle(),f._searchTermFromSearchBox=null,t=new af(o,r.id),e=f._getCategory(u),f._setImageClass(e,t),u.getIconColorAndClassName(function(n){n?t.setBackgroundColor(n):null}),f._setCardIcon(e,t),t.cardCloseHandler=function(n){n.preventDefault();n.stopImmediatePropagation();f._entrypointForCloseFromCapsule=!0;f._taskManager.removeTaskStack(r.id)},t.cardCloseKeyDownHandler=function(i){var r,u,s,e,o;i.preventDefault();i.stopImmediatePropagation();r=i;r.keyCode===9?r.shiftKey?(o=n(".bm_overflowCardText",i.target.parentElement),o.length>0&&(o.set_attr("tabindex","0"),o[0].focus())):(u=f._cardsList.convertToArray(),s=u.indexOf(t),s>=u.length-1&&(f._showOrHidePopout(!0),s===u.length-1&&(e=n(".bm_clearAllLink"),e.length>0&&(e.set_attr("tabindex","0"),e[0].focus())))):r.keyCode===13&&t.cardCloseHandler(i)},t.overflowTitleClickHandler=function(n){var r,u,e;n.preventDefault();r=f._taskManager.getStackById(t.getId());u=f._taskManager.getFocusedStack();r!==u&&(u&&u.setDisplayState({isHidden:!0}),r&&(r.displayState.cardTitleHoveringState===1&&r.setDisplayState({cardTitleHoveringState:2}),r.setDisplayState({isHidden:!1}),f._taskManager.toggleStack(r)),e=f._cardsList.convertToArray().indexOf(t),f._log({T:"CI.SearchCardReactivated",feature:i._featureName,action:"CI.SearchCardReactivated",data:{entryPoint:"overflow"}}));f._updateCardsList(t.getId(),t,2)},t.overflowTitleTouchHandler=function(n){t.overflowTitleClickHandler(n);f._showOrHidePopout(!1)},t.overflowTitleKeyDownHandler=function(i){var u=i,o=f._cardsList.convertToArray().indexOf(t),s,e,h,r,c;u.keyCode===13?(t.overflowTitleClickHandler(i),f._showOrHidePopout(!1)):u.keyCode===40?o!==f._cardsList.getCount()-1&&(i.preventDefault(),i.stopImmediatePropagation(),e=n(document.getElementById(t.getId())),s=e.get_sibling(1),s.length>0&&(r=n(".bm_overflowCardText",s[0]),r.length>0&&r[0].focus())):u.keyCode===38?o!==1&&(i.preventDefault(),i.stopImmediatePropagation(),e=n(document.getElementById(t.getId())),h=e.get_sibling(-1),h.length>0&&(r=n(".bm_overflowCardText",h[0]),r.length>0&&r[0].focus())):u.keyCode===9&&u.shiftKey&&o===1&&(i.preventDefault(),i.stopImmediatePropagation(),f._showOrHidePopout(!1),c=n(".bm_overflowCountContainer"),c.length>0&&c[0].focus())},t.overflowTitleMouseoverHandler=function(n){var r=f._taskManager.getStackById(t.getId());r&&r.setDisplayState({cardTitleHoveringState:1});f._log({T:"CI.CapsuleTitleHover",feature:i._featureName,action:"CI.CapsuleTitleHover",data:null});n.preventDefault()},t.overflowTitleMouseoutHandler=function(i){var r,u,e;try{r=n(document.getElementById(t.getId()));r.length>0&&(u=n(".bm_overflowCardText",r[0]),u.length>0&&u[0].blur());e=f._taskManager.getStackById(t.getId());e&&e.setDisplayState({cardTitleHoveringState:2})}finally{i.preventDefault()}},f._updateCardsList(t.getId(),t,0)))},o;r&&u&&(o=this._getCardItem(r.id),o||(r.changed.add(function(n){var i,u;r.getAllTasks().length===1&&n&&n.name==="foregroundTask"&&(i=n.newValue,i&&(u=f._getCardItem(i.stackId),u&&(u.setTitle(i.getTitle()),u.setCloseTitle(t.L_RemoveFromMap),f._updateQueryTerm())))}),u.changed.add(function(n){var i,r;n&&(n.name==="percentLoaded"&&n.newValue===1?e():n.name==="title"?(i=f._getCardItem(u.stackId),i&&(i.setTitle(n.newValue),i.setCloseTitle(t.L_RemoveFromMap),f._updateQueryTerm())):(n.name==="catid"||n.name==="catId")&&(r=f._getCardItem(u.stackId),r&&u.getIconColorAndClassName(function(n){n?r.setBackgroundColor(n):null})))}),u.getPercentLoaded()===1&&e()))},i.prototype._getCardItem=function(n){for(var i=this._cardsList.convertToArray(),t=0,r=i.length;t<r;t++)if(i[t].getId()===n)return i[t];return null},i.prototype._updateCardsList=function(n,t,r,u){var f,s,o,h,e;if(r===0)this._cardsList.addItem(n,t);else if(r===2)this._changeMapModeOnCardSelection(),this._cardsList.getItem(n);else if(r===1)for(this._log({T:"CI.SearchCardDeleted",feature:i._featureName,action:"CI.SearchCardDeleted",data:{entryPoint:u}}),f=this._cardsList.convertToArray(),f&&f[0]&&f[0].getId()===n&&(s=f[1],s&&(o=this._taskManager.getStackById(s.getId()),o&&(o.setDisplayState({isHidden:!1}),this._taskManager.toggleStack(o)))),this._cardsList=new ht(50),h=f.length,e=h-1;e>=0;e--)f[e].getId()!==n&&this._cardsList.addItem(f[e].getId(),f[e]);this._updateOverflowListOnTaskBar()},i.prototype._changeMapModeOnCardSelection=function(){var t=this,n=this._map.getMode(),r,i;n&&(n.mapModeType===2||n.mapModeType===3)?(r=n.getPreviousMapType()||this._map.createMapType(p.road),this._map.setMapType(r),i=n.getPreviousMode(),i?this._map.setMode(i):this._map.getContainer().instanceAsync("CompositeMapMode",function(n){t._map.setMode(n)})):this._map.getMapType().id===p.birdseyeV2&&this._map.getBirdseyeV2Manager().then(function(n){var i=t._map.getMapTypes()[n.previousMapState.mapTypeId||p.road];i&&t._map.setBaseLayers(i)})},i.prototype._updateOverflowListOnTaskBar=function(){for(var u,s=this,h=1,t=new ni,f=this._cardsList.convertToArray(),e=0,r=h,o=f.length;r<o;r++)e>=0&&t.insert(f[r]),e++;for(e===0&&this._showOrHidePreviousSearchTip(!1),u=this._taskBarViewModel,u.setOverflowCapsuleList(t),u.getOverflowCapsuleListCount()===0&&t.length>0&&this._log({T:"CI.SearchOverflowCounter",feature:i._featureName,action:"CI.SearchOverflowCounterShown",data:null}),u.getOverflowCapsuleListCount()===1&&t.length===0&&this._showOrHidePopout(!1),u.setOverflowCapsuleListCount(t.length),t.length>i._scrollCount?(n(".bm_popoutTop1").add_class("scroll"),n(".bm_overflowPopout").add_class("scroll")):(n(".bm_popoutTop1").remove_class("scroll"),n(".bm_overflowPopout").remove_class("scroll")),this._updateQueryTerm(),r=h,o=f.length;r<o;r++)f[r].insertIcon();this._cardsAnimationSearchInsideManager.animationCompleted.addOne(function(){t.length>0&&s._showOrHidePreviousSearchTipOnOverflowShown(!0);s._taskFrameworkConfigs.isSafari&&setTimeout(function(){u.resizeOnOverlayOpened()},100)});this._cardsAnimationSearchInsideManager.startAnimation(t,t.length);u.resizeOnOverlayOpened()},i.prototype._updateQueryTerm=function(){var n,i,r,t;if(this._taskbarConfigs.updateSearchTerm){n=this._cardsList.convertToArray();i=n&&n.length>0?n[0].getTitle():"";this._taskbarConfigs.updateSearchTermWithTaskTitle&&n&&n.length>0&&(r=this._taskManager.getStackById(n[0].getId()),r&&(t=r.getFirstTask(),t&&t._taskState&&(t._taskState.originalQuery||t._taskState.taskTitle)&&(i=t._taskState.originalQuery||t._taskState.taskTitle)));this._taskBarViewModel.setSearchTerm(i);return}},i.prototype._showOrHidePopout=function(t){var s=this._map.getRootElement(),u=s&&s.getParent(),h=u&&u.length>0&&u[0],f,r;if(h&&(f=n(".bm_overflowPopout",h).get_style("display"),(t&&f==="none"||!t&&f==="block")&&(r=this._taskBarViewModel.getControl(),this._overflowPopoutShown=t,r.length>0))){this._log({T:"CI.SearchOverflowPopout",feature:i._featureName,action:"CI.SearchOverflowPopout",data:{isShown:t}});var e=n(".bm_overflowPopout",r[0]),o=n(".bm_overflowBox",r[0]),c=n(".bm_outsideBeak",r[0]);e.length>0&&o.length>0&&(e.set_style({display:t?"block":"none"}),c.length>0&&c.set_style({display:t?"block":"none"}),t&&(this._showOrHidePreviousSearchTip(!1),o.add_class("active"),Microsoft.Maps.setTimeout(function(){var t=n(".bm_overflowCardText",e[0]);t.length>0&&(t[0].focus(),t.getParent().fireEvent("hover"))},20)),t||(o.remove_class("active"),this._taskBarViewModel.setOverflowExpanded(!1)))}},i.prototype._showOrHideReactivateTip=function(t){var r=this;this._reactivateTooltipShown||(this._log({T:"CI.SearchReactivateTip",feature:i._featureName,action:"CI.SearchReactivateTip",data:{isShown:t}}),t?n("#ReactivateSearchTip").add_class("opened"):n("#ReactivateSearchTip").remove_class("opened"),t&&Microsoft.Maps.setTimeout(function(){r._showOrHideReactivateTip(!1);r._reactivateTooltipShown=!0},i._timeoutForTooltipHiding))},i.prototype._showOrHidePreviousSearchTipOnOverflowShown=function(n){var t=this;this._previousSearchTooltipShown||(this._log({T:"CI.PreviousSearchTip",feature:i._featureName,action:"CI.PreviousSearchTip",data:{isShown:n}}),this._showOrHidePreviousSearchTip(n),n&&Microsoft.Maps.setTimeout(function(){t._showOrHidePreviousSearchTipOnOverflowShown(!1);t._previousSearchTooltipShown=!0},i._timeoutForTooltipHiding))},i.prototype._showOrHidePreviousSearchTip=function(t){t?n("#PreviousSearchTip").add_class("opened"):n("#PreviousSearchTip").remove_class("opened")},i.prototype._log=function(n){var t=Microsoft.Maps.logger;t&&t.logObject(n)},i.prototype.onSearchInvokedFromTaskbar=function(n){if(this._newSearchInitiatedFromTaskbar=!0,this._searchTermFromSearchBox=n,this._searchTermInsertedIntoSearchBoxFromCapsule){var t=this._cardsList.convertToArray();t&&t.length>0&&(this._stackIdToBeRemovedDueToSearchFromSearchBox=t[0].getId())}},i.prototype.overflowClick=function(n){window.clearTimeout(i._popoutHideHandler);this._overflowPopoutShown?this._showOrHidePopout(!1):this._showOrHidePopout(!0);n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation())},i.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this.overflowClick(n)},i.prototype.overflowMouseOver=function(n){this._overflowPopoutShown||this._showOrHidePreviousSearchTip(!0);n&&n.preventDefault()},i.prototype.overflowMouseOut=function(n){this._showOrHidePreviousSearchTip(!1);n&&n.preventDefault()},i.prototype.popoutMouseoverHandler=function(n){window.clearTimeout(i._popoutHideHandler);n&&n.preventDefault&&n.preventDefault()},i.prototype.clearAllClickHandler=function(n){var r,t,i,u,f;if(n&&n.preventDefault&&n.preventDefault(),r=this._taskBarViewModel,t=r.getOverflowCapsuleList(),t)for(i=0,u=t.length;i<u;i++)f=t[i],this._taskManager.removeTaskStack(f.getId())},i.prototype.clearAllKeyDownHandler=function(t){var i,r;if(t&&t.preventDefault&&t.preventDefault(),i=t,i)if(i.keyCode===13)this.clearAllClickHandler(t);else if(i.keyCode===9)if(i.shiftKey){this._showOrHidePopout(!0);var f=this._cardsList.convertToArray(),e=n(".bm_overflowItem")[f.length-1],u=n(".bm_overflowCardClose",e);u.set_attr("tabindex","0");u[0].focus()}else this._showOrHidePopout(!1),r=this._taskBarViewModel,r&&r.setSearchBoxFocus()},i.prototype.sbCloseTaskHandler=function(n){var u,f,t,r,i,e,o;if((n.preventDefault(),n.stopImmediatePropagation(),!this._searchBoxViewModel.getCloseDisable())&&(u=this._cardsList.convertToArray()[0],f=u&&this._taskManager.getStackById(u.getId()),f))for(t=f.getAllTasks(),r=0;r<t.length;r++)if(i=t[r],!i.displayState||i.displayState.stackOrder===1||i.displayState.prominence===1&&t.length===1){e=i.id;o={logData:{feature:"SB",action:"C",data:{BN:n.target.classList,TID:e}}};c.invokeHandler(h.instrumentationDataHandlerKey,o);(this._taskManager.getStacks().length>1||t.length>1)&&this._searchBoxViewModel.setCloseDisable(!0);this._taskManager.removeTaskAndReseatChild(e);break}},i.prototype.popoutMouseoutHandler=function(n){var t=this;i._popoutHideHandler=Microsoft.Maps.setTimeout(function(){t._showOrHidePopout(!1)},i._timeoutForHidePopout);n&&n.preventDefault&&n.preventDefault()},i.prototype._setImageClass=function(n,t){var r,u;n&&(r="",n.indexOf(i._categoryIdForDefaultSearchTask)>-1?r="maps_searchsvg":n.indexOf(i._categoryIdForMyPlacesTask)>-1?r="maps_myplacessvg":n.indexOf(i._categoryIdForPlaceTask)>-1||n.indexOf(i._categoryIdForAddressTask)>-1?r="maps_addresssvg":n.indexOf(i._categoryIdForDirectionsTask)>-1?r="maps_carsvg":n.indexOf(i._categoryIdForTrafficTask)>-1?r="maps_trafficsvg":n.indexOf(i._categoryIdForFeedbackTask)>-1?r="maps_feedbacksvg":n.indexOf(i._categoryIdForTransitTask)>-1?r="maps_transitsvg":n.indexOf(i._categoryIdForItineraryTask)>-1?r="maps_itinerarysvg":n.indexOf(i._categoryIdForMeasureTask)>-1?r="maps_measuresvg":n.length>0&&(r=n),u="bm_cardImage",r.length>0&&(u+=" "+r),t.setImageClass(u))},i.prototype._setCardIcon=function(n,t){n&&this._nonXSRCategories.indexOf(n)===-1&&!t.getCanvas()&&this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i&&(t.setCanvas(i),t.insertIcon()))},n,"#FFF",20,20)})},i.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},i.prototype._getCategory=function(n){if(n){var t=n.type;return t===f.directionsTask||t===f.directionsFlipTask?"directions":t===f.trafficTask||t===f.trafficFlipTask?"traffic":t===f.collectionsTask?"myplaces":t===f.feedbackTask?"feedback":t===f.transitLineTask||t===f.transitStopTask||t===f.nearbyTransitTask?"transit":t===f.itineraryListingsTask||t===f.itineraryDetailsTask?"itinerary":t===f.venueMapDirectoryTask?"90892":t===f.measureMap?"measure":t===f.myContributions?"myContributions":t===f.myContributionsV2Task?"myContributionsV2":t===f.myContributionsV3Task?"myContributionsV3":t===f.myContributionsAndRewardsTask?"myContributionsAndRewards":this._getSearchCategory(n)}return"search"},i.prototype._getSearchCategory=function(n){var s=["Place","City","Events"],i,r,u,f,o,t,e;if(n){if(i=n.viewModel,i){if(i.categoryFound)return n.viewModel.getCardCategoryId();if(r=i&&i.getEntities(),r&&r.length>-1&&(u=r[0],u)){if(f=u.getPrimaryCategoryPath(),f)return(o=lr.extractCategoryId(f,!1),!o)?f in s?"place":"search":o;if(t=u.getSegmentTypes(),t&&t.length>0)return(e=t[0],s.indexOf(e)>-1)?"place":e.indexOf("Local")>-1?t.length>1?t[1]:"place":e}}return"place"}},i._timeoutForHidePopout=500,i._timeoutForTooltipHiding=4e3,i._featureName="SearchPrototype",i._categoryIdForDefaultSearchTask="search",i._categoryIdForPlaceTask="place",i._categoryIdForAddressTask="address",i._categoryIdForDirectionsTask="directions",i._categoryIdForTrafficTask="traffic",i._categoryIdForMyPlacesTask="myplaces",i._categoryIdForFeedbackTask="feedback",i._categoryIdForTransitTask="transit",i._categoryIdForMeasureTask="measure",i._categoryIdForItineraryTask="itinerary",i._scrollCount=7,i}(),yf=function(n){function i(i,r,u,f){var e=this,o={};return e=n.call(this,o,f,u)||this,o.defineProperty("ariaLabel",null,null,{defaultValue:t.CloseMapView}),e.setAriaLabel(t.CloseMapView),e}return y(i,n),i}(at),oi=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("isActive"),t.defineProperty("cssClass"),t.defineProperty("dataTag"),t.defineProperty("showLabel"),t.defineProperty("popoutClass"),t.defineProperty("ariaExpanded"),t.defineProperty("ariaControls"),t.defineProperty("ariaHasPopout"),i.url="#",i.isNew=!1,i.banner="",i}return y(t,n),t}(gt),eo=function(i){function u(u,f,h,c,l,a){var v=this,y={},p;return v=i.call(this,y,c,h)||this,y.defineProperty("searchTerm"),y.defineProperty("capsuleList"),y.defineProperty("overflowCapsuleList"),y.defineProperty("overflowCapsuleListCount"),y.defineProperty("searchboxContainerClassName"),y.defineProperty("stackExists"),y.defineProperty("closeDisable"),y.defineProperty("displayInPrivate"),y.defineProperty("closeTitle"),y.defineProperty("displayClearSearch"),v.resources=t,v._map=f,v._taskManager=l,p=l.getFocusedStack(),v._currentStack=p&&p.id,v._cardsController=new er(a,l,v._map,v),v.searchInstData=v.stringify(v._getInstData()),v._stacks=l.getStacks(),v._taskManager=l,v.setCloseDisable(!1),v._isFlipped=!1,v._isFlipMode=!1,v.setDisplayInPrivate(r.isInPrivateMode?"":"none"),v.setCloseTitle(v.resources.ShareClose),v.setAsExpanded(!1),v.clearSearchEvent=new o,v.disposables.push(l.stackRemoved.add(function(n){var i,t;if(l.getStacks().length===0)v.setSearchTerm(""),v._searchBox&&v._searchBox.focus(),v.setStackExists(!1),v._setTaskType(null);else for(i=l.getStacks(),t=0;t<i.length;t++)p=i[t],p.displayState&&p.displayState.activationState===1&&v._setTaskType(p.getForegroundTask());n.stack.id===v._currentStack&&v._determineWidthOverride(l);l.getStacks().length===0&&v._setSearchControlsWidth(v._searchBox,s.searchBoxWidth)})),v.disposables.push(l.stackFocused.add(function(n){n&&n.stack&&(v._currentStack=n.stack.id,v._isFlipMode&&v._flipSetSearchTerm(),v._setTaskType(n.stack.getForegroundTask()))})),v.disposables.push(l.stackAdded.add(function(n){v._isFlipped=!1;v._determineWidthOverride(l);n&&n.stack&&(v._currentStack=n.stack.id);var t=v._getTaskFromArgs(n);v.setStackExists(t&&t!==undefined);v._setTaskType(t);v.disposables.push(n.stack.flipAnimationCompleted.add(function(){return v._flipSetSearchTerm()}))})),v.disposables.push(l.stacksReset.add(function(){var n=l.getFocusedStack();v._currentStack=n.id;v._determineWidthOverride(l);v.setStackExists(l.getStacks().length>0);v._setTaskType(n&&n.getForegroundTask())})),v.disposables.push(l.secondaryTaskAdded.add(function(n){var t=v._getTaskFromArgs(n);t&&t.id&&(t.id.toLowerCase().indexOf("itinerarydetails")>-1||!e._getIsSlideCardEnabled()&&t.id.toLowerCase().indexOf("transitline")>-1)&&v._flipSetSearchTerm()})),sj_evt.bind("CardResize",function(t){var s=v.getControl(),i,f,l,o;if(s&&s.length>0&&t&&t.length>1){var h=t[1],a=r&&r.features&&r.features.taskFramework,k=t.length>2&&t[2],y=a&&a.showLoadingSkeleton&&e._isPercievedLoadSkeletonShown();if(h){if(i=!0,!e._isSlideCardEnabled){i=!1;var p=v._taskManager.getFocusedStack(),c=p&&p.getForegroundTask(),u=c&&c.displayState,w=u&&u.prominence,b=u&&u.activationState;w&&w===1&&b&&b===1&&(f=c,l=f&&f.getCurrentWidth&&f.getCurrentWidth(),i=l&&l===h)}(!y&&i||y&&k)&&(o=n(".inputbox",s[0]),o&&o.length>0&&v._setSearchControlsWidth(o[0],h))}}}),v.setSearchboxContainerClassName("bm_searchBoxNavLeft bm_l2Search"),v}return y(u,i),u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.nullToDisplayNone=function(n){return n?"":"none"},u.prototype.setDisabledClass=function(n){return n?"disabled":""},u.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!==null)this._cardsController.onSearchInvokedFromTaskbar(n)},u.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},u.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},u.prototype.overflowClick=function(n){this._cardsController.overflowClick(n)},u.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},u.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},u.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},u.prototype.mouseEnterSearchBox=function(){},u.prototype.mouseLeaveSearchBox=function(){},u.prototype.clearSearchText=function(n){this.setSearchTerm("");this._searchBox&&(this._searchBox.value="");this.setSearchBoxFocus();this.setDisplayClearSearch(!1);this.clearSearchEvent.invoke();n.preventDefault();n.stopImmediatePropagation()},u.prototype.showClearTextTip=function(){var n,t,i;this.getAsExpanded()||(n=this._showTip(this.resources.ClearText),t=this.getControl().select(".clearSearchText"),t.append(n),i=n.get_absolute_pos(),n.set_style({top:52,left:18-i.width/2}))},u.prototype.showClearSearchTip=function(){},u.prototype.hideTip=function(){this._tooltip&&this._tooltip.removeTip()},u.prototype.stringify=function(t){return n.Internals.stringify(t)},u.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},u.prototype.sbCloseHandler=function(t){var i,u=this._taskManager.getStackById(this._currentStack),r,f;u&&(i=u.getForegroundTask());i&&i.id.toLowerCase().indexOf("collection")>-1&&(r=n(".collectionsCard.refresh"),r.length>0&&(f=r.select(".placesMessage"),f.get_style("display")==="none"&&(this._isFlipped=!0)));this._isFlipped?this._isFlipped=e.flipClickReturnToList(i):this._cardsController.sbCloseTaskHandler(t);t.preventDefault();t.stopPropagation()},u.prototype.setSearchBoxFocus=function(){if(this._searchBox)if(this._searchBox.focus(),st.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},u.prototype.setSearchBox=function(t){var i=this;this._searchBox=t;n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)})},u.prototype._setTaskType=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft"),u=i&&i.length>0&&i[0].firstElementChild,r;u&&(r=n(u),t&&t.type===f.directionsTask?r.add_class(f.directionsTask):r.remove_class(f.directionsTask))},u.prototype._determineWidthOverride=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft ul li.inputbox"),r=t.getStacks();r.length>0?i.has_class("inlineCard")||i.add_class("inlineCard"):i.remove_class("inlineCard")},u.prototype._onSearchBoxEnter=function(t){var r=t,f=r.keyCode||r.which,u,i;f===13&&(u=this._getInstData(),c.invokeHandler(h.instrumentationDataHandlerKey,u),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},u.prototype._mapTypeChanged=function(n){n&&(n.newMapTypeId===p.streetside||n.newMapTypeId===p.birdseyeV2)?this.getControl().add_class("b_hide"):this.getControl().remove_class("b_hide")},u.prototype._adjustSearchBoxLeftMargin=function(t){n(".MicrosoftMap .bm_searchBoxNavLeft").set_style({left:t+u.CardContentLeftPadding+"px"})},u.prototype._adjustSearchBoxWidth=function(){var e=this.getControl()[0],i=n(".inputbox",e)[0],r=n("#taskbarPrimer"),u=r.length>0&&r[0],t,f;u&&u.clientWidth>0&&(t=this._getCardContainerWidth(),t?this._setSearchControlsWidth(i,t,!0):(f=n(".bm_tcfPrimer .inputbox")[0],this._setSearchControlsWidth(i,f.getBoundingClientRect().width,!0)))},u.prototype._getCardContainerWidth=function(){var n=0,t=document.getElementsByClassName("overlay-container"),i;return t&&t.length>0&&(i=t[0].getAttribute("data-mapcardwidth"),n=i&&parseInt(i),n=isNaN(n)?0:n),n},u.prototype._setSearchControlsWidth=function(t,i,r){var o,s,f,e;t&&this._currentWidth!==i&&(this._currentWidth=i,o=0,s=r?0:u.searchBoxBorderWidth*2,t.setAttribute("style","width: "+(i===-1?"":i-o-s+"px")),f=n(".as_container_search",t),f&&f.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&f.set_style({width:i+"px"}),e=n("#taskbarPrimer"),e&&e.length>0&&i!==-1&&e.select(".inputbox").set_style({width:i+"px"}))},u.prototype._getTaskFromArgs=function(n){var t=n.task;return!t&&n.stack&&(t=n.stack.getForegroundTask()),t},u.prototype._getInstData=function(){return{logData:{feature:"SB",action:"C",data:{FN:l.Search}}}},u.prototype._flipSetSearchTerm=function(){var t=this._taskManager.getStackById(this._currentStack),n;t?(n=t.getForegroundTask(),s.updateSearchTermWithTaskTitle&&this.setSearchTerm(n.getTitle()),this._isFlipMode=!0,this._isFlipped=n.displayState.stackOrder>1?!0:!1):this._isFlipMode=!1},u.prototype._showTip=function(n){var t,i;return this._tooltip&&this._tooltip.removeTip(),t=new bt(this._map,"",[n],!0,!1,!0,!1,null,null,"searchBoxTip"),t.setShowClose(!1),t.setShowBeak(!0),i=t.getRootElement(),this._tooltip=t,i},u._searchFeatureName="Search",u.CardContentLeftPadding=16,u.searchBoxBorderWidth=2,u}(at),st=function(u){function w(i,f,h,c,l){var a=this,v={},y,k,b;return a=u.call(this,v,c,h)||this,a._commuteFlyoutDismissCount=0,a._commuteFlyoutNotNowActionCount=0,a._impressionIncrementedFlyoutDismiss=!1,v.defineProperty("searchTermInternal"),v.defineProperty("className"),v.defineProperty("asExpanded"),v.defineProperty("selectedSuggestionId"),v.defineProperty("isOnVertical"),v.defineProperty("overflowCapsuleList"),v.defineProperty("overflowCapsuleListCount"),v.defineProperty("searchboxPlaceHolderText"),v.defineProperty("overflowExpanded"),v.defineProperty("showCommuteFlyout"),v.defineProperty("commuteRewardsFlyoutTitle"),v.defineProperty("upsellImageClass"),v.defineProperty("commutePointValue"),a.setCommutePointValue(""+nt.commuteRewardsPointValue),a._isMapsAnswer=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.isMapsAnswer,s.fullScreen=a._isMapsAnswer?!1:s.fullScreen,y=r.features.localGuide,a._localGuideEnabled=y&&y.isEnabled,a._minimumActionButtonsWidth=s.minimumActionButtonsWidth,a._maxIdControlsWidth=s.maxIdControlsWidth,a._minIdControlsWidth=s.minIdControlWidth,a._searchBoxWidth=s.searchBoxWidth,a._navButtonWidth=s.navButtonWidth,a._minSearchBoxWidth=s.minSearchBoxWidth,a._searchButtonWidth=s.searchButtonWidth,a._noTextBuffer=s.taskbarTextBuffer,a._resizeBuffer=s.taskBarResizeBuffer,a._maxActionButtonsWidth=s.maximumActionButtonsWidth,a._searchBoxLeftBuffer=s.taskbarLeftBuffer,a._rightTaskbarBuffer=s.taskbarRightBuffer,a._smallSearchControlsWidth=a._minSearchBoxWidth,a._fullSearchControlsWidth=a._searchBoxWidth,a.setClassName("taskBar"),a.setSearchboxPlaceHolderText(""),a.setSearchTerm(""),a._taskManager=l,a.taskBarItems=[],a.taskBarExtraItems=[],w._taskItems=[],a.createTaskItems(),a._map=f,a._controlTemplateFactory=c,w._staticMap=f,a._signInState=new wi,a.setUpAlwaysOnPoi(),a._container=i,a.launchFeedbackMenu=new o,a.hideFeedbackMenu=new o,a.focusFeedback=new o,a.exitFullScreen=new o,a.exitFullScreen.add(function(){return a._exitFullScreenHandler()}),a.clearAutosuggest=new o,a.setAsExpanded(!1),a._mouseOutPrevent=!1,a.displayInPrivate=r.isInPrivateMode?"":"none",a._overlayCloseViewModel=new yf(i,f,cu,c),a._map&&a.disposables.push(a._map.viewChanged.add(function(){a._map.isPanning()||a.mapInteractedEvent()}),a._map.mapTapped.add(function(){return a.mapInteractedEvent()}),a._map.mapZoomStarted.add(function(){return a.mapInteractedEvent()}),a._map.primitiveTapped.add(function(){return a.mapInteractedEvent()}),a._map.mapPanStopped.add(function(){return a.mapInteractedEvent()})),a.disposables.push(a._taskManager.stackFocused.add(function(){w.enableDirectionsSearch=!1})),sj_evt&&sj_evt.bind("identityHeaderShown",function(){Microsoft.Maps.setTimeout(function(){a._setHiddenElementFocusHandler();a._adjustSearchBoxWidth();a._showIdControls();a._mapTabAccessibility()},500)}),a._menuList=[],a._touchByPassMouseout=!1,(a._trafficItem||a.isFeatureEnabled("traffic"))&&a._container.instanceAsync("TrafficLayerV2",function(n){a._trafficLayer=n;n&&(a._showTrafficLayerAfterInstantiation&&n.show(1),a._setTrafficButtonSelected(n.getIsShowing()),a.disposables.push(a._trafficLayer.changed.add(function(n){n.name==="isShowing"&&a._setTrafficButtonSelected(n.newValue)})))}),a.resources=t,a.searchInstData=a.createInstrumentationData(w._searchFeatureName),f&&(a.disposables.push(l.stackRemoved.add(function(){l.getStacks().length===0&&(a.setSearchTerm(""),a._searchBox&&a._searchBox.focus())})),a.disposables.push(f.mapTypeChanged.add(function(n){n.newMapTypeId===p.birdseye?(a._trafficItem&&a._trafficItem.setCssClass("trafficIcon realign disabled"),a._trafficIsDisabled=!0):n.oldMapTypeId===p.birdseye&&(a._trafficIsDisabled=!1,a._trafficLayer&&a._setTrafficButtonSelected(a._trafficLayer.getIsShowing()));a._setTextAlignment()}))),a._isMapsAnswer?sj_evt&&sj_evt.bind("LargeMapHidden",function(){a._clearHeaderLastElementKeyDownHandler()}):a._setTextAlignment(),s.showTaskBarLabels&&(n(window).add_event("resize",function(){a._onResizeHandler()}),s.fullScreen&&n(window).add_event("fullscreenChange,webkitfullscreenChange,mozfullscreenChange,msfullscreenchange,msfullscreenChange,MSFullscreenChange",function(){a._onResizeHandler()})),k=s.isEnabled&&!e._isSmallMapShownOnSerp()?"block":"none",a.getControl().set_style({display:k}),a.setIsOnVertical(r.isMapsVertical),a._isMapsAnswer&&(a.disposables.push(f.actualSizeChanged.addOne(function(){var i=n(".actions")[0],t;if(i&&(a.actionBarSize=i.getBoundingClientRect().width),t=n(".b_searchboxForm")[0],t){var r=n(".searchButton")[0],u=r?r.getBoundingClientRect().width:40,f=t.getBoundingClientRect().width-u;a._setSearchControlsWidth(n(".inputbox",a.getControl()[0])[0],f)}a._setTextAlignment()})),a.disposables.push(f.actualSizeChanged.add(function(){a._setTextAlignment()}))),a._cardsController=new er(a,l,a._map),b=r.features.taskFramework,b&&b.isTouchDevice&&a.getControl().add_class("bm_touch"),a._activeTask=a.getTask(),e._isSmallMapShownOnSerp()?sj_evt.bind("LargeMapShown",function(){a._setUpCommuteRewardsFlyout()}):Microsoft.Maps.setTimeout(function(){a._setUpCommuteRewardsFlyout()}),a.disposables.push(a._signInState.notifySignedIn.add(function(n){n&&a._setUpCommuteRewardsFlyout()})),a}return y(w,u),w.prototype.setAutoSuggestExpanded=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setAsExpanded(n):this.setAsExpanded(n);this._showOrHidePanelShading(n);n||this.setSelectedSuggestionId("")},w.prototype._setUpCommuteRewardsFlyout=function(){var n=this,t=new Promise(function(t){nt.forceShowCommuteRewardsFlyout?t(!0):nt.enableCommuteRewards&&nt.enableCommuteRewardsFlyout&&n._shouldPromptCommuteRewardsFlyout()&&n._signInState.getIsSignedIn()&&!r.isInPrivateMode?a.getPromotionAvailableCommuteResponse().then(function(i){(i===null||i===void 0?void 0:i.isPromotionAvailable)&&a.isPromotionErrorCodeExpected(i.errorCode)?n._hasBothHomeAndWork().then(function(n){t(!n)}):t(!1)}):t(!1)});t.then(function(t){if(t){var i=n._getCounterFromStorageKey(a.StorageKeys.FlyoutImpressionCountKey);i++;i>0&&i%2==0&&(n._trackFlyoutDismiss(4),n._impressionIncrementedFlyoutDismiss=!0);r.testHooksEnabled||localStorage.setItem(a.StorageKeys.FlyoutImpressionCountKey,""+i);n._drawCommuteFlyoutAndLogImpressions(i)}n.setShowCommuteFlyout(t)})},w.prototype._drawCommuteFlyoutAndLogImpressions=function(r){var e,u,f,o,s,h;this.setUpsellImageClass("upsellImage ".concat(nt.commuteRewardsEnableHighPoints?"high":""));e=t.CommuteRewards_FlyoutTitle.replace("{0}",""+nt.commuteRewardsPointValue);this.setCommuteRewardsFlyoutTitle(e);u=document.querySelector(".taskBar .actions .placesIcon");f=n("#rewardsFlyout");u&&f&&(o=u.getBoundingClientRect(),this._alignUnderTaskBarAction(f,o,1));s=i.logger;h={feature:l.CommuteRewards,action:"I",data:{visual:a.CommuteRewardsLogActionName.FlyoutImpression,count:r}};s.logObject(h)},w.prototype._shouldPromptCommuteRewardsFlyout=function(){var n,u,s;if(r.userExpectingCommuteRewards)return!1;var t=!1,f=!1,e=!1,o=localStorage.getItem(a.StorageKeys.FlyoutDismissKey),i=parseInt((n=localStorage.getItem(a.StorageKeys.FlyoutDismissCountKey))!==null&&n!==void 0?n:"");if(o&&!isNaN(i)){this._commuteFlyoutDismissCount=i;var h=new Date,c=Date.parse(o),l=Math.ceil((h.getTime()-c)/864e5);t=i<3&&l>=7}else t=!0;return u=this._getCounterFromStorageKey(a.StorageKeys.FlyoutNotNowActionKey),this._commuteFlyoutNotNowActionCount=u,f=u<2,s=localStorage.getItem(a.StorageKeys.ShownIneligibleKey)!==null,e=!s,t&&f&&e},w.prototype._hasBothHomeAndWork=function(){var n=!1,t=this._map&&this._map.getContainer();return new Promise(function(i){t?t.instanceAsync("ItineraryDataManager",function(t){t.syncFavorites(function(r){r===0&&t.home&&t.work&&(n=!0);i(n)})}):i(!0)})},w.prototype._showOrHidePanelShading=function(t){if(s.autoSuggestDimmingEnabled){var r=n(".MicrosoftMap .bm_waitlayer"),i=n(".MicrosoftMap .inner-container"),u=n(".taskLayoutContainer.bm_l2NavLeft"),f=r.length>0?n(r[0]):null,e=i.length>0?n(i[0]):null;if(!f||!e||u.length===0)return;r.set_style({display:""});i.length>0&&this._showOrHideWaitLayer(t,i[0],u)}},w.prototype._showOrHideWaitLayer=function(t,i,r,u){var s=n(i),f=s.select(".bm_waitlayer"),e,o,h;f.length>0&&(t?(s.set_style({position:""}),r.has_class("bm_asDroppedDown")||r.add_class("bm_asDroppedDown"),f.has_class("bm_highlightPane")||f.add_class("bm_highlightPane"),e=f.getParent().length>0&&f.getParent().get_size(),e&&(o=u&&u.leftOffset?e.width-1:e.width+1,h=u?u.leftOffset:0,f.set_style({width:o+"px",left:h+"px"}),u&&(u.leftOffset+=o))):(r.remove_class("bm_asDroppedDown"),f.remove_class("bm_highlightPane"),f.set_style({width:"",left:""})))},w.prototype.setSearchTerm=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setSearchTerm(n):this.setSearchTermInternal(n)},w.prototype.invertBoolean=function(n){return!n},w.prototype.getSearchTerm=function(){return this._searchBoxViewModel?this._searchBoxViewModel.getSearchTerm():this.getSearchTermInternal()},w.prototype.setSearchBox=function(t){var i=this;this._searchBoxViewModel?this._searchBoxViewModel.setSearchBox(t):(this._searchBox=t,n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)}))},w.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!=null)this._cardsController.onSearchInvokedFromTaskbar(n)},w.prototype.onCommuteRewardsEarnClick=function(n){var t,r,u,f;n.stopPropagation();this._launchCollectionsTask(n);t=n.target.getAttribute("data-action")==="earn";r=t?2:3;this._hideAndTrackDismissFlyout(r);u=i.logger;f={feature:l.CommuteRewards,action:"C",data:{activity:t?a.CommuteRewardsLogActionName.FlyoutEarnClick:a.CommuteRewardsLogActionName.FlyoutClick}};u.logObject(f)},w.prototype.onCommuteRewardsDismissClick=function(n){n.preventDefault();n.stopPropagation();this._hideAndTrackDismissFlyout(0);this._commuteFlyoutNotNowActionCount++;r.testHooksEnabled||localStorage.setItem(a.StorageKeys.FlyoutNotNowActionKey,""+this._commuteFlyoutNotNowActionCount)},w.prototype.overflowClick=function(n){this.setOverflowExpanded(!0);this._cardsController.overflowClick(n)},w.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},w.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},w.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},w.prototype.dispose=function(){n(window).remove_event("keyup",this._windowEventHandler);n(window).remove_event("keydown",this._firefoxEscapeEventHandler);n(window).remove_event("fullscreenChange,webkitfullscreenChange,mozfullscreenchange,msfullscreenChange,MSFullscreenChange,msfullscreenchange",this._onResizeHandler);this._clearHeaderLastElementKeyDownHandler()},w.prototype.setActionsOptions=function(i){for(var f,e,o,u=this.taskBarItems,r=0;r<u.length;r++)i===2047&&(u[r].action===8||u[r].action===256)?u[r].setIsActive(!1):(u[r].setIsActive((i&u[r].action)!=0),w.isFullScreen&&u[r].name===t.L_TaskBar_Label_Fullscreen&&(f=this._getTaskbarFullScreenButton(null),f.add_class("selected"),e=w.getMenuItem(t.L_TaskBar_Label_Fullscreen),o=n(".fullscreenIcon",e),o.add_class("selected")))},w.prototype.setActionsState=function(n,t){for(var i,e,r,f=this.taskBarItems,o=this.getControl(),u=0;u<f.length;u++)i=f[u],(n&i.action)!=0&&(e=i.getDataTag(),r=o.select('*[data-tag="'+e+'"]'),t==1?r.remove_class(w._pressedButtonClass):t==2&&r.add_class(w._pressedButtonClass),i.setCssClass(r.get_attr("class")))},w.prototype.stringify=function(t){return n.Internals.stringify(t)},w.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},w.prototype.clearAllKeyDownHandler=function(n){this._cardsController.clearAllKeyDownHandler(n)},w.prototype.setSearchBoxFocus=function(){if(this._searchBoxViewModel)this._searchBoxViewModel.setSearchBoxFocus();else if(this._searchBox)if(this._searchBox.focus(),w.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},w.prototype.mapInteractedEvent=function(){var n,t;w.enableDirectionsSearch=!1;this.hideMenu();n=this.getControl().select(".taskBar");n&&n.length>0&&n[0].classList.contains("bm_slideout")&&n.remove_class("bm_slideout");t=this.getShowCommuteFlyout();nt.enableCommuteRewards&&t&&this._hideAndTrackDismissFlyout(1)},w.prototype.hideMenu=function(){var t=this;window.clearTimeout(w._mouseOverDelayHandle);this._taskBarPopOutElement&&(w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var i=n(".bm_dropdownEntry",t._taskBarPopOutElement[0]),f,u,r;if(i&&i.length>0&&i[0].blur(),f=!1,u=n(".popOutTemplate",t._taskBarPopOutElement[0]),u&&u.length>0){if(u[0].querySelector(":focus")||u[0].querySelector(":hover")||u[0].querySelector(":active"))f=!0;else for(r=0;r<i.length;r++)if(i[r].parentElement.querySelector(":hover")||i[r].parentElement.querySelector(":active")||i[r].parentElement.querySelector(":focus")||i[r].querySelector(":focus")||i[r].querySelector(":hover")||i[r].querySelector(":active")){f=!0;break}f&&u.get_style("display")!=="none"||t.clearMenuElements()}},w._mouseTimeout*2));this._mouseOutPrevent=!1},w.prototype.mouseoverMenuHandler=function(t){var i=this;window.clearTimeout(w._mouseOverDelayHandle);w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);i._initializeMenu(t);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"})},w._mouseTimeout-100);t&&t.preventDefault&&t.preventDefault()},w.prototype.popoutMouseoverHandler=function(n){this._cardsController.popoutMouseoverHandler(n)},w.prototype.popoutMouseoutHandler=function(n){this._cardsController.popoutMouseoutHandler(n)},w.prototype.onFullScreenClick=function(i){var e=this;this._windowEventHandler||(this._windowEventHandler=function(n){return e._onEscapeEvent(n)},document.addEventListener("mozfullscreenchange",this._windowEventHandler),document.addEventListener("webkitfullscreenchange",this._windowEventHandler),document.addEventListener("msfullscreenChange",this._windowEventHandler),document.addEventListener("MSFullscreenChange",this._windowEventHandler),document.addEventListener("msfullscreenchange",this._windowEventHandler),document.addEventListener("fullscreenchange",this._windowEventHandler),n(window).add_event("keyup",this._windowEventHandler));w.enableDirectionsSearch=!1;var r=this._getTaskbarFullScreenButton(i),u=w.getMenuItem(t.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",u),o=n("#container");r&&(r.has_class("selected")?(n(r).exit_full_screen(),r.remove_class("selected"),r[0].setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),f.remove_class("selected"),u&&u.setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),this._updateFullScreenMenuItem(!1),w.isFullScreen=!1):(n(r).set_full_screen(o[0]),r.add_class("selected"),r.set_attr("aria-label",t.Taskbar_Label_ExitFullScreen),f.add_class("selected"),u&&u.setAttribute("aria-label",t.Taskbar_Label_ExitFullScreen),this._updateFullScreenMenuItem(!0),w.isFullScreen=!0,w._logFullScreen(!0)),w._adjustContainerTop());i&&i.preventDefault()},w.prototype._updateFullScreenMenuItem=function(n){for(var t,e,u,i=0,r=0,f=this._menuList;r<f.length;r++){if(t=f[r],t.iconClass.indexOf("fullscreenIcon")>-1){e=t.iconClass.indexOf("selected")>-1;u=!e&&n;u?this._menuList[i].iconClass+=" selected":u||(this._menuList[i].iconClass=t.iconClass.replace(" selected",""));break}i++}},w.getMenuItem=function(t){var f=n(".taskBarPopout",w._staticMap.getRootElement().getParent()[0])[0],u=n(".popOutInner",f)[0],r,i;if(u&&u.childElementCount>0)for(r=u.children,i=0;i<r.length;i++)if(r[i].innerHTML.indexOf(t)>-1)return r[i];return null},w.prototype.clearMenuElements=function(){this.hideFeedbackMenu.invoke();this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.setIsDisplayed(!1);n(".taskBarPopout",this._map.getRootElement().getParent()[0]).set_style({display:"none"});this._setMoreTaskItemState(!1)},w.prototype._setMoreTaskItemState=function(n){for(var i,t=w._taskItems.length-1;t>0;t--)if(w._taskItems[t].getCssClass().indexOf("moreIcon")>-1){i=w._taskItems[t];break}w._handleSelectedClass(i,n);i.setAriaExpanded(n)},w._handleSelectedClass=function(t,i){if(t)if(i)t.getCssClass().indexOf("selected")===-1&&t.setCssClass(t.getCssClass()+" selected");else while(t.getCssClass().indexOf("selected")>-1)t.setCssClass(t.getCssClass().replace(" selected","")),n(".moreIcon").fireEvent("blur")},w.prototype.mouseoutMenuHandler=function(n){var t=this;this._touchByPassMouseout||(window.clearTimeout(w._mouseOverDelayHandle),w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t.hideFeedbackMenu.invoke()},w._mouseTimeout));this._touchByPassMouseout=!1;n&&n.preventDefault&&n.preventDefault()},w.prototype.hoverFeedbackButton=function(){var t=n(".fullscreenMenuLink",this._taskBarPopOutElement[0]);t&&t.length>0&&t[0].parentElement.parentElement.focus()},w.prototype.boolToDisplay=function(n){return n?"":"none"},w.prototype.nullToDisplayNone=function(n){return n?"":"none"},w.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},w.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},w.prototype.boolToHide=function(n){return n?"none":""},w.prototype._onEscapeEvent=function(n){var t=n,i=document.mozFullScreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;(t&&t.key&&(t.key==="Escape"||t.key==="Esc")||t.keyCode&&t.keyCode===27||(n.type==="mozfullscreenchange"||n.type==="webkitfullscreenchange"||n.type==="fullscreenchange"||n.type==="msfullscreenchange"||n.type==="MSFullscreenChange"||n.type==="msfullscreenChange")&&!i)&&(this._exitFullScreenHandler(),w._logFullScreen(!1));this._setMoreTaskItemState(!1);n.preventDefault()},w.prototype.onOverlayCloseButtonClicked=function(){var n={logData:{feature:"TB",action:"C",data:{FN:w._featureNameToAction.Overlay,CN:"Close"}}};n.impressionGuid=r.dynamicProperties.serpIG?r.dynamicProperties.serpIG:r.dynamicProperties.mapsIG;c.invokeHandler(h.instrumentationDataHandlerKey,n)},w.prototype.onOverlayCloseKeydown=function(t){var i=t,r;i.keyCode&&(i.keyCode===13?this.onOverlayCloseButtonClicked():i.keyCode===9&&(t.preventDefault(),t.stopImmediatePropagation(),i.shiftKey?this._focusLastIdControl():(r=n("#MapStyleSelector"),r.length>0&&r[0].focus())))},w.prototype.getTaskbarItem=function(n){var t=this.taskBarItems.filter(function(t){return t.action===n}),i;return t&&t.length==1?(i=t[0].getCssClass(),this.getControl().select("."+i)):null},w.prototype._exitFullScreenHandler=function(){var i=this._getTaskbarFullScreenButton(null),r=w.getMenuItem(t.L_TaskBar_Label_Fullscreen),u=n(".fullscreenIcon",r);i.has_class("selected")&&(n("#container").exit_full_screen(),i.remove_class("selected"),u.remove_class("selected"),this._updateFullScreenMenuItem(!1));w.isFullScreen=!1;w._adjustContainerTop()},w.prototype._adjustSearchBoxLeftMargin=function(n){this._searchBoxViewModel&&this._searchBoxViewModel._adjustSearchBoxLeftMargin(n)},w.prototype.setIconClass=function(){var f=this._getShowTaskBarItemLabel(),u=n(".actions",this.getControl()[0])[0],t,i,r;if(u&&u.style&&u.style.display!=="none")if(t=n(".action"),!f&&t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&r.classList.contains("realign")&&r.classList.remove("realign");else if(t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&!r.classList.contains("realign")&&r.classList.add("realign")},w.prototype._getTaskbarFullScreenButton=function(t){var i=t&&t.target;return i?i.className.indexOf("actionLabel")>-1?n(i.parentElement):i.className.indexOf("action")>-1?n(i.firstChild):n(i):n(".taskBar .fullScreenIcon")},w.prototype._onSearchBoxEnter=function(t){var r=t,f=r.keyCode||r.which,u,i;f===13&&(u=this._getInstData(w._searchFeatureName),c.invokeHandler(h.instrumentationDataHandlerKey,u),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},w.prototype._createTaskItemWithTaskOption=function(n,t,i,r,u){var f=new oi;return f.setCssClass(n),f.taskOption=t,f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},w.prototype.createTaskItemWithClickHandler=function(t,i,r,u,f,e){var h=this,o;return e===void 0&&(e=!0),o=new oi,o.setCssClass(t),o.action=r,o.setIsActive(!0),o.setDataTag(f?f:""),o.setShowLabel(u),o.clickHandler=function(n){i(n);n.preventDefault()},o.keydownHandler=function(i){var r=h._map.getMode(),u,e,f;r&&(r.mapModeType===2||r.getDisplayName().indexOf("Birds")>-1)&&(s.fullScreen&&t.indexOf("full")>-1||!s.fullScreen&&t.indexOf("share")>-1)&&(u=i,e=u.keyCode||u.which,e===9&&(f=n("#id_h"),f.length>0&&h._setFocusToId(i,f)))},o.action=r,o},w.prototype.createTaskItemWithMouseHandlers=function(t,i,r,u,f){var o=this,e=new oi;return e.setCssClass(t),e.mouseoverHandler=function(n){window.clearTimeout(w._mouseOverDelayHandle);w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i(n)},w._mouseTimeout);n&&n.preventDefault&&n.preventDefault()},e.mouseoutHandler=function(n){o._touchByPassMouseout||(window.clearTimeout(w._mouseOverDelayHandle),w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){n.target.tagName==="A"&&(n&&n.preventDefault&&n.preventDefault(),o.hideMenu())},w._mouseTimeout));o._touchByPassMouseout=!1},e.clickHandler=function(n){(n.type==="touchend"||n.type==="pointerup")&&(o._touchByPassMouseout=!0);n&&n.preventDefault&&n.preventDefault();i(n);n.cancelBubble=!0;n.stopPropagation()},e.keydownHandler=function(t){var r=t,f=r.keyCode||r.which,u;f===40&&e.getCssClass().indexOf("selected")===-1?(window.clearTimeout(w._mouseOverDelayHandle),w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i(t)},w._mouseTimeout),t&&t.preventDefault&&t.preventDefault()):f===9&&!r.shiftKey&&t.target.className.indexOf("more")>-1&&(u=n("#id_h"),u.length>0&&o._setFocusToId(t,u))},e.action=r,e.setIsActive(!0),e.setDataTag(f?f:""),e.setShowLabel(u),e.setPopoutClass("taskBarPopout"),e},w.prototype.createTaskItems=function(){var n=this._getShowTaskBarItemLabel();this.addDirectionsItem(n);this.addTrafficItem(n);this._localGuideEnabled&&this.addLocalGuideItem(n);this.addCollectionItem(n);this.addSharingItem(n);this.addMoreMenuItem(n);this.addfullScreenItem(n)},w.prototype.addCollectionItem=function(n){var u=this,i;this.isFeatureEnabled("collections")&&!r.isInPrivateMode&&(i=this.createTaskItemWithClickHandler("placesIcon realign",function(n){u._launchCollectionsTask(n);u.setShowCommuteFlyout(!1)},2,n,"TaskBar.CollectionsButton",!1),i.altName=i.name=t.L_TaskBar_Label_Favorites,i.url="/maps/myplaces",i.instrumentationData=this.createInstrumentationData(f.collectionsTask),this.taskBarItems.push(i),w._taskItems.push(i))},w.prototype._launchCollectionsTask=function(n){var r,i,t;n.type!=="pointerup"&&(w.enableDirectionsSearch=!1,r={entryPoint:1,action:hi.GetAllCollections},i={type:f.collectionsTask,state:r},nt.enableSingleMyPlacesCard&&(t=this._container.instance(f.collectionsTask),t&&t.id&&t.stackId&&(i.state=undefined)),c.invokeHandler(h.taskDataHandlerKey,i),n.preventDefault())},w.prototype.makeHomeWorkRequest=function(){var t={entryPoint:1,action:hi.ProcessCardlessPrimitives},i={type:f.collectionsTask,requestorType:"TaskBar",requestState:t},n=this._map.getFrameManager();n&&n.frameRendered&&n.frameRendered.addOne(function(){c.invokeHandler(h.taskProcessDataHandlerKey,i)})},w.prototype.setUpAlwaysOnPoi=function(){var t=this,n;e._isSmallMapShownOnSerp()?(n=function(){t.makeHomeWorkRequest();sj_evt.unbind("LargeMapShown",n)},sj_evt.bind("LargeMapShown",n)):this.makeHomeWorkRequest()},w.prototype.addSharingItem=function(n){var u=r.features.sharing,i;u&&u.isEnabled&&!u.disableOutboardSharing&&(i=this.createTaskItemWithClickHandler("shareIcon realign",function(n){n.type!=="pointerup"&&(w.enableDirectionsSearch=!1,c.invokeHandler(h.shareDataHandlerKey,{entryPoint:v.TaskBar}))},8,n,"TaskBar.ShareButton",!1),i.altName=i.name=t.L_TaskBar_Label_Share,i.instrumentationData=this.createInstrumentationData(w._shareFeatureName),i.setIsActive(!1),i.setAriaExpanded(undefined),this.taskBarItems.push(i),w._taskItems.push(i))},w.prototype.addMoreMenuItem=function(n){var r=this,i=this.createTaskItemWithMouseHandlers("moreIcon realign",function(n){r.mouseoverMenuHandler(n)},128,n,"Taskbar.MoreButton");i.altName=i.name=t.L_TaskBar_Label_More;i.setAriaExpanded(!1);i.setAriaHasPopout(!0);i.setAriaControls("taskbarPopout");this.taskBarItems.push(i);w._taskItems.push(i)},w.prototype.addfullScreenItem=function(n,i){var u=this,r;s.fullScreen&&(r=this.createTaskItemWithClickHandler("fullScreenIcon",function(n){if(n.type!=="pointerup")u.onFullScreenClick(n)},256,n,"Taskbar.FullscreenButton"),r.altName=r.name=t.L_TaskBar_Label_Fullscreen,r.setIsActive(!1),r.setAriaExpanded(undefined),i?this.taskBarExtraItems.push(r):this.taskBarItems.push(r),w._taskItems.push(r))},w.prototype.addTrafficItem=function(n){var r=this,i;this.isFeatureEnabled("traffic")&&(i=void 0,this._trafficItem=i=this.createTaskItemWithClickHandler("trafficIcon",function(n){n.type!=="pointerup"&&(w.enableDirectionsSearch=!1,r._map.getMapType().id!==p.birdseye&&(r._trafficLayer?r._trafficLayer.toggle(1):r._showTrafficLayerAfterInstantiation=!0))},32,n,"TaskBar.TrafficButton",!1),i.altName=i.name=t.L_TaskBar_Label_Traffic,i.url="/maps/traffic",i.setAriaExpanded(undefined),i.instrumentationData=this.createInstrumentationData(w._trafficFeatureName),this.taskBarItems.push(i),w._taskItems.push(i))},w.prototype.addLocalGuideItem=function(n){var i=this.createTaskItemWithClickHandler("localGuideIcon",function(n){if(n.type!=="pointerup"){w.enableDirectionsSearch=!1;var t={type:f.localGuideTask,state:{entryPoint:v.TaskBar}};c.invokeHandler(h.taskDataHandlerKey,t)}},1024,n,"TaskBar.LocalGuideButton",!1);i.name=t.L_TaskBar_Label_LocalGuide;i.altName=t.LocalGuide_Title;i.url="/maps/localnearby";i.setAriaExpanded(undefined);i.instrumentationData=this.createInstrumentationData(w._localGuideFeatureName);this.taskBarItems.push(i);w._taskItems.push(i)},w.prototype.addDirectionsItem=function(n,i){var u=this,r;this.isFeatureEnabled("directions")&&(i?r=this._createTaskItemWithTaskOption("directionsIcon realign",{type:f.directionsTask,state:i},1,n,"TaskBar.DirectionsButton"):(r=this.createTaskItemWithClickHandler("directionsIcon realign",function(n){if(n.type!=="pointerup")u.onDirectionsClick(n)},1,n,"TaskBar.DirectionsButton",!1),r.altName=r.name=t.L_TaskBar_Label_Directions,r.url="/maps/directions",r.setAriaExpanded(undefined),r.instrumentationData=this.createInstrumentationData(f.directionsTask)),this.taskBarItems.push(r))},w.prototype.isFeatureEnabled=function(n){return r&&r.features[n]&&r.features[n].isEnabled},w.prototype.createInstrumentationData=function(n){var t=this._getInstData(n);return this.stringify(t)},w.prototype.onDirectionsClick=function(n){var t=this.getTask(),i,r;t&&(t.type===f.localDetailsTask||t.type===f.polygonEntityDetailsTask)&&!w.enableDirectionsSearch?(this._logDirectionsSearch(),this._getCardDetailsForDirections(t.type)):w.enableDirectionsSearch&&this._searchBox&&this._searchBox.value&&this._searchBox.value.length>0?(this._logDirectionsSearch(),this._getDetailsForDirections()):(i={entryPoint:1},r={type:f.directionsTask,state:i},c.invokeHandler(h.taskDataHandlerKey,r));w.enableDirectionsSearch=!1;n.preventDefault()},w.prototype._getCardDetailsForDirections=function(n){var t={searchEntitiesRequested:!0,entryPoint:v.TaskBar},i={requestorType:"TaskBar",type:n,requestState:t,useActiveTasks:!0};c.invokeHandler(h.taskProcessDataHandlerKey,i)},w.prototype._getDetailsForDirections=function(){var n={disableTaskActivate:!0,query:this._searchBox.value,noAds:!0,entryPoint:v.TaskBar},t={requestorType:"TaskBar",type:f.localDetailsTask,requestState:n,useActiveTasks:!1};c.invokeHandler(h.taskProcessDataHandlerKey,t)},w.prototype._logDirectionsSearch=function(){var n={logData:{feature:"TB",action:"SE",data:{C:"DS"}},impressionGuid:r.dynamicProperties.mapsIG};c.invokeHandler(h.instrumentationDataHandlerKey,n)},w._logFullScreen=function(n){var t=n?"FSO":"FSE",i={logData:{feature:"TB",action:"C",data:{FN:t}},impressionGuid:r.dynamicProperties.mapsIG};c.invokeHandler(h.instrumentationDataHandlerKey,i)},w.prototype._getInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:w._featureNameToAction[n]}},impressionGuid:r.dynamicProperties.mapsIG}},w.prototype._getMenuInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:n}},impressionGuid:r.dynamicProperties.mapsIG}},w.prototype._initializeMenu=function(t){var i=this,h,c,o,u,f;t&&t.preventDefault();h=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);h&&h.length>0&&(c=n(".feedbackPopOut")[0],c&&this._map.getRootElement().getParent().insertBefore(c,this._map.getRootElement()));this.checkNewTask()&&(this._menuList=[]);this._menuList.length===0&&(o=r.features.sharing,o&&o.isEnabled&&!o.disableOutboardSharing&&this._menuList.push(this._createShareMenuItem()),this.isFeatureEnabled("print")&&this._menuList.push(this._createPrintMenuItem()),this.isFeatureEnabled("feedback")&&this._menuList.push(this._createFeedbackMenuItem()),s.fullScreen&&this._menuList.push(this._createFullscreenMenuItem()),this._menuList.push(this._createEmbedMenuItem()),di.enableMyContributions&&this._menuList.push(this._createMyContributionsMenuItem()),this._activeTask=this.getTask());this._showDropdown(t);u=n(".feedbackMenuLink");f=u.length>0?u.select(".arrow"):null;f&&f.length>0&&(this._isFeedbackNoMenu()?f.add_class("hide"):f.remove_class("hide"));u.set_attr("aria-expanded","false");u.add_event("touchend",function(t){var r,u;if(i._isFeedbackNoMenu()){i._touchByPassMouseout=!0;return}r=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(r);u=i._map.getMode();t&&(t.preventDefault(),t.stopPropagation());i._touchByPassMouseout=!0});e._setFocusOnFirstMenuItem(this._taskBarPopOutElement)},w.prototype._createShareMenuItem=function(){var n=this;return{name:t.L_TaskBar_Label_Share,handler:function(){c.invokeHandler(h.shareDataHandlerKey,{entryPoint:v.TaskBar});n._setMoreTaskItemState(!1)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData(l.Share)}},w.getCurrentActiveTask=function(n){var i="",t;return n&&(t=n.getFocusedStack(),t?t.getForegroundTask()&&(i=t.getForegroundTask().type):i="BaseMap"),i},w.prototype._createMyContributionsMenuItem=function(){var n=this;return{name:t.L_TaskBar_Label_MyContributions,handler:function(){var t={type:di.enableMyRewards?f.myContributionsAndRewardsTask:f.myContributionsV3Task,state:{}};c.invokeHandler(h.taskDataHandlerKey,t);n._setMoreTaskItemState(!1)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData(l.MyContributions)}},w.prototype._createPrintMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_TaskBar_Label_Print,handler:function(){var t=w.getCurrentActiveTask(i);c.invokeHandler(h.printDataHandlerKey,{source:1,fullScreen:w.isFullScreen,taskType:t});n._setMoreTaskItemState(!1);wt.onPrintDialogOpen.addOne(function(){w.isFullScreen&&n.exitFullScreen.invoke()});wt.onPrintDialogClose.addOne(function(){window.clearTimeout(w._mouseOverDelayHandle);w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){n._setMoreTaskItemState(!1);Microsoft.Maps.setTimeout(function(){n.hideMenu()},50)},w._mouseTimeout)})},mouseouthandler:function(t){n._mouseOutPrevent||n.hideMenu();n._mouseOutPrevent=!1;t&&(t.preventDefault(),t.stopPropagation())},cssClass:"printMenuLink",iconClass:"printIcon menuLinkIcon",instData:this._getMenuInstData(l.Print)}},w.prototype._isFeedbackNoMenu=function(){var n=this.getTask();return n&&n.getReportType&&n.getReportType()===4?!1:!0},w.prototype._createFeedbackMenuItem=function(){var i=this,e={name:t.L_Menu_Feedback_Text,mouseoverhandler:function(){window.clearTimeout(w._submenuMouseOverDelayHandle);w._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){if(!i._isFeedbackNoMenu()){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)}},w._mouseTimeout)},mouseouthandler:function(n){i._touchByPassMouseout||(window.clearTimeout(w._submenuMouseOverDelayHandle),w._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i.hideFeedbackMenu.invoke()},w._mouseTimeout*2));i._touchByPassMouseout=!1;n&&(n.preventDefault(),n.stopPropagation())},cssClass:"feedbackMenuLink",iconClass:"feedbackIcon menuLinkIcon",subMenu:!this._isFeedbackNoMenu(),instData:this._getMenuInstData(l.Feedback)},o,r,u;return this._isFeedbackNoMenu()?(o=this.getNewFeedbackTaskData(),e.options={type:f.feedbackTask,state:o},r=this.getTask(),r&&r.isReportable&&r.isReportable()&&r.getReportType&&(u=r.getReportType(),u&&u!==9&&u!==10&&u!==11&&(e.options.activateOptions={parentId:r.id}))):e.handler=function(){i._taskbarDropdownViewModel.shouldAllowFeedbackClick=!1;var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},e},w.prototype.getNewFeedbackTaskData=function(){var u={title:"",activeTaskId:"",feedbackTaskType:2,entryPoint:6,options:{showFeedbackHeader:!1,noMenu:!0}},n=this.getTask(),r,f;if(n&&n.getReportType&&n.getReportOptions){var e=n&&n.getTitle?n.getTitle():"",o=n&&n.id?n.id:"",i=2,t=n.getReportType?n.getReportType():null;t&&(t===7?i=5:t===2||t===6||t===1||t===5||t===3?i=3:t===8?i=7:t===4&&(i=4));r=n.getReportOptions();f={title:e,activeTaskId:o,feedbackTaskType:i,entryPoint:6,options:r?r:{showFeedbackHeader:!1,noMenu:!0}};u=f}return u},w.prototype._createFullscreenMenuItem=function(){var i=this,u=n(".fullScreenIcon.realign"),r="fullscreenIcon menuLinkIcon";return w.isFullScreen&&(r+=" selected"),{name:t.L_TaskBar_Label_Fullscreen,handler:function(n){i.onFullScreenClick(n);i._setMoreTaskItemState(!1);i.hideMenu()},mouseouthandler:function(n){i.hideMenu();n&&(n.preventDefault(),n.stopPropagation())},cssClass:"fullscreenMenuLink",iconClass:r,instData:this._getMenuInstData(l.Fullscreen)}},w.prototype._createEmbedMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_TaskBar_Label_Embed,handler:function(t){n._openEmbedPage(t)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"embedMenuLink",iconClass:"embedIcon menuLinkIcon",instData:this._getMenuInstData(l.Embed)}},w.prototype._openEmbedPage=function(){var t,n,i;this._map&&(t=null,n=this._map.getBounds().center,r.encodeURLParameters!==null&&r.encodeURLParameters.length!==0?(i=null,i=r.encodeURLParameters.indexOf("CenterPoint")!==-1?yr.latLonEncoder(n.latitude,n.longitude):n.latitude+"~"+n.longitude,t=e._formatString(d.embedPageUrl,i,this._map.getMercatorZoomLevel())):t=e._formatString(d.embedPageUrl,n.latitude,n.longitude,this._map.getMercatorZoomLevel()),window.open(t,"EmbeddedMap"),this._logEmbed(t))},w.prototype._showDropdown=function(t){var f=this,i=t&&t.target,r,u;i.className.indexOf("actionLabel")>-1?i=t.target.parentElement.parentElement:i.className.indexOf("Icon")>-1&&(i=i.parentElement);this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.getIsDisplayed()===!0?(this._taskbarDropdownViewModel.shouldAllowFeedbackClick=this._isFeedbackNoMenu(),this._taskbarPopOutButtonViewModel.setIsDisplayed(!1),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(i)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):this._taskbarDropdownViewModel?(this._taskbarDropdownViewModel.shouldAllowFeedbackClick=this._isFeedbackNoMenu(),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(i)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):(this._taskbarDropdownViewModel=new tu(this._menuList,n(i)),this._taskbarDropdownViewModel.shouldAllowFeedbackClick=this._isFeedbackNoMenu(),this._taskbarPopOutButtonViewModel=new br(this._taskbarDropdownViewModel,null,this._taskbarDropdownViewModel.taskBarListDropDownTemplate),r=this._taskbarPopOutButtonViewModel.buildPopOut(),this._taskBarPopOutElement=n(".taskBarPopout",this._map.getRootElement().getParent()[0]),this._taskBarPopOutElement.append(r));u=i.getBoundingClientRect();this._alignUnderTaskBarAction(this._taskBarPopOutElement,u);n(".taskBarPopout").add_event("keydown",function(n){f._onMenuKeyDown(n)});this._taskbarPopOutButtonViewModel.setIsDisplayed(!0)},w.prototype._showIdControls=function(){var c=n("#b_header")[0],u,o;if(c&&(u=n("#id_h",c),u.length>0)){var t=n(".id_nc",u[0]),h=t&&t.length>0&&!t.has_class("bnc-hide"),i=n("#id_sc");if(r.isMapsAnswer)o=0,h?o=this._minIdControlsWidth:i.length>0&&(o=20),window.innerWidth<s.taskbarIdShowWidth+o?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),i.length>0&&!i.has_class("hide")&&i.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),i.length>0&&i.has_class("hide")&&i.remove_class("hide"));else{var f=n("#id_l",u[0]),e=n("#id_rh",u[0]),o=h?this._maxIdControlsWidth:100;window.innerWidth>=s.taskbarIdShowWidth?i&&i.length>0&&i.has_class("hide")&&i.remove_class("hide"):window.innerWidth<s.taskbarIdShowWidth&&this._localGuideEnabled&&i&&i.length>0&&!i.has_class("hide")&&i.add_class("hide");window.innerWidth<s.taskbarIdShowWidth+o?(f.length>0&&!f.has_class("hide")&&f.add_class("hide"),e.length>0&&!e.has_class("hide")&&e.add_class("hide"),h&&t.length>0&&!t.has_class("hide")&&t.add_class("hide")):(f.length>0&&f.has_class("hide")&&f.remove_class("hide"),e.length>0&&e.has_class("hide")&&e.remove_class("hide"),h&&t.length>0&&t.has_class("hide")&&t.remove_class("hide"))}this._removeIDFocusHandler(u);this._setLastIdKeyDownListener(u)}},w.prototype._setFocusToId=function(t,i){for(var r,e=this,f=i[0].children,u=0;u<f.length;u++)if(r=f[u].tagName.toLowerCase()==="a"?n(f[u]):null,r&&r.length>0&&(r.get_style("display")!=="none"||!(r.has_class("hide")||r.has_class("b_hide")))){t&&t.preventDefault&&t.preventDefault();r.add_event("keydown",function(t){if(t.keyCode===9&&t.shiftKey){var i=n(".moreIcon",e.getControl()[0]);i.length>0&&(t.preventDefault(),t.stopImmediatePropagation(),i[0].focus())}});r[0].focus();break}},w.prototype._clearHeaderLastElementKeyDownHandler=function(){var i=n("#b_header"),t=n("#id_h",i[0]);t.length>0&&this._removeIDFocusHandler(t)},w.prototype._setLastIdKeyDownListener=function(t){for(var i,f=this,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)if(i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&i.get_style("display")!=="none"&&(!i.get_attr("keydownListen")||i.get_attr("keydownListen").indexOf("false")>-1)){i[0].addEventListener("keydown",function(n){return f.idButtonKeydownHandler(n)});i.set_attr("keydownListen","true");break}},w.prototype._removeIDFocusHandler=function(t){for(var i,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&(i[0].removeEventListener("keydown",this.idButtonKeydownHandler),i.set_attr("keydownListen","false"))},w.prototype.idButtonKeydownHandler=function(t){if(t&&t.keyCode&&t.keyCode===9&&!t.shiftKey){var i=n("#mapFocus");e._isLargeMapShownOnSerp()&&(i=n(".overlayCloseLink"));i.length>0&&i[0].focus();t.preventDefault();t.stopImmediatePropagation()}},w.prototype._setTextAlignment=function(){for(var t=this._getShowTaskBarItemLabel(),n=0;n<this.taskBarItems.length;n++)this.taskBarItems[n].setShowLabel(t);this._adjustSearchBoxWidth();this._showIdControls()},w.prototype._adjustSearchBoxWidth=function(){var s=this.getControl()[0],h=e._isSmallMapShownOnSerp()?0:this._map.getActualSize().width,t,i,f,u;if(h>0)if(t=n(".inputbox",s)[0],i=n("#taskbarPrimer")[0],i&&i.clientWidth>0)f=n(".inputbox",i)[0],this._setSearchControlsWidth(t,f.getBoundingClientRect().width);else if(this._isMapsAnswer&&this.actionBarSize<this._minimumActionButtonsWidth&&(this.actionBarSize=this._maxActionButtonsWidth),t){var c=n("#b_header")[0],l=n("#id_h",c),r=n(".id_nc",l[0]),a=r&&r.length>0&&!r.has_class("bnc-hide"),v=a?47:0,y=this._rightTaskbarBuffer+this._searchBoxLeftBuffer+this._navButtonWidth+this._maxActionButtonsWidth+v,p=this._fullSearchControlsWidth-this._minSearchBoxWidth,o=window.innerWidth-(this._fullSearchControlsWidth+y);o>0?this._setSearchControlsWidth(t,this._searchBoxWidth):(u=p-Math.abs(o),u<0?this._setSearchControlsWidth(t,this._minSearchBoxWidth):this._setSearchControlsWidth(t,this._minSearchBoxWidth+u))}},w.prototype._setSearchControlsWidth=function(t,i){var u,f,r;t&&(u=38,f=n("#maps_sb",t)[0],t.setAttribute("style","width: "+i+"px"),r=n(".as_container_search",t),r&&r.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&r.set_style({width:i+"px"}))},w.prototype.insertPopoutInMap=function(){var t=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);t&&t.length!==0||(this._taskBarPopOutElement=e._createElement("div"),this._taskBarPopOutElement.set_attr("class","taskBarPopout"),this._taskBarPopOutElement.set_attr("id","taskBarPopoput"),this._map.getRootElement().getParent().insertBefore(this._taskBarPopOutElement[0],this._map.getRootElement()))},w.prototype.getSearchBox=function(){return this._searchBoxViewModel&&this._searchBoxViewModel.getControl()},w.prototype.getOverlayCloseButton=function(){return this._overlayCloseViewModel&&this._overlayCloseViewModel.getControl()},w.prototype.resizeOnOverlayOpened=function(){this._onResizeHandler()},w.prototype._onResizeHandler=function(){var l=this._getShowTaskBarItemLabel(),f,u,o,h,i,t,c,r;for(this._showIdControls(),this._setTextAlignment(),f=this.taskBarItems,u=0;u<f.length;u++)f[u].setShowLabel(l);if(this.setIconClass(),e._isLargeMapShownOnSerp()||e._isTravelOverlayShownOnSerp()){if(o=document.getElementById("b_header"),h=window.innerWidth,o)if(i=n(".id_button",o),h<=s.taskBarMapTypeTextMinWidth)for(t=0;t<i.length;t++)i[t].style.padding="0";else for(t=0;t<i.length;t++)i[t].removeAttribute("style");c=document.getElementsByTagName("html")[0];r=n(".b_footer.b_slimFoot.bm_oneMap")[0];h<=s.windowMinWidth?(c.style.overflowX="auto",r&&(r.style.zIndex="1001")):(c.style.overflowX="hidden",r&&r.removeAttribute("style"))}},w._adjustContainerTop=function(){var t=n("#container")[0];w.isFullScreen&&(t.style.top="0",t.style.bottom="0")},w.prototype._onMenuKeyDown=function(t){var o=this,e=t,r=e.keyCode||e.which,i,u,f;r===9?this.hideMenu():r===37?this.clearMenuElements():r===13||r===39?(i=t.target,i.className.indexOf("bm_dropdownEntry")>-1&&(i=i.children[0],i&&(i=i.children[0])),i.className.indexOf("feedback")>-1&&this.launchFeedbackMenu.invoke(n(".feedbackMenuLink").parent()),window.clearTimeout(w._mouseOverDelayHandle),w._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){o.focusFeedback.invoke()},w._mouseTimeout*2)):r===40?(u=t.target.nextElementSibling,u&&n(u)[0].focus()):r===38&&(f=t.target.previousElementSibling,f?n(f)[0].focus():this.clearMenuElements())},w.prototype._setTrafficButtonSelected=function(t){var i=n(".trafficIcon")[0];i&&(t&&!i.classList.contains("selected")?i.classList.add("selected"):!t&&i.classList.contains("selected")&&i.classList.remove("selected"));this._trafficIsSelected=t},w.prototype._getShowTaskBarItemLabel=function(){return this._searchBoxWidth===null?!1:s.showTaskBarLabels&&window.innerWidth>s.taskbarButtonsShowTextWidth+(e._isLargeMapShownOnSerp()?50:0)},w.prototype._logEmbed=function(n){var t={PL:n};g.instLog(et.EMC,t)},w.prototype._searchBoxFocusHandler=function(){var t=n("#maps_sb_container #maps_sb");t.length>0&&t[0].focus()},w.prototype._setHiddenElementFocusHandler=function(){var r=this,i=n("#b_header"),t;i.length>0&&(t=i.select("a"),t.length>0&&t[0].addEventListener("keydown",function(n){n&&n.keyCode&&n.keyCode===9&&!n.shiftKey&&(n.preventDefault(),n.stopPropagation(),r._searchBoxFocusHandler())}))},w.prototype._mapTabAccessibility=function(){var i=this,t=n("#mapFocus");t.length>0&&t[0].addEventListener("keydown",function(t){if(t&&t.keyCode&&t.keyCode===9&&t.shiftKey)if(t.preventDefault(),t.stopPropagation(),e._isLargeMapShownOnSerp()){var r=n(".overlayCloseLink");r.length>0&&r[0].focus()}else i._focusLastIdControl()})},w.prototype._focusLastIdControl=function(){var f=n("#b_header")[0],u,r,i,t;if(f&&(u=n("#id_h",f),u.length>0))for(r=u[0].children,i=r.length-1;i>=0;i--)if(t=r[i].tagName.toLowerCase()==="a"?n(r[i]):null,t&&t.length>0&&(t.get_style("display")!=="none"||!(t.has_class("hide")||t.has_class("b_hide")))){t[0].focus();break}},w.prototype.getTask=function(){if(this._taskManager&&this._taskManager.getFocusedStack){var n=this._taskManager.getFocusedStack();if(n)return n.getForegroundTask()}return null},w.prototype.checkNewTask=function(){var n=this.getTask();return n&&this._activeTask&&(n.id!==this._activeTask.id||n.id.indexOf("Directions")>-1)?!0:!1},w.prototype._alignUnderTaskBarAction=function(t,i,r){r===void 0&&(r=0);var e=i.height+10,f=n(window).get_scroll_pos().x,o=window.innerHeight/window.document.documentElement.offsetHeight*100<80,s=!(f===0||o),u=_G.RTL?i.right-t[0].clientWidth:i.left;r===1&&(u=_G.RTL?u+t[0].clientWidth-i.width:u-t[0].clientWidth+i.width);s&&(u+=f);t.set_style({left:"".concat(u,"px"),right:"",top:"".concat(e,"px")})},w.prototype._hideAndTrackDismissFlyout=function(n){this.setShowCommuteFlyout(!1);this._trackFlyoutDismiss(n)},w.prototype._trackFlyoutDismiss=function(n){this._impressionIncrementedFlyoutDismiss||this._commuteFlyoutDismissCount++;n===4&&(this._impressionIncrementedFlyoutDismiss=!0);r.testHooksEnabled||(localStorage.setItem(a.StorageKeys.FlyoutDismissKey,(new Date).toString()),localStorage.setItem(a.StorageKeys.FlyoutDismissCountKey,""+this._commuteFlyoutDismissCount));var t=this._getActivityForFlyoutDismissType(n),u=i.logger,f={feature:l.CommuteRewards,action:"CLS",data:{activity:t}};u.logObject(f)},w.prototype._getActivityForFlyoutDismissType=function(n){var t;switch(n){case 0:t=a.CommuteRewardsLogActionName.DismissClick;break;case 1:t=a.CommuteRewardsLogActionName.ImplicitDismiss;break;case 2:t=a.CommuteRewardsLogActionName.FlyoutEarnClick;break;case 3:t=a.CommuteRewardsLogActionName.FlyoutClick;break;case 4:t=a.CommuteRewardsLogActionName.FlyoutImpression}return t},w.prototype._getCounterFromStorageKey=function(n){var t,i=parseInt((t=localStorage.getItem(n))!==null&&t!==void 0?t:"");return isNaN(i)?0:i},w._shareFeatureName="Share",w._searchFeatureName="Search",w._trafficFeatureName="Traffic",w._fullscreenFeatureName="Fullscreen",w._embedFeatureName="Embed",w._overlayFeatureName="Overlay",w._localGuideFeatureName="LocalGuide",w._taskbarStyleSet="",w._taskbarStyle="",w._mouseTimeout=150,w._featureNameToAction=function(){var n={};return n[f.collectionsTask]=l.Collections,n[f.directionsTask]=l.Directions,n[w._shareFeatureName]=l.Share,n[w._searchFeatureName]=l.Search,n[w._trafficFeatureName]=l.Traffic,n[w._fullscreenFeatureName]=l.Fullscreen,n[w._embedFeatureName]=l.Embed,n[w._overlayFeatureName]=l.Overlay,n[w._localGuideFeatureName]=l.LocalGuide,n}(),w.hiddenStyle={visibility:"hidden"},w.visibleStyle={visibility:"visible"},w._pressedButtonClass="pressed",w._fullScreenModalDialogContentTemplate='<div class="fullscreenEscape"><p>{escText}<\/p><\/div>',w.isFullScreen=!1,w}(at),pf=function(){function u(t,i,u,f){var h=this,b=this._getTemplate(),l,a,c,v,y,p,w;if(b)this._taskManager=f,this._viewModel=this._CreateTaskBarViewModel(t,i,b,u,this._taskManager),l=this._viewModel.getControl(),this._map=i,this._controlTemplateFactory=u,a=i.getRootElement(),this.feedbackInitialize=new o,this._viewModel.launchFeedbackMenu.add(function(n){h.feedbackInitialize.invoke(n)}),this.dismissMenu=new o,this.dismissMenu.add(function(){h._viewModel.hideMenu()}),this.dismissFeedbackMenu=new o,this.focusFeedbackMenu=new o,this._viewModel.focusFeedback.add(function(){h.focusFeedbackMenu.invoke()}),this._viewModel.hideFeedbackMenu.add(function(){h.dismissFeedbackMenu.invoke()}),this.hoverFeedbackButton=new o,this.hoverFeedbackButton.add(function(){h._viewModel.hoverFeedbackButton()}),this.exitFullScreen=new o,this.exitFullScreen.add(function(){h._viewModel.exitFullScreen.invoke()}),this._visibilityChangedEvent=new o,this._visibilityChangedEvent.add(function(n){h._viewModel.setAutoSuggestExpanded(n)}),this._selectionChangedEvent=new o,this._selectionChangedEvent.add(function(n){h._viewModel.setSelectedSuggestionId(n)}),this._currentSearchBoxQuery=null,this._map.mapTapped.add(function(){h._searchBox&&h._searchBox.blur()}),this._autosuggestResultsFromNearby=!1,a.getParent().insertBefore(l,a),c=r.features.taskFramework,c&&(c.isOSx||c.isSafari)&&l.add_class("bm_safari"),v=n("#maps_sb"),this._viewModel.setIconClass(),this._viewModel._adjustSearchBoxWidth(),v.length>0&&(this._searchBox=v[0],this._viewModel.setSearchBox(this._searchBox)),n(".searchIcon").add_event("click",function(n){h.handleSearchButtonEvents(n)}),y=r.features.autosuggest,y.isEnabled&&(this._suggestionItemSelected=new o,this._suggestionItemSelected.add(function(n){h._onSuggestionItemSelected(n)}),this._suggestionItemClicked=new o,this._suggestionItemClicked.add(function(n){h._onSuggestionItemClicked(n)}),this._onAutosuggestKeydown=new o,this._onAutosuggestKeydown.add(function(n){h.onAutosuggestKeydownFunction(n)}),this._clickHandler=new o,this._clickHandler.add(function(){h.handleClick()}),c.nearbyButtonEnabled&&(this._onAutosuggestNearbyBlur=new o,this._onAutosuggestNearbyBlur.add(function(){return h._setNearbyExpansion()}))),typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_exit",!1,!0,!1)),this._viewModel.insertPopoutInMap(),this.fullScreenEnabled=s.fullScreen,y.enableQueryCompletion&&(p=e.createElementWithClassName("input","bm_completionBox bm_completionBoxHidden"),p.disabled=!0,this._searchBox&&this._searchBox.insertAdjacentElement("afterend",p));else throw new Error("Template is not defined!");this._clearSuggestions=!1;w=n("#b_TriviaOverlay");r.isMapsVertical&&w&&w.length>0&&ei.initialize(this._map,this._taskManager)}return u.prototype.initializeAutosuggest=function(){var f=n("#maps_sb_container"),u=n("#maps_sb"),t=new gr,i,r;this._searchBoxAutosuggestDataModel=t;this._autosuggestViewModel=new hr(t,this._controlTemplateFactory,!0,"TaskBarSearch",this._visibilityChangedEvent,this._selectionChangedEvent);i="as_container_search";r=n("#sb_as_container");this._autosuggest=new cr(r,u,i,this._autosuggestViewModel,this._map);this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown);this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected);this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked);this._autosuggest.setClickEventHandler(this._clickHandler)},u.prototype.handleSearchButtonEvents=function(n){st.enableDirectionsSearch=!1;this._autosuggest&&this._autosuggest.instrumentSearchButtonClickEvent();var t=this._autosuggestViewModel&&this._autosuggestViewModel.getSelectedSuggestion(),i=t?v.Autosuggest:v.SearchButton;this._performSearch(i,t);n&&n.preventDefault&&n.preventDefault()},u.prototype.handleClick=function(){st.enableDirectionsSearch=!0;this._autosuggest&&this._autosuggest.refreshAutosuggest();this._clearSuggestions&&(st.enableDirectionsSearch=!1,this._clearSuggestions=!1,this._searchBox&&this._searchBox.removeAttribute("placeholder"),this._searchBoxAutosuggestDataModel.clearDefaultSuggestions());this._autosuggestResultsFromNearby=!1},u.prototype.onAutosuggestKeydownFunction=function(n){var r=n,o=r.keyCode||r.which,s=this._autosuggestViewModel.getSelectedSuggestion(),u=si.waitForCompositionEnd&&o===229&&r.code==="Enter",t,i,f,e;u&&s===null||(o==13||u)&&(st.enableDirectionsSearch=!1,i=v.SearchBox,this._autosuggestViewModel&&(t=s),si.enableQueryCompletion&&!t&&(f=this._autosuggestViewModel.getCurrentSuggestion(),f&&(t=f.suggestion)),t&&(i=v.Autosuggest),i=this._autosuggestResultsFromNearby?v.Nearby:i,t&&u&&(e=t.searchText,this._searchBox.value=e,this.setSearchTerm(e)),this._performSearch(i,t),this._autosuggestResultsFromNearby=!1)},u.prototype.processCallback=function(n){var t,i,r,u,e,o;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===f.localDetailsTask||n.processorType===f.polygonEntityDetailsTask)&&(t={entryPoint:1},i=n.inData.requestState,i&&(i.searchEntitiesRequested||i.disableTaskActivate)&&n.outData&&n.outData.length>0&&(r=this._getEventTime(n.outData),r&&(u={dateTime:r,timeType:nu.arrival}),e=this._getWaypoint(n.outData),e&&(t.waypoints=[e],u&&(t.options=u))),o={type:f.directionsTask,state:t},c.invokeHandler(h.taskDataHandlerKey,o))},u.prototype.getTaskbarItem=function(n){return this._viewModel.getTaskbarItem(n)},u.prototype._getTemplate=function(){return yu},u.prototype._getWaypoint=function(n){var u=null,i,r,f,t;if(n.length>1||n[0]&&n[0].processorId){for(i=0;i<n.length;i++)if(n[i]&&n[i].data&&(r=n[i],f=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===f&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&!t.isApproximateLocation))){u=new gi(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,3);break}}else n[0]&&n[0]&&n[0].data.entities&&n[0].data.entities.length>0&&(t=n[0].data.entities[0],t&&!t.isApproximateLocation&&(u=new gi(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,3)));return u},u.prototype._getEventTime=function(n){var f,r,u,e,t,o,s;if(n[0]&&n[0]&&n[0].data&&n[0].data.length==1)for(r=0;r<n.length;r++)n[r]&&n[r].data&&(u=n[r],e=u.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===e&&(t=u.data&&u.data.length>0?u.data[0]:null,t&&t.id&&t.id.indexOf("event")>-1&&(o=i.GlobalConfig.features.localSearch.eventPreArrivalTime,t.getDateTime&&t.getDateTime()&&(s=new Date(t.getDateTime()),f=t.getDateTime()+t.getUtcOffset()*6e4-o*6e4))));return f},u.prototype._onSuggestionItemSelected=function(n){this.getSearchTerm()===n.searchText&&this._searchBox&&(this._searchBox.value=n.searchText);this.setSearchTerm(n.searchText)},u.prototype._onSuggestionItemClicked=function(n){this._performSearch(this._autosuggestResultsFromNearby?v.Nearby:v.Autosuggest,n);this._autosuggestResultsFromNearby=!1},u.prototype.onAutosuggestBlurHandler=function(){this.getSearchTerm()||(this._currentSearchBoxQuery&&this.setSearchTerm(this._currentSearchBoxQuery),this._searchBox.setAttribute("placeholder",t.SearchGhostText));this._currentSearchBoxQuery=null},u.prototype._performSearch=function(i,u){var tt=this,y,o,w,g,nt,l,b,a,it,rt,d,ut;wr.setStartTime("SearchRequest");y=this._searchBox?this._searchBox.value.trim():this._viewModel.getSearchTerm().trim();this._viewModel.onSearchInvokedFromTaskbar(null);if(this._autosuggest&&this._autosuggest.stopAutosuggest(),o={},o.query=y,i!==v.Autosuggest&&(o.originalQuery=y),s.searchFormCode&&i!==v.Nearby&&(o.formCode=s.searchFormCode),o.entryPoint=i,i===v.Nearby&&(w=n("div.overlay-taskpane"),g=null,w&&w.length>0&&(nt=w[w.length-1].getAttribute("data-entity"),nt&&(l=JSON.parse(nt),l&&l.routablePoint&&(g={location:l.routablePoint,title:l.entity&&(l.entity.name||l.entity.title||l.entity.adress)}))),o.nearbyPivotEntity=g),o.asConversationId=this._autosuggest&&this._autosuggest.getConversationId(),u&&(this.setSearchTerm(u.searchText),o.query=u.searchText,o.fullQuery=u.searchText,s.updateSearchTermOfAutosuggestWithTaskTitle&&(o.originalQuery=u.searchText),o.filterUrlParam=u.entityId,o.mapBounds=u.mapBounds,u.type==="Favorite"?(!u.entityId&&u.location&&(o.query=u.location.latitude+","+u.location.longitude,o.fullQuery=o.query),o.taskTitle=u.alternateName||u.name,o.asName=u.name,o.asFormattedAddress=u.formatedAddress):(o.asName=u.formatedLine1,o.asFormattedAddress=u.formatedLine2),b=u.primaryCategoryPath,b&&(e._isRestaurantCategory(b)||e._isHotelsCategory(b))&&(o.noAds=!0)),a=this._map.getMode(),a&&(a.mapModeType===2||a.mapModeType===3)&&y?(it=a.getPreviousMapType(),this._map.setMapType(it),rt=a.getPreviousMode(),this._map.setMode(rt),this.setActionsOptions(2047)):this._map.getMapType().id===p.birdseyeV2&&y&&this._map.getBirdseyeV2Manager().then(function(n){var t=tt._map.getMapTypes()[n.previousMapState.mapTypeId||p.road];t&&tt._map.setBaseLayers(t)}),d=r.features,u&&u.title===t.L_SearchNearbyTransit&&d&&d.transit&&d.transit.isEnabled){ut={location:k.getMapCenter(this._map),title:this._nearbyLocationTitle,entryPoint:1};c.invokeHandler(h.taskDataHandlerKey,{state:ut,type:f.nearbyTransitTask});return}c.invokeHandler(h.taskProcessDataHandlerKey,{requestState:o,type:f.localSearchTask})},u.prototype.setActionsOptions=function(n){this._viewModel.setActionsOptions(n)},u.prototype.setActionsState=function(n,t){this._viewModel.setActionsState(n,t)},u.prototype.setSearchTerm=function(n,t){this._viewModel.setSearchTerm(n);t&&c.invokeHandler(h.taskProcessDataHandlerKey,{type:f.localSearchTask,requestState:{query:n}})},u.prototype.getSearchTerm=function(){return this._viewModel.getSearchTerm()},u.prototype.setSearchBoxFocus=function(){this._viewModel.setSearchBoxFocus()},u.prototype.getSearchBox=function(){return n(this._searchBox)},u.prototype.setSearchBoxGhostText=function(n){this._searchBox&&(this._currentSearchBoxQuery=this.getSearchTerm(),this.setSearchTerm(""),this._searchBox.setAttribute("placeholder",n),this.setSearchBoxFocus(),this._clearSuggestions=!0)},u.prototype.updateSearchBoxAutosuggestDefault=function(n,t,i){var u=r.features.taskFramework;this._autosuggestResultsFromNearby=u.nearbyButtonEnabled&&!!i;this._searchBoxAutosuggestDataModel.updateDefaultSuggestions(n,t);this._autosuggest&&this._autosuggest.refreshAutosuggest();this._autosuggest&&this._onAutosuggestNearbyBlur&&this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestNearbyBlur)},u.prototype.setNearbyLocationTitle=function(n){this._nearbyLocationTitle=n},u.prototype._CreateTaskBarViewModel=function(n,t,i,u,f){return new st(n,t,r.isMobile?hu:this._getTemplate(),u,f)},u.prototype._setNearbyExpansion=function(){var i,r,u,t;if(this._autosuggestResultsFromNearby)for(i=n(".ibs_2btns"),i||(i=n(".ibs_3btns")),r=0;r<i.length;r++)u=n(i[r]),t=u.has_class("nearbyBtn")?u:null,t&&t.length>0&&(t.get_attr("aria-expanded")!==undefined||t.get_attr("aria-expanded")!=="")&&t.set_attr("aria-expanded","false")},u.SlideOutAnimDuration=250,u.MinimumTaskBarWidth=62,u.MaximumTaskBarWidth=76,u}(),bt=function(n){function i(i,r,u,f,e,s,h,c,l,a){var v=this,y={},w,p;return v=n.call(this,y)||this,y.defineProperty("title"),y.defineProperty("signInTitle"),y.defineProperty("messageLines"),y.defineProperty("isFaded"),y.defineProperty("isHidden"),y.defineProperty("showClose"),y.defineProperty("showBeak"),y.defineProperty("isDark"),y.defineProperty("preLink"),y.defineProperty("link"),y.defineProperty("postLink"),y.defineProperty("linkUrl"),y.defineProperty("customCssOverride"),h?u&&u.length&&(v._linkMessage=u[0],v._parseLinkMessage(),v.setLinkUrl("#")):v.setMessageLines(u),v.setTitle(r),v.setShowClose(!0),v.setShowBeak(!1),v.setIsDark(s),v.setCustomCssOverride(a),v.resources=t,v.tipRemoved=new o,v.signedIn=new o,v.messageLinkClicked=new o,v.tipHovered=new o,v._map=i,v._autoFadeHandlers=[],w=v._createTemplate(c),v.setTemplate(w),v._tipElement=v.getRootElement(),p=function(){v._fadeTimeout&&window.clearTimeout(v._fadeTimeout);v._tipElement&&v.removeTip()},f||(v._map&&(v._autoFadeHandlers.push(v._map.mapPanStarted.addOne(p)),v._autoFadeHandlers.push(v._map.mapTapped.addOne(p)),v._autoFadeHandlers.push(v._map.mapZoomStarted.addOne(p))),v._fadeTimeout=Microsoft.Maps.setTimeout(function(){v._tipElement&&v.fadeTip()},l?l:4e3)),e&&(v._windowClickEventHandler=function(n){if(v&&v.rendered){var i=n.target,t=v.getRootElement();t&&t.has(i)||Microsoft.Maps.setTimeout(function(){v.removeTip()},1)}},Microsoft.Maps.setTimeout(function(){window.addEventListener("click",v._windowClickEventHandler)},1)),v}return y(i,n),i.prototype.fadeTip=function(){var n=this;this.setIsFaded(!0);Microsoft.Maps.setTimeout(function(){n.removeTip()},1e3)},i.prototype.removeTip=function(){this._tipElement&&this._tipElement.removeFromParent();this._tipElement=null;this.tipRemoved&&this.tipRemoved.invoke();this.dispose()},i.prototype.dispose=function(){window.removeEventListener("click",this._windowClickEventHandler);e._clearDisposables(this._autoFadeHandlers);n.prototype.dispose.call(this)},i.prototype._createTemplate=function(n){var t=this;return new it(n||bu,{boolToDisplay:function(n){return t._boolToDisplay(n)},boolToNotDisplay:function(n){return t._boolToDisplay(!n)},boolToFadedClass:function(n){return t._boolToFadedClass(n)},nullToDisplayNone:function(n){return t._nullToDisplayNone(n)},closeClicked:function(n){n.preventDefault();t.removeTip()},onSignedIn:function(){t.signedIn&&t.signedIn.invoke();t.removeTip()},onTipHoverOver:function(n){n&&n.stopPropagation();n&&n.preventDefault();t.tipHovered&&t.tipHovered.invoke()},onTipHoverOut:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onLinkClicked:function(n){n&&n.stopPropagation();t.getLinkUrl()==="#"&&n&&n.preventDefault();t.messageLinkClicked&&t.messageLinkClicked.invoke();t.removeTip()}})},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._boolToFadedClass=function(n){var t=this.getCustomCssOverride();return"bm_tooltips"+(this.getIsDark()?" dark":"")+(n?" reminderHiddenFade":"")+(t?" "+t:"")},i.prototype._nullToDisplayNone=function(n){return n?"":"none"},i.prototype._parseLinkMessage=function(){var n=this._linkMessage,t,i,r;n&&(t=n.indexOf("<link>"),t!==-1?(i=n.slice(0,t),i&&this.setPreLink(i),n=n.substr(t).replace("<link>",""),t=n.indexOf("<\/link>"),r=n.slice(0,t),r&&this.setLink(r),n=n.substr(t).replace("<\/link>",""),n&&this.setPostLink(n)):this.setLink(n))},i}(ut),wf=function(n){function t(t,i){var r=n.call(this,null,null,[i],!0,!0,!1,!0,pu)||this;return r._privates.defineProperty("iconText",null,null,{defaultValue:t}),r.setShowClose(!1),r.setShowBeak(!0),r}return y(t,n),t}(bt),bf=function(n){function i(i,r,u,f){var e=this,o=[t.L_Tooltip_Itinerary_Saved_Text];return e=n.call(this,i,"",o,!1,!0,f)||this,e.separator=" "+String.fromCharCode(183)+" ",e._privates.defineProperty("name",null,null,{defaultValue:u}),e._privates.defineProperty("showEditName",null,null,{defaultValue:!1}),e._relatedTaskId=r,e.setShowClose(!1),e.setShowBeak(!0),e}return y(i,n),i.prototype._createTemplate=function(){var n=this;return new it(wu,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},renameClicked:function(t){t.preventDefault();n._onRenameClick()},onKeyPressed:function(t){t.keyCode===13&&n._onSaveLinkClick()},onSaveLinkClick:function(t){t.preventDefault();n._onSaveLinkClick()}})},i.prototype._onRenameClick=function(){window.clearTimeout(this._fadeTimeout);e._clearDisposables(this._autoFadeHandlers);var n=this.getRootElement().select(".nameEditBox");n&&n.length&&(n[0].value=this.getName());this.setIsDark(!1);this.setShowEditName(!0);this.setShowClose(!0);window.removeEventListener("click",this._windowClickEventHandler)},i.prototype._onSaveLinkClick=function(){var n=this.getRootElement().select(".nameEditBox"),t=n&&n.length&&n[0].value,i,r;t&&(i={action:6,title:t},r={type:f.itineraryDetailsTask,requestState:i,taskId:this._relatedTaskId},c.invokeHandler(h.taskProcessDataHandlerKey,r));this.fadeTip()},i}(bt);i.TaskBar=pf;i.Flyover=ir;i.Landmarks3D=uf;i.FlywheelButtonViewModel=rf;i.FlywheelBannerViewModel=tf;u.SharingDialogViewModel=cf;u.PrintManager=wt;u.SlideOutMenu=typeof fr!="undefined"?fr:undefined;u.BirdsEyeV2DialogViewModel=typeof tr!="undefined"?tr:undefined;u.CommutabilityControl=ku;u.CommutabilityControlV2=gu;u.CommutabilityControlOverlay=du;u.CommutabilityControlV2Overlay=nf;u.CommuteRewards=a;u.UserTipControl=bt;u.SaveSuccessTipControl=bf;u.SaveOnSerpConfirmationTip=wf}catch(or){if(i.logger)i.logger.logCriticalError(or);else throw or;}}).call(window)