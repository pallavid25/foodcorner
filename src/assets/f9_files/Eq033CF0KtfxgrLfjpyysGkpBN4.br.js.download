(function(){var p,fi,at,ai,tt;try{(function(){var n={L_Collections_NotFound_Text:"The original result is no longer available:",L_Collections_TryAgain_Text:"Try searching and saving again.",L_FilterName_AlongARoute:"Along a route",L_FilterName_QueryRep_FilterBy_AllPrices:"All Prices",L_FilterName_QueryRep_FilterBy_AllRatings:"All Ratings",L_FiltersBar_Rating_OptionSuffix:"& up",L_LocalSearch_BackToCollections:"Favorites group",L_LocalSearch_BackToSearchResults:"Search results",L_LocalSearch_ReturnToList:"return to list",L_LocalSearch_ReturnToItinerary:"return to itinerary",L_SearchNearbyGhostTextFormat:"Search near {query}",L_SearchNearbyTerm_1:"Parking",L_SearchNearbyTerm_2:"Hotels",L_SearchNearbyTerm_3:"Restaurants",L_SearchNearbyTerm_4:"Coffee",L_NearbyMinute:"min",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_SearchNearbyCategoryId_1:"90925",L_SearchNearbyCategoryId_2:"91572",L_SearchNearbyCategoryId_3:"90287",L_SearchNearbyCategoryId_4:"91649",L_SearchNearbyCategoryId_5:"90089",L_SearchNearbyCategoryId_6:"90738",L_SearchNearbyCategoryId_7:"250",L_SearchNearbyTerm_5:"Gas stations",L_SearchNearbyTerm_6:"Grocery stores",L_SearchNearbyTerm_7:"Nearby Transit",L_NearbyFloatingContainerNearbyTitle:"Nearby",L_NearbyFloatingContainerDrivingTitle:"Driving",L_NearbyFloatingContainerTransitTitle:"Transit",L_NearbyFloatingContainerWalkingTitle:"Walking",Nearby_Search_Area:"Search this area",L_FiltersBar_UserRating_SelectionLabel:"Rating: {0} stars & up",L_Menu_SuggestAnEdit_Link_Text:"Suggest an edit",L_FiltersBar_UserRating_SelectionLabel_HighestRating:"Rating: {0} stars",L_FilterName_QueryRep_FilterBy_AllCuisines:"All Cuisines",L_PrintEntityAddress_Text:"Address:",L_PrintEntityPhone_Text:"Phone:",L_PrintEntityTitle_Text:"Title:",L_PrintNotes_Watermark:"Type your notes here.",L_PrintEntityWebsite_Text:"Website:",L_PrintCurrency_Text:"$",L_PrintExtendedArea_Text:"Area:",L_PrintExtendedAt_Text:"Located At:",L_PrintExtendedAvgRate_Text:"Average Rate:",L_PrintExtendedCapitol_Text:"Capital:",L_PrintExtendedCC_Text:"Calling Code:",L_PrintExtendedCounty_Text:"County Seat:",L_PrintExtendedCuisine_Text:"Cuisine:",L_PrintExtendedFounded_Text:"Founded:",L_PrintExtendedGDP_Text:"GDP:",L_PrintExtendedHotelClass_Text:"Hotel Class:",L_PrintExtendedLatLong_Text:"Location:",L_PrintExtendedPopulation_Text:"Population:",L_PrintExtendedPrice_Text:"Price:",L_PrintExtendedTravelTip_Text:"Travel Tip:",L_WikipediaTitle_Text:"Wikipedia",L_HoursLabel_Text:"Hours",L_ReportMissingBusiness_Text:"Add a Missing Business",Overlay_NewErrorLink_Separator:"{0} or {1}",L_AddMissingBusinessCardTitle:"Add missing business",L_AddMissingBusinessMessage:"Did not find what you are looking for?",L_PrintClinicTitle_Text:"Clinic:",L_PrintHomeFactsTitle_Text:"Home Facts",L_PrintLastSoldTitle_Text:"Last Sold:",L_PrintMoreInfoTitle_Text:"More Info",L_PrintSpecialtyTitle_Text:"Specialty:",L_PrintZestimateTitle_Text:"ZEstimate ",L_PrintExperienceTitle_Text:"Years of experience:",L_FilterName_QueryRep_FilterBy_Price:"Price",L_FilterName_QueryRep_FilterBy_Rating:"Rating",L_FilterName_QueryRep_FilterBy_Cuisine:"Cuisine",L_FilterName_QueryRep_FilterBy_OpenTime:"Open time",L_FilterName_QueryRep_FilterBy_Amenities:"Amenities",L_FilterName_QueryRep_SortBy:"Sort by",L_AddNickNameOption:"Add a nickname",L_AddNoteOption:"Add a description",L_EditNickNameOption:"Edit nickname",L_EditNoteOption:"Edit description",L_DeleteNickNameOption:"Delete nickname",L_DeleteNoteOption:"Delete description",L_AddButton:"Add",L_EditButton:"Save",L_AnnotateToolTip:"Add a nickname or description",L_ReservationTitle:"Your Reservation",L_FlightTitle:"Your Flight",L_EventInfoMessage:"This event was inferred from your Outlook email account or calendar.",L_CheckInText:"Check-in",L_CheckOutText:"Check-out",L_SeeEmailLinkText:"See email for this reservation",L_SeeEmailFlightLinkText:"See email for this flight",L_DepartureText:"Departs ",L_ArrivalText:"Arrives at ",L_AirportFormat:"{0} ({1})",L_AirlineFormat:"{0} Confirmation #{1}",L_SeeMoreFlightsText:"See your other flights",L_VenueMapTaskTitle_Suffix:"Directory - ",L_VenueMapTask_NoEntity_Message:"Detailed directory of this level coming soon",L_VenueMapTask_NoCategory_Message:"No business of selected category on this level",L_PrintTrailInfo_Text:"Trail Data:",L_PrintSeason_Text:"Season:",L_PrintDifficulty_Text:"Difficulty:",L_PrintActivities_Text:"Activities:",L_PrintSeparator_Text:" · ",L_PrintAnnualVisitors_Text:"Annual Visitors:",L_PrintArchitects_Text:"Architect(s):",L_PrintArchitectureFirm_Text:"Architecture Firm:",L_PrintArtists_Text:"Artists:",L_PrintAverageStay_Text:"Average Stay:",L_PrintCapacity_Text:"Capacity:",L_PrintDateCompleted_Text:"Date Completed:",L_PrintEstablished_Text:"Established:",L_PrintFloors_Text:"Floors:",L_PrintHeight_Text:"Height:",L_PrintInterests_Text:"Interests:",L_PrintMainSites_Text:"Main Sites: ",L_PrintMedia_Text:"Media:",L_PrintOpened_Text:"Opened:",L_PrintOpen_Text:"Open:",L_PrintRates_Text:"Rates:",L_PrintServiceAreas_Text:"Service Areas:",L_PrintSites_Text:"Sites:",L_PrintSubjects_Text:"Subjects:",L_PrintTeams_Text:"Team(s):",L_PrintElevation_Text:"Elevation:",L_PrintFirstAscender_Text:"First ascender:",L_PrintFirstAscent_Text:"First ascent:",L_PrintLastEruption_Text:"Last eruption:",L_PrintMountainRange_Text:"Mountain range:",L_PrintProminence_Text:"Prominence:",L_PrintCollegesUniversities_Text:"Colleges and universities:",L_PrintNearbyAirport_Text:"Nearby Airport(s):",L_AddToItinerary:"Add to Itinerary",L_SaveTooltip:"Save",L_ShareTooltip:"Share",L_EllipsisTooltip:"More",L_TimeDriveHome_Text:"{0} drive from home",L_TimeDriveWork_Text:"{0} drive from work",L_TimeWalkHome_Text:"{0} walk from home",L_TimeWalkWork_Text:"{0} walk from work",L_TimeDurationLessThan_Text:"< {0} min",AnnotationCloseText:"Close",PaginationNextLabelText:"Next Page",PaginationPreviousLabelText:"Previous Page",PaginationMoreLabelText:"See more",InfoboxListAriaLabel:"Click for more details",L_Deal_Text:"DEAL",HotelsFound:"Found ",HotelsNear:" hotels near ",HotelPricesHere:"Hotel prices here are ",HotelCityAverage:" than city average",HotelPricesCheaper:" cheaper ",HotelPricesExpensive:" more expensive ",HotelPricesWithin:"within",HotelWithinCityAverage:" city average",HotelDistanceFromCityCenter:" miles away from city center",HotelThisLocation:"This location is ",HotelNear:"near",HotelCityCenter:" city center",HotelAreaSafety:"Area safety here is ",HotelSafetyExcellent:"Excellent",HotelSafetyGood:"Good",HotelSafetyNeutral:"Neutral",MetadataLine:"{0} · {1}",CoffeeMetadataLine:"Coffee · {0}",L_Menu_Print_Link_Text:"Print"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("LocalSearch",n):window.$MicrosoftMaps8.ResourcesObject=n})();var o=window.$MicrosoftMaps8,a=o.Local=o.Local||{},v=o.Internal=o.Internal||{},kt=v.TaskData=v.TaskData||{},ki=o.Directions=o.Directions||{},ct=v.AdsScenario,de=o.ButtonGroupViewModel,di=v._BaseMapTemplateSelector,h=v.BaseTask,yt=v.BaseTaskViewModel,ge=o.BirdseyeV2Metadata,no=o.BitmapImageTemplate,du=o.GlobalConfig.features.calendar,gu=o.CalendarSync,to=v.CanvasDrawingContext,pt=kt.CollectionActions,io=o.GlobalConfig.features.collections,ro=o.CommonControls.CollectionsListDropdownViewModel,dt=v.ControlTemplate,f=o.DataHandlerKeys,nf=v._Debug,tf=ki.DefaultDirectionsFormattedTextProvider,uo=o.DetailsTaskPoiManager,ur=o.GlobalConfig.features.directions,fr=o.Directions.DirectionsInputData,fo=o.CommonControls.DirectionsListDropdownViewModel,g=kt.DirectionsMode,er=kt.DistanceUnit,u=v._EntryPoints,ft=v._FeatureNames,or=o.GlobalConfig.features.feedback,rf=o.FiltersBarModuleViewModel,eo=o.FiltersBarViewModel,oo=o.FiltersStatusBarViewModel,uf=o.FiltersBar,gt=o.FiltersBarItem,wt=o.FiltersBarItemData,t=v._Gimme,c=o.GlobalConfig,e=o.GlobalDataEventHandler,lt=o.Heading,i=v._Helper,sr=o.HomeOrWorkEnabledLocalSearchEntity,so=typeof o.Infobox!="undefined"?o.Infobox:undefined,nt=v._JSEvent,ho=v._LatLonCrs,hr=c.features.layerManager,ff=o.CommonControls.ListDropdownViewModel,n=c.features.localSearch,ni=o.LocalSearchEntity,co=v._LocalStorageCache,cr=o.LocationRect,ef=v._MapAuthentication,ot=v.MapHelper,lo=v.MapInteractionBehavior,b=o.Location,lr=o.MapMath,sf=o.MapsInfobox,ei=o.MapTypeId,ar=o.MapView,hf=o.MapViewAnimator,ao=o.MicroPoiManager,cf=o.CommonControls.ModalDialogViewModel,st=v._Network,ti=v._ObservableObject,vo=v._ObservableObjectChangedArgs,oi=v._ObservableCollection,yo=v._OverlayEntity,lf=o.CommonControls.PopOutButtonViewModel,po=o.CommonControls.PopOutMessageViewModel,wo=o.CommonControls.CollectionPopOutMessageViewModel,bo=c.features.parking,vr=o.GlobalConfig.features.print,yr=v.PrintContent,pr=v.PrintManager,k=v._PerfV2Logger,wr=kt.RecommendationEntity,r=o.ResourceManager.LocalSearch,af=o.ResultsTaskPoiManager,vf=ki.RouteErrorType,yf=ki.RouteResultsDataModel,si=o.SignInState,hi=o.SimplePointPrimitive,pf=v._StreetsidePerfConstants,ut=o.CommonControls.ServerSideAds,ci=o.CommonControls.TnAAds,ko=o.TaskBar,go=o.TaskMapInteractionBehavior,ii=v._TaskDataHandlerHelper,w=c.features.taskFramework,s=o.TaskTypes,ns=o.TopicSearchPoiManager,ts=o.VectorImageTemplate,is=o.VectorMapLayer,rs=v.TipComponents,bt=kt.Waypoint,us=o.CommonControls.SelectionListDropdownViewModel,br=o.GlobalConfig.features.streetside,ri=o.GlobalConfig.features.travel,li=o.ZoomLevel,fs=v.TransientLensActions,es=o.PolygonListingTaskPoiManager,wf='<div class="bm_annotationRoot" data-tag="annotationRoot">    <div class="auxillaryButtons">        <a class="annotateButton" data-tag="annotateButton" role="button" aria-expanded="false" event:click="onAnnotateClick" href="#" title="{Binding resources.L_AnnotateToolTip}" aria-expanded="false"><\/a>    <\/div>    <div class="nameContainer">        <TextBlock Text="{Binding CurrentName}" />    <\/div>    <div class="annotateDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}">        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding CurrentName Converter=displayNameChangeMessage}" event:click="onAddNicknameClick" style:display="{Binding IsHomeWork Converter=boolToNotDisplay}" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding Description Converter=displayNoteChangeMessage}" event:click="onAddDescriptionClick" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding resources.L_DeleteNickNameOption}" event:click="onDeleteNicknameClick" style:display="{Binding CurrentName Converter=displayDeleteNickName}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNickNameOption}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding resources.L_DeleteNoteOption}" event:click="onDeleteDescriptionClick" style:display="{Binding Description Converter=boolToDisplay}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNoteOption}" />        <\/a>    <\/div>    <div class="annotatePopOut popOutTop nickNamePopOut" style:display="{Binding ShowNickNameEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" data-tag="annotateClose" event:click="onCloseClick" href="#" role="button" aria-label="{Binding resources.AnnotationCloseText}" title="{Binding resources.AnnotationCloseText}"><\/a>        <div id="addNameLabel">            <TextBlock text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/div>        <div class="nameInputContainer">            <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressName" aria-labelledby="addNameLabel"/>            <a href="#" class="annotationAddButton" role="button" data-tag="annotationAddButton" event:click="onSaveNickNameClick">                <TextBlock Text="{Binding CurrentName Converter=showAddEditNameButton}" />            <\/a>        <\/div>    <\/div>    <div class="annotatePopOut popOutTop descriptionPopOut" style:display="{Binding ShowDescriptionEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" role="button" data-tag="annotateClose" event:click="onCloseClick" href="#" aria-label="{Binding resources.AnnotationCloseText}" title="{Binding resources.AnnotationCloseText}"><\/a>        <div id="addDescriptionLabel">            <TextBlock text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/div>        <div class="descriptionInputContainer">            <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressNote" aria-labelledby="addDescriptionLabel"><\/textarea>            <a href="#" class="annotationAddButton" role="button" data-tag="annotationAddButton" event:click="onSaveDescriptionClick">                <TextBlock Text="{Binding Description Converter=showAddEditNoteButton}" />            <\/a>        <\/div>    <\/div>    <div class="descriptionContainer" style:display="{Binding Description Converter=boolToDisplay}">        <TextBlock Text="{Binding Description}" />    <\/div>    <div class="originalNameContainer" style:display="{Binding CurrentName Converter=displayIfDifferentName}">        <TextBlock Text="{Binding OriginalName}" />    <\/div><\/div>',bf='<ul>    <ItemsControl ItemsSource="{Binding geochainSegments}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <li><TextBlock Text="{Binding displayName}" /><\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/ul>',gi='<div class="localEntitiesPrintText" data-tag="localEntitiesPrintText">    <div class="localEnititiesList" data-tag="localEntitiesList">        <ItemsControl ItemsSource="{Binding printEntities}" panelTagName="ul">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <div class="printEntity" data-tag="detailPrintEntity">                            <div class="printEntityTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                <div class="localSearchPrintTitle" data-tag="localDetailsPrintTitle">                                    <TextBlock Text="{Binding Title}" />                                <\/div>                            <\/div>                            <div class="printEntityTitle" style:display="{Binding originalName Converter=nullToDisplayNone}">                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintOriginalName">                                    <TextBlock Text="{Binding originalName}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityAddress" style:display="{Binding Address Converter=hideIfMatchedData}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                    <TextBlock Text="{Binding Address}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                    <TextBlock Text="{Binding Phone}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintWebsite">                                    <TextBlock Text="{Binding Website}" />                                <\/div>                            <\/div>                        <\/div>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="isText showText dataPrintFacts">        <div class="localPrintFactsList" data-tag="localPrintFactsList">            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                    <div class="localPrintFactLabel">                                        <TextBlock Text="{Binding factLabel}" />                                    <\/div>                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                        <div style:display="{Binding factData Converter=nullToDisplayNone}">                                            <TextBlock Text="{Binding factData}" />                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                            <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                    <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.length}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.elevation}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.duration}" />                                                <\/span>                                            <\/div>                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                            <\/span>                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                <\/span>                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                            <\/span>                                        <\/div>                                    <\/div>                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                        <div class="localPrintFactLabel trailDifficulty">                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                        <\/div>                                        <span class="{Binding extendedFacts.difficulty}">                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div>    <div class="isText showText">        <div class="printHours" data-tag="detailPrintHours" style:display="{Binding listHours Converter=emptyToDisplayNone}">            <div class="localPrintLabel">                <TextBlock Text="{Binding resources.L_HoursLabel_Text}" />            <\/div>            <table>                <ItemsControl ItemsSource="{Binding listHours}" panelTagName="tbody">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <tr data-tag="hourListing">                                <td class="dayOfTheWeek" data-tag="dayOfTheWeek"><TextBlock Text="{Binding day}" /><\/td>                                <td class="hoursOfTheDay" data-tag="hoursOfTheDay">                                    <ItemsControl ItemsSource="{Binding hourRanges}">                                        <ItemsControl.ItemTemplate>                                            <DataTemplate>                                                <div class="todaysHours" data-tag="todaysHours">                                                    <TextBlock Text="{Binding start}" />                                                    <TextBlock Text=" - " />                                                    <TextBlock Text="{Binding end}" />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.ItemTemplate>                                    <\/ItemsControl>                                <\/td>                            <\/tr>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/table>        <\/div>    <\/div><\/div>',kf='<div class="isText showText localListingListPrintText" data-tag="localListingListPrintText">    <div class="entitiesCol1" data-tag="entitiesCol1">        <div class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntities}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" alt="{Binding iconText}"/>                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="schoolFact" style:display="{Binding schoolInfo Converter=nullToDisplayNone">                                        <TextBlock Text="{Binding schoolInfo}" />                                    <\/div>                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <div class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                                                                                                    <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                    <\/div>                                <\/div>                             <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>           <\/div>    <div class="entitiesCol2" style:display="{Binding printEntitiesList2 Converter=nullToDisplayNone}" data-tag="entitiesCol2">        <div class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntitiesList2}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" alt="{Binding iconText}"/>                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <div class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                        <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>                    <\/div><\/div>',df='<div class="LocalListingTitlePrint" data-tag="LocalListingTitlePrint">    <div class="printQuery">        <div class="localSearchPrintTitle" data-tag="localSearchPrintTitle">            <TextBlock Text="{Binding query}" />        <\/div>    <\/div><\/div>',kr='<div class="localSearchPrintPanel" data-tag="localSearchPrintPanel">    <div class="localSearchPrintText">        <div>            <table>                <tr>                    <td class="textColumn">                        <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true"><\/Tab>                    <\/td>                    <td class="noteColumn">                        <div class="printNotes localPrintNotes" style:display="{Binding isDetails Converter=boolToDisplay}">                            <div class="searchNotesTableData screenNotes">                                <textarea class="searchNotes" contenteditable="true" aria-label="{Binding resources.L_PrintNotes_Watermark}" placeholder="{Binding resources.L_PrintNotes_Watermark}" maxlength="{Binding notesMaxCharSize}" data-tag="printNotes">                                    <TextBlock Text="{Binding PrintNotes}" />                                <\/textarea>                            <\/div>                            <div class="printedNotes">                            <\/div>                        <\/div>                    <\/td>                                    <\/tr>            <\/table>        <\/div>        <div>            <Tab TabContent="{Binding printListingsViewModel}" TabTemplate="{Binding listingsPrintTemplate}" IsDisplayed="true"><\/Tab>        <\/div>    <\/div>    <div class="localSearchMapPrint isMap showMap taskMapPrintPageBreak" data-tag="localSearchMapPrint">        <div class="printArea" data-tag="printArea">            <div class="printMap" data-tag="printMap">            <\/div>        <\/div>    <\/div>    <div class="detailsAttribution" style:display="{Binding isDetails Converter=boolToDisplay}">        <TextBlock Text="{Binding attributionText}"/>    <\/div><\/div>',gf='<div class="bm_report-missing-business-link-content">    <div class="feedbackCardLabel">        <TextBlock Text="{Binding resources.L_AddMissingBusinessMessage}" />    <\/div>    <div class="feedbackCardText">        <a href="#" class="reportProblemLink" role="button" event:click="addMissingEntityLinkClicked">            <TextBlock Text="{Binding resources.L_ReportMissingBusiness_Text}" />        <\/a>    <\/div><\/div>',ne='<div class="bm_svrpagination" style:display="{Binding showSeeMore Converter=boolToDisplay}">        <div class="om_wfr_sm">        <span class="om_wfr_smw">            <a href="#" class="om_wfr_smlk" aria-label="{Binding resources.PaginationMoreLabelText}" role="button" event:click="seeMoreClicked">                <span class="om_wfr_smtxt"><TextBlock Text="{Binding resources.PaginationMoreLabelText}" /><\/span>                <span class="om_wfr_arrow"><\/span>            <\/a>        <\/span>    <\/div><\/div>',te='<div class="bm_sk_boldDetails">    <div class="skbd_topImages">        <div class="skbd_topImage"><\/div>        <div class="skbd_topImage"><\/div>        <div class="skbd_topImage"><\/div>        <div class="skbd_topImage sk_last"><\/div>    <\/div>    <div class="skrd_gap"><\/div>    <div class="skbd_twoColumn">        <div class="skbd_leftPane">            <div class="skbd_boldTitle"><\/div>            <div class="skbd_boldTitleSub"><\/div>            <div class="skbd_boldLongLine"><\/div>            <div class="skbd_boldLongLine"><\/div>            <div class="skbd_boldShortLine"><\/div>            <div class="skbd_boldShortLine"><\/div>            <div class="skrd_buttonWrapper">                <div class="skrd_buttons left"><\/div>                <div class="skrd_buttons left"><\/div>                <div class="skrd_buttons right"><\/div>            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>        <\/div>        <div class="skbd_rightPane">            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>            <div class="skbd_repeatMod">                <div class="skbd_mod1">                    <div class="skbd_modTitle"><\/div>                    <div class="skbd_blockImages">                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                        <div class="skbd_blockImage"><\/div>                    <\/div>                <\/div>                <div class="skbd_mod2">                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                    <div class="skbd_seg">                        <div class="skbd_modTitle"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleLine"><\/div>                        <div class="sk_itemSingleShortLine"><\/div>                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',ie='<div class="bm_sk_TopicSearchLanding">    <div class="bm_sk_tsContainer">        <div class="ts_cardTitle"><\/div>        <ul class="ts_filters">            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>            <li class="ts_filter_item">                <div class="ts_filter_box" />            <\/li>        <\/ul>        <ul class="ts_carousels">            <li class="ts_singleCarousel">                <div class="ts_carouselTitle">                <\/div>                <div class="ts_carouselItems">                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                <\/div>            <\/li>            <li class="ts_singleCarousel">                <div class="ts_carouselTitle">                <\/div>                <div class="ts_carouselItems">                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                <\/div>            <\/li>            <li class="ts_singleCarousel">                <div class="ts_carouselTitle">                <\/div>                <div class="ts_carouselItems">                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                <\/div>            <\/li>            <li class="ts_singleCarousel">                <div class="ts_carouselTitle">                <\/div>                <div class="ts_carouselItems">                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                <\/div>            <\/li>            <li class="ts_singleCarousel">                <div class="ts_carouselTitle">                <\/div>                <div class="ts_carouselItems">                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                    <div class="ts_carouselItem"><\/div>                <\/div>            <\/li>        <\/ul>    <\/div><\/div>',re='<div class="bm_svrpagination">        <div>        <a href="#" role="button" class="bm_leftChevron" aria-label="{Binding resources.PaginationPreviousLabelText}" event:click="leftChevronClicked" style:display="{Binding showLeftChevron Converter=boolToDisplay}"><\/a>    <\/div>    <div>        <a href="#" role="button" class="bm_rightChevron" aria-label="{Binding resources.PaginationNextLabelText}" event:click="rightChevronClicked" style:display="{Binding showRightChevron Converter=boolToDisplay}"><\/a>    <\/div>    <\/div>',dr='<div class="bm_sk_regularDetails">    <div class="skrd_mainImage"><\/div>    <div class="skrd_buttonWrapper">        <div class="skrd_buttons left"><\/div>        <div class="skrd_buttons right"><\/div>    <\/div>    <div class="skrd_line"><\/div>    <div class="skrd_line"><\/div>    <div class="skrd_shortLine"><\/div>    <div class="skrd_gap"><\/div>    <div class="bm_sk_SingleList">        <ul>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>        <\/ul>    <\/div><\/div>',ue='<div class="bm_sk_largeDetails">    <div class="skld_mainImage"><\/div>    <div class="skld_buttonWrapper">        <div class="skld_buttons"><\/div>        <div class="skld_buttons"><\/div>        <div class="skld_buttons"><\/div>    <\/div>    <div class="skld_line"><\/div>    <div class="skld_line"><\/div>    <div class="skld_shortLine"><\/div>    <div class="skrd_gap"><\/div>    <div class="bm_sk_SingleList">        <ul>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>        <\/ul>    <\/div><\/div>',ui='<div class="bm_sk_SingleList">    <ul>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>    <\/ul>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li><\/div>',fe='<div class="bm_nearbyMapContainer bm_hideOnLoad">    <div class="bm_nearbyMapSearchButton" aria-role="alert" aria-live="polite">        <div id="map-manual-refresh" class="ol_refreshpanel bm_nearbySearchArea" >            <span><TextBlock Text="{Binding resources.Nearby_Search_Area}" /><\/span>        <\/div>    <\/div>    <div class="b_nearbyFloatingContainer">        <span class="nearbyIcon"><\/span>        <div class="nearbyText" aria-label="{Binding titleText}">            <TextBlock Text="{Binding titleText}" />        <\/div>        <span class="nearbyModePic"><\/span>        <div class="nearbyDropdown" tabindex="-1" aria-label="{Binding drivingText}">            <TextBlock Text="{Binding drivingText}" />            <span class="nearbyDropdownIcon"><\/span>        <\/div>        <div class="nearbyDropdownList" >            <a class="nearbyDrivingOption" role="button" href="#">                <span class="b_nearbyFloatingContainerDrivingImg"><\/span>                <TextBlock Text="{Binding drivingText mode=TwoWay}" />            <\/a>            <a class="nearbyWalkingOption" role="button" href="#">                <span class="b_nearbyFloatingContainerWalkingImg"><\/span>                <TextBlock Text="{Binding walkingText mode=TwoWay}" />            <\/a>            <a class="nearbyTransitOption" role="button" href="#">                <span class="b_nearbyFloatingContainerTransitImg"><\/span>                <TextBlock Text="{Binding transitText mode=TwoWay}" />            <\/a>        <\/div>        <div class="nearbyClose">            <span class="nearbyCloseIcon"><\/span>        <\/div>    <\/div><\/div>',gr='<div class="bm_sk_MultiList">    <ul>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>    <\/ul><\/div>',ee='<div class="bm_upcomingEventsRoot" data-tag="upcomingEvents">    <div class="infoIcon" event:mouseover="onInfoHovered" event:mouseout="onInfoExited"><\/div>    <div class="upcomingEventPopUp popOutTop" style:display="{Binding ShowPopUp Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_EventInfoMessage}" />    <\/div>    <ItemsControl ItemsSource="{Binding Events}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div style:display="{Binding eventIndex Converter=initiallyHideOtherFlights}">                    <hr class="collectionSeparator flightSeparator" style:display="{Binding eventIndex Converter=displayAfterFirst}" />                    <div class="hotelEventDetails" style:display="{Binding type Converter=hotelToDisplay}">                        <h2>                            <TextBlock Text="{StaticBinding resources.L_ReservationTitle}" />                        <\/h2>                        <div class="checkInDetails">                            <div class="checkInTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckInText}" />                            <\/div>                            <div class="checkInTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="checkOutDetails">                            <div class="checkOutTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckOutText}" />                            <\/div>                            <div class="checkOutTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailLinkText}" />                            <\/a>                        <\/div>                    <\/div>                    <div class="flightEventDetails" style:display="{Binding type Converter=flightToDisplay}">                        <h2 style:display="{Binding eventIndex Converter=hideAfterFirst}">                            <TextBlock Text="{StaticBinding resources.L_FlightTitle}" />                        <\/h2>                        <div class="airlineDetails">                            <TextBlock Text="{Binding $self$ Converter=getAirlineDetails}" />                        <\/div>                        <div class="departureDetails">                            <div class="departureAirport">                                <TextBlock Text="{StaticBinding resources.L_DepartureText}" />                                <a class="airportLink" data-task="{Binding departureAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding departureAirport.entity.businesslistingid Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding departureAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="departureTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="arrivalDetails">                            <div class="arrivalAirport">                                <TextBlock Text="{StaticBinding resources.L_ArrivalText}" />                                <a class="airportLink" data-task="{Binding arrivalAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding arrivalAirport.entity.businesslistingid  Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding arrivalAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="arrivalTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailFlightLinkText}" />                            <\/a>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="showMoreFlights" style:display="{Binding ShowOtherFlights Converter=showMoreFlightButton}">        <hr class="collectionSeparator flightSeparator" />        <a class="showMoreLink" event:click="onExpandClick" href="#">            <TextBlock Text="{StaticBinding resources.L_SeeMoreFlightsText}" />        <\/a>    <\/div><\/div>',nu='<div>    <div class="bm_filtersBarModule"><\/div>    <ItemsControl ItemsSource="{Binding entities}" PanelTagName="div" class="bm_venueDirectory">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div class="bm_venueEntity" data-task="{Binding taskInfo}" event:click="onBusinessClick" event:mouseover="onBusinessMouseOver" event:mouseout="onBusinessMouseOut">                    <div class="bm_venueEntityWrapper">                        <div class="bm_entityDetails">                            <div class="bm_localName">                                <TextBlock Text="{Binding name}"><\/TextBlock>                            <\/div>                            <div class="bm_phoneNumber">                                <TextBlock Text="{Binding phoneNumber}"><\/TextBlock>                            <\/div>                            <div class="bm_floorName">                                <TextBlock Text="{Binding floorName}"><\/TextBlock>                            <\/div>                        <\/div>                    <\/div>                    <div class="bm_entityDivider"><\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="bm_noEntityMessage">    <\/div><\/div>',tu='<div>    <ItemsControl ItemsSource="{Binding entities}" PanelTagName="div" id="bm_venueDirectory">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div class="card bm_venueEntity" data-task="{Binding taskInfo}" event:click="onBusinessClick" event:mouseover="onBusinessMouseOver" event:mouseout="onBusinessMouseOut">                    <div id="bm_venueEntityWrapper">                        <div class="textContainer" id="bm_entityDetails">                            <div class="title bm_localName">                                <TextBlock Text="{Binding name}"><\/TextBlock>                            <\/div>                            <div class="subtitle" id="bm_phoneNumber">                                <TextBlock Text="{Binding phoneNumber}"><\/TextBlock>                            <\/div>                            <div class="notes" id="bm_floorName">                                <TextBlock Text="{Binding floorName}"><\/TextBlock>                            <\/div>                        <\/div>                    <\/div>                    <div id="bm_entityDivider"><\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="bm_noEntityMessage">    <\/div><\/div>',y=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),iu=function(n){function o(t,i,u,f,e,o,s){s===void 0&&(s=null);var h=this,c={};return h=n.call(this,c)||this,c.defineProperty("currentName"),c.defineProperty("originalName"),c.defineProperty("description"),c.defineProperty("tempAnnotation"),c.defineProperty("isHomeWork"),c.defineProperty("showDropdown",function(n,t){return h._onShowPopOutChanged(n,t)}),c.defineProperty("showNickNameEdit",function(n,t){return h._onShowPopOutChanged(n,t)}),c.defineProperty("showDescriptionEdit",function(n,t){return h._onShowPopOutChanged(n,t)}),h.controlTemplateFactory=t,h._templateName=wf,h.disposables=[],h.annotationChanged=new nt,h.setCurrentName(f),h.setIsHomeWork((f==="Home"||f==="Work")&&f!==e),h.setOriginalName(e?e:f),h.setDescription(o),h.setShowDropdown(!1),h.setShowNickNameEdit(!1),h.setTempAnnotation(""),h.resources=r,h._map=i,h._isAddress=u,h._impressionGuid=s,h._windowClickEventHandler=function(n){var t=h._control,i=t.select(".nickNamePopOut"),r=t.select(".descriptionPopOut");i&&i.has(n.target)||r&&r.has(n.target)||(h._hideDropdown(n),h._hideDescriptionPopOut(n),h._hideNickNamePopOut(n))},h._windowKeyupEventHandler=function(n){var r=n,i,t;if(r.keyCode===9){if(i=document.activeElement,t=i&&i.classList,i&&(t.contains("annotateEntry")||t.contains("nickNamePopOut")||t.contains("descriptionPopOut")||t.contains("nameEditBox")||t.contains("descriptionEditBox")||t.contains("annotationAddButton")||t.contains("annotateClose")))return;h._hideDropdown(n);h._hideDescriptionPopOut(n);h._hideNickNamePopOut(n)}},h}return y(o,n),o.prototype.boolToDisplay=function(n){return n?"":"none"},o.prototype.boolToNotDisplay=function(n){return n?"none":""},o.prototype.displayIfDifferentName=function(n){return n===this.getOriginalName()?"none":""},o.prototype.displayDeleteNickName=function(n){return n===this.getOriginalName()||this.getIsHomeWork()?"none":""},o.prototype.displayNameChangeMessage=function(n){return n===this.getOriginalName()?this.resources.L_AddNickNameOption:this.resources.L_EditNickNameOption},o.prototype.displayNoteChangeMessage=function(n){return n?this.resources.L_EditNoteOption:this.resources.L_AddNoteOption},o.prototype.showAddEditNameButton=function(n){return n===this.getOriginalName()?this.resources.L_AddButton:this.resources.L_EditButton},o.prototype.showAddEditNoteButton=function(n){return n?this.resources.L_EditButton:this.resources.L_AddButton},o.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},o.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},o.prototype.onAnnotateClick=function(n){this.setShowDropdown(!0);Microsoft.Maps.setTimeout(function(){var n=t(".bm_annotationRoot"),r=t(".annotateDropdown ",n[0]);i._setFocusOnFirstMenuItem(r)},100);this._logInstrumentation("Annotate");n.stopPropagation();n.preventDefault()},o.prototype.onAddNicknameClick=function(n){this.setShowDropdown(!1);this.getCurrentName()!==this.getOriginalName()&&this.setTempAnnotation(this.getCurrentName());this.setShowNickNameEdit(!0);var i=t(".nameEditBox",this._control[0]);i&&i.length&&i[0].focus();this._logInstrumentation("EditNickName");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onAddDescriptionClick=function(n){var r,i;this.setShowDropdown(!1);r=this.getDescription();r&&this.setTempAnnotation(r);this.setShowDescriptionEdit(!0);i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value=this.getTempAnnotation());i&&i.length&&i[0].focus();this._logInstrumentation("EditNotes");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onDeleteNicknameClick=function(n){this.setShowDropdown(!1);this.setCurrentName(this.getOriginalName());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("DeleteNickName");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onDeleteDescriptionClick=function(n){this.setShowDropdown(!1);this.setDescription(null);this.setTempAnnotation("");var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value="");this.annotationChanged.invoke();this._logInstrumentation("DeleteNotes");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onSaveNickNameClick=function(n){this.setShowNickNameEdit(!1);var i=this.getTempAnnotation().trim();i&&(i=t.Internals.HTMLEncode(i),this.setCurrentName(i),this.setTempAnnotation(""),this.annotationChanged.invoke());this._logInstrumentation("SaveNickName");n&&n.stopPropagation();n&&n.preventDefault()},o.prototype.onSaveDescriptionClick=function(n){this.setShowDescriptionEdit(!1);this.setDescription(this.getTempAnnotation());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("SaveNotes");n&&n.stopPropagation();n&&n.preventDefault()},o.prototype.onCloseClick=function(n){this.setShowDescriptionEdit(!1);this.setShowNickNameEdit(!1);this.setTempAnnotation("");var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value="");n.stopPropagation();n.preventDefault()},o.prototype.onKeyPressName=function(n){if(n.keyCode===13)this.onSaveNickNameClick(null)},o.prototype.onKeyPressNote=function(n){if(n.keyCode===13&&!n.shiftKey){var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&i[0].blur();this.onSaveDescriptionClick(null)}},o.prototype.addAuxillaryButton=function(n){var t=this.getControl().select(".auxillaryButtons"),i;t&&t.length>0&&(i=t.select("a"),i&&i.length>0&&t.insertBefore(n,i))},o.prototype._onShowPopOutChanged=function(n,i){var u=this,r=t(window);i?Microsoft.Maps.setTimeout(function(){r.add_event("click,contextmenu",u._windowClickEventHandler);r.add_event("keyup",u._windowKeyupEventHandler)},1):n&&(r.remove_event("click,contextmenu",this._windowClickEventHandler),r.remove_event("keyup",this._windowKeyupEventHandler),this._focusAnnotateButton())},o.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._hideNickNamePopOut=function(){this.getShowNickNameEdit()?this.setShowNickNameEdit(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._hideDescriptionPopOut=function(){this.getShowDescriptionEdit()?this.setShowDescriptionEdit(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._logInstrumentation=function(n){var t={AN:n,EP:u.LocalDetails},i={logData:{feature:"DC",action:"C",data:t},impressionGuid:this._impressionGuid};e.invokeHandler(f.instrumentationDataHandlerKey,i)},o.prototype._focusAnnotateButton=function(){var n=this.getControl().select(".annotateButton");n&&n.length&&n[0].focus()},o}(ti),ru=function(){function n(){}return n}(),oe=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return y(t,n),t}(ru),os=[new gt("RestaurantPrice","bm_Price",r.L_FilterName_Price,2,1).addAllOptions([1,2,3,4].map(function(n){for(var t="",i=0;i<n;i++)t=t.concat(r.L_FiltersBar_Price_Unit);return new wt(n.toString(),t,"RestaurantPrice_RPrice"+(n+1))})),new gt("HotelStarRating","bm_Rating",r.L_FilterName_Rating,1,2,function(n){return i._formatString(r.L_FiltersBar_HotelRating_SelectionLabel,n.getSelectedOptions().map(function(n){return n.value}).join(", "))}).addAllOptions([2,3,4].map(function(n){return new wt(n.toString(),r.L_FiltersBar_HotelRating_OptionSuffix,"UserRating_URating"+(2*n-1)+"Up")})).addOption(new wt("5","","UserRating_URating9Up")),new gt("CuisineCategory","bm_Cuisine",r.L_FilterName_Cuisine,2,0).addAllOptions(["91210","91216","91221","91223","91225","91229","91238"].map(function(n){return new wt(n,r["L_FiltersBar_Cuisine_"+n],"CuisineCategory_"+n)}))],uu=function(n){function t(t,i){var r=this,u={};return r=n.call(this,u,i,bf)||this,u.defineProperty("geochainSegments"),r.setGeochainSegments(t),r}return y(t,n),t}(yt),nr=function(n){function t(t){var i=n.call(this,t.getTitle(),t.getAddress(),t.id,t.getLocation(),t.getRoutableLocation(),t.getMenuUrl(),t.getImageUrl(),t.getPrimaryCategoryPath(),t.getPrimaryCategoryName(),t.getVdpId(),t.getLocationType(),t.getDateTime())||this;return t.getPhone()&&n.prototype.setPhone.call(i,t.getPhone()),t.getWebsite()&&n.prototype.setWebsite.call(i,t.getWebsite()),i.factData=null,i.factLabel=null,i.colorIndex=null,i.resources=r,i}return y(t,n),t.prototype.hideIfMatchedData=function(n){var t=n;return t===null||this.getTitle()===t?"none":""},t.prototype.nullToDisplayNone=function(n){return n?"":"none"},t}(ni),ss=function(n){function s(t,i,u,f){var e=this,o={};return e=n.call(this,o)||this,o.defineProperty("events"),o.defineProperty("showPopUp"),o.defineProperty("showOtherFlights"),e.controlTemplateFactory=t,e._templateName=ee,e.disposables=[],e.resources=r,e._map=i,e._id=f,e.setEvents(u),e._logEventShownInstrumentation(),e}return y(s,n),s.prototype.boolToDisplay=function(n){return n?"":"none"},s.prototype.boolToNotDisplay=function(n){return n?"none":""},s.prototype.nullToDisplayNone=function(n){return n?"":"none"},s.prototype.hotelToDisplay=function(n){return n==="Events.HotelEvent"?"":"none"},s.prototype.flightToDisplay=function(n){return n==="Events.FlightEvent"?"":"none"},s.prototype.getTimeString=function(n){if(n){var t=i._formatLongDateString(n),r=i._formatTimeString(n);return"{0}, {1}".replace("{0}",t).replace("{1}",r)}return""},s.prototype.getAirportText=function(n){return n?this.resources.L_AirportFormat.replace("{0}",n.city).replace("{1}",n.airportCode):""},s.prototype.getAirlineDetails=function(n){return n?this.resources.L_AirlineFormat.replace("{0}",n.airline).replace("{1}",n.reservationId):""},s.prototype.initiallyHideOtherFlights=function(n){return!this.getShowOtherFlights()&&n>0?"none":""},s.prototype.displayAfterFirst=function(n){return n>0?"":"none"},s.prototype.hideAfterFirst=function(n){return n>0?"none":""},s.prototype.hideIfEntity=function(n){return n===this._id?"none":""},s.prototype.displayIfEntity=function(n){return n===this._id?"":"none"},s.prototype.showMoreFlightButton=function(n){var t=this.getEvents();return!n&&t&&t[0]&&t[0].type==="Events.FlightEvent"&&t.length>1?"":"none"},s.prototype.onExpandClick=function(n){this.setShowOtherFlights(!0);var t=this.getEvents();this.setEvents([]);this.setEvents(t);n.preventDefault();n.stopPropagation()},s.prototype.onInfoHovered=function(){this.setShowPopUp(!0)},s.prototype.onInfoExited=function(){this.setShowPopUp(!1)},s.prototype.buildEventDataTaskAttribute=function(n){var i=o.CloudGraphDataManager.CollectionEntity.buildEntityDataTaskOptions(n);return i.state.taskTitle="",i.activateOptions={},t.Internals.stringify(i)},s.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},s.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},s.prototype._logEventShownInstrumentation=function(){var n={AN:"UE",EP:u.LocalDetails},t={logData:{feature:"DC",action:"A",data:n}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},s}(ti),rt;(function(n){n[n.ID=0]="ID";n[n.SB=1]="SB"})(rt||(rt={})),function(n){n[n.STP=0]="STP";n[n.LLT=1]="LLT";n[n.LDT=2]="LDT";n[n.LDA=3]="LDA";n[n.LLR=4]="LLR";n[n.LSR=5]="LSR";n[n.RAP=6]="RAP";n[n.MBR=7]="MBR";n[n.FLBK=8]="FLBK";n[n.SPR=9]="SPR";n[n.LLA=10]="LLA"}(p||(p={})),function(n){n[n.NoBoldUX=0]="NoBoldUX";n[n.BoldUXInNarrowWidth=1]="BoldUXInNarrowWidth";n[n.BoldUXInWideWIdth=2]="BoldUXInWideWIdth"}(fi||(fi={})),function(n){n[n.Collapsed=0]="Collapsed";n[n.NarrowWidth=1]="NarrowWidth";n[n.WideWidth=2]="WideWidth"}(at||(at={})),function(n){n[n.SingleColumn=1]="SingleColumn";n[n.TwoColumns=2]="TwoColumns";n[n.ThreeColumns=3]="ThreeColumns"}(ai||(ai={})),function(n){n[n.Collapsed=0]="Collapsed";n[n.SingleColumn=1]="SingleColumn";n[n.TwoColumns=2]="TwoColumns";n[n.ThreeColumns=3]="ThreeColumns"}(tt||(tt={}));var fu=function(){function n(n){this._perfLogger=n}return n.prototype.perfStart=function(n){if(rt[n]){var t=ft.Search+"_"+rt[n];return this._perfLogger.start(t)}return null},n.prototype.log=function(n,t,i){var r={impressionGuid:i,logData:{feature:ft.Search,action:p[n],data:t}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.prototype.getMarketFromBingPlacesUrl=function(n){var r=n&&n.select("div.wpc_sfl")[0],u=r&&r.lastElementChild,f=u&&u.href,t=f&&f.split("market="),i=t&&t.length>1?t[1].split("&"):null;return i&&i.length>0?i[0]:""},n}(),eu=function(){function u(n,t,i,r,u,f,e){var o=this,s;this.map=n;this.panelRoot=t;this._logHelper=i;this._selector=r;this._attributeName=u;this._pushpins=[];this._entities=[];this._eventHandlers=[];this._disposables=[];this._transientLensViewModel=f;this._transientLensViewModel&&this._transientLensViewModel.initializeCollections();this.landMarkFilterRule=null;this._signInSate=new si;this._isSignedIn=this._signInSate.getIsSignedIn();this._disposables.push(this._signInSate.notifySignedIn.add(function(n){return o._isSignedIn=n}));this.changed=new nt;this.titleChanged=new nt;this.catIdPopulated=new nt;this.catIdPopulated.add(function(){return o._assignEntitySearchCategory()});this.launchOverflowTask=new nt;e&&e.selectedCategoryId&&(s=e.selectedCategoryId);this.populateCardCategoryId(s)}return u.getSuggestionIconColor=function(){return i._isHighContrastMode()?u._highContrastSuggestionIconColor:u._suggestionIconColor},u.prototype.selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this.map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},u.prototype.dispose=function(){this.clear();i._clearDisposables(this._disposables);this._transientLensViewModel.dispose()},u.prototype.setResponseContent=function(r,u,f){var s,h,e,c,o;r&&(this.clear(f),this.panelRoot&&(f&&f.isInfiniteScroll||this.panelRoot.clear(),this.parseEntitiesFromResponse(r,u,f),this._parseLandMarkMetaData(r),this._parseCategoryData(r),s=!0,!n.showContentFirstForPermalinks||i._getUrlParam(window.location,"disablecf")==="1"||(h=t(".cardPrimer"),e=t(".cardPrimer .contentRoot"),e&&e.length>0&&e[0].children.length>0&&r.select(".nonajaxCardPrimer").length>0&&(c=e.select(".bm_filterBar"),c.length>0&&c.removeFromParent(),f&&f.isInfiniteScroll||this.panelRoot.append(t(e[0].children[0])),s=!1),h&&h.removeFromParent()),!s||f&&f.isInfiniteScroll||(o=r.length>0&&r[0].innerHTML,this.localEntitiesWithinRUBRegion(r,u)&&(o="<div><\/div>"),o?this.panelRoot.appendHTML(o):this.panelRoot.append(r)),f&&f.isInfiniteScroll||this._forceImageRedrawForEdge(),this._addWebResultBoxCLickHandler()),u&&(u.originIG=u.originIG||l.getImpressionGuid(this.panelRoot),Microsoft.Maps.setTimeout(function(){if(!u.localFilters){var n=i._decodeHTML(t(".stickyFiltersRoot .bm_filterBar").get_attr("fp"));n&&(u.localFilters=n)}},0)))},u.prototype.getResponseContainer=function(){return this.panelRoot},u.prototype.getCardCategoryId=function(){return this._cardCategoryId},u.prototype.getPushpinPrimitives=function(){return this._pushpins},u.prototype.clearPushpinPrimitives=function(){this._pushpins=[]},u.prototype.UpdatePrimitiveState=function(n,t){for(var u,r=!1,i=0,f=this._pushpins.length;i<f;i++)if(this._pushpins[i].entity.id===n){if(u=this._pushpins[i].entity,u&&u.isApproximateLocation)return r;this._pushpins[i].viewState=t;this._pushpins[i].revision=(this._pushpins[i].revision||0)+1;r=!0;break}return r},u.prototype.getEntities=function(){return this._entities},u.prototype.localEntitiesWithinRUBRegion=function(n,t){var r,f,u,o,s,e;if(i._shouldDisableLoadingForRUBRegion()&&t.fromSharing&&(r=this.parseEntitiesFromResponse(n,t),r&&r.entities))for(f=r.entities,u=0,o=f.length;u<o;u++)if(s=f[u],e=s.getLocation(),i._shouldDisableShareForPoint(e.latitude,e.longitude))return!0;return!1},u.prototype.parseEntitiesFromResponse=function(n,i,r){var u=this,f,e;return r&&r.infiniteScrollData&&r.infiniteScrollData.entities.length>0?(this._entities=this._entities.concat(r.infiniteScrollData.entities),this._pushpins=this._pushpins.concat(r.infiniteScrollData.pushpins),{entities:this._entities,pushpins:this._pushpins}):(f=n.select(this._selector),f.for_each(function(r){var f=r.getAttribute(u._attributeName),e=r.getAttribute("data-facts"),s=e&&t.Internals.parseJSON(e);if(f){var h=t.Internals.parseJSON(f),o=r.getAttribute("data-itineraryfacts"),c=o&&t.Internals.parseJSON(o);u.processEntity(h,n,i,!1,s,c)}}),e=n.select(".lsAdMetadata"),e.for_each(function(r){var f=r&&r.getAttribute("data-entity"),e;f&&(e=t.Internals.parseJSON(f),u._lsAdPin=u.processEntity(e,n,i,!1,null,null,r))}),{entities:this._entities,pushpins:this._pushpins})},u.prototype.isTaskOnItinerarySlideout=function(n){var t;return n&&((t=n.parentTaskId)===null||t===void 0?void 0:t.startsWith(s.itineraryDetailsTask))},u.prototype.processEntity=function(n,t,i,r,u,f,e){var o,g,s,d,v,y,a,l,p;if(!n)return null;if(o=n.entity,!o&&i&&(o={title:i.query}),o&&!o.title&&i&&(o.title=i.query),o&&o.title){var w=n.geometry,k=n.routablePoint,h=null,c=null;if(w&&(h=new b(w.y,w.x)),k&&(c=new b(k.latitude,k.longitude)),h||(h=c),c||(c=h),h&&c)return(g=this._isSignedIn,s=g?new sr(o.title,o.address,o.id,h,c,o.menuUrl,o.imageUrl,o.primaryCategoryPath,o.primaryCategoryName,o.vdpId,o.locationType,o.startDateTime,o.endDateTime,o.utcOffset,o.isAllDayEvent,o.segmentTypes):new ni(o.title,o.address,o.id,h,c,o.menuUrl,o.imageUrl,o.primaryCategoryPath,o.primaryCategoryName,o.vdpId,o.locationType,o.startDateTime,o.endDateTime,o.utcOffset,o.isAllDayEvent,o.segmentTypes),o.phone&&s.setPhone(o.phone),o.website&&s.setWebsite(o.website),o.subtitle&&(s.subtitle=o.subtitle),o.iconText&&(s.iconText=o.iconText),o.isUpHierarchy&&(s.isUpHierarchy=!0),o.isApproximateLocation&&(s.isApproximateLocation=!0),o.usePricePoi&&(s.usePricePoi=!0),o.badgeType&&(s.badgeType=o.badgeType),o.infoboxHtml&&(s.infoboxHtml=o.infoboxHtml),o.disablePoiLabel&&(s.disablePoiLabel=!0),o.city&&s.setCity(o.city),o.localFilters&&s.setLocalFilters(o.localFilters),d=o.chainId,d&&s.setChainId(d),o.adProviderId&&(s.adBusinessLocationId=o.adBusinessLocationId,s.adImpressionGuid=o.adImpressionGuid,s.adProviderId=o.adProviderId,s.adQuery=o.adQuery,s.adRetailEntitySource=o.adRetailEntitySource,s.adStoreId=o.adStoreId,s.adTriggerType=o.adTriggerType,s.adYpid=o.adYpid),e&&(v=e.getElementsByClassName("b_emb_adblock"),(v===null||v===void 0?void 0:v.length)>0&&(y=v[0].getElementsByTagName("a"),(y===null||y===void 0?void 0:y.length)>0&&(s.infoboxAdLink=y[0]))),t&&this._updateEntityState(t,s),a=null,s.subtitle&&s.subtitle.indexOf("useastitle:")>-1&&(s.subtitle=s.subtitle.replace("useastitle:",""),s.subtitle&&s.subtitle.length>0&&(a=s.clone(),a.setTitle(s.subtitle),a.subtitle=null)),l=new hi(h,a!==null?a:s),l.entity.poiType=1,s.isApproximateLocation&&(l.viewState=3),o.isPermanentlyClosed&&(s.isPermanentlyClosed=!0),u&&this._updateEntityWithDataFacts(s,u),f&&this._updateEntityWithItineraryFacts(s,f),r&&(p=this._findPushpin(s.id),p>0))?(this._pushpins[p]=l,this._entities[p]=s,l):(this._pushpins.push(l),this._entities.push(s),l)}return null},u.prototype._updateEntityWithDataFacts=function(n,t){var s,h,f;n.interests=t.Interests;n.stayDuration=t["Average stay"];n.addressFields=t.addressFields;var i=n.getPrimaryCategoryName(),e=n.getPrimaryCategoryPath(),u=n.getSegmentTypes();if(t.campgrounds)s=t.campgrounds,n.metadataString=r.MetadataLine.replace("{0}",s.RVSites).replace("{1}",s.tentSites);else if(t.trails)h=t.trails,n.metadataString=r.MetadataLine.replace("{0}",h.length).replace("{1}",h.elevation);else if(i&&i==="Hotel"&&t["Hotel class"])n.metadataString=t["Hotel class"];else if(i&&i==="Restaurant"||e.indexOf("90232")>-1||e.indexOf("90287")>-1){var c=t.cuisine&&t.cuisine.split(","),o=c&&c.length&&c[0],f=t.price&&this._escapePriceString(t.price);o&&f?n.metadataString=r.MetadataLine.replace("{0}",o).replace("{1}",f):f?n.metadataString=t.price:o&&(n.metadataString=o);i||(i="Restaurant")}else e&&e.indexOf("91649")>-1&&t.price?(f=this._escapePriceString(t.price),n.metadataString=r.CoffeeMetadataLine.replace("{0}",f)):u&&u.length&&u[0]==="Events"&&(n.metadataString=t.Venue);n.mainSegmentType=i?i:u&&u.length&&u[0]},u.prototype._updateEntityWithItineraryFacts=function(n,t){t.Address&&(n.addressFields=t.Address);t.PhoneNumber&&n.setPhone(t.PhoneNumber);t.PriceInfo&&(n.fullPriceString=t.PriceInfo);t.AverageStay&&(n.averageStay=t.AverageStay);t.Categories&&(n.interests=t.Categories.join(", "));t.Rating&&(n.rating=t.Rating);t.OpenHours&&(n.openHours=t.OpenHours);t.Action&&t.Action.ActionName&&t.Action.ActionUrl&&(n.actionName=t.Action.ActionName,n.actionUrl=t.Action.ActionUrl)},u.prototype._escapePriceString=function(n){return n.indexOf("$")===0?"$"+n:n},u.prototype._findPushpin=function(n){for(var t=0;t<this._pushpins.length;t++)if(this._pushpins[t].entity&&this._pushpins[t].entity.id===n)return t;return-1},u.prototype.getHouseListingCounts=function(){return null},u.prototype.getPaginationRootId=function(){return null},u.prototype.updateAdvertising=function(n){this.updateTextAds(n);this.updateTnAAds();this.updateLocalSearchAds()},u.prototype.updateTextAds=function(){},u.prototype.updateTnAAds=function(){},u.prototype.updateLocalSearchAds=function(){},u.prototype.processDirectionsData=function(){},u.prototype.processCollectionsData=function(){},u.prototype.processTravelData=function(){},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.nullToDisplayNone=function(n){return n?"":"none"},u.prototype.hideIfMatchedData=function(n){return n===null||this.getEntities()[0].getTitle()===n?"none":""},u.prototype.emptyToDisplayNone=function(n){return n&&n.length?"":"none"},u.prototype._updateEntityState=function(){},u.prototype._addEventsToEventList=function(n,t,i){this._eventHandlers.push({item:n,eventName:t,handler:i})},u.prototype.clear=function(){this._pushpins=[];this._entities=[];this._eventHandlers.forEach(function(n){n.item.remove_event(n.eventName,n.handler)});this._eventHandlers=[]},u.prototype._parseLandMarkMetaData=function(n){var r=n.select("div[data-landmark]"),u,i;if(r.length==1&&(u=r[0],i=u.getAttribute("data-landmark"),i)){var f=t.Internals.parseJSON(i),s=f.type,e=[],o=[];f.value.forEach(function(n){e.push(n.CategoryID);o.push(n.Percentage)});this.landMarkFilterRule={field:s,value:e,distribution:o}}},u.prototype.parseSuggestionMetaData=function(){var r=this.panelRoot.select("div[data-suggestions]"),u,n,f,i;return r.length!=1?null:(u=r[0],n=u.getAttribute("data-suggestions"),!n)?null:(f=t.Internals.parseJSON(n),i=[],f.forEach(function(n){var t=[];n.viewport&&n.viewport.length>1&&!isNaN(n.viewport[0].latitude)&&!isNaN(n.viewport[0].longitude)&&!isNaN(n.viewport[1].latitude)&&!isNaN(n.viewport[1].longitude)&&(t.push(new b(n.viewport[0].latitude,n.viewport[0].longitude)),t.push(new b(n.viewport[1].latitude,n.viewport[1].longitude)));i.push({Name:n.name,Id:n.categoryId,viewport:t})}),i)},u.prototype._drawCategoryItem=function(n,t,r,u){var e=t.Name,c=t.Id,h=i._createElement("li"),f=i._createElement("a"),o,s;return f.set_attr("class","searchNearbySuggestionLinkIcon"),o=i._createElement("div"),o.set_attr("class","suggestionIconBound"),f.add_event("click",u),this._addEventsToEventList(f,"click",u),f.set_attr("data-tag",r+"."+e),f.set_attr("aria-label",e),f.set_attr("href","#"),f.set_attr("role","button"),f.append(o),h.append(f),s=null,e.indexOf("Transit")>-1&&(s="#2F95EB"),window.matchMedia("screen and (-ms-high-contrast: black-on-white)").matches?s="black":window.matchMedia("screen and (-ms-high-contrast: white-on-black)").matches&&(s="white"),n.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i.set_attr("title",e),i.set_attr("alt",e),o.append(i),o.appendText(t.Name))},c,s,25,25),h},u.prototype._parseCategoryData=function(){},u.prototype.populateCardCategoryId=function(n){var t=this;n===""?(this.categoryFound=!1,this.catIdPopulated.invoke()):n?this.map.getTemplateSelector().then(function(){var i=di.extractCategoryId(n,!1);i&&(t._cardCategoryId=i,t.changed.invoke());t.categoryFound=typeof t._cardCategoryId!="undefined";t.catIdPopulated.invoke()}):this.catIdPopulated.invoke()},u.prototype.addReportLinkToNoResultCard=function(t,u,f){var b=this,c,h,e,l,y,o,p,w,s,a,k,v,d;t.select("div[data-answerinfo]").length>0&&(c=t.select("div[data-answerinfo]"),c.get_attr("data-answerinfo")==="0"&&(n.useNewErrorCard?this._createNewReportLinkForNoResultCard(u,c,f):(h=i._createElement("p"),e=i._createElement("a"),e.set_text(r.L_Menu_ReportProblem_Link_Text),e.set_attr("href","#"),e.set_attr("data-tag","reportProblemLink"),e.set_attr("class","reportProblemLink"),l=i._createElement("div"),l.set_attr("class","reportProblemLinkWrapper"),l.append(e),h.append(l),y=c.select(".query"),o=y.length>0?y[0].textContent:"",o=o||f&&f.query,p=this.getUserFacts(),this._houseIntentFound(f)||(w=i._createElement("span"),w.set_attr("class","reportProblemLinkSeparator"),h.append(w),s=i._createElement("a"),s.set_text(r.L_ReportMissingBusiness_Text),s.set_attr("href","#"),s.set_attr("class","reportProblemLink"),a=i._createElement("div"),a.set_attr("class","reportProblemLinkWrapper"),a.append(s),h.append(a),k=function(n){return b.onAddMissingBusinessLinkClicked(n,u,o,o,p,1)},s.add_event("click",k)),v=this.panelRoot.select(".errmsg"),v.append(i._createElement("br")),v.append(h),v.append(i._createElement("br")),d=function(n){return b._onReportProblemLinkClick(n,u,o,o,p)},e.add_event("click",d))))},u.prototype.onAddMissingBusinessLinkClicked=function(n,t,i,u,o,h){n.preventDefault();var c={AN:"RapEntryPoints#"+h.toString()};this._logHelper&&this._logHelper.log(p.MBR,c);e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,state:{entryPoint:3,feedbackTaskType:6,title:r.L_AddMissingBusinessCardTitle,activeTaskId:t,options:{dataFacts:{parentId:t},reportType:1,noFoundType:2,userFacts:o,rapEntryPoint:h}}})},u.prototype._addWebResultBoxCLickHandler=function(){var i=this,n,t;this.panelRoot&&(n=this.panelRoot.select(".b_mapWebResults"),n.length&&(t=n.select(".b_wrBox"),t.length&&t.for_each(function(n){var r,t,u;if(n&&(r=n.getElementsByClassName("b_webResult"),r&&r.length&&(t=r[0].getElementsByTagName("a"),t&&t.length))){for(u=0;u<t.length;u++)t[u].setAttribute("target","_blank");n.addEventListener("click",function(){var r=t[0].getAttribute("href"),u,f,n;r&&(_w.open(r,"_blank"),u=l.getImpressionGuid(i.panelRoot),f=_G.IG,_G.IG=u,n="&"+t[0].getAttribute("h"),_w.si_sbwu&&_w.si_sbwu(n)||_w.si_T&&_w.si_T(n),_G.IG=f)})}})))},u.prototype._createNewReportLinkForNoResultCard=function(t,u,f){var b=this,h=i._createElement("div"),e,l,p,o,w,a,v,s,y,k,c,d;h.add_class("linkContainer");e=i._createElement("a");e.set_text(r.L_Menu_ReportProblem_Link_Text);e.set_attr("href","#");e.set_attr("data-tag","reportProblemLink");e.set_attr("class","reportProblemLink");l=i._createElement("div");l.set_attr("class","reportProblemLinkWrapper");l.append(e);h.append(l);p=u.select(".query");o=p.length>0?p[0].textContent:"";o=o||f&&f.query;w=this.getUserFacts();this._houseIntentFound(f)||(a=i._createElement("span"),a.set_attr("class","reportProblemLinkSeparator"),n.useNewErrorCard&&(v=r.Overlay_NewErrorLink_Separator,v=v.replace("{0}","").replace("{1}",""),a.set_text(v)),h.append(a),s=i._createElement("a"),s.set_text(r.L_ReportMissingBusiness_Text),s.set_attr("href","#"),s.set_attr("class","reportProblemLink"),y=i._createElement("div"),y.set_attr("class","reportProblemLinkWrapper"),y.append(s),h.append(y),k=function(n){return b.onAddMissingBusinessLinkClicked(n,t,o,o,w,1)},s.add_event("click",k));c=this.panelRoot.select(".mapErrLinksContainer");c.length===0&&(c=this.panelRoot.select(".mapErrLinksContainerFilter"));c.length>0&&(c.append(h),d=function(n){return b._onReportProblemLinkClick(n,t,o,o,w)},e.add_event("click",d))},u.prototype._houseIntentFound=function(n){if(n){if(n.searchQueryCategory&&i._isHouseCategory(n.searchQueryCategory))return!0;if(n.categoryLayers&&n.categoryLayers.length)for(var t=0;t<n.categoryLayers.length;t++)if(n.categoryLayers[t]&&i._isHouseCategory(n.categoryLayers[t]))return!0}return!1},u.prototype._onReportProblemLinkClick=function(n,t,i,r,u){n.preventDefault();this._logHelper&&this._logHelper.log(p.RAP,{AN:"RapEntryPoints#2"});e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:3,title:i,activeTaskId:t,options:{query:r,reportType:1,userFacts:u,rapEntryPoint:2}}})},u.prototype._forceImageRedrawForEdge=function(){var n=this;t.Browser.is_edge&&Microsoft.Maps.setTimeout(function(){for(var u=n.panelRoot.select(".irpserp img, .cico img"),i=0,o=u.length;i<o;i++){var r=u[i],f=r,e=function(n){t([n.srcElement]).set_style({outline:"0px solid white"});n.srcElement.removeEventListener("load",e)};f&&!f.complete?r.addEventListener("load",e):t([r]).set_style({outline:"0px solid white"})}},0)},u.prototype._assignEntitySearchCategory=function(){var n=this.getCardCategoryId(),t=this.getEntities();n&&t&&t.length&&t.forEach(function(t){t.setSearchCategory(n);(n==="Event"||n==="Events")&&t.setSelectedCategoryForIcon(n)})},u.prototype.getUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},u._suggestionIconColor="rgb(96,96,96)",u._highContrastSuggestionIconColor="rgb(255,255,0)",u}(),vi=function(a){function v(i,u,f,e,o,s,h,l,y,p){var w=a.call(this,i,u,e,"div.overlay-taskpane","data-entity",o,l)||this,b,k,d,g;if(w._adsVisibleLogged=!1,w._annotationControlAdded=!1,w._nearbyButton=null,w._preProcessLinks=function(n){var t,i,r;try{if(sj_evt.unbind("accordionAjaxResponse",w._preProcessLinks),n&&n.length>1)for(t=n[1],i=0;i<t.length;i++)r=t[i],r&&r.tagName==="DIV"&&w._handleExternalLinks(r)}finally{sj_evt.fire("accordionProcessed",t)}},w._handleExternalLinks=function(n){for(var i,r,u=n.getElementsByTagName("a"),t=0;t<u.length;t++)i=u[t],r=i.href,r.indexOf(v._externalLinkAttrNameWithHash)>-1&&w._processExternalLink(r,i)},w._processHotelsAndRestaurantsSeoLinks=function(n,i){if(n){var r=n.indexOf("#data-process=");n=n.substring(r+14);n=n.replace(/\?form=[a-zA-Z]*[0-9]*/i,"");i.setAttribute("data-process",n);i.setAttribute("href","#")}return t.Internals.parseJSON(n)},w._buttonGroupViewModel=s,w._moduleClickEventInitialized=!1,w._controlTemplateFactory=y,w._taskId=f,w._state=l,l&&l.savedEntityId&&(w.savedEntityId=l.savedEntityId),l&&l.collectionId&&(w.collectionId=l.collectionId),l&&l.itineraryTaskId&&(w.itineraryTaskId=l.itineraryTaskId),l&&l.id&&(w.itineraryEntityId=l.id),w.printNotes="",w._taskBar=h,w.iconClass="srcTsk",w.resources=r,w.printTitleViewModel=null,w._primitivesInteracted=p,b=n.searchNearbyDefaultSuggestions,w._searchNearbyDefaultCategories=[],b){for(k=0;k<b.length;k++)if(d=b[k].split(":"),d.length==2){var it=d[0],rt=d[1],nt=r[it],tt=r[rt];nt&&tt&&w._searchNearbyDefaultCategories.push({Name:nt,Id:tt})}g=c.features;g&&g.transit&&g.transit.isEnabled&&(w._searchNearbyDefaultCategories[w._searchNearbyDefaultCategories.length-1]={Name:r.L_SearchNearbyTerm_7,Id:r.L_SearchNearbyCategoryId_7})}return w}return y(v,a),v.prototype.dispose=function(){a.prototype.dispose.call(this);this._buttonGroupViewModel.dispose();this.annotationControl&&this.annotationControl.dispose();this.upcomingEventsControl&&this.upcomingEventsControl.dispose()},v.prototype.getIsDetails=function(){return!0},v.prototype.getPrintNotes=function(){return this.printNotes},v.prototype.getAttributionText=function(){return this._getAttribution()},v.prototype.updatePoiTitle=function(n){this._pushpins&&this._pushpins.length>0&&this._pushpins[0].entity.setTitle(n)},v.prototype.resetPrimitives=function(n){n.setPrimitives(this._pushpins)},v.prototype.registerLocatedAtSearchEvents=function(){sj_evt.unbind("SearchLocatedAt",this._searchLocatedAtHandler);sj_evt.bind("SearchLocatedAt",this._searchLocatedAtHandler,0)},v.prototype.registerModuleClickEvents=function(){sj_evt.unbind("TPModHdrClick",this._moduleHeaderClickHander);sj_evt.bind("TPModHdrClick",this._moduleHeaderClickHander,0)},v.prototype.registerVenueMapEvents=function(){var t=this,n=this.panelRoot.select("div[class=bm_venueMapButton]");n&&n[0]&&n.is_element_inView()&&n.add_event("click",function(){t.handleVenueMapClick()})},v.prototype.registerGeochainEvents=function(){for(var n,i,o,e=this.panelRoot.select(".geochainModule a"),r=0;r<e.length;r++)n=e[r],i={},n.hasAttribute("data-sid")?i.id="sid:"+n.getAttribute("data-sid"):n.hasAttribute("data-vdpid")?i.id="vdpid:"+n.getAttribute("data-vdpid"):i.query=n.innerText,i.entryPoint=u.Geochain,o={type:s.localSearchTask,requestState:i},n.setAttribute(f.taskProcessDataHandlerKey,t.Internals.stringify(o))},v.prototype.registerCalendarEvents=function(){var h=this,n=this.panelRoot.select("#cal_tm1"),i=this.panelRoot.select("#cal_tm2"),c,r,o,s,l;if(n&&n.length&&i&&i.length){c=this.panelRoot.select("*[data-cal-loc]");r=null;try{r=t.Internals.parseJSON(c.get_attr("data-cal-loc"))}catch(a){}o=this.map.getContainer();o&&(o.instanceAsync("Calendar",function(t){t.init(h.panelRoot,n,i,r)}),s=this._getReservertionForm(n),s&&(l=s.select("input[type='submit']"),l.add_event("click",function(){var n=h._buildLogData("C",{AN:"Reservation",EP:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,n)})))}},v.prototype._initializeNearbyButton=function(n,t){var e=this,f=this.panelRoot.select("div.ibsb_nearby"),i,r,u;f!==null&&(this._nearbyButton=f.get_ancestor(2));this._nearbyButton&&this._nearbyButton.length!==0||(this._nearbyButton=this.panelRoot.select(".nearbyBtn"));this._nearbyButton&&(i=a.prototype.parseSuggestionMetaData.call(this),i||(i=this._searchNearbyDefaultCategories),r=[],i!=null&&i.forEach(function(n){r.push(n.Name)}),this._nearbyButton.length===1&&(this._nearbyButton.add_class("nearbyBtn"),this._nearbyButton.set_attr("role","button"),this._nearbyButton.set_attr("aria-expanded","false"),u=function(n){return e._nearbySearchLinkClickHandler(n,t,r,i&&i.length?i[0].viewport:null)},this._nearbyButton.add_event("click",u),this._addEventsToEventList(this._nearbyButton,"click",u)))},v.prototype.registerActionButtonEvents=function(n,i){var l=this,tt=this.panelRoot.select("div[data-entity]"),o=tt&&t(tt[0]),r,c,f,a,it,y,e,v,p,rt,b,k,s,d,g,h,ut,nt;o&&this._taskId&&(r=o.select("a[class=directionsAction]"),r&&r.length!==0||(r=this._initializeAlternateDirectionsButton(o)),c=this.getEntities()[0],f=c&&c.getLocation(),w.nearbyButtonEnabled&&this._initializeNearbyButton(o,f),a=c&&c.getRoutableLocation(),a=a?a:f,r&&r.length===1&&(r.set_attr("role","button"),r.set_attr("aria-expanded","false"),it=this._buildLogData("C",{AN:"Directions",CP:f,EP:u.LocalDetails}),y=function(n){return l._buttonGroupViewModel.directionButtonClicked(n,a,it,u.LocalDetails)},r.add_event("click",y),this._addEventsToEventList(r,"click",y)),e=o.select("a[class=scheduleContactBtn], a#scheduleContactBtn"),e&&e.length===1&&(v=e.get_attr("href"),p=v&&v!="#"?t.Internals.parseJSON(v):null,e.set_attr("href","#"),p&&e.length&&(e.set_attr("role","button"),e.set_attr("aria-expanded","false"),rt=this._buildLogData("C",{AN:"ScheduleTourOrContactAgent",CP:f,EP:u.LocalDetails}),b=function(n){return l._buttonGroupViewModel.scheduleContactTourButtonClicked(n,p,rt,u.LocalDetails)},e.add_event("click",b),this._addEventsToEventList(e,"click",b))),k=new si,s=o.select("a[class=saveAction], a#newCollectAction, a.b_saveOnLocal, .MyPlacesSaveBtn"),s&&s.length===1&&(s.set_attr("role","button"),s.set_attr("aria-expanded","false"),s.set_attr("aria-label",this.resources.L_SaveTooltip),d=this._buildLogData("C",{AN:"CollectionsMenu",CP:f,EP:u.LocalDetails}),g=function(n){!k.getIsSignedIn()&&ri.isEditable?l._buttonGroupViewModel.saveWithTravelButtonClicked(n,f,d,u.LocalDetails):l._collectionClick(n,f,d,u.LocalDetails,k.getIsSignedIn())},s.add_event("click",g),this._addEventsToEventList(s,"click",g)),h=o.select("a[class=shareAction], a#shareAction"),h&&h.length===1&&(h.set_attr("role","button"),h.set_attr("aria-expanded","false"),h.set_attr("aria-label",this.resources.L_ShareTooltip),ut=this._buildLogData("C",{AN:"ShareActionButton",CP:f,EP:u.LocalDetails}),nt=function(t){return l._shareButtonClicked(t,ut,n)},h.add_event("click",nt),this._addEventsToEventList(h,"click",nt)),this._buttonGroupViewModel.setEntityData(c,{requestorType:"LocalDetailsTask",requestorId:this._taskId},this.panelRoot),this._addSuggestionsToNearbyModule(f),this._registerBrowseProductsClick(o,i))},v.prototype.registerActionsModuleEvents=function(){var s=this,n=this.panelRoot.select("div[class=actionAnswer]"),t,o,i,r;if(n&&n.length)for(t=0;t<n.length;t++)if(o=n[t].getAttribute("data-actiontype"),i=n[t].getElementsByTagName("a"),i&&i.length&&o)for(r=0;r<i.length;r++)i[r].addEventListener("click",function(){var n=s._buildLogData("C",{AN:"ActionModule",EP:u.LocalDetails,DT:o});e.invokeHandler(f.instrumentationDataHandlerKey,n)})},v.prototype.processDirectionsData=function(t){var r=this.getEntities(),i=r&&r[0],s=i&&i.getAddress(),f,e,o;i&&i.id&&i.id.indexOf("event")>-1&&(e=n.eventPreArrivalTime,f=i.getDateTime&&i.getDateTime()?i.getDateTime()+i.getUtcOffset()*6e4-e*6e4:null);o=ii.getDirectionTaskOptions(s,i.getRoutableLocation(),u.LocalDetails,i.getTitle(),i.id,null,f);t&&t.inData&&t.inData.requestorState&&(t.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processDirectionsData(t,o):this._transientLensViewModel.processDirectionsData(t))},v.prototype.processTravelData=function(n,t){var i,r,o,h;n&&n.inData&&n.inData.requestorState?n.inData.requestorState.entryPoint===u.LocalDetails?(((i=t===null||t===void 0?void 0:t.parentTaskId)===null||i===void 0?void 0:i.startsWith(s.itineraryDetailsTask))||this._buttonGroupViewModel.processSaveWithTravelData(n),this.isTaskOnItinerarySlideout(t)&&t.listingTaskId&&t.listingTaskId!==t.parentTaskId&&(r={action:9},o={type:s.itineraryDetailsTask,taskId:t.parentTaskId,requestorType:s.localListingTask,requestorId:t.listingTaskId,requestState:r},e.invokeHandler(f.taskProcessDataHandlerKey,o))):this._transientLensViewModel.processTravelData(n):n&&n.outData&&n.outData.length&&(h=n.outData[n.outData.length-1],this.itineraryTaskInfo=h,this._populateAddToContainer())},v.prototype._populateAddToContainer=function(){var v=this,l=this.panelRoot.select("div[data-entity]"),f=l&&t(l[0]),n,e,o,u,s,a,h;f&&f.length!==0&&(n=f.select("div[class=bm_addToContainer]"),this.itineraryTaskInfo&&!n.length&&(e=f.select("div[class=b_subModule]"),o=e.length&&e[0],o&&(n=i._createElement("div"),n.add_class("bm_addToContainer bm_addToFirstModule"),o.appendChild(n[0]))),this.itineraryTaskInfo&&!c.isInPrivateMode&&n.length?(n.clear(),n.add_class("bm_addToItineraryContainer"),u=i._createElement("a"),u.set_attr("href","#"),u.set_attr("class","addToAction addToItinerary"),s=i._createElement("span"),s.set_attr("class","addToItineraryIcon"),u.append(s),u.appendText(r.L_AddToItinerary),a=this.itineraryTaskInfo.processorId,h=function(n){return v._addAttractionButtonClicked(n,a)},u.add_event("click",h),this._addEventsToEventList(u,"click",h),n.append(u),n.set_style({display:"block"})):n.length&&(n.set_style({display:"none"}),n.remove_class("bm_addToItineraryContainer")))},v.prototype.processCollectionsData=function(n){var r=this.getEntities(),i=r&&r.length===1&&r[0],f=ii.getMyPlacesTaskOptions(i.getTitle(),i.getLocation(),i.getDescription()),t,e;f.activateOptions={parentId:this._taskId};f.state.data.id=i.id;t=n.inData.requestState;(t.action===pt.AddEntity||t.action===pt.AddFavorite||t.action===pt.AddToTemporaryCollection)&&(e=n.outData.length&&n.outData[0].data&&n.outData[0].data.entityId,e&&(this.savedEntityId=e),t.collectionId&&(this.collectionId=t.collectionId),t.action===pt.AddToTemporaryCollection&&(this.collectionId="TEMP"));n&&n.inData&&n.inData.requestorState&&(n.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processCollectionsData(n,f):this._transientLensViewModel.processCollectionsData(n))},v.prototype.setResponseContent=function(i,r){var f=this,s,y,o,h,c,l;if(i){this._delayLoadRecommendationModuleImages(i);this._hideEmptyModules(i);a.prototype.setResponseContent.call(this,i,r);window.AccordionControl&&AccordionControl&&AccordionControl.accordion&&(s=AccordionControl.accordion.length,s>0&&(y=AccordionControl.accordion[s-1],y.isResponsePreprocessingRequired=!0,sj_evt.bind("accordionAjaxResponse",this._preProcessLinks)));o=r===null||r===void 0?void 0:r.category;n.oneSizeDetail&&o&&(o==="Restaurant"||o.indexOf("90232")>-1||o.indexOf("90287")>-1)&&(h=t(".b_ot_dtp_pickers"),h.length>0&&h.add_class("bm_onesize"));n.enableJavaScriptLoadingInResponse&&Microsoft.Maps.setTimeout(function(){f._loadJavaScriptInResponse(i)},10);c=this.panelRoot.select(".overlay-container");c.length>0&&(l=c[0].getAttribute("data-answerinfo"),l!=null&&n.pushpinIconScenarios!=null&&n.pushpinIconScenarios.indexOf(l)!==-1&&(this.iconClass="addrTsk"));var e={},p={},w=this.panelRoot.select("a[href]");w.for_each(function(n){var r=n.getAttribute("href"),o,i,h,w,c,a,k,y;if(r)if(o=r.toLowerCase(),o.indexOf("http")===0||o.indexOf("/search")===0||o.indexOf("/images/search")===0)n.setAttribute("target","_blank");else if(o.indexOf("/local/reportproblem")===0)or.shouldIgnoreSAE&&f.panelRoot.select(".infoModule .b_feedbackComponent")||f._setLocalFeedbackTaskOptions(n);else if(o.indexOf(v._externalLinkAttrNameWithHash)>-1)f._processExternalLink(r,n);else if(o.indexOf("data-process")===0||o.indexOf("/maps")===0&&o.indexOf("#data-process")!==-1){i=null;try{o.indexOf("data-process")===0?(r=r.replace(/data-process=/i,""),r=r.replace(/\?form=[a-zA-Z]*[0-9]*/i,""),n.setAttribute("data-process",r),n.setAttribute("href","#"),i=t.Internals.parseJSON(r)):i=f._processHotelsAndRestaurantsSeoLinks(r,n)}catch(g){w=f._buildLogData("C",{AN:"SEARCHERROR",EP:u.LocalDetails,DT:"BadDataProcess"});n.setAttribute("data-instrumentation",t.Internals.stringify(w));n.setAttribute("data-process","")}if(i&&i.moduleName&&(h=i.moduleName,h in e?e[h]+=1:e[h]=1,w=f._buildLogData("C",{AN:h,EP:u.LocalDetails}),n.setAttribute("data-instrumentation",t.Internals.stringify(w))),i&&i.requestState&&i.requestState.passThruParam&&i.requestState.passThruParam.indexOf("lemodule=")!==-1&&(c=i.requestState.passThruParam.split("="),c&&c.length>1)){var s="lemoduleSeeAll."+c[1],d="MapsModule."+c[1],b,l=f.panelRoot.select("div[data-entitymetadata]");if(l&&l.length)for(a=0;a<l.length;a++)if(l[a].getAttribute("data-moduletag")===d){b=l[a];break}k=f._buildLogData("C",{AN:s,EP:u.LocalDetails});b&&(y=b.getAttribute("data-entitymetadata"),y&&y.length&&(p[s]=y,k=f._buildLogData("C",{AN:s,EP:u.LocalDetails,DAT:y})));n.setAttribute("data-instrumentation",t.Internals.stringify(k));s in e?e[s]+=1:e[s]=1}}});this._addOutingsEventHandlers();this._addModulesInstrumentation(e,p);this.addProductAdsClientInstrumentation();a.prototype.addReportLinkToNoResultCard.call(this,i,this._taskId,r)}},v.prototype.addProductAdsClientInstrumentation=function(){var i=this,n=this.panelRoot.select(".ProductAdsContainer");n&&n.length&&n.for_each(function(n){var s=n.getAttribute("data-mapimp"),r,h,o;s&&(r=t.Internals.parseJSON(s),r&&r.module&&r.count&&(h=i._buildLogData("I",{AN:r.module,EP:u.LocalDetails,CNT:r.count}),e.invokeHandler(f.instrumentationDataHandlerKey,h)),n.setAttribute("data-mapimp",""));o=t(n).select("a[data-maplog]");o&&o.length&&o.for_each(function(n){var u=n.getAttribute("data-maplog"),r,o;u&&(r=t.Internals.parseJSON(u),r&&(o=i._buildLogData("C",r),n.addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,o)})),n.setAttribute("data-maplog",""))})})},v.prototype.loadDelayedRecommendationModuleImages=function(){var n=this.panelRoot.select("div.EntityCollectionModuleContainer");!n||n.length<1||n.for_each(function(n){var f=n.getElementsByClassName("b_slideexp"),t,r,e,u,i,o;if(f&&f.length&&(t=f[0].getElementsByClassName("slide"),t&&t.length))for(r=0;r<t.length;r++)for(e=t[r].getElementsByTagName("img"),u=0;u<e.length;u++)i=e[u],i&&(o=i.getAttribute("data-delayedsrc"),o&&(i.setAttribute("src",o),i.setAttribute("data-delayedsrc","")))})},v.prototype._delayLoadRecommendationModuleImages=function(n){var t=0,r=n.select("div[data-mapcardwidth]"),f=r&&r.length&&r[0].getAttribute("data-mapcardwidth"),u,i;if(f)if(u=parseInt(f),u===384)t=2;else if(u===650)t=4;else return;(i=n.select("div.EntityCollectionModuleContainer"),!i||i.length<1)||i.for_each(function(n){var e=n.getElementsByClassName("b_slideexp"),i,u,o,f,r,s;if(e&&e.length&&(i=e[0].getElementsByClassName("slide"),i&&i.length>t))for(u=t;u<i.length;u++)for(o=i[u].getElementsByTagName("img"),f=0;f<o.length;f++)r=o[f],r&&(s=r.getAttribute("src"),s&&(r.setAttribute("data-delayedsrc",s),r.setAttribute("src","")))})},v.prototype._hideEmptyModules=function(n){var t=n.select("div.wpc_module.sb_meta");t.for_each(function(n){n.childElementCount==0&&n.setAttribute("style","display: none;")})},v.prototype._processExternalLink=function(n,t){var r,i;try{r=n.indexOf(v._externalLinkAttrNameWithHash);n=n.substr(r+v._externalLinkAttrNameWithHash.length+1);n=n.replace(/\?form=[a-zA-Z]*[0-9]*/i,"");i=v._externalLinkAttrNameWithHash.substr(1);t[i]=n;t.setAttribute(i,n);t.setAttribute("href","#");t.setAttribute("target","_blank");t.addEventListener("click",function(){t.setAttribute("href",t.getAttribute(i))});t.addEventListener("mouseover",function(){t.setAttribute("href",t.getAttribute(i))});t.addEventListener("focus",function(){t.setAttribute("href",t.getAttribute(i))})}catch(f){this._buildLogData("C",{AN:"SEARCHERROR",EP:u.LocalDetails,DT:"BadDataProcess"})}},v.prototype._initializeAlternateDirectionsButton=function(n){var u=n.select("a#DirBtn"),s,h,e,c,r,t,l,a,f;if(u&&u.length!==0||(s=n.select(".ibsb_dir"),h=s&&s.length>0?s:n.select("svg#padirectionssvg"),u=h?h.get_ancestor(2):null),u&&u.length!==0||(u=n.select(".b_directionBtn")),e=!1,u&&u.length>0)if(c=this.panelRoot.select(".directionsPopOut"),c&&c.length!==0)e=!0;else if(r=u.get_ancestor(3),r&&r.length>0)if(r.has_class("b_subModule"))try{t=null;this._state&&(i._isHouseCategory(this._state.listingCategoryPath)||i._isHouseCategory(this._state.selectedCategoryId)||i._isHouseCategory(this._state.category)||i._isHouseCategory(this._state.searchQueryCategory))&&(t=r.select(">.b_mort"),t&&t.length!==0||(t=r.select(">.b_subscomp")),t&&t.length!==0||(t=r.select(">.b_lBottom.b_snippet")));t&&t.length!==0||(t=r.select(".infoCardIcons"));t&&t.length!==0||(t=r.select(".b_vList"));t&&t.length>0&&(f=document.createElement("div"),f.className="bm_popout directionsPopOut",r.insertBefore(f,t),e=!0)}catch(v){l=o.logger;l&&(a={feature:"MC",action:"WRN",data:{errorMessage:"_initializeAlternateDirectionsButton exception: "+v.toString()}},l.logObject(a))}else(r.has_class("b_icbtns")||r.has_class("b_actionBtns")||r.has_class("b_mapsActionBtns"))&&(f=document.createElement("div"),f.className="bm_popout directionsPopOut",r.append(f),e=!0);return e||(this._processDirectionsButtonClick(),u=null),u},v.prototype._processDirectionsButtonClick=function(){if(this.panelRoot){var n=this.getEntities()[0],t=this.panelRoot.select("#DirBtn")[0];n&&t&&t.addEventListener("click",function(t){t.preventDefault();var i=new bt(n.getAddress(),n.getRoutableLocation(),n.getTitle(),!1,null,n.id,null,null,null,2,1,null),r={entryPoint:3,waypoints:[i]};e.invokeHandler(f.taskDataHandlerKey,{type:s.directionsTask,state:r})})}},v.prototype.parseEntitiesFromResponse=function(n,i){var e=this,u=a.prototype.parseEntitiesFromResponse.call(this,n,i),r,o,s,f;return this._sendUpdateEntityRequestToItinerary(i,u.entities),r=u.entities,this.boundingBox=this._parseBoundingBox(n),this.boundingBox&&(r=this.getEntities(),r&&r.length===1&&r[0].setBoundingBox(this.boundingBox)),o=n.select("div.EntityCollectionModuleContainer"),o.for_each(function(n){var l=n.getAttribute("data-entitylist"),r,f,c,o,s,i,h,u;if(l&&(r=t.Internals.parseJSON(l),r&&r.length>0))for(c=n.getAttribute("data-moduletag"),c&&(o=c.split("."),o&&o.length===2&&(f=o[1])),s=0;s<r.length;++s)i=r[s],e._pushpins&&i&&i.location&&i.location.length===2&&i.title&&i.id&&(h=new wr(i.id,i.title),f&&(h.setSearchCategory(f),h.setSelectedCategoryForIcon(f)),u=new hi(new b(i.location[0],i.location[1]),h),u.alwaysShowOnMap=!1,u.viewState=3,u.entity.poiType=1,e._pushpins.push(u))}),s=n.select("div.overlay-taskpane").get_attr("data-facts"),f=l.parseDataFact(s),f&&r&&r.length===1&&(r[0].addressFields=f.addressFields),i&&i.dateTime&&r[0]&&r[0].setDateTime(i.dateTime),i&&i.imgUrls&&i.imgUrls.length&&r[0]&&!r[0].getImageUrl()&&r[0].setImageUrl(i.imgUrls[0]),u},v.prototype.processPhotostripData=function(){var n,i=this.panelRoot.select("div[data-photostripconfig]").get_attr("data-photostripconfig");i&&(n=t.Internals.parseJSON(i));n&&(this._setPhotoStripWidth(n),this._registerPhotostripEvents())},v.prototype.createCalendarSync=function(){var t=this,u=this.getEntities()&&this.getEntities()[0],i,f,r;u?(this.calendarSync=[],this.panelRoot.select(".calendarSyncControlContainer").for_each(function(i){var f=i.getAttributeNode("id"),r=f?f.nodeValue.split("_")[0]:"";t.calendarSync.push(new gu(t.map,t.panelRoot.select(r?"#"+r+"_calendarSyncControlContainer":".calendarSyncControlContainer"),t.panelRoot.select(r?"#"+r+"calendarSyncLabel":".calendarSyncLabel"),t.panelRoot.select(".calendarSyncMessage"),t._taskId,u,n))})):(i=this.panelRoot.select(".calendarSyncModule"),i&&i.length&&(f=i[0],r=f.parentElement,r&&r.classList.contains("b_subModule")&&(r.style.display="none")))},v.prototype.addCollectionsDescription=function(n){var e,t,r,u,f;if(n&&n.descriptionList&&n.descriptionList.length>0&&(e=n.descriptionList,t=this.panelRoot.select("ul[id=userDescriptionList]"),t&&t.length===1)){for(r=0;r<e.length;r++)u=i._createElement("li"),u.set_attr("data-tag","MapActionModule.UserDescription.Item"),u.set_text(e[r]),t.append(u);f=this.panelRoot.select("div[id=userDescription]");f&&f.length==1&&f.set_style({display:"block"})}},v.prototype.addAnnotationControl=function(u){var rt=this,g,nt,ut,ft,w,f,s,bt,p,o,ct,lt,at,vt,v,tt,yt,pt,l,it,gt,b,wt,et,a,k,d,ot;if(!this._annotationControlAdded){var ht=this.getEntities(),e=ht&&ht.length&&ht[0],y=this.panelRoot.select(".local-variant");if((!y||y.length===0)&&(this._state.selectedCategoryId==="House"||(e?e.getPrimaryCategoryPath()==="House"||n.enableNewActionBarButtons:!1))&&(y=this.panelRoot.select(".overlay-taskpane")),y&&y.length&&(g=y.select(".b_entityTitle"),nt=g.parent(),nt&&nt.length&&g&&g.length?(p=document.createElement("div"),p.className="b_annotate annotate",nt.insertBefore(p,g),o=document.createElement("div"),o.className="collectionsPopOut",n.enableNewActionBarButtons?(s=this.panelRoot.select(".b_actionBtns"),ut=this.panelRoot.select(".b_sepActionBtns"),ut&&ut.length?ut.append(o):s&&s.length&&s.append(o)):nt.insertBefore(o,g)):this._state&&(i._isHouseCategory(this._state.listingCategoryPath)||i._isHouseCategory(this._state.selectedCategoryId)||i._isHouseCategory(this._state.category)||i._isHouseCategory(this._state.searchQueryCategory))&&(ft=y.select(".b_subModule"),w=ft.select(">.b_subscomp"),w&&w.length!==0||(w=ft.select(">.b_lBottom.b_snippet")),o=document.createElement("div"),o.className="collectionsPopOut",w&&w.length>0&&ft.insertBefore(o,w))),f=this.panelRoot.select(".annotate"),n.enableNewActionBarButtons&&(!f||f.length===0)&&(s=this.panelRoot.select(".b_actionBtns"),s&&s.length&&(bt=s.parent(),p=document.createElement("div"),p.className="b_annotate annotate",bt.insertBefore(p,s),o=document.createElement("div"),o.className="collectionsPopOut",s.append(o),f=t(p))),ct=this.panelRoot.select(".geocoderInfoModule"),lt=this.panelRoot.select(".mapsCustomInfoCard .b_entityTitle"),f&&f.length){var kt=u.originalName?u.originalName:e?e.getTitle():"",ti=u.taskTitle||kt,dt=null;u.descriptionList&&(dt=u.descriptionList[u.descriptionList.length-1]);at=e&&e.getLocationType();vt=at==="StreetAddress"||at==="Other"&&(!e.id||e.id===e.getTitle());this._state.selectedCategoryId==="House"||(e?e.getPrimaryCategoryPath()==="House":!1)?f.removeFromParent():(v=new iu(this._controlTemplateFactory,this.map,vt,ti,kt,dt,h.getImpressionGuid(this.panelRoot)),this.annotationControl=v,v.annotationChanged.add(function(){var t=v.getDescription(),n=v.getCurrentName();rt._sendUpdateEntityProcessCall(n,t);rt._state.descriptionList=[t];rt._state.taskTitle=n;rt.titleChanged.invoke(n)}),tt=this.panelRoot.select(".b_tp_bann"),tt&&tt.length&&(tt.removeFromParent(),f.getParent().insertBefore(tt,f)),f.append(v.getControl()),f.set_style({display:"block"}),vt&&f.add_class("address"),ct&&ct.set_style({display:"none"}),lt&&lt.set_style({display:"none"}),yt=(f.parent().select(".infobubble_item")||[])[0],pt=(f.parent().select(".infobubble")||[])[0],yt&&pt&&(l=f.select(".nameContainer"),l&&l.length>0&&(l.append(yt),l.append(pt),l[0].firstChild.textContent)),it=this.panelRoot.select("div[data-sponad]").get_attr("data-sponad")==="true",gt=this.panelRoot.select("div[class=faketab]").length>0,(n.enableNewActionBarButtons||it)&&(b=this.panelRoot.select("div.b_actionBtns"),b&&b.length!==0||(b=this.panelRoot.select(".b_sepActionBtns")),(b&&b.length||it)&&(wt=b.select("#moreBtn, .moreBtn"),(wt&&wt.length||it)&&(et=this.panelRoot.select("[data-tag=annotateButton]"),et&&et.length&&et.set_style({display:"none"})))),this._annotationControlAdded=it||gt?!1:!0);a=this.panelRoot.select(".mapActionsModule li");a&&a.length!==0||(a=this.panelRoot.select(".local-variant .b_entityTitle ~ .b_hList li"));a&&a.length>3&&(k=this.panelRoot.select(".shareAction, #shareAction"),k&&k.length>0&&(ot=k.parent(),v.addAuxillaryButton(k),ot.removeFromParent(),k.add_class("show"),k.set_attr("title",r.L_ShareTooltip)),a.length>4&&(d=this.panelRoot.select(".newCollectAction, #newCollectAction, .b_saveOnLocal"),d&&d.length>0?(ot=d.parent(),v.addAuxillaryButton(d),ot.removeFromParent(),d.add_class("show"),d.set_attr("title",r.L_SaveTooltip)):c.isInPrivateMode&&a[a.length-1].remove()));this.panelRoot.select("#shareAction").add_class("show");this.panelRoot.select("#newCollectAction").add_class("show");c.isInPrivateMode&&this.panelRoot.select("#newCollectAction").remove_class("show");var l=this.panelRoot.select(".nameContainer"),st=this.panelRoot.select(".b_sepActionBtns"),ni=this.panelRoot.select(".b_wftp");ni&&ni.length>0&&st&&st.length>0&&l&&l.length>0&&(st.removeFromParent(),l.append(st))}}},v.prototype.removeUpcomingEventContainer=function(){var t=this.panelRoot.select(".upcomingEvents"),n;t&&t.length&&(n=t.getParent(),n&&n.has_class("wpc_module")&&n.removeFromParent())},v.prototype.expandDetailsCard=function(){var r=this,n,i;c.isMobile&&(n=this.panelRoot.select("a[id*='expitem_']"),n&&n.length&&(n.get_attr("data-exp").length>0?n.for_each(function(n){var i=t(n);i.get_attr("data-exp").indexOf("tp_mobileexp")>=0&&r._toggleExpansion(i,!0)}):n.for_each(function(n){n.click()}),i=this.panelRoot.select("div[id='tp_mobileexp']"),i.removeFromParent()))},v.prototype._updateEntityState=function(n,t){this._isHomeOrWorkScenario(n)&&t&&this._processHomeAndWork(t)},v.prototype._parseCategoryData=function(){var t,n=this.getEntities();n&&n.length===1&&(t=n[0].getPrimaryCategoryPath(!0));this.populateCardCategoryId(t)},v.prototype.processTnAAds=function(){var n=this.panelRoot.select("[data-tag=TnA.AdsModule.Container]"),t;n&&n.length>0&&(t=h.getImpressionGuid(this.panelRoot),ci.setShownAds("AT",".maps_tna_ad_item",n,t),ci.setShownAds("DE",".maps_tna_ad_card",n,t))},v.prototype.enableAdsShownLogging=function(t){var i=this;n.adsShownLogging&&this._adsContainer&&this._adsContainer.length&&(this._logIfAdsVisible(this._adsContainer,"NotScrolled"),this._adsVisibleLogged||(t&&t.add(function(){i._logIfAdsVisible(i._adsContainer,"Scrolled")}),sj_evt.bind("customScrolled",function(n){n&&i._logIfAdsVisible(i._adsContainer,"Scrolled")})))},v.prototype.processAdvertising=function(n){var i;try{if(i=this.getEntities(),ut.isEnabled()&&i&&i.length){var r=i[0],t=this.panelRoot.select("div.mapsTextAds"),u=t&&t.length&&t[0].getAttribute("data-tracingTag"),f=u==="PD"?ct.PD:this.GetDetailsScenario(n,r);ut.setShownAds(f,t,h.getImpressionGuid(this.panelRoot));this._adsContainer=t}}catch(e){ut.logError(e)}},v.prototype.logInstrumentationForShoppingDataGroup=function(){var i=this.panelRoot.select("div[data-hasshoppingdatagroup]").get_attr("data-hasshoppingdatagroup")==="true",n,t;i&&(n=o.logger,n&&(t={feature:"LocalDetails",action:"local:datagroupid.shopping",data:null},n.logObject(t,h.getImpressionGuid(this.panelRoot))))},v.prototype.registerNewMoreMenuEvents=function(n){var f=this,e,o,r;this._moreMenuListDropdownModel=new ff;this._moreMenuPopOutButtonViewModel=new lf(this._moreMenuListDropdownModel);this._moreMenuTask=n;var u=this.panelRoot.select("#moreBtn"),s=this.panelRoot.select(".b_icbtns"),h=this.panelRoot.select(".b_wftp"),c=h.length>0;u.length&&(u.set_attr("role","button"),u.set_attr("aria-expanded","false"),u.set_attr("aria-label",this.resources.L_EllipsisTooltip),s.length&&!c?s.append(this._moreMenuPopOutButtonViewModel.buildPopOut()):(e=this.panelRoot.select(".b_actionBtns"),o=this.panelRoot.select(".b_sepActionBtns"),o&&o.length?o.append(this._moreMenuPopOutButtonViewModel.buildPopOut()):e&&e.length?e.append(this._moreMenuPopOutButtonViewModel.buildPopOut()):u.append(this._moreMenuPopOutButtonViewModel.buildPopOut())),r=this,u.add_event("click",function(n){var o;if(n.preventDefault(),n.stopImmediatePropagation(),u.set_attr("aria-expanded","true"),r._moreMenuListDropdownModel.setDropdown(r._moreMenuTask.getMenuList()),r._moreMenuPopOutButtonViewModel.setDropdown(r._moreMenuListDropdownModel),r._moreMenuListDropdownModel.setButtonElement(u),r._moreMenuPopOutButtonViewModel.setIsDisplayed(!0),or.shouldIgnoreSAE){var h=r.panelRoot.select(".menuLocalFeedback"),e=h?h.parent():null,f=r.panelRoot.select(".b_feedbackComponent a.b_suggestedit");f=f&&f.length!==0?t(f[0]):r.panelRoot.select("#epf_infb");e&&e.length>0&&f.length>0&&(e.remove_event("click",function(){}),e.remove_attr("data-dropdown"),e.add_event("click",function(n){n.stopImmediatePropagation();f.fireEvent("click")}),e.add_event("touchend",function(n){n.stopImmediatePropagation();f.fireEvent("click")}))}o=t(".bm_popOutContainer",s[0]);o.length>0&&i._setFocusOnFirstMenuItem(o)}),u.add_event("keydown",function(n){var e=n,o,u,r;if(e.keyCode&&e.keyCode===9&&!i._isAttractionCategory(f.getCardCategoryId())&&!e.shiftKey)for(o=t(".csrc.sc_rc1",f.panelRoot[0]),u=0;u<o.length;u++)if(r=t(o[u]).get_sibling(1,0),r.length>0&&(r[0].tagName==="a"||r[0].tagName==="A")){n.preventDefault();n.stopImmediatePropagation();r[0].removeEventListener("keydown",function(){return f._ratingKeyDownEventHandler});r[0].addEventListener("keydown",function(n){return f._ratingKeyDownEventHandler(n)});r[0].setAttribute("tabindex","0");r[0].focus();break}}))},v.prototype.registerShowAllImageEvents=function(){var n=this,i=t(".iasmtab.leftsmtab",this.panelRoot[0]);i&&i.length>0&&i.add_event("keydown",function(i){var u=i,r;u.keyCode&&u.keyCode===9&&!u.shiftKey&&(r=t(".b_mapbtns",n.panelRoot[0]).select("a"),r&&r.length>0&&(i.preventDefault(),i.stopImmediatePropagation(),r[0].removeEventListener("keydown",function(){return n._firstMapBtnKeyDownEventHandler}),r[0].addEventListener("keydown",function(t){return n._firstMapBtnKeyDownEventHandler(t)}),r[0].focus()))})},v.prototype._firstMapBtnKeyDownEventHandler=function(n){var r=n,i;r&&r.keyCode&&r.keyCode===9&&r.shiftKey&&(i=t(".iasmtab.leftsmtab",this.panelRoot[0]),i&&i.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),i.set_attr("tabindex","0"),i[0].focus()))},v.prototype._ratingKeyDownEventHandler=function(n){var o=this,f=n,r,i,e,u;f.keyCode&&f.keyCode===9&&(f.shiftKey?(r=t(".b_mapbtns",this.panelRoot[0]),r&&r.length>0&&(i=r.select("a"),i.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),i.set_attr("tabindex","0"),i[i.length-1].focus()))):(e=t(".b_icbtns",this.panelRoot[0]),e.length>0&&(u=e.select("a"),u.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),u[0].addEventListener("keydown",function(n){var r=n,f,u,i;if(r&&r.keyCode&&r.keyCode===9&&r.shiftKey)for(f=t(".csrc.sc_rc1",o.panelRoot[0]),u=0;u<f.length;u++)if(i=t(f[u]).get_sibling(1,0),i.length>0&&(i[0].tagName==="a"||i[0].tagName==="A")){n.preventDefault();n.stopImmediatePropagation();i[0].setAttribute("tabindex","0");i[0].focus();break}}),u[0].focus()))))},v._getLocationForEntity=function(n){var t=n&&n.entity&&n.entity.getGeometry();return t?new b(t.y,t.x):null},v._getWorkHomeResourceString=function(n){var i=n.isHome,t=n.requestOptions.mode;return i?t===g.walking?r.L_TimeWalkHome_Text:r.L_TimeDriveHome_Text:t===g.walking?r.L_TimeWalkWork_Text:r.L_TimeDriveWork_Text},v.prototype._logIfAdsVisible=function(n,t){if(!this._adsVisibleLogged&&n&&n.length){var i=n[0].getBoundingClientRect();if(i){if(i.top===0&&i.bottom===0||i.height===0)return;i.top>=0&&i.bottom<=window.innerHeight&&(this._adsVisibleLogged=!0,ut.logAdsShown(t))}}},v.prototype._isHomeOrWorkScenario=function(t){var i=t.select(".overlay-container").get_attr("data-answerInfo"),r=i&&parseInt(i);return r&&n.homeWorkAnswerScenarios&&n.homeWorkAnswerScenarios.indexOf(r)!==-1},v.prototype._processHomeAndWork=function(n){var r=new si,i,t;r.getIsSignedIn()&&(i=this.map,t=this.map&&this.map.getContainer(),t&&t.instanceAsync("ItineraryDataManager",function(t){t&&t.syncFavorites(function(r){if(r===0){var u=v._getLocationForEntity(t.home),f=v._getLocationForEntity(t.work);(u||f)&&v._updateEntityWithHomeOrWorkDistance(t,n,i,h.getImpressionGuid(this.panelRoot))}})}))},v._getWaypoints=function(n,t,i,r){var u=[],e=i?n.home:n.work,f=e.entity;return u.push(new bt(f.getAddress(),t,f.getName(),!1,null,f.id,null,null,null,1,4,null)),u.push(new bt(r.getAddress(),r.getRoutableLocation()?r.getRoutableLocation():r.getLocation(),r.getTitle(),!1,null,r.id,null,null,null,2,1,null)),u},v._updateEntityWithHomeOrWorkDistance=function(t,u,o,s){s===void 0&&(s=null);var l=v._getLocationForEntity(t.home),a=v._getLocationForEntity(t.work),b=u.getRoutableLocation(),k=b?b:u.getLocation(),y=l&&lr.greatCircleDistance(k,l),p=a&&lr.greatCircleDistance(k,a),h,c,w;if(y&&p?(h=y<=p,c=h?y:p,w=h?l:a):y?(h=!0,c=y,w=l):p&&(h=!1,c=p,w=a),c&&c<n.maxHomeOrWorkDistanceMeters&&c>n.minHomeOrWorkDistanceMeters){var d=v._getWaypoints(t,h?l:a,h,u),nt={waypoints:d,options:{unit:ur.unit===1?er.miles:er.km,maxRoutes:1},mode:c<n.maxWalkingDistance?g.walking:g.driving},tt={isSummaryOnly:!0,requestOptions:nt,isHome:h,entity:u};yf.downloadRoutes(tt,function(t,h,c){var l,a,y;if(c.errorCode===vf.Success&&h&&(l=h.resourceSets.length>0&&h.resourceSets[0]&&h.resourceSets[0].resources&&h.resourceSets[0].resources[0],l)){var p=new tf,w=v._getWorkHomeResourceString(t),b=l.travelDurationTraffic<=n.minTimeThreshold*60?i._formatString(r.L_TimeDurationLessThan_Text,n.minTimeThreshold):p.getDurationString(l.travelDurationTraffic);u.subtitle=w.replace("{0}",b);u instanceof sr&&u.setRouteRequestState(t);a=o&&o.getFrameManager();a&&a.hackHackSetFrame();y={logData:{feature:"DC",action:"HWSHOW",data:{HW:t.isHome?"H":"W"}},impressionGuid:s};e.invokeHandler(f.instrumentationDataHandlerKey,y)}})}},v.prototype.GetDetailsScenario=function(n,t){if(n.scenarioKey==="HS"||t.getPrimaryCategoryName()==="Hotel")return ct.HO;var i=t.getLocationType();return i==="City"||i==="Country"?ct.PL:n.scenarioKey==="LS"||n.scenarioKey==="LLS"?ct.LS:n.scenarioKey==="EAIA"||t.mainSegmentType==="Events"?ct.EV:ct.DE},v.prototype.getDetailsHtmlContentForPrint=function(n){var t=this,f=this.annotationControl&&this.annotationControl.getOriginalName(),e=this.annotationControl&&this.annotationControl.getDescription(),i,u,r;return this.printTitleViewModel=new yu(this.map,this._controlTemplateFactory,this.getEntities(),n,f),this.notesMaxCharSize=vr.notesMaxChars,i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideIfMatchedData:function(n){return t.hideIfMatchedData(n)},emptyToDisplayNone:function(n){return t.emptyToDisplayNone(n)}},this.titlePrintTemplate=new dt(gi,i),u=this._controlTemplateFactory({templateText:kr,staticResources:i}),this.printNotes=e||"",r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},v.prototype.hideIfMatchedData=function(n){var t=this.getEntities()&&this.getEntities()[0]&&this.getEntities()[0].getSegmentTypes()?this.getEntities()[0].getSegmentTypes()[0].toLowerCase():"";return n===null||this.getEntities()[0].getTitle()===n||t==="house"?"none":""},v.prototype.prepareMenuModule=function(){var t=this.panelRoot.select("div[data-tabcontrolid]").get_attr("data-tabcontrolid"),n;t&&(n=this.panelRoot.select("#"+t+"_menu"),n&&n.length&&(this._prepareTabs(n[0],t),Microsoft.Maps.setTimeout(function(){sj_evt.fire("tab_init",tabcontrol)},10)))},v.prototype.prepareReviewsAccordionModule=function(n){var i=this.panelRoot.select("div[class=revacc]"),t,r;i&&i.length&&(t=i.select("div[class=acc-header]"),t&&t.length&&t[0].children&&t[0].children.length&&sj_evt.bind("accordion_item_click",n,1),r=i.select("a[id*='expitem_']"),r&&r.length&&r.for_each(function(t){t.addEventListener("click",function(){n&&n()})}),Microsoft.Maps.setTimeout(function(){sj_evt.fire("accordion_init",AccordionControl)},10))},v.prototype.addRecommendationModuleHover=function(n){var i=this,u=this.panelRoot.select("div.EntityCollectionModuleContainer"),r=1;u.for_each(function(u){var l=u.getAttribute("data-entitylist"),e,o;if(l&&(e=t.Internals.parseJSON(l),e&&e.length>0)){for(var s=r,h=r+e.length-1,f=u.parentElement,a=0,c=!1;f&&a<5;){if(c=f&&f.className&&f.className.indexOf("wpc_module")>-1?!0:!1,c)break;++a;f=f.parentElement}c?(f.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(n,s,h,!0)}),f.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(n,s,h,!1)})):(u.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(n,s,h,!0)}),u.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(n,s,h,!1)}));o=t(u).select("li");o&&o.length&&o.length==e.length?o.for_each(function(t){var u=r++;t.addEventListener("mouseenter",function(){i._onRecommendationModuleItemHover(n,u,!0)});t.addEventListener("mouseleave",function(){i._onRecommendationModuleItemHover(n,u,!1)})}):r+=e.length}})},v.prototype.edgeRecoModuleFix=function(){var n=this.panelRoot.select("div.wpc_module.sb_meta");n&&n.length&&n.for_each(function(n){n.setAttribute("style","outline: 1px solid transparent")})},v.prototype.handleVenueMapClick=function(){var n={};n.type=s.venueMapDirectoryTask;n.action="activate";n.activateOptions={};n.activateOptions.activationState=1;var i={},r=this.panelRoot.select("div.overlay-taskpane.local-taskpane"),u=r.get_attr("data-venues"),t=JSON.parse(u);t.venueMapInfo&&t.venueMapInfo[0]&&t.venueMapInfo[0].id&&(i.venueMapId=t.venueMapInfo[0].id,i.venueMapType=t.venueMapInfo[0].mapType,i.title=this._state.taskTitle||"",n.state=i,e.invokeHandler(f.taskDataHandlerKey,n))},v.prototype._onRecommendationModuleItemHover=function(n,t,i){if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length){var r=this._pushpins[t];r.viewState=i?1:0;r.zIndex=i?2:0;n.setPrimitives(this._pushpins,!0)}},v.prototype._onRecommendationModuleHover=function(n,t,i,r){if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length&&i<this._pushpins.length){for(var u=t;u<=i;++u)this._pushpins[u].viewState=r?0:3,!r&&n._primitives&&n._primitives.length&&u<n._primitives.length&&n._primitives[u].bucket&&delete n._primitives[u].bucket;n.disableComputingMapViewForLoadingOnly=!0;r?n.setPrimitives(this._pushpins,!0):n.setPrimitives([this._pushpins[0]],!0)}},v.prototype._addOutingsEventHandlers=function(){var n=this.panelRoot.select(".articleList a.articleCard"),s,i,o,r;n&&n.length!==0||(n=this.panelRoot.select(".bm_outingsModule a"));n&&n.length>0&&(s=this._buildLogData("C",{AN:"MapsModule.OutingsLink",EP:u.LocalDetails}),n.for_each(function(n){n.addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,s)})}));i=this.panelRoot.select(".articleList .b_module_expansion .b_expand");i&&i.length>0&&(o=this._buildLogData("C",{AN:"MapsModule.OutingsExpansion",EP:u.LocalDetails}),i[0].addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,o)}),i[0].addEventListener("keydown",function(n){if(n.keyCode&&n.keyCode===13){var i=n.currentTarget;i&&i.nextElementSibling&&Microsoft.Maps.setTimeout(function(){var n=t(".articleList .b_module_expansion .b_collapse");n.length>0&&(n[0].setAttribute("tabindex","1"),n[0].focus(),n[0].setAttribute("tabindex","0"))},500);e.invokeHandler(f.instrumentationDataHandlerKey,o)}}));r=this.panelRoot.select(".articleList .b_module_expansion .b_collapse");r&&r.length>0&&r[0].addEventListener("keydown",function(n){if(n.keyCode&&n.keyCode===13){var i=n.currentTarget;i&&i.previousElementSibling&&Microsoft.Maps.setTimeout(function(){var n=t(".articleList .b_module_expansion .b_expand");n.length>0&&(n[0].setAttribute("tabindex","1"),n[0].focus(),n[0].setAttribute("tabindex","0"))},500)}})},v.prototype._addModulesInstrumentation=function(n,i){var nt=this,b=this.panelRoot.select("div[data-suppressed]"),v,y,p,w,a,c,s,l,o,h,tt,k,it,r,d,rt,g;if(b&&b.length&&(v=b[0].getAttribute("data-suppressed"),v&&v.length&&(c=this._buildLogData("R",{AN:"Suppressed",EP:u.LocalDetails,DAT:v}),c.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,c))),y=this.panelRoot.select("div[data-umodules]"),y&&y.length&&(p=y[0].getAttribute("data-umodules"),p&&p.length&&this._state&&(w={moduleKeys:p,query:this._state.query,id:"",title:""},a=this.getEntities&&this.getEntities(),a&&a.length&&(w.id=a[0].id,w.title=a[0].getTitle()),c=this._buildLogData("UM",{AN:"UnrecognizedModules",EP:u.LocalDetails,DAT:t.Internals.stringify(w)}),c.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,c))),s=this.panelRoot.select("div[data-moduletag]"),s&&s.length)for(l=0;l<s.length;l++)o=s[l].getAttribute("data-moduletag"),o&&(h=s[l].getAttribute("data-entitymetadata"),h&&h.length&&(i[o]=h),tt=t(s[l]),k=tt.select("a[href]"),k&&k.for_each(function(i){var e="",s="",c,f,r,l;try{c=i.getAttribute("data-process");c&&(f=JSON.parse(c),f&&f.requestState&&(r=f.requestState,r.title&&(s=r.title),r.entityId&&(e=r.entityId)))}catch(a){}l=h&&h.length?nt._buildLogData("C",{AN:o,EP:u.LocalDetails,ID:e,Name:s,DAT:h}):nt._buildLogData("C",{AN:o,EP:u.LocalDetails,ID:e,Name:s});i.setAttribute("data-instrumentation",t.Internals.stringify(l));o in n?n[o]+=1:n[o]=1}));it=["MapsModule.PointsOfInterest","MapsModule.PeopleAlsoSearchedFor","MapsModule.FoundAtThisAddress","MapsModule.FoundNearThisAddress","MapsModule.EatAndDrink","MapsModule.ThingsToDo","MapsModule.WhereToStay","MapsModule.PlaceNearby","MapsModule.PlaceToGo","MapsModule.Events","MapsModule.EventsAtVenue"];for(r in n)n.hasOwnProperty(r)&&n[r]&&(d=it.indexOf(r)>-1?Math.floor(n[r]/2):n[r],g=i[r],rt=g?this._buildLogData("I",{AN:r,EP:u.LocalDetails,CNT:d,DAT:g}):this._buildLogData("I",{AN:r,EP:u.LocalDetails,CNT:d}),e.invokeHandler(f.instrumentationDataHandlerKey,rt))},v.prototype._prepareTabs=function(n,t){for(var r,i,u,f,h,e,o=this,s=0;s<n.children.length;s++)r=n.children[s],i=r.getAttribute("data-content"),i&&(u=this.panelRoot.select("#"+i),u&&u.length&&(r.setAttribute("data-content",i+"_"+t),u[0].id=i+"_"+t)),r.addEventListener("click",function(){o._menuModuleClicked("TabClick")});f=this.panelRoot.select("div[data-tabcontrolid]");f&&(h=["_navl","_navr"],h.forEach(function(n){var i=f.select("#"+t+n);i&&i.length&&i[0].addEventListener("click",function(){o._menuModuleClicked("NavClick")})}),e=f.select("a[class=b_moreLink]"),e&&e.length&&e[0].addEventListener("click",function(){o._menuModuleClicked("MenuLinkClick")}))},v.prototype._menuModuleClicked=function(n){var t=this._buildLogData("C",{AN:"RestaurantMenu",EP:u.LocalDetails,DT:n});e.invokeHandler(f.instrumentationDataHandlerKey,t)},v.prototype._shareButtonClicked=function(n,t,i){n&&n.preventDefault();e.invokeHandler(f.shareDataHandlerKey,{action:"shareTasks",taskIds:[i],entryPoint:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,t)},v.prototype._addAttractionButtonClicked=function(n,t){n&&n.preventDefault();var i=this.getEntities()[0],r=ii.getItineraryAddItemOptions(i.getTitle(),i.getLocation(),i.id,i.getImageUrl(),t,i.getSelectedCategoryForIcon(),i.interests,i.stayDuration);e.invokeHandler(f.taskProcessDataHandlerKey,r)},v.prototype._setPhotoStripWidth=function(n){var i,t,r,u;if(n.PhotostripItems&&n.PhotostripItems.length){for(this._photostripTotalWidth=0,i=n.PhotostripItems.length,t=0;t<i;t++)r=n.PhotostripItems[t],this._photostripTotalWidth+=r.IsPano?v._photoWidth*2:v._photoWidth;u=this.panelRoot.select("ul.photostrip");u.set_style({width:this._photostripTotalWidth+"px"})}},v.prototype._slidePhotstripLeft=function(n,t,i){if(t<0){var r=i*++t;n.set_style({left:r+"px"})}return t},v.prototype._slidePhotstripRight=function(n,t,i){var r,u,f;return t<=0&&(r=i*(t-1),this._photostripTotalWidth>Math.abs(r)&&(u=Math.floor(v._photostripVisibleWidth/v._photoWidth),f=(this._photostripTotalWidth-Math.abs(r))/v._photoWidth,f>u?n.set_style({left:r+"px"}):(r=r+(v._photostripVisibleWidth-(this._photostripTotalWidth-Math.abs(r))),n.set_style({left:r+"px"})),--t)),t},v.prototype._showImageInModalDialog=function(n){if(n){var t=v._imgModalDialogContentTemplate.replace("{imgSrc}",n.imgsrc).replace("{imgAttrb}",n.imgattrb).replace("{providerLink}",n.providerlink).replace("{providerLinkText}",n.providerlinktext),i=new cf(t,"bigImgDialog");i.OpenDialog()}},v.prototype._registerPhotostripEvents=function(){var n=this,r=this.panelRoot.select("ul.photostrip"),e=v._photoWidth*3,i=0,o=this.panelRoot.select("div.mapsPhotostrip .psnav.prev"),s=function(t){i=n._slidePhotstripLeft(r,i,e);t.preventDefault()},u,f,h;o.add_event("click",s);this._addEventsToEventList(o,"click",s);u=this.panelRoot.select("div.mapsPhotostrip .psnav.next");f=function(t){i=n._slidePhotstripRight(r,i,e);t.preventDefault()};u.add_event("click",f);this._addEventsToEventList(u,"click",f);h=r.select("a.thumb[data-imgsrc]");h.for_each(function(i){var r=t(i),f=t.Internals.parseJSON(r.get_attr("data-imgsrc")),u=function(t){n._showImageInModalDialog(f);t.preventDefault()};r.add_event("click",u);n._addEventsToEventList(r,"click",u)})},v.prototype._parseBoundingBox=function(n){var f=n.select("div[data-boundingbox]").get_attr("data-boundingbox"),r=f&&t.Internals.parseJSON(f),u,i;return r&&r.boundingBox&&r.boundingBox.length>1?(u=[],i=r.boundingBox[0],u.push(new b(i.latitude,i.longitude)),i=r.boundingBox[1],u.push(new b(i.latitude,i.longitude)),u):null},v.prototype._buildLogData=function(n,t){return{logData:{feature:"DC",action:n,data:t},impressionGuid:h.getImpressionGuid(this.panelRoot)}},v.prototype._loadJavaScriptInResponse=function(n){n.select("div[data-answerinfo]").length>0&&n.select("script").for_each(function(n){var i=n.textContent,t;v._detailsPageScripts[i]||(t=document.createElement("script"),t.type="text/javascript",t.textContent=i,document.head.appendChild(t),v._detailsPageScripts[i]=t)})},v.prototype._moduleHeaderClickHander=function(n){var t,i;n&&n[1]&&n[2]&&(t=n[1].nextElementSibling,t&&(i=_w.getComputedStyle(t,null).display==="none",t.style.display=i?"block":"none",Log.Log(i?"Show":"Hide","TaskPane",n[2],!1)))},v.prototype._searchLocatedAtHandler=function(n){if(n&&n[1]){var t={query:n[1],fullQuery:n[1],entryPoint:u.LocalDetails};n[2]&&(t.filterUrlParam='local_ypid:"'+n[2]+'"');e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:t,type:s.localSearchTask})}},v.prototype._toggleExpansion=function(n,t){var o=t?"id":"data-expe",i=n.get_attr(o),u,f,e,r;if(i.indexOf("txt")==0)i=i.substr(3);else if(i.lastIndexOf("_hit")==i.length-4)i=i.substr(0,i.length-4);else return;u=this.panelRoot.select("[data-exp=H;"+i+";;;;]");u&&(t?u.remove_class("b_hide"):u.add_class("b_hide"));f=this.panelRoot.select("[id=txt"+i+"]");f&&(t?f.add_class("b_hide"):f.remove_class("b_hide"));e=this.panelRoot.select("[id="+i+"_hit]");e&&(t?e.add_class("b_hide"):e.remove_class("b_hide"));r=this.panelRoot.select("[data-expid="+i+"]");r&&r.has_class("tp_collapsed")&&(t?r.remove_class("tp_collapsed"):r.add_class("tp_collapsed"))},v.prototype._getReservertionForm=function(n){for(var t=n.parent(),i=null,r=0;r<5;r++){if(t&&t[0]&&t[0].tagName=="FORM"){i=t;break}t=t.parent()}return i},v.prototype._addSuggestionsToNearbyModule=function(n){var u=this,v=this.getEntities(),y=v&&v[0],s=!0,t=a.prototype.parseSuggestionMetaData.call(this),o,p,i,l,r;t||(s=!1,t=this._searchNearbyDefaultCategories);o=[];t.forEach(function(n){o.push(n.Name)});p=c.features;i=this.panelRoot.select("a[class=searchNearbySearchLink]");i&&i.length===1&&(l=function(i){return u._nearbySearchLinkClickHandler(i,n,o,t&&t.length?t[0].viewport:null)},i.add_event("click",l),this._addEventsToEventList(i,"click",l),i.add_class("xsrIcon"));r=this.panelRoot.select("ul[class=searchNearbyModule]");this.selectorReady().then(function(i){var l,c,a;r&&r.length===1&&(l="searchNearbyModuleIcon searchNearbyWithLabels",r.set_attr("class",l),t.forEach(function(t){var f=u._drawCategoryItem(i,t,"SearchNearbySuggestionLink",function(i){return u._nearbySuggestionClickHandler(i,n,s,y,t.viewport)});f&&r.append(f)}),c=u.panelRoot.select("li.searchNearbySearchButton"),c&&c.length===1&&(c.removeFromParent(),r.append(c)),a={logData:{feature:"NBS",action:"A",data:{CAT:o.join(","),DY:s}},impressionGuid:h.getImpressionGuid(u.panelRoot)},e&&e.invokeHandler(f.instrumentationDataHandlerKey,a))})},v.prototype._nearbySearchLinkClickHandler=function(t,i,o,s){var h,l;this._nearbyButton.set_attr("aria-expanded","true");h=this._getMapBounds(s);l=this._buildLogData("C",{AN:"SearchNearby",CP:i,EP:u.LocalDetails,DT:"SearchLink"});t&&t.preventDefault();e.invokeHandler(f.instrumentationDataHandlerKey,l);h||ot.setMapCenter(this.map,i,n.searchNearbyDefaultZoomLevel);var c=this.getEntities()[0],a=c&&c.getTitle()||"",v=r.L_SearchNearbyGhostTextFormat.replace("{query}",a);this._taskBar&&this._taskBar.setSearchBoxGhostText(v);this._taskBar&&this._taskBar.setNearbyLocationTitle(c.getTitle());o&&this._taskBar.updateSearchBoxAutosuggestDefault(o,h,w.nearbyButtonEnabled)},v.prototype._nearbySuggestionClickHandler=function(t,i,o,h,l){var d=h&&h.getAddress(),g=h&&h.getTitle()||d,a,v,w,b,y,p,k;if(t&&t.target){for(a=t.target;a.parentNode;){if(a.nodeName.toLowerCase()==="a")break;a=a.parentNode}if((t.stopPropagation(),t.preventDefault(),a)&&(v=a.getAttribute("aria-label"),v)){if(w=o?"SuggestionLinkDynamic.":"SuggestionLink.",b=this._buildLogData("C",{AN:"SearchNearby",CP:i,EP:u.LocalDetails,DT:w+v}),e.invokeHandler(f.instrumentationDataHandlerKey,b),(!l||l.length<2)&&ot.setMapCenter(this.map,i,n.searchNearbyDefaultZoomLevel),y={},y.entryPoint=u.LocalDetails,y.query=v,y.mapBounds=this._getMapBounds(l),p=c.features,v===r.L_SearchNearbyTerm_7&&p&&p.transit&&p.transit.isEnabled){k={location:i,title:g,entryPoint:1};e.invokeHandler(f.taskDataHandlerKey,{state:k,type:s.nearbyTransitTask});return}e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:y,type:s.localSearchTask})}}},v.prototype._getMapBounds=function(n){if(n&&n.length>1&&!isNaN(n[0].latitude)&&!isNaN(n[0].longitude)&&!isNaN(n[1].latitude)&&!isNaN(n[1].longitude)){var t=[];return t.push(Math.max(n[0].latitude,n[1].latitude)),t.push(Math.min(n[0].longitude,n[1].longitude)),t.push(Math.min(n[0].latitude,n[1].latitude)),t.push(Math.max(n[0].longitude,n[1].longitude)),t}return null},v.prototype._setLocalFeedbackTaskOptions=function(n){var s=this,h=this.getEntities(),f=h&&h[0],t,e,a;if(f){t={};t.entityName=f.getTitle();t.entityYpid=f.id;var u=null,o=null,c=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),l=this.panelRoot.select("div.overlay-taskpane").get_attr("data-ufacts");if(c){try{u=JSON.parse(c)}catch(v){}u&&(t.dataFacts=u)}if(l){try{o=JSON.parse(l)}catch(v){}o&&(t.userFacts=o,u&&u.feedbackMetaData&&u.feedbackMetaData.isTestingLocation==="true"&&(t.userFacts.isTestingLocation="true"))}t.query=f.getTitle();t.reportType=4;this._state&&(e=this._state&&this._state.searchQueryCategory||this._state.selectedCategoryId||this._state.category||this._state.listingCategoryPath,e&&(i._isHouseCategory(e)?t.reportType=8:e==="Event"&&(t.reportType=9)));a=function(n){s._onSuggestAnEditLinkClick(n,s._taskId,f.getTitle(),t)};n.text=r.L_Menu_SuggestAnEdit_Link_Text;n.href="#";n.onclick=a}},v.prototype._onSuggestAnEditLinkClick=function(n,t,i,u){n.preventDefault();e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:4,title:r.L_Menu_SuggestAnEdit_Link_Text+" - "+i,activeTaskId:t,options:u}})},v.prototype._getAttribution=function(){var n=this.panelRoot.select(".b_suppModule div[class*='b_footnote']");return n&&n.length>0?n[0].innerText:""},v.prototype._sendUpdateEntityProcessCall=function(n,t){var r,u,i;(this.savedEntityId||this.collectionId)&&(r={action:pt.UpdateEntity,data:{description:t,title:n},entityId:this.savedEntityId,collectionId:this.collectionId},i={type:s.collectionsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:r},e.invokeHandler(f.taskProcessDataHandlerKey,i));this.itineraryTaskId&&(u={action:4,itineraryItemChanged:{Description:t,Name:n,Id:this.itineraryEntityId}},i={type:s.itineraryDetailsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:u,taskId:this.itineraryTaskId},e.invokeHandler(f.taskProcessDataHandlerKey,i))},v.prototype._sendUpdateEntityRequestToItinerary=function(n,t){if(this.isTaskOnItinerarySlideout(n)&&t&&t.length===1){var i={action:4,itineraryItem:ii.getItineraryItemFromSearchEntity(t[0],t[0].getLocation())},r={type:s.itineraryDetailsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:i,taskId:n.parentTaskId};e.invokeHandler(f.taskProcessDataHandlerKey,r)}},v.prototype._collectionClick=function(n,t,i,r,u){this.annotationControl&&(this._buttonGroupViewModel.entityDescription=this.annotationControl.getDescription(),this.annotationControl.getCurrentName()!==this.annotationControl.getOriginalName()&&(this._buttonGroupViewModel.entityNickName=this.annotationControl.getCurrentName(),this._buttonGroupViewModel.entityOriginalName=this.annotationControl.getOriginalName()));u?ri.isEditable?this._buttonGroupViewModel.saveWithTravelButtonClicked(n,t,i,r,!0):this._buttonGroupViewModel.collectionMenuButtonClicked(n,t,i,r):this._buttonGroupViewModel.collectionButtonClicked(n,t,i,r)},v.prototype._registerBrowseProductsClick=function(n,i){for(var u=this,f=n.select(".shoppingButton"),o=f.length,s=function(){var n=f[r],o=t(n).select("a"),s,l;if(o&&o.length===1){var v=n.getAttribute("data-browseProductUrl"),y=n.getAttribute("data-productSearchUrl"),p=n.getAttribute("data-autosuggestEndPoint"),w=n.getAttribute("data-retailer"),c=e.getEntities(),a="";c&&c.length>0&&(a=c[0].getTitle());s=i&&i.productRootKeyword;s||(s=n.getAttribute("data-productRootKeyword"));l=function(n){n.stopImmediatePropagation();n.preventDefault();u.launchOverflowTask.invoke({taskType:0,title:w||a,loadingUrl:v,productSearchUrl:y,autosuggestEndpoint:p,entryPoint:1,productRootKeyword:s,impressionGuid:h.getImpressionGuid(u.panelRoot)})};o.add_event("click",l);e._addEventsToEventList(o,"click",l)}},e=this,r=0,c=o;r<c;r++)s()},v._detailsPageScripts={},v._photostripVisibleWidth=310,v._photoWidth=82,v._imgModalDialogContentTemplate='<div class="bigImg"><p>{imgAttrb}<\/p><div><img src="{imgSrc}" /><\/div><p><a href="{providerLink}">{providerLinkText}<\/a><\/p><\/div>',v._externalLinkAttrNameWithHash="#data-extlink",v}(eu),se=function(){function r(){this._skeletonCardBuffer=32;this._rightLaneSkeletonBufferAdjustment=4}return r.getInstance=function(){return r._instance||(r._instance=new r),r._instance},r.prototype.initialize=function(n){var t=this;this._initialized||(n&&n.getContainer().instanceAsync("TaskManager",function(n){t._taskManager=n},null,!0),this._activeTasksList=[],this._initialized=!0)},r.prototype.showOrHideSearchCardPrimer=function(u,f,e,o){var lt=t(".taskLayoutContainer.bm_l2NavLeft"),g=t(".taskLayoutContainer.bm_l2NavLeft .bm_scrollbarMask .cardWrapper.expand"),tt=t(".taskLayoutContainer.bm_l2NavLeft .bm_scrollbarMask .taskCard"),s=t(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft"),c=s.select(".bm_skCombinedWrapper"),k=c&&c.length>0&&c.has_class("bm_skSlideCard"),a=c.select(".bm_cardWrapper.bm_skeletonResults"),rt=c.select(".bm_cardWrapper.bm_skeletonDetails"),ft=c.select(".bm_cardWrapper.bm_skeletonResults .contentRoot"),oi=c.select(".bm_cardWrapper.bm_skeletonDetails .contentRoot"),d=!i._getIsSlideCardEnabled(),h=this._taskManager&&this._taskManager.getFocusedStack(),nt=i.getVerticalTaskBarWidth(),et=i.shouldLeftLaneBeHidden(),at=!(h&&h.getAllTasks().length>0),vt=this._getClickSourceInfo(e,h),yt=vt.isListingClick,ot=this._isSlideoutFromItineraryDetailsTask(f),pt=vt.newParent,wt=w.suppressSkeleton&&s.has_class("bm_suppressSkeleton"),bt=0,kt,b,dt,v,gt,st,fi,ni,ut,y,ht,ti,ii,p,ei,ri,l,ct;if(s.remove_class("bm_hideSkeleton"),kt=s.length>0&&s.select(".contentRoot"),kt&&kt.length!==0)if(u){if(wt){this._activeTasksList.push(f);return}if(!this._isEligibleForSkeleton(f,e,o))return;n.enableTopicSearchExperience&&s.remove_class("bm_wideSkeleton").remove_class("bm_narrowSkeleton");this._defaultSkeletonWidth=n.wideListCardFallback&&t("body")[0].clientWidth<n.wideListCardMinClientWidth?360:w.defaultSkeletonWidth;b=this._getSkeletonTemplate(f,e,h);b&&b.template===ui&&this._updateSkeletonTemplateForLazyLoad(b);dt=b.template;v=b.width;bt=v;gt=!0;d&&!c.has_class("bm_skFlipCard")&&c.add_class("bm_skFlipCard");f instanceof it||ot?(y=c.select(".bm_cardWrapper.bm_skeletonDetails .contentRoot"),this._clearDivContents(y),y.appendHTML(dt),st=v+this._skeletonCardBuffer,y.set_style({width:st+"px"}),rt.set_style({display:""}),(k||pt)&&!d&&!et?rt.add_class("bm_rightLaneSkeleton"):a.set_style({display:"none"}),this._setLeft(s,nt),yt||ot?i._getIsSlideCardEnabled()&&!et?(at?this._setLeft(s,nt):(ht=h&&this._getCardForTask(h.getFirstTask().id,tt),l=this._getPanelWrapperParentForCard(ht),l&&(fi=l.get_size().width+nt-2,i.isSlideOutCard(h)&&h.getFirstTask()!==h.getForegroundTask()&&(p=this._getCardForTask(h.getForegroundTask().id,tt),p&&p.getParent().set_style({display:"none"})),ot&&f.setCurrentWidth(388),pt?(ni=this._taskManager.getTaskById(vt.parentId),ut=this._getSkeletonTemplate(ni,{requestState:ni._getTaskState()}),this._clearDivContents(ft),ft.appendHTML(ut.template),ft.set_style({width:ut.width+this._skeletonCardBuffer-this._rightLaneSkeletonBufferAdjustment+"px"}),s.set_style({width:ut.width+v+this._skeletonCardBuffer*2-this._rightLaneSkeletonBufferAdjustment+"px"}),a.set_style({display:""}),bt=ut.width):(this._setLeft(s,fi),y.set_style({width:st-this._rightLaneSkeletonBufferAdjustment+"px"}),rt.add_class("bm_rightLaneSkeleton")))),gt=!1):this._setLeft(s,nt):!k||d||et||y.set_style({width:st-this._rightLaneSkeletonBufferAdjustment+"px"})):k&&(d||et)||(y=c.select(".bm_cardWrapper.bm_skeletonResults .contentRoot"),this._clearDivContents(y),y.appendHTML(dt),y.set_style({width:v+this._skeletonCardBuffer+"px"}),a.set_style({display:""}),this._defaultSkeletonWidth===416?v>this._defaultSkeletonWidth?a.add_class("bm_wideSearchCard"):a.add_class("bm_416SearchCard"):v>r.RegularListingCardLaneWidth&&a.add_class("bm_wideSearchCard"),k||rt.set_style({display:"none"}),this._setLeft(s,nt));this._activeTasksList.push(f);yt||at||(ht=h&&this._getCardForTask(h.getFirstTask().id,tt),l=this._getPanelWrapperParentForCard(ht),l&&l.set_style({width:v+"px"}),i.isSlideOutCard(h)&&(p=this._getCardForTask(h.getForegroundTask().id,tt),p&&p.getParent().set_style({display:"none"})));s.set_style({display:"block"});i._setPercievedLoadSkeletonShown(!0);gt&&lt.set_style({width:v+"px"});n.enableTopicSearchExperience&&(s.add_class(b&&b.width>r.CustomOneWideCardThreshhold?"bm_wideSkeleton":"bm_narrowSkeleton"),n.useTopicSearchCompactDesign&&!s.has_class("bm_tsCompact")&&s.add_class("bm_tsCompact"));ti=f instanceof it;ti&&(!ti||k||yt)?(pt||d)&&sj_evt.fire("CardResize",bt,!0):sj_evt.fire("CardResize",v,!0)}else{if(this._activeTasksList.indexOf(f)<0)return;wt||(ii=d&&k&&!(f instanceof it),ii||lt.set_style({width:""}),g&&g.length>0&&(l=this._getPanelWrapperParentForCard(g),!ii&&l&&l.set_style({width:""}),i.isSlideOutCard(h)&&(lt.set_style({width:""}),p=!at&&this._getCardForTask(h.getForegroundTask().id,tt),p&&(p.getParent().set_style({display:""}),p.remove_class("hidden")),ot&&f.setCurrentWidth(484))),!k||f instanceof it||d||(ei=a.get_size().width,a.set_style({display:"none"}),this._setLeft(s,ei+nt-4)),f instanceof it||(a.remove_class("bm_wideSearchCard"),a.remove_class("bm_416SearchCard")));ri=this._activeTasksList.indexOf(f);ri>-1&&this._activeTasksList.splice(ri,1);this._activeTasksList.length===0&&(wt?s.remove_class("bm_suppressSkeleton"):(l=this._getPanelWrapperParentForCard(g),g&&g.length>0&&l&&l.set_style({width:""}),s.set_style({display:"none"}),this._setLeft(s,""),rt.remove_class("bm_rightLaneSkeleton"),c.remove_class("bm_skFlipCard"),i._setPercievedLoadSkeletonShown(!1),ct={width:""},ft.set_style(ct),oi.set_style(ct),s.set_style(ct),s.select(".bm_skCombinedWrapper").remove_class("bm_skSlideCard").remove_class("bm_skFlipCard"),n.useTopicSearchCompactDesign&&s.has_class("bm_tsCompact")&&s.remove_class("bm_tsCompact")))}},r.prototype._getPanelWrapperParentForCard=function(n){for(var t=n;t!==null&&!t.has_class("panelWrapper")&&t.length!==0&&t.getParent()!==t;)t=t.getParent();return t},r.prototype._isEligibleForSkeleton=function(n,i,r){var u,e,f;if(!this._needsCardPrimer(i,n))return!1;if(u=r||n.displayState,u){if(u.prominence!==1||u.isHidden)return!1;(u.activationState===1&&u.stackOrder===2||u.activationState===2&&u.stackOrder===1)&&(e=t(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft"),f=e.select(".bm_skCombinedWrapper"),f.has_class("bm_skSlideCard")||f.has_class("bm_skSlideCard"))}return!0},r.prototype._getEntryPoint=function(n){return n&&n.requestState?n.requestState.entryPoint:null},r.prototype._needsCardPrimer=function(n,t){var i=!0,r=this._getEntryPoint(n);if(r){switch(r){case u.Collections:case u.DirectionsRouteList:case u.Feedback:case u.ItineraryListings:case u.MapsTour:case u.MobileListMap:case u.MyPlacesNew:case u.TransitLine:case u.TransitStop:case u.TravelL2:case u.VenueMap:case u.DirectionsWaypointSearch:case u.Trivia:i=!1}r===u.LocalDetails&&t instanceof ou&&(i=!1);r===u.LocalGuide&&n.requestState&&n.requestState.parentTaskId&&(i=!1)}return i},r.prototype._isSlideoutFromItineraryDetailsTask=function(n){return n&&n._taskState&&n._taskState.parentTaskId?n._taskState.parentTaskId.indexOf(s.itineraryDetailsTask)!==-1:!1},r.prototype._getClickSourceInfo=function(t,i){var e=!1,o=!1,s=t&&t.requestState&&t.requestState,f=s&&s.parentTaskId,r=this._getEntryPoint(t);if(r===u.LocalListing||r===u.TopicSearch&&n.enableTopicSearchExperience)e=!0,o=!1;else if((r===u.Infobox||r===u.LayerManager)&&i){var h=i.getFirstTask(),c=i.getForegroundTask(),l=h&&h.id===f,a=c&&c.id===f;o=!(l||a);(r===u.Infobox&&f||r===u.LayerManager&&s.listingTaskId)&&(e=!0)}return{isListingClick:e,newParent:o,parentId:f}},r.prototype._getSkeletonTemplate=function(t,i,u){var s,o,c;if(!t)return null;var e=i&&i.requestState,h=t.getRecommendedWidth(),f={template:ui,width:h?h:this._defaultSkeletonWidth};if(t instanceof it||!(t instanceof et)&&this._isIdBasedLookup(e)?(f.template=dr,f.width=r.RegularDetailsCardLaneWidth):t instanceof et&&(t instanceof tr||t instanceof pi||this._isRestaurantCategoryQuery(t,e)?(f.template=gr,f.width=this._getWiderListingCardWidth(e,t)):n.enableTopicSearchExperience&&t instanceof lu?(f.template=ie,f.width=window.innerWidth>n.threeColumnMinBrowserWidth?r.WiderListingCardCustomOneWidth:r.RegularListingCardCustomOneWidth):(f.template=ui,f.width=this._defaultSkeletonWidth)),e&&!(t instanceof it))switch(e.searchQueryCategory){case"Attraction":f.template=gr;f.width=this._getWiderListingCardWidth(e,t)}return w&&w.enableBoldUXChanges&&u&&(s=u.getAllTasks(),s&&s.length>1&&(o=u.getForegroundTask(),o&&o.displayState&&o.displayState.stackOrder==2&&(c=o.getCurrentWidth(),c==944&&(f.template=te,f.width=944)))),f},r.prototype._updateSkeletonTemplateForLazyLoad=function(n){var f,t,e,u;n&&n.template===ui&&(f=this._taskManager&&this._taskManager.getFocusedStack(),f&&(t=i.isSlideOutCard(f)?f.getFirstTask():f.getForegroundTask(),t&&t._getTaskState&&(e={requestState:t._getTaskState()},u=this._getSkeletonTemplate(t,e),u.template===dr&&t.getRecommendedWidth&&t.getRecommendedWidth()>r.RegularDetailsCardLaneWidth?(n.template=ue,n.width=r.WiderDetailsCardLaneWidth):u.template===ui&&t.getCurrentWidth()!==null?(n.template=u.template,n.width=t.getCurrentWidth()):(n.template=u.template,n.width=u.width))))},r.prototype._isRestaurantCategoryQuery=function(n,t){return n instanceof bi&&t.isCategoryQuery},r.prototype._isIdBasedLookup=function(n){return n&&(n.id&&n.id.indexOf("id:")>-1||n.filterUrlParam&&n.filterUrlParam.indexOf("id:")>-1&&n.filterUrlParam.indexOf("local_topicid")===-1)},r.prototype._getWiderListingCardWidth=function(n,t){return n&&n.isThreeColumnResponseExpected&&!(t instanceof pi)?r.WiderListingCardLaneWidth:r.WiderListingCardTwoColumnWidth},r.prototype._getCardForTask=function(n,r){var o=!i._getIsSlideCardEnabled(),u,f,e;if(r&&r.length>0&&n)for(u=0;u<r.length;u++)if(f=t(r[u]),e=o?f.select(".cardFace").get_attr("data-subtaskid"):f.get_attr("data-subtaskid"),e===n)return f;return null},r.prototype._clearDivContents=function(n){if(n.length>0)while(n[0].firstChild)n[0].removeChild(n[0].firstChild)},r.prototype._setLeft=function(n,t){var r={};r[i._isRtl()?"right":"left"]=t;n.set_style(r)},r.WiderListingCardLaneWidth=732,r.WiderListingCardCustomOneWidth=656,r.RegularListingCardCustomOneWidth=464,r.CustomOneWideCardThreshhold=550,r.WiderListingCardTwoColumnWidth=484,r.WiderDetailsCardLaneWidth=650,r.RegularDetailsCardLaneWidth=464,r.RegularListingCardLaneWidth=384,r.BoldDetailsCardLaneWidth=944,r}(),yi=function(o){function c(t,i,u,f,e,s,h){var l=this;return i&&i.add_class("bm_listings-container"),l=o.call(this,t,i,f,"a.listings-item","data-entity",s)||this,l._poiManager=e,l._taskId=u,l._controlTemplateFactory=h,l.resources=r,l.printTitleViewModel=null,l.printListingsViewModel=null,l._paginationImageDelayLoaded=!1,l.loadInfobox=new nt,l._paginationItemsPerPage=n.useNewListingSearchCount?n.listingSearchCount:c._evenColumnListItemsPerPage,l._paginationCurrentPage=0,c._entityCardHoverTimeout=n.hoverThreshold,l}return y(c,o),c.prototype.getIsDetails=function(){return!1},c.prototype.getQuery=function(){return this._query},c.prototype.setQuery=function(n){this._query=n},c.prototype.getPaginationViewModel=function(){return this._paginationViewModel},c.prototype.clear=function(n){n&&n.isInfiniteScroll||o.prototype.clear.call(this)},c.prototype.setResponseContent=function(t,i,r){if(t){var u=t.select(".bm_3col"),f=t.select("a.listing-ads");u&&u.length?(this._paginationItemsPerPage=n.useNewListingSearchCount?n.listingSearchCount:c._threeColumnListItemsPerPage,i&&(i.isThreeColumns=!0)):this._paginationItemsPerPage=f&&f.length?n.useNewListingSearchCount?n.listingSearchCount+2:c._listItemsPerPageWithAds:n.useNewListingSearchCount?n.listingSearchCount:c._evenColumnListItemsPerPage;this.isWaterfallListingsEnabled()||this.IsInfiniteScrollEnabled()||this._delayLoadListingImagesInPagination(t);o.prototype.setResponseContent.call(this,t,i,r);this.isWaterfallListingsEnabled()&&(this._paginationItemsPerPage=c._waterfallListItemsPerPage);this.setQuery(i.query);o.prototype.addReportLinkToNoResultCard.call(this,t,this._taskId,i);this._dataCategory!="House"&&this._addReportMissingEntityLinkToLocalListing(t,this._taskId,i);this._logModulesImpressions()}},c.prototype._addReportMissingEntityLinkToLocalListing=function(n,t,i){var e=this,f=this.panelRoot.select(".report-missing-business-link-container"),h=f.select(".bm_report-missing-business-link-content"),c=n.select("div[data-answerinfo]"),o=c.select(".query"),r=o.length>0?o[0].textContent:"",u,s;if(r=r||i&&i.query,u=this.getUserFacts(),s=this._dataCategory||this._getDataCategory(),s==="TestingLocation"&&u&&(u.isTestingLocation="true"),f.length>0&&h.length<1){var l={addMissingEntityLinkClicked:function(n){e.onAddMissingBusinessLinkClicked(n,e._taskId,r,r,u,4)}},a=this._controlTemplateFactory({templateText:gf,staticResources:l}),v=a.applyDataTemplate(this);f.append(v)}},c.prototype.dispose=function(){o.prototype.dispose.call(this);this._hoverPoi=null;var n=this._taskId.replace(/\$/g,"");t("."+n).removeFromParent()},c.prototype.registerListItemEvents=function(n,i){var e=this,f,u,r;this._listingPageProcessor=i;f=this.panelRoot.select("a[data-entity]");u=this.getPushpinPrimitives();f.for_each(function(n){var h=n.getAttribute("data-entity"),c=n.parentElement&&n.parentElement.classList.contains("b_rtbad"),r=!c&&t.Internals.parseJSON(h),f=r&&r.entity,o,s,i;if(f){for(s=u.length,i=0;i<s;i++)if(u[i].entity.id===f.id){o=u[i];break}e.registerListItemEvent(o,n)}});r=this.panelRoot.select(".lsAdMetadata");r.length&&r[0]&&(this._placeAdInfoIcon(r),this._lsAdPin&&(this.registerListItemEvent(this._lsAdPin,r[0]),ut.bindWhyThisAdHandler(r)))},c.prototype.registerListItemEvent=function(n,i){var u=this,r=t(i),f=function(t){return u._processMouseOver(n,t)},e=function(){return u._processMouseOut(n)};r.add_event("mouseenter",f).add_event("mouseleave",e);this._addEventsToEventList(r,"mouseenter",f);this._addEventsToEventList(r,"mouseleave",e)},c.prototype.InsertListItemCarousel=function(n,t){var i=this.processEntity(n,null,null,!0);i&&n.entity&&this.registerListItemEvent(i,t)},c.prototype.processDirectionsData=function(n){n&&n.inData&&n.inData.requestorState&&this._transientLensViewModel.processDirectionsData(n)},c.prototype.processCollectionsData=function(n){this._transientLensViewModel.processCollectionsData(n)},c.prototype.processTravelData=function(n,t){var r,i=n&&n.outData&&n.outData.length>0&&n.outData[0].data;i&&i.success&&i.primitives&&i.primitives.length>0&&this._listingPageProcessor?this._processPrimitivesFromItinerary(i.primitives):n&&n.inData&&n.inData.requestorState&&n.inData.requestorState.entryPoint===u.LocalListing?((r=t===null||t===void 0?void 0:t.parentTaskId)===null||r===void 0?void 0:r.startsWith(s.itineraryDetailsTask))||this._transientLensViewModel.getButtonGroupViewModel().processSaveWithTravelData(n):this._transientLensViewModel.processTravelData(n)},c.prototype.resetLeftLaneTaskPrimitives=function(n){var i,r;((i=this._itineraryPrimitives)===null||i===void 0?void 0:i.length)>0&&(this._itineraryPrimitives=null,r=this.panelRoot.select("a[data-task]"),r.for_each(function(i){var u=t(i),e,r;u.remove_class("saveTick");e=u.get_attr("data-task");r=t.Internals.parseJSON(e);(r===null||r===void 0?void 0:r.activateOptions)&&(r===null||r===void 0?void 0:r.state)&&(r.activateOptions.parentId=n,r.activateOptions.saveSlideoutTask=!1,r.state.listingTaskId=undefined,i.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(r)))}))},c.prototype.getListingsHtmlContentForPrint=function(n){var t=this,i,u,r;return this.printTitleViewModel=this,this.printListingsViewModel=new pu(this.map,this._controlTemplateFactory,this.getPushpinPrimitives(),n,this.panelRoot),i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideMatchedData:function(n){return t.hideIfMatchedData(n)},chooseIconSource:function(n){return t.chooseIconSource(n)}},this.titlePrintTemplate=new dt(df,i),this.listingsPrintTemplate=new dt(kf,i),u=this._controlTemplateFactory({templateText:kr,staticResources:i}),r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},c.prototype.chooseIconSource=function(n){var t="";return n&&(n===1&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAYAAAARIY8tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI+SURBVHgBrVXLbdtAEH2zEhEYvtAd6KgkhzAdOBXEvEjIyXYFMSuQXAGhCiKfAscBaFcQdRDlkFjIJSyBNyOWyPHM8gPZ+tiS+ACCu+Tuezuzu/MIaxC1Qne2jxNk+MhAC/kDEBJijNngwkkx8idBvIqDVhLvoSekZ3gBDGHYyHC+TGhB4Nvb0JMVR+VqCTRiw49WqmNMhlYKHAnBcTE1hoHf+R2MVwpcvg51QlQSz5hPP60JX/G1HbaahC8S7aH25e13b4PrBYFIBk4NfsoIlwnn3T9BHxvgsh32idCTZuIw3pfRmnLAlPBDyaU52JRc0Z3YOQN53JlEVH63ApLTE+Q5j5079LElnFd2bqzpKjhzAcqKjWI5CXGQYEv44yChPIqKk2zuCf+knXRugwPsiMgL3em98Em6JRsHJiV4Vgk0Rg2wUcgl1PZ0H0eVAIN/oSbIHliuLINbnSI5mlvnfkGg4JJj6xrDRSc/orVgnstIwcoFgHeoCRWX7IVxHFznbXha5FADuNjXTAWKszuSvvt/T0rzjrAXTFKktUzrmN1kZlzoWzqfd4nCzs1sPRJOLjmBziQYFlG0xGB62BLqIShKjnJWAvYn41SdijOcXb0JNxa5aoe5QQlHyvhQfn/kB9/FD7LKDzBqiqj/jB9oqZnN+0EqfvB3iR+UeOpoaoeyohsyEnbhVrZ+NXCoBa0kxkscrYS6lBD35+zwOQy0zC+rxLRulgo1ZIVEdMzEHqobSjHpisE3zTsM15X4B+Sp+kmb/BknAAAAAElFTkSuQmCC"),n===2&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAA2FBMVEUAAAAAAP8AgIAAVaoAgL8AZswAgKoAbbYAYL8cccYVar8UcMIUbLoTcb0Obb0Sbb8Sbr0RbL4RbbwQb70Qbb4QcL8PbL0Pbr4Pbb8Pbb0Sbr8Qbr4Pbr0Pbr4Pbb8Rb70Pbr0Pbr4Pbr8Rb70Rbr4Rbr8Qbb0Qbr4Qbr4Qb78Qbr0Qb74Qbr4Qbr4Qbb4Qbr0Pbr4Qbr8Qb74Qbr4Qbb4Qbr0Qbr4Qbr4Qbr4Qbr4Qbb4Qbr4Qbr4Qbr4Qbr4Qbr4Qb74Qbr4Pbr4Qbr4Qbr4Qbr4Qbr7///9cX+KCAAAARnRSTlMAAQIDBAUGBwgJGBkaGzY4Ojs9Pj9AQkNERkhydHZ3eISGh4iJi4yNjo+QkZKUsbO1ysvMzc7P0ODh4uPk5ebo6er3+Pn6Owdb5QAAAAFiS0dER2C9yXsAAADnSURBVBgZXcGJVoJAAAXQ50iiQbJFuWZqpaZmAeaWS0Dv/z8phcMR5l6khDsJDn+HYOIK5LRWzCybyChzct03tRvNGmzImYKE8smwrSKldkIuFFzMeazjyjhxirMWwzryjIgNQKzYRlGXSwGXaxVF1S0dvPMZsgFH8GlBZtPDkbeQ6dwjZgWyCmMcqEF2xx/4tCBz+IUx+5C98BX33FRRVNvRhvhmB0U9+iWgydBAnhnxEWczngxcmb8c40JZMOpWkao9RfwoI6FMye3Q1iu6M9yR4zIyjYAZ/wE5whl5+3jvvdklJP4B8mkkDDFG69QAAAAASUVORK5CYII="),n===3&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAYAAAARIY8tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHCSURBVHgBvVVbUsJAEOxd8D/cIDcQb6AnEE6AnkB+LUsIUpbfnEA4gXICuYF4AnME/hViT2azpHikIKTsn6R2d7p3Znd7DIoQIYDFDQyukSDkSOhmFhybc2yCM8xwj3gfhSkg7vOvi0NgMUYNg11C2wLPaGKJN79bwx1u7lTWrDi/QovzHRcZU6SNB2a2V2DIgCQlV+I6bovSTxFRqIZXxl26uDYe8b4tIAstPvkXcPGABYpwDAZcb9KyLpjtRbYx6xdYfDjy0dHkAomRWOH4ZUaeVvDEm6I1j7koQllobJyWSzmdwPqgJNEFykJjR3lO42r/DaldDw2cCr3iwhfwljUsb0DTKc5RBSL3CAUWLUsVFVjhC1VhzRXY3HD52m9DuRIRMJ44QHXwXNarWZyjKmRcFnM5A33WCc8iqiiLxJ1rXQT01GeAs+ZToQ8sSDlpF9YpTtz03UlZaGw/z6kCPfq5ZhG6PlAOGhtC7EI4kTe7Ja1ZD7xL2z5eZOgblLjpVTb8j/0gw2ZHk3aYYMpv7LvVC+d+SCiGlhEf1NHyuzJpA+ngEEgfEKve4cSmMFCdNtup3O3A79akvj/lOxoXWfwfT6aTbanaOXYAAAAASUVORK5CYII=")),t},c.prototype._parseCategoryData=function(n){var i,t=n.select("div[data-category]");t&&t.length===1&&(i=t.get_attr("data-category"));this.populateCardCategoryId(i)},c.prototype._logEntityCardHoverIfNecessary=function(n){if(n&&this._entityCardHoverStartTime&&Date.now()-this._entityCardHoverStartTime>=c._entityCardHoverTimeout){var t=this.getQuery()||"",i={logData:{feature:"LC",action:"H",data:{ID:n.id,Q:t,EP:u.LocalListing}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,i);this._entityCardHoverStartTime=null}},c.prototype._placeAdInfoIcon=function(n){if(n&&n.length>0){var i=n.select(".b_adSlug"),t=n.select(".b_adinfo");t.length<1&&(t=n.select(".infobubble_item"));t.length>0&&i.length>0&&i[0].insertAdjacentElement("afterend",t[0])}},c.prototype._processPrimitivesFromItinerary=function(n){var r=this,i;this._itineraryPrimitives=n;i=this.panelRoot.select("a[data-entity]");i.for_each(function(i){var l=i.getAttribute("data-entity"),f=t(i),s,h,u,c;f.add_class("savePlus").remove_class("saveTick");var a=f.select(".cico").getParent(),v=i.parentElement&&i.parentElement.classList.contains("b_rtbad"),e=!v&&t.Internals.parseJSON(l),o=e&&e.entity&&e.entity.id;if(o)for(s=o.replace("sid:","").replace("ypid:","").replace("YN",""),h=n.length,u=0;u<h;u++)if(c=n[u].entity.id.replace("YN",""),c===s){f.remove_class("savePlus").add_class("saveTick");a.remove_event("click",r._listingPageProcessor.getSaveButtonClickHandler(o));break}})},c.prototype._logModulesImpressions=function(){var r,o,s,n,i;if(this.panelRoot&&(r=this.panelRoot.select("div[data-implog]"),r&&r.length))for(o=0;o<r.length;o++)if(s=r[o].getAttribute("data-implog"),s)try{if(n=t.Internals.parseJSON(s),n&&n.length)for(i=0;i<n.length;i++)n[i].AN&&n[i].CNT&&e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:ft.Search,action:"I",data:{AN:n[i].AN,CNT:n[i].CNT,EP:u.LocalListing}},impressionGuid:h.getImpressionGuid(this.panelRoot)})}catch(c){}},c.prototype._processMouseOver=function(t){var i,r;n.enableInfoBox&&(i=t,i&&(i.viewState!==1&&i.viewState!==3&&(this.loadDelayedListingImagesInPagination(),i.viewState=1,i.zIndex=2,this._hoverPoi=i,i.entity.changed&&i.entity.changed.invoke({sender:i.entity}),sj_evt&&sj_evt.fire("pushpinhoverstarted",t),this._entityCardHoverStartTime=Date.now()),r=et.mapsInfobox,r&&r.getOptions()&&r.getOptions().visible!==!1||i.viewState!==1||this.loadInfobox.invoke(t)))},c.prototype._processMouseOut=function(n){var i=n?n.viewState:null,t=this._hoverPoi;n&&t&&(n===t&&sj_evt&&sj_evt.fire("pushpinhoverstopped",n),i!==3&&(t.viewState=0,t.zIndex=this._paginationCurrentPage>0?1:0,t.entity.changed&&t.entity.changed.invoke({sender:t.entity}),this._hoverPoi=null,this._logEntityCardHoverIfNecessary(n.entity)));et.mapsInfobox&&et.mapsInfobox.setOptions({visible:!1})},c.prototype._buildLogData=function(n,t){return{logData:{feature:"LC",action:n,data:t}}},c.prototype._mapviewSuggestionClickHandler=function(n){var t,i,o,r;if(n&&n.target){for(t=n.target;t.parentNode;){if(t.nodeName.toLowerCase()==="a")break;t=t.parentNode}(n&&n.preventDefault(),t)&&(i=t.getAttribute("aria-label"),i)&&(o=this._buildLogData("C",{AN:"SearchSuggestion",EP:u.LocalListing,DT:"SuggestionLinkDynamic."+i}),e.invokeHandler(f.instrumentationDataHandlerKey,o),r={},r.entryPoint=u.LocalListing,r.query=i,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:r,type:s.localSearchTask}))}},c.prototype.updateTnAAds=function(){var n=this.panelRoot.select("[data-tag=TnA.AdsModule.Container]"),t,i;n&&n.length>0&&(t=h.getImpressionGuid(this.panelRoot),i=this._getDataCategory(),ci.setShownAds("MC",".maps_tna_ad_card",n,t,i),ci.setShownAds("SC",".maps_tna_ad_item",n,t,i))},c.prototype.updateLocalSearchAds=function(){var i=this.panelRoot.select("div.lsAdMetadata"),n,r;i&&i.length&&(n=i.select(".ad_sc"),n&&n.length&&(r=h.getImpressionGuid(this.panelRoot),n.for_each(function(n){var i=t(".listad",n),f=t("a",n),u=f&&f[0];u&&(ut.updateAdLink(u,r),i&&i[0]&&i[0].addEventListener("click",function(){ut.callGLink(u,r)}))})))},c.prototype.getHouseListingCounts=function(n){var t,i;if((n===null||n===void 0?void 0:n.length)&&(t=n.get_attr("data-listingMetadata"),(t===null||t===void 0?void 0:t.length)&&(i=JSON.parse(t),i))){var u=parseInt(i.CurrentListCount),f=parseInt(i.BlockedCount),r=u+f;return isNaN(r)?null:r}return null},c.prototype.updateTextAds=function(){if(ut.isEnabled())try{var n=this.panelRoot.select("div.mapsTextAds");ut.setShownAds(ct.LI,n,h.getImpressionGuid(this.panelRoot))}catch(t){ut.logError(t)}},c.prototype.processPoiPagination=function(n,t){var y=this,e=this._getResultItemRoot(),f,r,u,s;if(e&&e.length===1&&(f=this._getResultItems(e),this._shouldPaginate(f))){var h=this._isPricePoiPagination(),o=Math.floor(f.length/this._paginationItemsPerPage)+(f.length%this._paginationItemsPerPage>0?1:0),l=i._createElement("div"),a=i._createElement("ul"),v=[];for(this._paginationCurrentPage=1,l.set_attr("class","bm_paginationModule"),r=0;r<=o+1;r++)u=i._createElement("a"),v.push(u),u.set_attr("href","#"),u.set_attr("data-pageNumber",r.toString()),r===0?u.set_attr("class",c._noDisplayClassName):r===o+1?u.set_attr("class","bm_rightArrow"):u.set_text(r.toString()),r===1&&u.set_attr("class","bm_active"),u.add_event("click",function(n){y._paginationHandler(n,v,o,f,t,h)}),s=i._createElement("li"),s.append(u),r>c._paginationVisiblePageButtons&&r<o+1&&s.set_attr("class",c._noDisplayClassName),a.append(s);l.append(a);e.getParent().append(l);this._paginationSetDisplayForItems(f,1,!0,t,h);n.disableListingRefresh=h?!1:!0;this._paginationListingItems=f}},c.prototype.setIconOnlyLimitBySegmentTypeOrCategoryId=function(){var e,t,r,i,u,f;if(n&&n.iconOnlyLimitBySegmentTypeOrCategoryId){if(e=this._getDataCategory(),!e)return;if(t=e.split("."),r=Object.keys(n.iconOnlyLimitBySegmentTypeOrCategoryId),r&&r.length&&t&&t.length)for(i=0;i<t.length;i++)if(u=t[i]&&t[i].toLowerCase(),u&&r.indexOf(u)>-1&&(f=n.iconOnlyLimitBySegmentTypeOrCategoryId[u],f&&!isNaN(parseFloat(f)))){this._poiManager.iconOnlyLimit=parseFloat(f);break}}},c.prototype._enableServerPaginationForRestaurants=function(){var n=!1,t,r;return this.panelRoot&&(t=this._getDataCategory(),i._isRestaurantCategory(t)&&(r=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),n=!!r)),n},c.prototype._enableServerPaginationForLocal=function(){var i,r,t;return n.serverPaginationForLocalEntities&&(i=this._getDataCategory(),i&&i.startsWith("90000")&&(r=this.panelRoot.select("div[data-hasmoreresults]"),r.length))?(t=r.get_attr("data-hasmoreresults"),t&&t.length>0&&t.indexOf("false")<0):!1},c.prototype._getResultItems=function(n){return this.isWaterfallListingsEnabled()?this.panelRoot.select("a.listings-item"):!n||n.length!==1?null:n.select("li")},c.prototype._getResultItemRoot=function(){return this.isWaterfallListingsEnabled()?this.panelRoot.select("div.wfr_cells"):this.panelRoot.select("div.entity-listing-container ul")},c.prototype.isWaterfallListingsEnabled=function(t){t||(t=this.panelRoot);var i=this._getDataCategory();return n.waterfallEnabledCategories&&n.waterfallEnabledCategories.length!==0&&i?n.waterfallEnabledCategories.indexOf(i.toLowerCase())>=0?t.select("div.wfr_cells").length>0:!1:!1},c.prototype.enableServerPagination=function(t,i,r){var h,f,w,o,l,u,v,s;if(!this._enableServerPaginationForRestaurants()&&!this._enableServerPaginationForLocal()){if(f=n.categoriesWithServerPagination,!f||f.length<1)return!1;var y=!1,p=this._getDataCategory(),e=p&&p.split(".");if(e&&e.length)for(w=e.length,o=0;o<w;++o)if(l=e[o].toLowerCase(),l&&f.indexOf(l)>-1){y=!0;break}if(!y)return!1}if(u=this._getResultItemRoot(),!u||u.length!==1)return!1;if(this._paginationControl&&!(i&&i.mapPannedOrZooomed))return u.getParent().append(this._paginationControl),!0;var a=this._getResultItems(u),b=this.getHouseListingCounts(this.panelRoot.select("div[data-listingMetadata]")),k=b?b:a.length,d=(h=u.select("div.b_rtbad").length)!==null&&h!==void 0?h:0;return!a||!this._pushpins||k<this._paginationItemsPerPage&&!this.isWaterfallListingsEnabled()||this._getNoMoreResults()||a.length!==this._pushpins.length+d?!1:(v=this._getInfiniteScrollComponentId(t),v&&this.IsInfiniteScrollEnabled()?this._paginationViewModel||(this.isWaterfallListingsEnabled()&&(this._paginationItemsPerPage=c._waterfallListItemsPerPage),this._paginationViewModel=new wu(this._controlTemplateFactory,this._paginationItemsPerPage,k,t,r,v,this.isWaterfallListingsEnabled()),this.IsInfiniteScrollEnabled()&&this._paginationViewModel.setActiveState(!0)):this._paginationViewModel=new bu(this._controlTemplateFactory,this._paginationItemsPerPage,t,r),s=this._paginationViewModel&&this._paginationViewModel.getControl(),!s)?!1:(this._paginationControl=s,u.getParent().append(s),!0)},c.prototype.resetServerPagination=function(){this._paginationControl=null},c.prototype.getCategory=function(){return this._getDataCategory()},c.prototype.getDomEntities=function(){return this._getResultItems(this._getResultItemRoot())},c.prototype.getPaginationRootId=function(n){var r=this.isWaterfallListingsEnabled(n)?"WfrGridId":"InfScrollCompId",i=n.select("div.overlay-listings").get_attr("data-listingMetadata"),t;if(i)try{if(t=JSON.parse(i),t)return t[r]}catch(u){}return null},c.prototype._getInfiniteScrollComponentId=function(n){return!n||!n.panelRoot?null:this.getPaginationRootId(n.panelRoot)},c.prototype._getDataCategory=function(){if(!this._dataCategory&&this.panelRoot){var n=this.panelRoot.select("div[data-category]");n&&n.length&&(this._dataCategory=n.get_attr("data-category"))}return this._dataCategory},c.prototype._getNoMoreResults=function(){var n=this.panelRoot&&this.panelRoot.select("div[data-hasmoreresults]");return n&&n.length&&n.get_attr("data-hasmoreresults")==="false"},c.prototype._isPricePoiPagination=function(){var r,e,s,t,f;if(n.poiCountOverrideByCategoryId){for(r=!1,e=this._pushpins.length,t=0;t<e;++t)if(this._pushpins[t]&&this._pushpins[t].entity&&this._pushpins[t].entity.usePricePoi){r=!0;break}if(r){var o=this._getDataCategory(),i=o&&o.split("."),u=Object.keys(n.poiCountOverrideByCategoryId);if(u&&u.length&&i&&i.length)for(s=i.length,t=0;t<s;++t)if(f=i[t]&&i[t].toLowerCase(),f&&u.indexOf(f)>-1)return!0}}return!1},c.prototype._delayLoadListingImagesInPagination=function(){var f=this._getResultItemRoot(),n,i,t,r,u,e;if(f&&f.length===1&&(n=this._getResultItems(f),n&&!(n.length<=this._paginationItemsPerPage))){for(i=this._paginationItemsPerPage;i<n.length;i++)if(t=n[i].getElementsByTagName("img"),t&&t.length)for(r=0;r<t.length;r++)u=t[r],e=u.getAttribute("src"),e&&(u.setAttribute("data-delayedsrc",e),u.setAttribute("src",""));this._paginationImageDelayLoaded=!0}},c.prototype.loadDelayedListingImagesInPagination=function(){var n=this._paginationListingItems,i,t,r,u,f;if(this._paginationImageDelayLoaded&&n&&n.length&&n.length>this._paginationItemsPerPage)for(this._paginationImageDelayLoaded=!1,i=this._paginationItemsPerPage;i<n.length;i++)if(t=n[i].getElementsByTagName("img"),t&&t.length)for(r=0;r<t.length;r++)u=t[r],f=u.getAttribute("data-delayedsrc"),f&&(u.setAttribute("src",f),u.setAttribute("data-delayedsrc",""))},c.prototype._paginationSetDisplayForItems=function(n,t,i,r,u){var f,e;if(n&&this._pushpins&&!(n.length<=this._paginationItemsPerPage)&&n.length===this._pushpins.length){if(i&&t===1)for(f=0;f<n.length;f++)f>=this._paginationItemsPerPage&&(n[f].style.display="none"),u?this._pushpins[f].zIndex=f<this._paginationItemsPerPage?1:0:f>=this._paginationItemsPerPage?(this._pushpins[f].entity.isPaginationReducedPoi=!0,this._pushpins[f].zIndex=0):this._pushpins[f].zIndex=1;else for(this.loadDelayedListingImagesInPagination(),f=0;f<n.length;f++)e=Math.floor(f/this._paginationItemsPerPage)+1===t,e?n[f].removeAttribute("style"):n[f].style.display="none",u||(this._pushpins[f].entity.isPaginationReducedPoi=!e),this._pushpins[f].zIndex=e?1:0;this._poiManager.setPrimitives(this._pushpins,!1);r&&r()}},c.prototype._paginationHandler=function(n,t,i,r,u,f){var s,e,o;if(n&&n.preventDefault(),!(t.length<i+2)){if(n&&n.target&&(s=n.target.getAttribute("data-pageNumber"),s)){if(e=parseFloat(s),isNaN(e))return;if(e<1){if(this._paginationCurrentPage<=1)return;this._paginationCurrentPage-=1}else if(e>i){if(this._paginationCurrentPage>=i)return;this._paginationCurrentPage+=1}else{if(this._paginationCurrentPage===e)return;this._paginationCurrentPage=e}for(this._paginationSetDisplayForItems(r,this._paginationCurrentPage,!1,u,f),o=1;o<=i;o++)o<t.length&&t[o].set_attr("class",o===this._paginationCurrentPage?"bm_active":"");this._paginationCurrentPage<=1?t[0].set_attr("class",c._noDisplayClassName):t[0].set_attr("class","bm_leftArrow");this._paginationCurrentPage>=i?t[t.length-1].set_attr("class",c._noDisplayClassName):t[t.length-1].set_attr("class","bm_rightArrow");i>c._paginationVisiblePageButtons&&(this._paginationCurrentPage-1>0&&t[this._paginationCurrentPage-1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1?(t[this._paginationCurrentPage-1].getParent().set_attr("class",""),this._paginationCurrentPage+c._paginationVisiblePageButtons-2<t.length&&t[this._paginationCurrentPage+c._paginationVisiblePageButtons-1].getParent().set_attr("class",c._noDisplayClassName)):this._paginationCurrentPage+2<t.length&&t[this._paginationCurrentPage+1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1&&(t[this._paginationCurrentPage+1].getParent().set_attr("class",""),this._paginationCurrentPage-c._paginationVisiblePageButtons+1>0&&t[this._paginationCurrentPage-c._paginationVisiblePageButtons+1].getParent().set_attr("class",c._noDisplayClassName)))}u&&u()}},c.prototype.IsInfiniteScrollEnabled=function(){var t=this._getDataCategory();return t&&n.infiniteScrollEnabledCategories.indexOf(t.toLowerCase())>-1},c.prototype._shouldPaginate=function(n){return!n||!this._pushpins||n.length<=this._paginationItemsPerPage||n.length!==this._pushpins.length||n.length===this._paginationItemsPerPage+1&&n.select(".lsAdMetadata").length>0?!1:!0},c._evenColumnListItemsPerPage=20,c._threeColumnListItemsPerPage=21,c._listItemsPerPageWithAds=22,c._waterfallListItemsPerPage=18,c._paginationVisiblePageButtons=9,c._noDisplayClassName="bm_noDisplay",c}(eu),l=function(o){function l(t,i,r,u,f){var e=o.call(this,i)||this,s;return e.map=t,e._trafficLayer=f,e._count=n.useNewListingSearchCount?n.listingSearchCount:20,e._offset=0,e._stopSharing=!1,e.pageProcessor=r,e.type="LocalSearch",e._taskUrlParams.push({param:"q",paramGetter:function(){return e._getQueryParam()}}),e._taskUrlParams.push({param:"segment",paramGetter:function(){return e._getSegmentParam()}}),e._taskUrlParams.push({param:"lf",paramGetter:function(){return e._getFiltersParam()}}),e.scrollLane=new nt,e.laneScrolled=new nt,e.mapsInfoboxOptions={showCloseButton:!1,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},l._poiHoverLoggingThresholdForEventLogging=n.hoverThreshold,e._logHelper=new fu(e.perfLog),e.setPercentLoaded(0),u&&(e._transientLensViewModel=u,e.disposables.push(e._transientLensViewModel.invalidateLayer.add(function(){return e.concatOverlayPrimitive()}))),l._overlayCloseBtnListenerAdded||(s=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn")[0],s&&s.addEventListener&&(l._overlayCloseBtnListenerAdded=!0,s.addEventListener("click",function(){l._useBfpr=!1}))),e.setCurrentWidth(null),e.setRecommendedWidth(null),w.showLoadingSkeleton&&(e._searchPrimer=se.getInstance(),e._searchPrimer.initialize(t)),e._overrideGlinkPing(),e}return y(l,o),l.prototype.activate=function(n,t){o.prototype.activate.call(this,n,t);this.poiManager&&(this.poiManager.disableComputingMapViewForLoadingOnly=t.disableComputingMapViewForLoadingOnly,t.disableComputingMapViewForLoadingOnly=!1);this._taskState=t;this._transientLensViewModel.setOptions({requestorId:this.id,requestorType:this.type});this._taskState&&this._taskState.content&&this.processResponse(this._taskState.content);this.getTitle()&&(this._initialTitle=this.getTitle())},l.prototype.deactivate=function(){l.mapsInfobox&&(l.mapsInfobox.setOptions({visible:!1}),l.mapsInfobox.preventAutoClose=!1);this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.resetDataSource()});o.prototype.deactivate.call(this);this.viewModel.dispose()},l.prototype.setDisplayState=function(t){var s=this,u,f,e;if(o.prototype.setDisplayState.call(this,t),t.activationState&1&&this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.applyFilterOnDataSource(s.viewModel.landMarkFilterRule)}),t.activationState&1&&t.prominence&1&&(l._removeCardPrimer(this.map),(n===null||n===void 0?void 0:n.displayWebResultsOnMap)&&((u=this._taskState)===null||u===void 0?void 0:u.scenarioKey)&&this._taskState.scenarioKey.indexOf("ERR")>-1&&((f=this.panelRoot)===null||f===void 0?void 0:f.length)>0)){for(var i=this.panelRoot.parent(),r=null,h=0;i&&i.length>0&&h++<5;){if(i.has_class("contentRoot")){r=i;break}i=i.parent()}e=(r===null||r===void 0?void 0:r.length)>0&&r.select("div.bm_cardClose");e.length&&e.set_style({display:"none"})}},l.prototype.process=function(t,r,u){var e=t&&t.requestState,h,v;if(e){if(l._useBfpr&&(e.useBfpr=!0,this._taskState&&!this._taskState.useBfpr&&(this._taskState.useBfpr=!0)),e.action==1){var y={success:!0,primitives:e.travelPrimitives},w=[{data:y}],b={processorType:s.itineraryDetailsTask,inData:t,outData:w};this.viewModel.processTravelData(b,this._taskState);return}if(e.searchEntitiesRequested)this.viewModel&&r&&r({processorId:this.id,data:this.viewModel.getEntities()});else if(e.trackingDataRequested)this.viewModel&&r&&r({processorId:this.id,data:{ImpressionGuid:this._getImpressionGuid(),TraceId:this._getTraceId()}});else if(this._taskState=e,this._taskState.query&&(this._taskState.query=this._taskState.query.trim()),!this._taskState.query&&this._taskState.category&&(this._taskState.query=""),this._taskState.query||this._taskState.id||this._taskState.category){h=this._taskState.id?rt.ID:rt.SB;this._searchPerfState=this._logHelper.perfStart(h);var o=this._createUrl(),f=this._taskState.passThruParam,a=n.formCodeMonitr,d=f&&(f.indexOf("sponover")>-1||f.indexOf("sponad")>-1);((d||!i._isLocalOrRealEstateScenarioOverlayShownOnSerp())&&a&&f&&f.toUpperCase().indexOf(a)===-1||f&&f.toLowerCase().indexOf("lemodule")>-1)&&(o+=f.indexOf("&")!==0?"&"+f:f);k.getStartTime(this.id)||k.getStartTime("SearchRequest")||k.setStartTime("SearchRequest");this._sendSearchRequest(o,t,r,u,!0);n.instrumentOldSearchEvents&&(v={Q:this._taskState.query?this._taskState.query:"",URL:o},this._logHelper&&this._logHelper.log(p.LSR,v,c.dynamicProperties.mapsIG))}}},l.prototype.processCallback=function(n){var i,u,f,t,r;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===s.directionsTask?this.viewModel.processDirectionsData(n):n.processorType===s.collectionsTask?(i=n.inData.requestState,i&&i.action===pt.UpdateEntity&&i.data&&i.data.title&&this.type!==s.localListingTask&&(u=i.data.title,this.setTitle(u),f=this.viewModel,f.updatePoiTitle(u),f.resetPrimitives(this.poiManager),f.annotationControl.setCurrentName(u)),this.viewModel.processCollectionsData(n)):n.processorType===s.itineraryDetailsTask?this.viewModel.processTravelData(n,this._taskState):(n.processorType===s.localSearchTask||n.processorType===s.hotelsDetailsTask)&&n.outData.length&&n.outData[0].data&&n.outData[0].data.content&&(t=n.outData[0].data.content,r=d.parseCategory(t),this._taskState=n.inData.requestState||this._taskState,this._resetMicropois(),this._taskState&&r&&!this._taskState.isFallbackRequery&&(this._isOutingsFallback(r,t)||this._isHotelsFallback(r,t)||this._isRestaurantsFallback(r,t))?(this._taskState.disableTaskActivate=!1,this._requestFallback(t)):(this.processResponse(t),sj_evt.fire("scrollToTop"),this._logInstrumentationForLocalTopicsClick())))},l.prototype.serialize=function(n){var r,i,u,t;if(this._taskState&&(this._taskState.content=null,this._taskState.activatingElement=null,this._taskState.taskTitle||(this._taskState.taskTitle=this.getTitle()),this._taskState.primerPois=null,this._taskState.primerRequestUrl=null,this._taskState.primerParseSelector=null,n&&(this._reduceLatLonPrecisions(),this._taskState.shareDescription=this.getShareDescription(),this._taskState.fromSharing=!0,this._taskState.ads&&(this._taskState.ads=null),this.displayState.prominence===1)))if(this instanceof it||this instanceof pi)this._taskState&&(this._taskState.disableComputingMapViewForLoadingOnly=!0,this instanceof it&&(i=this.viewModel.getPushpinPrimitives(),i&&i.length&&(this._taskState.point=[Math.round(i[0].geometry.y*1e6)/1e6,Math.round(i[0].geometry.x*1e6)/1e6])));else return r=this._buildTaskStateWithPrimerPois(),r.disableComputingMapViewForLoadingOnly=!0,r;if(this._taskState&&this._taskState.originalResponse){u={};for(t in this._taskState)t&&t.indexOf("originalResponse")<0&&this._taskState.hasOwnProperty(t)&&(u[t]=this._taskState[t]);return u}return this._taskState},l.prototype.getShareDescription=function(){return""},l.prototype.getCardIconInfo=function(){return{iconClass:"srcTsk",iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},l.prototype._refreshWithDelay=function(n){var t=this;(!i._getIsSlideCardEnabled()||this.displayState.prominence!==1)&&this.displayState.activationState===2&&this instanceof tr||(st.abortRequest(this._outstandingRefreshReqId),window.clearTimeout(this._resultsReqTimeoutHandler),k.getStartTime(this.id)||k.setStartTime(this.id),this._resultsReqTimeoutHandler=Microsoft.Maps.setTimeout(function(){t._refresh(n)},af.refreshTimeout))},l.prototype._refresh=function(n){var t=this,r,u,f,e;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;this._taskState.cacheId=null;r=this._createUrl(n);r&&(this.setPercentLoaded(0),u=this._taskState&&this._taskState.id?rt.ID:rt.SB,n||(n={}),n.perfState=this._logHelper.perfStart(u),f=function(r){var u,s,f;t._showOrHideWaitLayer(!1);u=!0;try{n.perfState.end("NT");var e=t._convertToResponseObject(r),o=d.getEntitiesFromResponse(e,t._taskState),c=o&&o.entities;u=t._shouldProcessResponseOnRefresh(c,n);u&&(t.processResponse(e,n),s=n.forceLogAsLocalListingTask?p.LLT:p.LLR,f=null,n.forceLogAsLocalListingTask&&(f=h.getImpressionGuid(e)),t._logActivated(s,n.forceLoggingEntryPoint,f,n),t._logMapPageView(f),t.displayState&&t.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:h.getImpressionGuid(t.viewModel.panelRoot),primitives:t.viewModel.getPushpinPrimitives()}))}finally{u&&t._postRefresh()}},this._showOrHideWaitLayer(!0),e=function(){t._showOrHideWaitLayer(!1)},this._outstandingRefreshReqId=st.downloadGeneric(r,"srchrefresh",f,null,e,null,0,null,k.getLogKeyFromUrl(r)))},l.prototype.getIconColorAndClassName=function(n){var t=this,r,i;if(this._taskState.cardBackgroundData){n(this._taskState.cardBackgroundData.cardBackgroundColor,this._taskState.cardBackgroundData.cardClassName);return}r=this._taskState&&this._taskState.listingCategoryPath?!0:this.viewModel.categoryFound;typeof r=="undefined"?n(null,null):(i=function(i){i=i||di.FallbackLocalCat;t._buildCardIcon(null,i,function(r){t._taskState.cardBackgroundData={cardBackgroundColor:r,cardClassName:"catid_"+i};n(t._taskState.cardBackgroundData.cardBackgroundColor,t._taskState.cardBackgroundData.cardClassName)})},this._taskState.listingCategoryPath?this.map.getTemplateSelector().then(function(){var n=di.extractCategoryId(t._taskState.listingCategoryPath,!1);i(n)}):i(this.viewModel.getCardCategoryId()))},l.prototype.activateInfobox=function(r,u,f,e,o){var s=this,h=r.entity;f&&t.Browser.is_ie&&t.Browser.ie_version<12||e?l.mouseoverTimeout=0:f||l.mouseoverTimeout!==0||(l.mouseoverTimeout=500);n.enableRichInfoBox&&l.mapsInfobox&&l.mapsInfobox.getOptions().visible===!0&&l.mapsInfobox.setOptions({visible:!1});window.clearTimeout(l.mouseoverDelayHandle);l.mouseoverDelayHandle=window.setTimeout(function(){var e,t;if((!l.mapsInfobox||!l.mapsInfobox.preventAutoClose)&&h&&(h.infoboxHtml&&h.infoboxHtml.length>0||u&&u.length>0)&&(l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1}),!o))if(e=new Microsoft.Maps.Location(r.geometry.y,r.geometry.x),s.mapsInfoboxOptions.htmlContent=u?u:h.infoboxHtml,s.mapsInfoboxOptions.location=e,s.mapsInfoboxOptions.entity=h,t=f?new Microsoft.Maps.Point(4,4):u?new Microsoft.Maps.Point(10,10):new Microsoft.Maps.Point(8,8),!f&&s.displayState&&s.displayState.prominence&&s.displayState.prominence===1&&Number(c.stlVersion)>8.22&&s.map.getMapType().id===ei.road&&(t=new Microsoft.Maps.Point(22,32)),(i._isHotelsCategory(s._taskState.category||s._taskState.searchQueryCategory)||i._isHouseCategory(s._taskState.category||s._taskState.searchQueryCategory))&&(t=new Microsoft.Maps.Point(10,20)),s.mapsInfoboxOptions.offset=t,s.mapsInfoboxOptions.visible=!0,!l.mapsInfobox||n.enableRichInfoBox){if(l.mapsInfobox=null,f&&i.preventMicropoiUnderLandmarkPoi(s.mapsInfoboxOptions,sf.getExistingInfobox(),s.map))return;l.mapsInfobox=new Microsoft.Maps.MapsInfobox(e,s.mapsInfoboxOptions,s._transientLensViewModel&&s._transientLensViewModel.getButtonGroupViewModel(),s.id,s._taskState.formCode);l.mapsInfobox.setMap(s.map)}else l.mapsInfobox.setOptions(s.mapsInfoboxOptions)},n.enableRichInfoBox?l.mouseoverTimeout/3:l.mouseoverTimeout)},l.prototype._showOrHideWaitLayer=function(n){var r=this,i=t(".MicrosoftMap .bm_waitlayer");n?this.displayState&&this.displayState.prominence===1&&this.displayState.activationState===1&&(this._waitlayerId=Microsoft.Maps.setTimeout(function(){r._showOrHideWaitLayer(!1)},3e3),i.set_style({display:"block"}),w.dimOnAutoSuggest&&i.set_style({width:i.getParent().get_style("width")})):(clearTimeout(this._waitlayerId),i.set_style({display:"none"}),w.dimOnAutoSuggest&&i.set_style({width:""}))},l.prototype._shouldProcessResponseOnRefresh=function(n){return n&&n.length>0},l.prototype._shouldSuppressMapViewChangeOnRefresh=function(n){return n?n.mapPannedOrZooomed||n.isPaginated:!1},l.prototype._onPrimitivesChanged=function(n){var t=this._currentRefreshContext?this._shouldSuppressMapViewChangeOnRefresh(this._currentRefreshContext):!1;this._currentRefreshContext=undefined;this._canRenderPrimitives(this._getTaskState(),n)?this.poiManager&&this.poiManager.setPrimitives(n,t):this.poiManager&&this.poiManager.setPrimitives([],t)},l.prototype._postRefresh=function(){},l.prototype._getTaskState=function(){return this._taskState},l.prototype._resetMicropois=function(){},l.prototype._logInstrumentationEventForEntityClick=function(){var t=c.dynamicProperties.serpIG,n;t&&(n=Microsoft.Maps.logger,n&&n.logObject({T:"CI.OverlayEntClick",feature:"LocalOverlay",action:"CI.OverlayEntClick",data:{}},t,!1))},l.prototype._logPoiHoverIfNecessary=function(n,t,i){var r=n.primitive.entity;r&&(n.newValue===1?this._poiHoverStartTimeStamp=Date.now():(this._poiHoverStartTimeStamp&&Date.now()-this._poiHoverStartTimeStamp>=l._poiHoverLoggingThresholdForEventLogging&&this._logPoiHover(r,t,i),this._poiHoverStartTimeStamp=null))},l.prototype._logPoiHover=function(n,t,i){if(this._getTaskState()){var r=this._getTaskState().query||"",u={logData:{feature:"POI",action:"H",data:{ID:n.id,Q:r,EP:t,MP:!!i}},impressionGuid:this.pageProcessor instanceof ir?this.pageProcessor.getImpressionGuidFromEntity(h.getImpressionGuid(this.panelRoot),n.id):h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,u)}},l.prototype._logInstrumentationForLocalTopicsClick=function(){var t,i,r;this._taskState&&(n.openTopicsCarouselLinksInNewCard||this._taskState.disableTaskActivate===!0&&this._taskState.entryPoint==="LocalListing")&&(t=this._taskState.originIG,i=n.openTopicsCarouselLinksInNewCard?this._taskState.entryPoint:"LocalTopics",t&&(r={EP:i,Q:this._taskState.query?this._taskState.query:"",SNRO:this._taskState.scenarioKey,SIG:t,MIG:this._getMasterImpressionGuid(),TRACE:this._getTraceId(),CT:this._getListingContentType()},this._logHelper&&this._logHelper.log(p.LLT,r,t)))},l.prototype.processResponse=function(t,r){var h=this._getImpressionGuid(),o,s,c,f,u,e,l;h&&(this._taskState&&(this._taskState.impressionGuid=h),this.poiManager&&(this.poiManager.impressionGuid=h));o=t.select(".wfr_grid");o&&o.length>0&&(this.resizableComponentId=o.get_attr("id"));this.viewModel.setResponseContent(t,this._getTaskState());s=this.viewModel.panelRoot.select("div[data-mapcardwidth]");c=s&&s.length&&s[0].getAttribute("data-mapcardwidth");!c||r&&r.isInfiniteScroll||(f=parseInt(c),this.setRecommendedWidth(f),this.setCurrentWidth(f),w&&w.enableBoldUXChanges&&this.resizeCard.invoke(),n&&n.enablePoiCentering&&this.displayState&&i&&(u=void 0,e=32,this.map.getActualSize().width<=w.slideoutMinWidth||i.shouldLeftLaneBeHidden()?u=f+i.getVerticalTaskBarWidth()+e:this.displayState.stackOrder>1?(l=this.map.getViewportPadding(),u=i._isRtl()?l.right:l.left,u<n.placeCardWidth&&(e+=20,u+=f+i.getVerticalTaskBarWidth()+e)):u=f+i.getVerticalTaskBarWidth()+e,this._setViewportPaddingForCardSide(u)));!n.enableImagePostLoading||n.enableImprovedPerf&&this instanceof it||Microsoft.Maps.setTimeout(function(){sj_evt.fire("RMS.LoadImg")},0);this.setTaskComplete(r)},l.prototype.setTaskComplete=function(n){var t,u,r;if(this.setPercentLoaded(1),this._taskState.mapBounds=this._getLocalMapViewBounds(),this.serializableObjectChanged.invoke({magnitude:0}),t=this.viewModel.getPushpinPrimitives(),t&&(this._currentRefreshContext=n,this.setMapPrimitives(t),!this._stopSharing&&t.length))for(u=0;u<t.length;u++)if(r=t[u],r&&r.geometry&&i._shouldDisableShareForPoint(r.geometry.y,r.geometry.x)){this._stopSharing=!0;break}l._removePoiPrimerLayer(this.map);this._taskState.activatingElement=null},l.prototype.shouldResize=function(){var r=this.viewModel&&this.viewModel.getCardCategoryId(),i,t;if(r&&n.enabledCategoriesForResize.indexOf(r.toLowerCase())>-1)return!0;if(this._taskState&&this._taskState.primaryCategoryPath)for(i=this._taskState.primaryCategoryPath.split("."),t=0;t<i.length;t++)if(n.enabledCategoriesForResize.indexOf(i[t].toLowerCase())>-1)return!0;return!1},l.prototype.getSupportedSize=function(){return[]},l.prototype._logActivated=function(n,t,i,r){var k=this._taskState.fullQuery||this._taskState.query,h=k||this._taskState.id,w,o,s,f,c,l,a,v,y,b;h||(h="");w=(r===null||r===void 0?void 0:r.filterValueChanged)===!0?u.FilterChange:(r===null||r===void 0?void 0:r.mapPannedOrZooomed)===!0?u.MapPanZoom:"";o=n===p.LLR?w:this._taskState.entryPoint||"";t&&(o=t);var d=this._logCid(n,o)?this._taskState.asConversationId:"",g=this._taskState.scenarioKey||"",e={EP:o,Q:h,BB:this._tryGetBounds(),SNRO:g,SIG:this._getImpressionGuid()||this._taskState.impressionGuid,MIG:this._getMasterImpressionGuid(),TRACE:this._getTraceId(),CID:d};e&&e.SNRO&&e.SNRO.indexOf("ERR")!==-1&&(e.AAP=this._getAnswerPicked());n===p.LDT&&(s=this.viewModel&&this.viewModel.getEntities&&this.viewModel.getEntities(),f=s&&s.length&&s[0],e.LT=f&&f.getLocationType?f.getLocationType():"",e.SGMT=f&&f.getSegmentTypes?f.getSegmentTypes():null,c=this.panelRoot.select(".iaplanner"),e.IC=c&&c.length?!0:!1,l=f&&f.getPrimaryCategoryPath&&f.getPrimaryCategoryPath(),l&&(e.CAT=l),a=f&&f.getTitle&&f.getTitle(),a&&(e.RE=a),f&&this._logEntityIdType(e,f),v=f&&f.getVdpId&&f.getVdpId(),v&&(e.VDPID=v),y=this.panelRoot.select(".wfr_grid"),e.BLD=y&&y.length>0?this.getCurrentWidth()===464?fi.BoldUXInNarrowWidth:fi.BoldUXInWideWIdth:fi.NoBoldUX);n===p.LLT&&(e.CT=this._getListingContentType(),e.BLD=this.getCurrentWidth()===484?ai.TwoColumns:ai.ThreeColumns);b=n===p.LLR&&i?i:e.SIG;this._logHelper.log(n,e,b)},l.prototype._logCid=function(n,t){return(t===u.Autosuggest||t===u.SearchBox||t===u.SearchButton)&&n!=p.LLR?!0:!1},l.prototype._logEntityIdType=function(n,t){var i=t.id;i&&(i.indexOf("sid:")===0?n.SID=i.substr(i.indexOf(":")+1):i.indexOf("ypid:")===0?n.YPID=i.substr(i.indexOf(":")+1):i.indexOf("eventId:")===0?n.EID=i.substr(i.indexOf(":")+1):i.indexOf("geoId:")===0&&(n.GID=i.substr(i.indexOf(":")+1)))},l.prototype._getLocalMapViewBounds=function(){var t=ot.getMapBounds(this.map,!0),n=[];return n.push(t.getNorth()),n.push(t.getWest()),n.push(t.getSouth()),n.push(t.getEast()),n},l.prototype._getListingContentType=function(){var t=this.panelRoot.select("div.overlay-listings").get_attr("data-listingMetadata"),n;if(t)try{if(n=JSON.parse(t),n)return n.ContentType}catch(i){}return""},l.prototype._getTotalResultCount=function(n){var t,i,r;if(!n)return 0;if(t=n.select("div.overlay-listings").get_attr("data-listingMetadata"),t)try{if(i=JSON.parse(t),i)return r=i.TotalCount,parseInt(r)}catch(u){}return 0},l.prototype._getImpressionGuid=function(){return h.getImpressionGuid(this.panelRoot)},l.prototype._getMasterImpressionGuid=function(){return h.getMasterImpressionGuid()},l.prototype._getTraceId=function(){var n=this.panelRoot.select("div[data-traceid]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-traceid"),t)?t:""},l.prototype._contextMenuInvoked=function(n){n?(this._contextMenuPrimitive=n.primitive,this._contextMenuPrimitive&&(this._contextMenuPrimitive.viewState=0),this._contextMenuPrimitiveBucket=n.primitive.bucket,this._contextMenuPrimitiveViewState=this._contextMenuPrimitive.viewState,this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.show(n)):(this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.hide())},l.prototype.registerViewModelEvents=function(){var n=this;this.disposables.push(this.viewModel.changed.add(function(){var t=n.viewModel.getCardCategoryId();t&&(n.map.getTemplateSelector().then(function(i){i&&i.getCategoryIconTemplate(function(t){var i=t&&t.iconColor;i&&n.poiManager&&n.poiManager.setIconColorFromCard&&n.poiManager.setIconColorFromCard(i)},t)}),n.changed.invoke({name:"iconClass"}))}));this.disposables.push(this.viewModel.catIdPopulated.add(function(){n.changed.invoke({name:"catId"})}))},l.prototype.updateMapBounds=function(n){var t=this;this.disposables.push(this.map.getFrameManager().frameRendered.addOne(function(){ar.areEqual(t.map.getView(),n)&&(t._taskState.mapBounds=t._getLocalMapViewBounds(),t.serializableObjectChanged.invoke({magnitude:0}))}))},l.prototype.concatOverlayPrimitive=function(){var n=this._transientLensViewModel.getPrimitive();n?this.showOverlayPrimitive(n):this.hideOverlayPrimitive()},l.prototype.showOverlayPrimitive=function(n){this._contextMenuPrimitive.bucket&&delete this._contextMenuPrimitive.bucket;this._contextMenuPrimitive.viewState=3;this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke();n.viewState=3;var t=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(t.concat(n))},l.prototype.hideOverlayPrimitive=function(){this._contextMenuPrimitive&&(this._contextMenuPrimitiveBucket&&(this._contextMenuPrimitive.bucket=this._contextMenuPrimitiveBucket),this._contextMenuPrimitive.viewState=this._contextMenuPrimitiveViewState,this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke(),this._onPoiViewStateChanged({primitive:this._contextMenuPrimitive,oldValue:3,newValue:this._contextMenuPrimitiveViewState}));var n=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(n)},l.prototype._tryGetBounds=function(){try{return ot.getMapBounds(this.map).bounds}catch(n){return[]}},l.prototype._disableAdsRequest=function(n){return n&&n.isPaginated&&n.isWaterfallEnabled?!0:!1},l.prototype._createUrl=function(t,r,f){var rt,e,ii,ft=!1,ri,p,s,a,o,g,ui,nt,ht,tt,d,ct,lt,fi,at,ei,oi,si,vt,v,ci,b,pt,wt,h,it,bt,y,kt,dt,k,gt,ni,ti;if(this._taskState){e=this._getRequestUrlFormat().replace("{mkt}",c.dynamicProperties.market).replace("{appid}",c.dynamicProperties.appId);ii=e.indexOf("overlaybfpr")>-1;p=this._getLocationInfo();i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(this._taskState.fullQuery=this._taskState.fullQuery||this._taskState.query);s=this._taskState.id;o="";this._taskState.localFilters&&(ri=!0);var et=(rt=this._taskState.localFilters)===null||rt===void 0?void 0:rt.toLowerCase(),st=et===null||et===void 0?void 0:et.indexOf("realestatemarket");i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.localFilters&&st!=0?this._taskState.filterUrlParam&&st==-1&&(this._taskState.localFilters+=" "+this._getRealEstateMarketParam(this._taskState.filterUrlParam)):n.suppressIdOnAutoSuggest&&this._taskState.entryPoint===u.Autosuggest||(this._taskState.filterUrlParam&&!this._taskState.localFilters?o=this._taskState.filterUrlParam+"%20":s&&s.indexOf("ypid:")===0?(a=n.localFilterFormat,o=encodeURIComponent(a.replace("{ypid}",s.substring(5))+" ")):s&&s.indexOf("sid:")===0?(a=n.entityFilterFormat,o=encodeURIComponent(a.replace("{sid}",s.substring(4))+" "),g=this._taskState.hasOwnProperty("localListingsState")?this._taskState.localListingsState:null,this._taskState.localFilters&&st>-1?o+=encodeURIComponent(this._taskState.localFilters+" "):g!=null&&g.hasOwnProperty("filterUrlParam")&&(ui=g.filterUrlParam,o+=encodeURIComponent(this._getRealEstateMarketParam(ui)))):s&&s.indexOf("eventId:")===0?(a=n.eventFilterFormat,tt=s.indexOf("eventParentId:"),tt!==-1?(nt=s.substring(8,tt-1),ht=s.substring(tt+14)):(nt=s.substring(8),ht=nt),o=encodeURIComponent(a.replace("{eventId}",nt).replace("{eventParentId}",ht).replace("{latlong}",this._taskState.latLongForEventRequery).replace("{city}",this._taskState.locationForEventRequery)+" ")):s&&s.indexOf("vdpid:")===0&&(a=n.vdpIdFilterFormat,o=encodeURIComponent(a.replace("{vdpid}",s.substring(6))+" ")));this._overridePoiCount();d=r!==undefined?r.toString():this._offset.toString();o?(lt=f!==undefined?f.toString():this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))?this._taskState.poiCount:this._count.toString(),e+="&count="+lt+"&ecount="+lt+"&first="+d+"&efirst="+(parseInt(d)+1).toString(),e+=p):(ct=f!==undefined?f.toString():this._taskState.entryPoint===u.DirectionsWaypointSearch?n.directionsSearchCount.toString():this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))?this._taskState.poiCount:this._count.toString(),e+="&count="+ct+"&ecount="+ct+"&first="+d+"&efirst="+(parseInt(d)+1).toString()+p,this._taskState.localFilters&&(o+=encodeURIComponent(this._taskState.localFilters+" ")),(ri||t&&t.mapPannedOrZooomed)&&(this._taskState.disableOSearchFromBackend||(this._taskState.disableOSearchFromBackend=this.panelRoot.select("div[data-disableosearch]").get_attr("data-disableosearch")),this._taskState.disableOSearchFromBackend==="1"&&(e+=l._disableOSearchParameter)));this._taskState.chainId?(e+="&chain="+this._taskState.chainId,n.sendCarouselRead&&(o+=encodeURIComponent('carouselread:"true" '))):this._taskState.forceSendCarouselRead&&(o+=encodeURIComponent('carouselread:"true" '));fi=this._taskState.taskTitle||"";at=this._taskState.query||this._taskState.taskTitle||o||this._taskState.category;i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&!p&&(at=this._taskState.fullQuery);ei=encodeURIComponent(at.trim());typeof Base64Encoder!="undefined"&&(this._taskState.asName&&(oi=Base64Encoder.stringToBase64(this._taskState.asName),o+=encodeURIComponent('een:"'+oi+'" ')),this._taskState.asFormattedAddress&&(si=Base64Encoder.stringToBase64(this._taskState.asFormattedAddress),o+=encodeURIComponent('eea:"'+si+'" ')));this._taskState.extraFuiAugmentations&&(o+=encodeURIComponent(this._taskState.extraFuiAugmentations+" "));t&&(t.isPaginated||t.mapPannedOrZooomed||t.appliedFilterOption)&&this.viewModel&&i._isAttractionCategory(this.viewModel.getCardCategoryId())&&!(this._taskState.localFilters&&this._taskState.localFilters.indexOf('tsource:"OutdoorAttraction"')>-1)&&(o+=encodeURIComponent('tsource:"attraction" '));this._taskState.segmentType==="Attraction"&&(o+=encodeURIComponent('entitylisttype:"Attraction" '));n.sendDoNotBlockResultsForSID&&this._taskState.listingCategoryPath&&i._isAttractionCategory(this._taskState.listingCategoryPath)&&this._taskState.id&&this._taskState.id.indexOf("sid:")>-1&&(o+=encodeURIComponent('DoNotBlockResultsForSID:"false" '));o+=this._getCacheId();o+=this._getSearchInsideMapBounds();o+=this._getMapPanOrZoom(t);o+=this._getEntityListType();this._taskState.entryPoint===u.Autosuggest&&(o+=encodeURIComponent('isAutoSuggestion:"true" '));ft=this._taskState.filterUrlParam&&(this._taskState.filterUrlParam.indexOf("local_ypid")>-1||this._taskState.filterUrlParam.indexOf("sid")>-1||this._taskState.filterUrlParam.indexOf("eventId")>-1||this._taskState.filterUrlParam.indexOf("local_vdpid")>-1);vt=this._taskState.id||ft?"details":this._getCardTypeAugmentation();o+=encodeURIComponent('mapcardtype:"'+vt+'" ');e+="&cardtype="+vt;e=e.replace("{title}",encodeURIComponent(fi));e=e.replace(new RegExp("{query}","gi"),ei).replace("{filter}",o);e=e.replace("{tid}",l._tabID);v="";this._taskState.primerPois&&this._taskState.primerPois.length>0&&(this._taskState.primerPois.forEach(function(n){n.entity.id&&(v+=n.entity.id+",")}),v=v.substr(0,v.length-1),v&&(e+="&localypids="+v));this._taskState.startDate&&this._taskState.endDate&&(e+="&ckin="+this._taskState.startDate+"&ckout="+this._taskState.endDate);var w=this._taskState.filterUrlParam,yt=w&&w.indexOf("sid:")>-1,li=yt&&w.indexOf("eventid:")>-1,hi=yt&&w.indexOf('disp:"itr"')>-1||w&&w.indexOf('disp:"itrlist"')>-1;n.sendAplusAnswerRequeryPage?ii&&!li&&!hi&&(this._taskState.id&&this._taskState.id.indexOf("sid:")===0||yt)&&(e=e.replace("[AplusAnswer",'[AplusAnswer RequeryPage="Default"')):e=e.replace("[AplusAnswer]","");hi&&(this._taskState.noAds=!0);ci=i._getUrlParam(window.location,"overrideBfprAnswerPicker");ci=="true"&&(e+="&overrideBfprAnswerPicker=true");p&&e.indexOf("localMapView")<0&&(e+=p);this._taskState.entryPoint===u.Autosuggest&&(e+="&isAS=true")}return b=n.formCodeMonitr,b&&e.toUpperCase().indexOf(b)!==-1||(b&&window.location.href.toUpperCase().indexOf(b)>-1?e+="&FORM="+b:n.useNewFormCode&&(pt=this._getFormCode(),pt&&(e+="&FORM="+pt))),this._updateTitle(),this._taskState.noAds&&(wt=this._getTextAdsCode(),(wt==="r"||wt==="h")&&(this._taskState.noAds=!1)),ut.isEnabled()&&this._taskState&&!this._taskState.noAds&&!this._disableAdsRequest(t)&&(h=this._getTextAdsCode(),h&&(t&&t.mapPannedOrZooomed?i._isAttractionCategory(this.viewModel.getCardCategoryId())?h="tnaonly":this.displayState&&this.displayState.activationState===2&&h==="1"&&(h="1b"):(this._taskState.id||ft)&&h!=="h"&&h!=="r"&&h!=="rb"&&h!=="ts"&&(h="d")),h&&(this._taskState.ads&&(h+=this._taskState.ads),e+="&ads="+h,it=ot.getMapCenter(this.map),it&&(e+="&cp="+it.latitude+"~"+it.longitude),ut.logQueryEvent(this._taskState.entryPoint))),e=e.replace("{originIG}",this._taskState.originIG?this._taskState.originIG:""),t&&(t.isPaginated||t.mapPannedOrZooomed||t.isInfiniteScroll)&&n.useInitialPageIGForPagination&&(bt=this.panelRoot.select(".bm_instScroll"),y=bt.length>0?bt.select(".bm_instData").get_attr("data-iid"):null,(!y||y.length<1)&&(y=this.panelRoot&&this.panelRoot.select("div[data-iid]").get_attr("data-iid")),y&&y.length>0&&(e+="&ig="+this._getImpressionGuid()+"&iid="+y)),kt=Logger.getOverlayType(),kt&&(e+="&OVRLY="+kt),this._taskState&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&(e+="&isFallbackQuery=true"),i._getIsSlideCardEnabled()&&this._taskState.disableWideCard&&(e+="&widecard=false"),dt=this._isThreeColumnsOk(t),k=this._taskState,k&&(k.isThreeColumnResponseExpected=dt),dt&&(e+="&3colok=true"),k&&k.entryPoint===u.LocalListing&&k.noCoBan&&(e+="&noCoBan=true"),gt=c.dynamicProperties.mapsIG,gt&&(e+="&MCIG="+gt),this._taskState&&this._taskState.triviaAugmentation&&(e+=this._taskState.triviaAugmentation),this._taskState&&this._taskState.isTriviaRequest&&(e+="&isTriviaRequest=true"),t&&t.mapPannedOrZooomed&&this.viewModel&&this.viewModel.isWaterfallListingsEnabled()&&(e+="&requestId="+i._getHash(Date.now().toString())),n.enableUrlTestParamPassthrough&&(ni=i._getUrlParam(window.location,"p1"),ni&&(e+="&p1="+ni),ti=i._getUrlParam(window.location,"setapplicationendpoint"),ti&&(e+="&setapplicationendpoint="+ti)),e},l.prototype._getCardTypeAugmentation=function(){return"unknown"},l.prototype._getTextAdsCode=function(){return"1"},l.prototype._getFormCode=function(){var t=this._taskState;return t.passThruParam&&t.passThruParam.toUpperCase().indexOf("FORM=")!==-1?null:n.formFromTaskState?t.formCode||null:null},l.prototype._isThreeColumnsOk=function(t){return this.viewModel&&this.viewModel.isTaskOnItinerarySlideout(this._taskState)?!1:t&&(t.isInfiniteScroll||t.isPaginated||t.mapPannedOrZooomed)&&w&&w.enableBoldUXChanges&&this.getCurrentWidth()<732?!1:_w&&_w.innerWidth&&n&&n.threeColumnMinBrowserWidth&&_w.innerWidth>=n.threeColumnMinBrowserWidth&&(!t||!t.isPaginated&&!t.appliedFilterOption&&!t.filterValueChanged&&!t.mapPannedOrZooomed)||this._taskState&&this._taskState.isThreeColumns?!0:!1},l.prototype._getAnswerPicked=function(){var n=this.panelRoot.select("div[data-answerpicked]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-answerpicked"),t)?t:""},l.prototype.microPoiRequestForLocalOverlayIsAllowed=function(){return this._taskState&&this._taskState.entryPoint&&i._isLocalOverlayShownOnSerp()&&(this._taskState.isFallbackRequery||this._taskState.entryPoint.lastIndexOf(u.Permalink)>-1)&&this._peekForLocalOverlayCategoryId(this.panelRoot)?!0:!1},l.prototype.sendPaginationRequest=function(n,t,r,f){var e=this,o,s,c;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;this._taskState.entryPoint=f?u.InfiniteScrollPagination:u.ServerPagination;o=this._createUrl({isPaginated:!0,isInfiniteScroll:f,isWaterfallEnabled:r.isWaterfallEnabled()},n,t);o&&(this.setPercentLoaded(0),s=function(n){var c;e._showOrHideWaitLayer(!1);var t=e._convertToResponseObject(n),o=d.getEntitiesFromResponse(t,e._taskState),s=o&&o.entities;if(s&&s.length){c=h.getImpressionGuid(t);e._logActivated(p.LLR,f?u.InfiniteScrollPagination:u.ServerPagination,c);e._logMapPageView(c);var l=e.viewModel.getHouseListingCounts(t.select("div[data-listingMetadata]")),a=l?l:s.length,v=r.updateDisplayState(a,d.parseNoMoreResults(t),t);if(!v)return;e.processResponse(t,{isPaginated:!0,isInfiniteScroll:f,infiniteScrollData:o});e.displayState&&e.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:h.getImpressionGuid(e.viewModel.panelRoot),primitives:e.viewModel.getPushpinPrimitives()});f||e.scrollLane.invoke(e.panelRoot);sj_evt.fire("OnCardRefresh",e.panelRoot,e.stackId)}else r.updateDisplayState(0,!1,t)},this._showOrHideWaitLayer(!0),c=function(){e._showOrHideWaitLayer(!1);r.updateDisplayState(0,!1,null)},st.downloadGeneric(o,"pagination",s,null,c,null,0,null,k.getLogKeyFromUrl(o)))},l.prototype._getCacheId=function(){var n="";return this._taskState.cacheId&&(n=encodeURIComponent('cacheid:"'+this._taskState.cacheId+'" ')),n},l.prototype._getEntityListType=function(){var n="";return this._taskState.entityListType&&(n=encodeURIComponent('EntityListType:"'+this._taskState.entityListType+'" ')),n},l.prototype._getSearchInsideMapBounds=function(){var n="";return this._taskState.searchInsideMapBounds&&(n=encodeURIComponent('Checkbounds:"1" ')),n},l.prototype._getMapPanOrZoom=function(n){var t="";return n&&n.mapPannedOrZooomed&&(t=encodeURIComponent('MapPannedOrZooomed:"1" ')),t},l.prototype._invokeListenersAction=function(n,t){var i={action:n,listenerId:this.id};e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:i,type:s.directionsTask,taskId:t})},l.prototype._updateTitle=function(){this._initialTitle&&this.setTitle(this._initialTitle)},l.prototype._getPointsString=function(n){var t=n.map(function(n){return n.latitude+","+n.longitude});return t.join(",")},l.prototype._sendSearchRequest=function(n,r,f,e,o){var h=this,p,w,a,s,v,b,d,y;if(this._taskState&&this._taskState.entryPoint===u.Permalink&&(this._taskState.originalQuery=this._taskState.query),a=t(".cardPrimer"),!l._cardPrimerConsumed&&!this._taskState.isFallbackRequery&&this.map.getConfig().enablePoiPrimer&&a&&a.length>0&&(s=a.select(".contentRoot"),s&&s.length>0&&s[0].children.length>0)){l._cardPrimerConsumed=!0;v=(w=(p=r.requestState)===null||p===void 0?void 0:p.searchQueryCategory)===null||w===void 0?void 0:w.toLowerCase();v&&(v==="restaurant"||v==="hotel")&&(this._taskState.disableTaskActivate=!1);this._parseResponse(s[0].innerHTML,r,f);return}n&&(b=this._taskState&&this._taskState.id?rt.ID:rt.SB,d=this._logHelper.perfStart(b),sj_evt.fire("v8SearchRequestStarted"),y=!1,st.downloadGeneric(n,"search",function(n){if(y=!0,d.end("NT"),sj_evt.fire("v8SearchResponseReceived"),o)try{h._logSearchProcessRequest(n)}catch(t){}(!i._isSmallMapShownOnSerp()||c.dynamicProperties.prefetchingResultsOnSerp||c.dynamicProperties.prefetchingDetailsOnSerp)&&(h.showCardPrimer(!1,r,e),h._parseResponse(n,r,f),sj_evt.fire("v8SearchResponseParsed"))},null,function(){y=!0;h.showCardPrimer(!1,r,e)},null,0,null,k.getLogKeyFromUrl(n)),this._taskState&&this._taskState.action===2||this.viewModel&&this.viewModel.isTaskOnItinerarySlideout(r.requestorState)||y||this.showCardPrimer(!0,r,e))},l.prototype.showCardPrimer=function(n,t,i){w.showLoadingSkeleton&&this._searchPrimer&&this._searchPrimer.showOrHideSearchCardPrimer(n,this,t,i)},l.prototype._logSearchProcessRequest=function(t){var e,i,f;if(t&&this._taskState){e=this._taskState.fullQuery||this._taskState.query;i=e||this._taskState.id;i||(i="");var r=this._convertToResponseObject(t),u=r.select("[data-answerinfo]").get_attr("data-answerinfo"),s=r.select("[data-traceid]").get_attr("data-traceid"),c=r.select("[data-answerpicked]").get_attr("data-answerpicked"),l=u&&n.scenarioKeys[u]?n.scenarioKeys[u]:"",o=h.getImpressionGuid(r);n.instrumentOldSearchEvents&&(f={EP:this._taskState.entryPoint,Q:i,BB:this._tryGetBounds(),SNRO:l,SIG:o,MIG:this._getMasterImpressionGuid(),TRACE:s||"",AAP:c||""},this._logHelper.log(p.SPR,f,f.SIG));this._logMapPageView(o)}},l.prototype._logMapPageView=function(n){if((n===null||n===void 0?void 0:n.length)>0){var t={impressionGuid:c.dynamicProperties.mapsIG,logData:{feature:ft.MapPageView,action:"C",data:{P:"Page.Maps.Search",CIG:n}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)}},l.prototype._addImgUrlsToTaskState=function(n){var f,i,e,r,u,o;for(this._taskState.imgUrls=[],f=n.select(".mapsCustomInfoCard, .iclc, .iaplanner, [data-ovl], .entity-listing-container"),i=0;i<f.length&&this._taskState.imgUrls.length<4;i++)for(e=t(f[i]).select("img"),r=0;r<e.length&&this._taskState.imgUrls.length<4;r++)u=e[r].getAttribute("src"),o=u&&u.match("/th/?"),o&&o.length>-1&&this._taskState.imgUrls.push(u)},l.prototype._isInLocalOverlayCategoryIdList=function(t){var i,r;if(t&&n&&n.localOverlayOnSerpCategoryIDs&&(i=t.split("."),i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&n.localOverlayOnSerpCategoryIDs.indexOf(i[r])>-1)return!0;return!1},l.prototype._isHotelListingRequeryOnOverlay=function(){var t=this._taskState.selectedCategoryId||this._taskState.category;return i._isLocalOverlayShownOnSerp()&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&n.multiEntityScenarios.indexOf(this._taskState.fallbackScenario)>-1&&this._isInHotelCategoryIdList(t)?!0:!1},l.prototype._isInHotelCategoryIdList=function(t){var i,u,r;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),u=Object.keys(n.poiCountOverrideByCategoryId),u&&u.length&&i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&u.indexOf(i[r])>-1)return!0;return!1},l.prototype._getPoiCountOverrideIfAny=function(t){var i,f,r,u;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),f=Object.keys(n.poiCountOverrideByCategoryId),f&&f.length&&i&&i.length))for(r=0;r<i.length;++r)if(u=i[r]&&i[r].toLowerCase(),u&&f.indexOf(u)>-1&&n.poiCountOverrideByCategoryId[u])return n.poiCountOverrideByCategoryId[u];return null},l.prototype._getRequestUrlFormat=function(){if(i._isTravelOverlayShownOnSerp())return n.fallbackRequestUrlFormatForTravelOverlayOnSerp&&n.fallbackRequestUrlFormatForTravelOverlayOnSerp.length>10&&this._taskState&&this._taskState.isFallbackRequery?n.fallbackRequestUrlFormatForTravelOverlayOnSerp:(l._useBfpr=!0,this._taskState&&(this._taskState.useBfpr=!0),n.requestUrlFormatForTravelOverlayOnSerp);var t=i._getCoreConfig();return this._taskState.isFallbackRequery&&this._taskState.fallbackCategory&&this._taskState.fallbackCategory.toLowerCase().indexOf("attraction")>-1?this._taskState&&this._taskState.useBfpr?n.useBfprRequestUrlFormat:n.requestUrlFormat:n.requestUrlFormatForEventDetailCard&&n.requestUrlFormatForEventDetailCard.length>10&&this._taskState&&(this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf("eventId")!==-1||this._taskState.id&&this._taskState.id.indexOf("eventId")!==-1)?n.requestUrlFormatForEventDetailCard:(this._taskState&&this._taskState.useBfpr&&(l._useBfpr=!0),l._useBfpr)?n.useBfprRequestUrlFormat:n.requestUrlFormat},l.prototype._overridePoiCount=function(){var t=this._taskState&&this._taskState.searchQueryCategory,i;!t&&this._taskState&&this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf('entitysegment:"Attraction"')>-1&&(t="Attraction");t&&this._taskState.entryPoint&&this._taskState.entryPoint===u.Permalink&&n.categoriesWithServerPagination&&n.categoriesWithServerPagination.length&&n.categoriesWithServerPagination.indexOf(t.toLowerCase())>-1&&(this._taskState.poiCount=n.useNewListingSearchCount?n.listingSearchCount.toString():n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf(t)>-1&&this._isThreeColumnsOk(null)?"21":"20",this._taskState.isFallbackRequery=!0);n.waterfallEnabledCategories&&n.waterfallEnabledCategories.length>0&&this._isWaterfallEnabledForCategory(t,this._taskState.segmentType)&&(n.optimizeResultsListLoadingForWaterfall&&this._taskState.entityIndex!==undefined?(i=parseInt(this._taskState.entityIndex)+9,i<18?i=18:i>100&&(i=100),this._taskState.poiCount=i.toString()):this._taskState.poiCount="18")},l.prototype._isWaterfallEnabledForCategory=function(t,i){return t&&n.waterfallEnabledCategories.indexOf(t.toLowerCase())>=0||i&&n.waterfallEnabledCategories.indexOf(i.toLowerCase())>=0?!0:!1},l.prototype._peekForLocalOverlayCategoryId=function(t){if(t&&n&&n.localOverlayOnSerpCategoryIDs){var i=d.parseCategory(t);return i&&(this._taskState.category=i),this._isInLocalOverlayCategoryIdList(i)}return!1},l.prototype._isHotelsFallback=function(t,r){return i._isHotelsCategory(t)&&n.enableCustomHotelsExperience?(this._taskState.category=t,this._taskState.pivotEntity=r&&r.select("div[data-pivot]").get_attr("data-pivot"),!0):!1},l.prototype._isRestaurantsFallback=function(t,r){return i._isRestaurantCategory(t)&&n.enableCustomRestaurantsExperience?(this._taskState.category=t,this._taskState.pivotEntity=r&&r.select("div[data-pivot]").get_attr("data-pivot"),!0):!1},l.prototype._isRealEstateFallback=function(n,t){return i._isHouseCategory(t)&&d.parseAnswerInfo(n,this._taskState).intentKey==="multiEntity"?(this._taskState.originalResponse=n,!0):!1},l.prototype._isOutingsFallback=function(t){if(n.useNewListingSearchCount)return!1;var r="20",i=t&&t.toLowerCase(),f=i&&(i.indexOf("attraction")>-1||i.indexOf("protectedsite")>-1||i.indexOf("trail")>-1&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.indexOf("Trail")>-1),e=[u.SearchBox,u.SearchButton,u.Permalink,u.Autosuggest];if(this._taskState&&f&&e.indexOf(this._taskState.entryPoint)>-1){if(n.categoriesWithServerPagination&&n.categoriesWithServerPagination.length&&n.categoriesWithServerPagination.indexOf(i)>-1)return n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf(t)>-1&&this._isThreeColumnsOk(null)?(this._taskState.poiCount="21",!0):this._taskState.poiCount&&this._taskState.poiCount.indexOf(r)<0?(this._taskState.poiCount=r,!0):!1;if(!this._taskState.poiCount)return this._taskState.poiCount="50",!0}return!1},l.prototype._parseResponse=function(n,t,r){var o=this._convertToResponseObject(n),l,c;this._taskState||(this._taskState=t.requestState);this._addImgUrlsToTaskState(o);this._taskState.searchPerfState=this._searchPerfState;var a=this._taskState.entryPoint,v=a===u.TaskBar&&this._checkDirectionsIntent(o.select("[data-answerinfo]").get_attr("data-answerinfo")),h=d.parseCategory(o);this._taskState.primaryCategoryPath=h;l=this._isHotelsFallback(h,o)||this._isRestaurantsFallback(h,o);this._taskState.disableTaskActivate&&!v?(c=d.getEntitiesFromResponse(o,this._taskState),this._taskState.isFallbackRequery&&this._taskState.originalCallback?this._taskState.originalCallback({originalProcessInputData:this._taskState.originalProcessInputData,data:{content:o,entities:c&&c.entities}}):r&&r({originalProcessInputData:this._taskState.isFallbackRequery?this._taskState.originalProcessInputData:null,data:{content:o,entities:c&&c.entities,action:this._taskState.action===2&&this._taskState.action}})):!this._taskState.isFallbackRequery&&(this._isOutingsFallback(h,o)||l)?this._requestFallback(o):i._isZipCodeCategory(this._taskState.category||h)?(this._taskState.category||(this._taskState.category=h),this._shouldRequeryForZipCode(o,this._taskState)?(this._taskState.originalResponse=o,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:this._taskState,type:s.polygonListingTask})):(this._taskState.originalResponse&&(this._mergeResponses(o,this._taskState.originalResponse),delete this._taskState.originalResponse),d.parseResponse(o,this._taskState,this._trafficLayer,this.map))):d.parseResponse(o,this._taskState,this._trafficLayer,this.map)},l.prototype._requestFallback=function(t){var o="",r="",u,f,i,e,c;t&&(u=t.select("div[data-answerinfo]"),u&&u.length&&(r=u.get_attr("data-answerinfo"),r&&(o=n.scenarioKeys[r])));this._taskState.isFallbackRequery=!0;this._taskState.fallbackScenario=r;this._taskState.fallbackCategory=d.parseCategory(t);f=t.select("div[data-iscategoryquery]").get_attr("data-iscategoryquery");f&&(this._taskState.isCategoryQuery=f.toLowerCase()==="true");i={Q:this._taskState.query?this._taskState.query:this._taskState.fullQuery?this._taskState.fullQuery:"",EP:this._taskState.entryPoint,SNRO:o};i.SIG=h.getImpressionGuid(t);i.MIG=h.getMasterImpressionGuid();this._logHelper&&this._logHelper.log(p.FLBK,i,i.SIG);e=d.parseAnswerInfo(t,this._taskState);c=e.intentKey==="multiEntity"?s.localListingTask:e.intentKey==="singleEntity"?s.localDetailsTask:s.localSearchTask;d.invokeTask(c,t,this._taskState,!1)},l.prototype._checkDirectionsIntent=function(t){return n.directionsIntentDrivingScenarios.indexOf(t)>=0?!0:n.directionsIntentTransitScenarios.indexOf(t)>=0||n.directionsIntentWalkingScenarios.indexOf(t)>=0?!0:void 0},l.prototype._shouldRequeryForZipCode=function(n,t){var e=!1,r,f,u;return i._isZipCodeCategory(t.category)&&(r=this._getItemCountsFromResponse(n),r&&(f=r[1]+r[2],u=t.originalResponse&&this._getItemCountsFromResponse(t.originalResponse),u&&(f+=u[1]+u[2]),e=f<r[0])),e},l.prototype._getItemCountsFromResponse=function(n){var t=n.select("div.overlay-listings").get_attr("data-listingMetadata");if(t.length>0){var i=JSON.parse(t),r=parseInt(i.TotalCount),u=parseInt(i.BlockedCount),f=n.select(".listings-item").length;return[r,u,f]}return null},l.prototype._mergeResponses=function(n,i){var u=this._getItemCountsFromResponse(n),f=this._getItemCountsFromResponse(i);if(u&&f){var e="data-listingMetadata",o=n.select("div.overlay-listings"),c=o.get_attr(e),s=JSON.parse(c);s.BlockedCount=(u[1]+f[1]).toString();o.set_attr(e,JSON.stringify(s));var h=".listings-item",r=n.select(h).getParent(),l=i.select(h),a=n.select(".b_vList");l.for_each(function(n){r&&r.length&&n&&a.insertBefore(t(n).getParent(),r)})}},l.prototype._convertToResponseObject=function(n){var r=i._tryParsingWithDOMParser(n);return r||(r=t(document.createElement("div")),r.set_html(n)),r},l.prototype._getLocationInfo=function(){try{var t,n=this._taskState.point;return n&&n.length===2?l._circularViewFormat.replace("{0}",n[0].toString()).replace("{1}",n[1].toString()).replace("{2}",l._radiusInMeters):(t=this._taskState.mapBounds&&this._taskState.mapBounds.length===4?this._taskState.mapBounds:this._getLocalMapViewBounds(),l._mapViewFormat.replace("{0}",t.join(",")))}catch(i){return""}},l.prototype.isSharable=function(){return this._stopSharing?!1:this.getMapPrimitives()&&this.getMapPrimitives().length>0},l.prototype.getMenuList=function(){for(var u,o,t=[],s=!1,i=0;i<t.length;i++)if(t[i].name.indexOf("print")||t[i].name.indexOf("Print")){s=!0;break}if(!s&&this.hasPrintContent()&&(u=this,t.push({name:r.L_Menu_Print_Link_Text,handler:function(){e.invokeHandler(f.printDataHandlerKey,{source:2,taskType:u.type,taskId:u.id,data:u.getPrintInstrumentationData()})},cssClass:"menuPrintItem",instData:this.getInstData("Print")})),o=this.viewModel,o&&o.annotationControl){var n=o.annotationControl,h=n.getCurrentName(),c=n.getDescription();t.push({name:n.displayNameChangeMessage(h),handler:function(){n.onAddNicknameClick.apply(n)}});t.push({name:n.displayNoteChangeMessage(c),handler:function(){n.onAddDescriptionClick.apply(n)}});n.displayDeleteNickName(h)===""&&t.push({name:r.L_DeleteNickNameOption,handler:function(){n.onDeleteNicknameClick.apply(n)}});n.getDescription()&&t.push({name:r.L_DeleteNoteOption,handler:function(){n.onDeleteDescriptionClick.apply(n)}})}return this.isReportable()&&(this.getReportType()!==4&&this.getReportType()!==9?t.push(this._getFeedbackListData()):this.getReportType()===4&&t.push(this._getLocalFeedbackListData())),t},l.prototype.openReportLocalProblemLink=function(){var n=this.viewModel.reportLocalProblemLinkURL;n&&window.open(n,"_blank")},l.prototype._getFeedbackListData=function(){var t=this._taskState.searchQueryCategory||this._taskState.selectedCategoryId||this._taskState.category||this._taskState.listingCategoryPath,n=3;return i._isHouseCategory(t)&&(n=7),{name:r.L_Menu_ReportProblem_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:n,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},cssClass:"menuReportAProblemItem",instData:this.getInstData("Report Problem")}},l.cleanupPrimerData=function(n){l._removeCardPrimer(n);l._removePoiPrimerLayer(n)},l.parseDataFact=function(n){var t=null;if(n)try{t=JSON.parse(n)}catch(i){}return t},l._removeCardPrimer=function(r){if(r.getConfig().enablePoiPrimer){var u=t(".cardPrimer");u&&u.length>0&&!l._removeCardPrimerTimer&&(l._removeCardPrimerTimer=Microsoft.Maps.setTimeout(function(){l._removeCardPrimerTimer=null;!n.showContentFirstForPermalinks||i._getUrlParam(window.location,"disablecf")==="1"?u&&u.removeFromParent():u.set_style({display:"none"})},500))}},l._removePoiPrimerLayer=function(n){for(var t=n.getLayers(),i,r=0,u=t.length;r<u;r++)if(t[r].getId()==="PoiPrimer"){i=t[r];break}i&&n.getFrameManager().frameRendered.addOne(function(){t.remove(i);i.dispose()})},l.prototype._buildTaskStateWithPrimerPois=function(){var n={};for(var t in this._taskState)this._taskState.hasOwnProperty(t)&&(n[t]=this._taskState[t]);return n.primerPois=this._getPrimerPoisFromViewModel(),n},l.prototype._getPrimerPoisFromViewModel=function(){var r=[],i=this.viewModel.getPushpinPrimitives(),u=i.length>5?5:i.length,t,n;for((this.type===s.localDetailsTask||this.type===s.polygonEntityDetailsTask)&&(u=1),t=0;t<u;t++)n=i[t],r.push({geometry:{y:Math.round(n.geometry.y*1e6)/1e6,x:Math.round(n.geometry.x*1e6)/1e6,bounds:[]},entity:{title:n.entity.getTitle(),id:n.entity.id,subtitle:n.entity.getAddress()}});return r},l.prototype._reduceLatLonPrecisions=function(){var n;if(this._taskState){if(this._taskState.mapBounds&&this._taskState.mapBounds.length>0)for(n=0;n<this._taskState.mapBounds.length;n++)this._taskState.mapBounds[n]&&(this._taskState.mapBounds[n]=Math.round(this._taskState.mapBounds[n]*1e6)/1e6);if(this._taskState.point&&this._taskState.point.length>0)for(n=0;n<this._taskState.point.length;n++)this._taskState.point[n]&&(this._taskState.point[n]=Math.round(this._taskState.point[n]*1e6)/1e6)}},l.prototype._getLocalFeedbackListData=function(){return{name:r.L_Menu_SuggestAnEdit_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:4,activeTaskId:this.id,title:r.L_Menu_SuggestAnEdit_Link_Text+" - "+this.getTitle(),options:this.getLocalReportOptions()}},cssClass:"menuLocalFeedback",instData:this.getInstData("Suggest an Edit")}},l.prototype.getReportOptions=function(){var n=null,t;return this.getReportType()!==1&&this.getReportType()!==6&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n=this.viewModel.getEntities()[0].getLocation()),t={parentId:this.id},{query:this._taskState.query,reportType:this.getReportType(),pushPinLocation:n,reportLocalProblemLinkURL:this.viewModel.reportLocalProblemLinkURL,taskStateId:this._taskState.id,scenarioKey:this._taskState.scenarioKey,dataFacts:t,userFacts:this.loadUserFacts(),rapEntryPoint:3}},l.prototype.getLocalReportOptions=function(){var n={},t,i;return this.getReportType()!==1&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n.pushPinLocation=this.viewModel.getEntities()[0].getLocation(),n.entityName=this.viewModel.getEntities()[0].getTitle(),n.entityYpid=this.viewModel.getEntities()[0].id),t=this.loadDataFacts(),t&&(n.dataFacts=t),i=this.loadUserFacts(),i&&(n.userFacts=i),n.query=this._taskState.query,n.reportType=this.getReportType(),n},l.prototype.loadDataFacts=function(){var n=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts");return l.parseDataFact(n)},l.prototype.loadUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},l.prototype.isReportable=function(){return this._taskState&&this.getReportType()!==0},l.prototype.isPrintable=function(){var n=this.viewModel?this.viewModel.getPushpinPrimitives():null;return vr.isEnabled&&n&&n.length>0},l.prototype.getReportType=function(){var f,e,r=this._taskState.scenarioKey,t=0,o=this._taskState.searchQueryCategory||this._taskState.selectedCategoryId||this._taskState.category||this._taskState.listingCategoryPath;return n.reportAsNotFoundKeys.indexOf(r)>-1&&(t=1),n.reportAsMultiBusinessKeys.indexOf(r)>-1?t=6:n.reportAsAddressKeys.indexOf(r)>-1?t=this._taskState.entryPoint===u.ContextMenu?3:2:n.reportAsPlaceKeys.indexOf(r)>-1?t=i._isHouseCategory(o)?8:5:n.reportAsLocalKeys.indexOf(r)>-1&&(t=o&&o.indexOf("Event")>-1?9:((e=(f=this.viewModel)===null||f===void 0?void 0:f.getEntities()[0])===null||e===void 0?void 0:e.mainSegmentType)==="Trail"?1:4),t},l.prototype.getEntityMarket=function(){var n=this.loadDataFacts();return n&&n.languageCultureName?n.languageCultureName:""},l.prototype._getQueryParam=function(){var n="";return this._taskState&&(n+=encodeURIComponent(this._taskState.query||this._taskState.taskTitle)),n},l.prototype._getSegmentParam=function(){return""},l.prototype._getFiltersParam=function(){var n="";return this._taskState&&this._taskState.localFilters&&(n+=encodeURIComponent(this._taskState.localFilters+" ")),n},l.prototype._setViewportPaddingForCardSide=function(n){var t=this.map.getViewportPadding();t&&(t[i._isRtl()?"right":"left"]=n,this.map.setViewportPadding(t))},l.prototype._getRealEstateMarketParam=function(n){var u=18,i=n.indexOf("RealEstateMarket"),r,t;if(i>-1&&i+u<=n.length)for(r=-1,t=i+u;t++;t<n.length)if(n[t]=='"')return r=t,n.substring(i,r+1).toLowerCase()+" ";return""},l._disableOSearchParameter="&DisableOSearch=1",l._circularViewFormat="&localCircularView={0},{1},{2}",l._mapViewFormat="&localMapView={0}",l._useBfpr=!1,l._cardPrimerConsumed=!1,l._overlayCloseBtnListenerAdded=!1,l._radiusInMeters="16000",l._tabID=_G.IG,l.mouseoverTimeout=500,l.mouseoutTimeout=500,l}(h),it=function(o){function c(n,t,i,r,u,f,e,h,c){var l=o.call(this,n,f,t,r)||this;return l.showCloseButton=!0,l.type=s.localDetailsTask,l.poiManager=i,l._controlTemplateFactory=e,l._buttonGroupViewModel=u,l.disposables.push(l.poiManager.contextMenuInvoked.add(function(n){return l._contextMenuInvoked(n)})),l.disposables.push(l.poiManager.poiTapped.add(function(){return l._poiTapped()})),l.disposables.push(l.poiManager.poiHoverStarted.add(function(n){return l._poiHoverStarted(n)})),l.disposables.push(l.poiManager.poiHoverStopped.add(function(){return l._poiHoverStopped()})),l.disposables.push(l.poiManager.mapViewChanged.add(function(n){return l.updateMapBounds(n)})),l._taskBar=h,l._geochainManager=c,l.scrollToTop=new nt,l._taskUrlParams.push({param:"sid",paramGetter:function(){return l._getSidParam()}}),l._taskUrlParams.push({param:"ypid",paramGetter:function(){return l._getYpidParam()}}),l._taskUrlParams.push({param:"eventid",paramGetter:function(){return l._getEventIdParam()}}),w&&w.enableBoldUXChanges&&l.disposables.push(l.toggleCompleted.add(function(n){var t={TYPE:n,COL:n==="EXP"?l.getCurrentWidth()===944?at.WideWidth:at.NarrowWidth:at.Collapsed};l._logHelper.log(p.LDA,t,l._getImpressionGuid())})),l}return y(c,o),c.prototype.activate=function(n,i,r,u){var f=this,s,h,e;i&&(this.viewModel=new vi(this.map,this.panelRoot,this.id,this._logHelper,this._transientLensViewModel,this._buttonGroupViewModel,this._taskBar,i,this._controlTemplateFactory,this.primitiveInteracted),this.registerViewModelEvents(),s=i.taskTitle?i.taskTitle:i.fullQuery||i.query,this.setTitle(s),this.disposables.push(this.viewModel.titleChanged.add(function(n){f.setTitle(n);var t=f.viewModel;t.updatePoiTitle(n);t.resetPrimitives(f.poiManager)})),o.prototype.activate.call(this,n,i),i.content?(i.scenarioKey||(e=d.parseAnswerInfo(i.content,i),i.scenarioKey=e&&e.scenarioKey?e.scenarioKey:null),this._suppressProcessDetails()||this._processLocalDetails(i)):(i.disableTaskActivate=!0,h={requestState:i},o.prototype.process.call(this,h,function(n){f.processResponse(n.data.content);f._suppressProcessDetails()||f._processLocalDetails(i);sj_evt&&f.displayState&&f.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",f.panelRoot,f.stackId)},u)),i&&i.scrollElement&&i.scrollElement.length>0&&sj_evt.bind("bm_scrollCard",function(){f.scrollToTop.invoke(t(i.scrollElement))}),this._sendProductAdsAjax(i))},c.prototype.process=function(n,t){var i=n&&n.requestState,r,u;i&&(i.hideBackButton&&i.listingTaskId?(r=this.panelRoot.select(".commonButton.backArrowButton.overlayButton"),u=r.get_attr(f.taskDataHandlerKey),u&&u.indexOf(i.listingTaskId)>0&&(r.set_style({display:"none"}),r.parent().set_style({display:"none"})),t&&t({processorId:this.id,data:{}})):o.prototype.process.call(this,n,t))},c.prototype.deactivate=function(){var r,n,t;if(this._taskState.openingNewCard||this._taskState.flippingCard){var u=this._taskState.openingNewCard?!1:!0,i=this.viewModel&&this.viewModel.getEntities(),h={showEntity:!0,selectedEntityId:i&&i.length>0?i[0].id:null},c={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:h,useActiveTasks:u};e.invokeHandler(f.taskProcessDataHandlerKey,c)}this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();o.prototype.deactivate.call(this);r=this.panelRoot.select("a[data-streetside]");r.set_style({opacity:0});n=this.panelRoot.select("#bev2Img");n&&n.length>0&&n.set_style({opacity:0});t=this.panelRoot.select(".tp_tasks");t&&t.length>0&&t.set_style({opacity:0})},c.prototype.setTaskComplete=function(){var t=this,c=this._taskState&&this._taskState.id?rt.ID:rt.SB,a=this._logHelper.perfStart(c),u,r,h;if(this.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(u=window.$cp_bsperf=window.$cp_bsperf||{},u.Maps_CP_CLT=u.Maps_CP_CLT||performance.now(),k.record("Maps_CP_LDT",Math.round(u.Maps_CP_CLT))),this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose(),k.removeKey("SearchRequest"),this._firstFrameRenderedHandler=this.map.getFrameManager().frameRendered.addOne(function(){var r,u,f;t._firstFrameRenderedHandler.dispose();r=k.getStartTime(t.id,!0);r&&(k.log("Maps_LDTTG",r),t.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(k.log("Maps_CP_LDTTG",performance.timing.navigationStart),l.hasCardPrimerPerfDataLogged=!0),u=Microsoft.Maps.Local,f=t instanceof u.HotelsDetailsTask?"Maps_HLDTTG":t instanceof u.RestaurantDetailsTask?"Maps_RLDTTG":t instanceof u.HouseDetailsTask?"Maps_RELDTTG":i._isAttractionCategory(t.viewModel.getCardCategoryId())?"Maps_ALDTTG":"",f&&k.log(f,r));a.end("RT");n.enableImprovedPerf&&Microsoft.Maps.setTimeout(function(){sj_evt.fire("RMS.LoadImg")},0);t.viewModel&&t.viewModel.loadDelayedRecommendationModuleImages();t.viewModel&&t.viewModel.enableAdsShownLogging(t.laneScrolled);sj_evt.fire("initRoomRatesModule",t.panelRoot)}),r=this.viewModel.getEntities(),r&&r.length>0&&(h=r[0],this.poiManager&&this.poiManager.setTargetMapView(this.viewModel.boundingBox),this.setTitle(this._taskState&&this._taskState.taskTitle?this._taskState.taskTitle:h.getTitle()),this._taskState.id||(this._taskState.id=h.id),this._taskState.taskTitle&&this._taskState.overridePoiTitle&&this.viewModel.updatePoiTitle(this._taskState.taskTitle)),o.prototype.setTaskComplete.call(this),(this._taskState.flippingCard||this._taskState.openingNewCard)&&r&&r.length>0){var v={hideEntity:!0,selectedEntityId:r[0].id},y=this._taskState.openingNewCard?!1:!0,p={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:v,useActiveTasks:y};e.invokeHandler(f.taskProcessDataHandlerKey,p)}this.displayState&&this.displayState.activationState===1&&this.displayState.prominence===1&&this._launchOverflowOnActivation();this.setCloseButtonClass();this._setAdsOnTopCloseButton()},c.prototype.getSupportedSize=function(){return this.viewModel&&this.viewModel.isTaskOnItinerarySlideout(this._taskState)?[464]:[944,464]},c.prototype.getSlideoutSupportedSize=function(){return[]},c.prototype.processResponse=function(n,t){var i=this;o.prototype.processResponse.call(this,n,t);this.panelRoot&&(this.panelRoot.add_event("click",function(n){n&&n.target&&n.target.tagName.toLowerCase()==="a"&&i._logInstrumentationEventForEntityClick()}),this._showDestinationItinerariesModule(),this._showProductAdsModule(),this._fetchHotelAdsIfOpalActionWhereToStay(),this._handleAutoDealersBtnClick(),this.viewModel.localEntitiesWithinRUBRegion(n,this._getTaskState())&&this.close())},c.prototype._suppressProcessDetails=function(){return!1},c.prototype.serialize=function(n,t){var i=o.prototype.serialize.call(this,n),r=this.viewModel,u,f;return i&&r&&r.calendarSync&&r.calendarSync.length&&r.calendarSync[0]&&(i.dateTime=r.calendarSync[0].getStartDateTime()),u=r&&r.annotationControl,f=i,i&&u&&u.getCurrentName()!==u.getOriginalName()&&(f.originalName=u.getOriginalName()),i&&t&&t===2&&(f.hideBackButton=!0,f.flippingCard=!1),i&&(i.fromSharing=n),i},c.prototype.getOriginalName=function(){var t=this.viewModel,n=t&&t.annotationControl;return n&&n.getCurrentName()!==n.getOriginalName()?n.getOriginalName():""},c.prototype.getNotes=function(){var n=this.viewModel,t=n&&n.annotationControl;return t?t.getDescription():""},c.prototype.canColorFade=function(){return!1},c.prototype.hasPrintContent=function(){return this.isPrintable()},c.prototype.getPrintContent=function(){var r=this,n,t;return this.hasPrintContent()?(n=null,this.viewModel instanceof vi&&(n=this.viewModel.getDetailsHtmlContentForPrint(this.loadDataFacts())),t=new oi,t.insert(this.poiManager.getLayerId(),0),pr.onPrintDialogClose.addOne(function(){return i._refocusPrintDropDownMenu(r.id)}),n?new yr(n,t,null):null):null},c.prototype.getShareDescription=function(){var i,r,u,n="",f=String.fromCharCode(183),o=this.viewModel.getEntities(),e=this.loadDataFacts(),t;return(e&&e.price&&(r=e.price),o.length===1&&(t=o[0],i=t.getAddress()||t.getDescription(),u=t.getPrimaryCategoryName()),i&&(n+=i),r&&(n+=f+r),u&&(n+=f+u),n.length&&n.charAt(0)===f&&(n=n.substr(1)),n===t.getTitle())?"":n},c.prototype.setDisplayState=function(n){var r,u,s;o.prototype.setDisplayState.call(this,n);n.activationState===1&&n.prominence===1&&(ri&&ri.isEditable&&!this._itineraryTaskChecked&&this._checkItineraryTasks(),this.setCloseButtonClass(),this._setAdsOnTopCloseButton(),this._launchOverflowOnActivation());var f=this._getTaskState(),h=f&&((r=f.flippingCard)!==null&&r!==void 0?r:!1),e=this.panelRoot.select("a[data-streetside]");h&&(n.activationState===2||n.activationState===3)?e.set_style({opacity:0}):n.activationState===1&&e.set_style({opacity:1});n.prominence===1&&this.resizableComponentId&&(u=t("#"+this.resizableComponentId),u.length>0&&(s=i._getWaterfallResizeEventName(w,this.resizableComponentId),sj_evt.fire(s,u[0])))},c.prototype._onPoiViewStateChanged=function(n){var t,i,r;n&&n.primitive&&n.primitive.entity instanceof wr&&n.newValue!==n.oldValue&&(this._logPoiHoverIfNecessary(n,u.LocalDetails),t=n.primitive.entity,t&&t.id&&n.newValue===2&&(i={entryPoint:u.POI,id:t.id,openingNewCard:!0,taskTitle:t.getTitle()},r={taskColorIndex:this.displayState.colorIndex,groupName:this.id},e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:i,activateOptions:r})))},c.prototype.addBackToListBtn=function(){var s,h,n,c,o,e,t;this.panelRoot&&this.panelRoot.length!==0&&this._taskState&&(s=this.panelRoot.select(".faketab"),h=i.shouldLeftLaneBeHidden(),s.length===0&&(h||this._taskState.listingTaskId)&&(n=i._createElement("a"),n.add_class("commonButton backArrowButton overlayButton"),n.set_attr("href","#"),c=this._taskState.entryPoint===u.Collections,n.set_attr("title",c?r.L_LocalSearch_BackToCollections:r.L_LocalSearch_BackToSearchResults),o=void 0,o=this._taskState.listingTaskId&&!this._taskState.openingNewCard?{action:"focus",id:this._taskState.listingTaskId}:{action:"remove",id:this.id},n.set_attr(f.taskDataHandlerKey,JSON.stringify(o)),e=i._createElement("div"),e.add_class("overlayBackButtonText"),e.set_text(r.L_LocalSearch_ReturnToList),n.append(e),t=i._createElement("div"),t.set_attr("data-tag","detailsCardBackBtnContainer"),t.set_style({"padding-bottom":"35px"}),t.append(n),this.panelRoot.insertBefore(t,this.panelRoot[0].firstElementChild)))},c.prototype._getCardTypeAugmentation=function(){return"details"},c.prototype._createUrl=function(n,t,i){var r=o.prototype._createUrl.call(this,n,t,i);return this._taskState&&this._taskState.adProviderId&&(r+="&enablerelprod=true"),r},c.prototype._registerOverlayLinksForInstrumentation=function(n,t,i,r){var e=this,u=this.panelRoot!=null?this.panelRoot.select(n):null,f,o;if(u&&u.length>0)for(f=u.length,o=function(){var n=u[f],o;n&&(o=n.getAttribute("h")||n.getAttribute("data-h"),o&&(n.removeAttribute("h"),n.removeAttribute("data-h"),n.setAttribute("h1",o),sj_be(n,"click",function(u){var f,s=Microsoft.Maps.logger,h,o,c;s&&(h={T:i,feature:t,action:i,data:(f={},f[r]=n.href,f)},s.logObject(h,e._getImpressionGuid(),!1));o=n.getAttribute("h1");o&&(c=_G.IG,_G.IG=e._getImpressionGuid(),n.setAttribute("h",o),_w.si_ct&&_w.si_ct(n,!1,u),_G.IG=c,n.removeAttribute("h"))})))};--f>=0;)o()},c.prototype._setAdsOnTopCloseButton=function(){var t=this.panelRoot,n,u;if(t&&t.length>0){for(var i=t.parent(),r=null,f=0;i.length>0&&f++<5;){if(i.has_class("contentRoot")){r=i;break}i=i.parent()}n=r&&r.length>0&&r.select(".bm_cardClose");n&&n.length>0&&(u=t&&t.select(".bm_topads"),u&&u.length>0?n.add_class("bm_adsclose"):n.has_class("bm_adsclose")&&n.remove_class("bm_adsclose"))}},c.prototype._showProductAdsModule=function(){var t=this.panelRoot.select("div.productAdsModuleContainer");if(t&&t.length){if(t.getParent().add_class("hideControl"),!this._taskState||!this._taskState.adProviderId||!this._taskState.adQuery||!this._taskState.adImpressionGuid||!this._taskState.adYpid||!this._taskState.adRetailEntitySource||!n.requestUrlFormatForProductAdsModule)return;this._productAdsResponse?this._productAdsResponseHandler(this._productAdsResponse,t):this._productAdsContainer=t}},c.prototype._productAdsResponseHandler=function(n,t){var i=this;Microsoft.Maps.setTimeout(function(){n&&t&&t.length&&(t.getParent().remove_class("hideControl"),t.appendHTML(n),i.viewModel&&i.viewModel.addProductAdsClientInstrumentation(),ut.bindWhyThisAdHandler(t));var r=t.select("div.carouselPlaceHolder");r&&r.length&&r.set_style({display:"none"})},5)},c.prototype._sendProductAdsAjax=function(t){var i=this,r;t&&t.adProviderId&&t.adQuery&&t.adImpressionGuid&&t.adYpid&&t.adRetailEntitySource&&n.requestUrlFormatForProductAdsModule&&(r=n.requestUrlFormatForProductAdsModule.replace("{query}",t.adQuery).replace("{provid}",t.adProviderId).replace("{storeid}",t.adStoreId||"").replace("{ig}",t.adImpressionGuid).replace("{ypid}",t.adYpid).replace("{rsource}",t.adRetailEntitySource).replace("{bizloc}",this._taskState.adBusinessLocationId||"").replace("{trigtype}",this._taskState.adTriggerType||""),st.downloadGeneric(r,"productadsajax",function(n){n&&(i._productAdsContainer?i._productAdsResponseHandler(n,i._productAdsContainer):i._productAdsResponse=n)},null,function(){i._productAdsResponse=null},null,0))},c.prototype._showDestinationItinerariesModule=function(){var n=this.panelRoot.select("div.itinerariesModuleContainer"),t;if(n&&n.length){t=n.getParent();t.removeFromParent();return}},c.prototype._findHotelAdsIndex=function(n,t){if(n&&n.length&&t)for(var i=0;i<n.length;i++)if(n[i]&&n[i].EntityId&&n[i].EntityId.indexOf(t)>-1)return i;return-1},c.prototype._fetchHotelAdsIfOpalActionWhereToStay=function(){var r=this,u=this.panelRoot.select("div.EntityCollectionModuleContainer");u&&u.length&&u.for_each(function(u){var o=u.getAttribute("data-moduletag"),e,f;if(o&&o.indexOf("MapsModule.WhereToStayOpalAction")>-1&&(e=u.getAttribute("data-hoteladsajax"),f=r._getImpressionGuid(),e&&f)){t(u).set_style({display:"none"});st.downloadGeneric(e+"&IG="+f+"&originig="+f,"hoteladsajax",function(f){var e,s,h,o;if(f)try{e=t.Internals.parseJSON(f);e&&e.length&&(s=t(u).select("div[class=slide]"),s&&s.length&&(h=[],s.for_each(function(n){var v=t(n).select("a[data-process]"),y,f,u,s,c,o,p,h,l,a;v&&v.length&&(y=v[0].getAttribute("data-process"),y&&(f=t.Internals.parseJSON(y),f&&f.requestState&&f.requestState.entityId&&(u=e.findIndex?e.findIndex(function(n){return n.EntityId.indexOf(f.requestState.entityId)>-1}):r._findHotelAdsIndex(e,f.requestState.entityId),u>-1&&e[u]&&e[u].Price&&(s=t(n).select(".lc_ritems"),s&&s.length&&(c=e[u].PriceDropPercentage&&e[u].OriginalPrice,o=null,c&&(o=i._createElement("div").add_class("lc_dealbage"),i._createElement("div").add_class("lc_dealtext").set_text("DEAL").appendTo(o),i._createElement("div").set_text(e[u].PriceDropPercentage).appendTo(o)),p="lc_prices"+(c?" lc_deal":""),h=i._createElement("div").add_class(p),i._createElement("div").add_class("lc_curprice").set_text(e[u].Price).appendTo(h),c&&i._createElement("div").add_class("lc_oriprice").set_text(e[u].OriginalPrice).appendTo(h),e[u].NumOfProvider&&i._createElement("div").set_text(e[u].NumOfProvider).appendTo(h),o&&o.appendTo(s),h.appendTo(s))))));l=t(n).select("div[class=lm_hpapriceholder]");l&&l.length&&l.removeFromParent();a=t(n).select("div[class=lm_hpapercentholder]");a&&a.length&&a.removeFromParent()}),n.forceHotelRecoModuleClientSort&&h.length>0&&h.forEach(function(n){if(n){var i=t(n).getParent();i&&i.length&&i[0].firstChild&&i[0].insertBefore(n,i[0].firstChild)}})))}catch(c){t(u).set_style({display:"block"});o=r.panelRoot.select(".wfr_grid");o&&o.length>0&&sj_evt.fire("WFR.Resized",o[0]);return}t(u).set_style({display:"block"});o=r.panelRoot.select(".wfr_grid");o&&o.length>0&&sj_evt.fire("WFR.Resized",o[0])},null,function(){t(u).set_style({display:"block"})},null,0);return}})},c.prototype.reprocessDetails=function(n){n&&this._processLocalDetails(n)},c.prototype._processLocalDetails=function(t){var r=this,f=null,k=null,d=null,g=null,e=this.viewModel.getEntities(),i,s,c,nt,l,v,y,w,a,b,tt;if(e&&e.length>0&&(k=e[0].getRoutableLocation(),d=e[0].getLocation(),g=e[0].getBoundingBox(),f=e[0].getTitle()),!f||t.taskTitle&&t.originalName?f=t.taskTitle||t.title||"":(t.taskTitle=f,this.setTitle(f)),this._processForCollectionError(t),this.pageProcessor.process(this.panelRoot,{routablePoint:k,id:this.id,showBackButton:this._shouldShowBackButton(t),cameFromCollections:t.entryPoint===u.Collections,listingTaskId:t.listingTaskId,location:d,boundingBox:g,map:this.map,geochainManager:this._geochainManager,controlTemplateFactory:this._controlTemplateFactory,taskTitle:f,getDisplayState:function(){return r.displayState},impressionGuid:h.getImpressionGuid(this.panelRoot)},this.perfLog),this.addBackToListBtn(),i=this.viewModel,du.enableCalendarSync?i.createCalendarSync():(s=this.panelRoot.select(".calendarSyncModule"),s&&s.getParent()&&s.getParent().set_style({display:"none"})),i.launchOverflowTask.add(function(n){r.launchOverflowTask.invoke(n)}),i.processAdvertising(t),i.processTnAAds(),i.registerActionButtonEvents(this.id,this._taskState),i.registerModuleClickEvents(),i.registerCalendarEvents(),i.registerLocatedAtSearchEvents(),i.processPhotostripData(),i.registerVenueMapEvents(),this._checkLoadingVenueMapTask(),i.addAnnotationControl(t),t.taskTitle&&i.updatePoiTitle(t.taskTitle),i.removeUpcomingEventContainer(),i.registerGeochainEvents(),i.expandDetailsCard(),i.prepareMenuModule(),i.prepareReviewsAccordionModule(function(){r._disableSizeChangeAction()}),i.registerActionsModuleEvents(),i.addRecommendationModuleHover(this.poiManager),n.enableNewActionBarButtons&&(i.registerNewMoreMenuEvents(this),i.registerShowAllImageEvents()),n.edgeRecoModuleFix&&i.edgeRecoModuleFix(),i.logInstrumentationForShoppingDataGroup(),c=this.panelRoot.select('div[id^="locovl"]'),this._imgSetOvlId||(this._imgSetOvlId=c.get_attr("data-ovl")),!t.isImgOvlOpen&&this._imgSetOvlId){var o=_d.getElementsByTagName("html")[0],it=o.style.overflowX,rt=o.style.overflowY,ut=o.style.overflow;sj_evt.fire("ovlHide",this._imgSetOvlId,!0);o.style.overflow=ut;o.style.overflowX=it;o.style.overflowY=rt}else this._imgSetOvlId=c.get_attr("data-ovl"),typeof ovlc!="undefined"&&ovlc.show(this._imgSetOvlId,t.imgSetOvlCurIndex);this._imgSetOvlShowHandlerWrapper||(this._imgSetOvlShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._imgSetOvlShowHandler.apply(r,t[0])});sj_evt.unbind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper);this._imgOvlHitTargetId=c.get_attr("id");sj_evt.bind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper,0);this._imgSetOvlHideHandlerWrapper||(this._imgSetOvlHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._imgSetOvlHideHandler.apply(r,t[0])});sj_evt.unbind("ovlHide",this._imgSetOvlHideHandlerWrapper);sj_evt.bind("ovlHide",this._imgSetOvlHideHandlerWrapper,0);nt={searchTaskInstance:this,updateDetailsPricePoi:this._updateDetailsPricePoi};sj_evt.fire("pricePoiInit",nt);l=this.panelRoot.select(".wfr_grid");l&&l.length>0&&sj_evt.fire("WFR.Resized",l[0]);v=this._getSidParam();v&&(y=this.panelRoot.select(".iaplanner"),y&&y.length!==0||(w=Microsoft.Maps.logger,w&&(a=this.panelRoot.select(".plchold .cico img"),b=null,a&&a.length===2&&(b=a[0].getAttribute("src")),tt={feature:"DC",action:"NoImgCollage",data:{sid:v,imageUrl:b}},w.logObject(tt,h.getImpressionGuid(this.panelRoot)))));this._logActivated(p.LDT)},c.prototype._shouldShowBackButton=function(n){var t=n.flippingCard||(n.openingNewCard&&n.entryPoint!==u.LayerManager?!1:n.openingNewCard),r=!i._getIsSlideCardEnabled()||i.shouldLeftLaneBeHidden();return t&&r||typeof n.listingTaskId!="undefined"},c.prototype._updateDetailsPricePoi=function(n,t,i){var u,f,r;n&&t&&(u=n.searchTaskInstance,u&&(f=u.viewModel,f&&f.getPushpinPrimitives&&(r=f.getPushpinPrimitives(),r&&r.length&&r[0].entity&&(r[0].entity.iconText=t,i&&(r[0].entity.badgeType=3),u.poiManager&&u.poiManager.setPrimitives&&u.poiManager.setPrimitives(r)))))},c.prototype._checkLoadingVenueMapTask=function(){var n=this.panelRoot.select("div[class=bm_venueMapButton]");this._taskState.loadVenueMap&&n&&n[0]&&(this._taskState.loadVenueMap=!1,this.viewModel.handleVenueMapClick())},c.prototype._disableSizeChangeAction=function(){var n=this;Microsoft.Maps.setTimeout(function(){n.primitiveInteracted.invoke({action:2})},0)},c.prototype._processForCollectionError=function(n){var t;if(n&&n.scenarioKey&&n.scenarioKey==="ERR"&&n.entryPoint===u.Collections&&(t=this.panelRoot.select("div[class=errmsg]"),t&&t.length===1)){var f=i._createElement("p"),e=i._createElement("p"),o=i._createElement("p"),s=i._createElement("p");f.set_text(r.L_Collections_NotFound_Text);e.set_text(n.taskTitle);o.set_text(n.query);s.set_text(r.L_Collections_TryAgain_Text);t.clear();t.append(f);t.append(i._createElement("br"));t.append(e);t.append(o);t.append(i._createElement("br"));t.append(s)}},c.prototype._poiTapped=function(){if(this.primitiveInteracted.invoke(),this.displayState.activationState!==1){var n={action:"focus",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)}},c.prototype._poiHoverStarted=function(n){var u,r,t,f,e,o,s;n&&n.primitive&&(r=n.primitive,t=r.entity,this._taskState.infoboxHtml||(t===null||t===void 0?void 0:t.infoboxHtml)?this.activateInfobox(r,this._taskState.infoboxHtml):((u=this.displayState)===null||u===void 0?void 0:u.prominence)===2&&(f=t.getTitle()||t.getAddress(),f&&(e=i.createElementWithClassName("a","infoBoxLink"),o=i.createElementWithClassName("span","cnm"),o.textContent=f,e.appendChild(o),s=e.outerHTML,this._taskState.infoboxHtml=s,this.activateInfobox(r,this._taskState.infoboxHtml))))},c.prototype._poiHoverStopped=function(){window.clearTimeout(l.mouseoverDelayHandle);l.mouseoverDelayHandle=window.setTimeout(function(){var n;((n=l.mapsInfobox)===null||n===void 0?void 0:n.preventAutoClose)===!1&&l.mapsInfobox.setOptions({visible:!1})},l.mouseoutTimeout/2)},c.prototype._imgSetOvlShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._taskState.isImgOvlOpen=!0;this._taskState.imgSetOvlCurIndex=t[2];this._imgSetOvlId=t[1];this.serializableObjectChanged.invoke({magnitude:2})},c.prototype._imgSetOvlHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]===this._imgSetOvlId&&(this._taskState.isImgOvlOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},c.prototype._checkItineraryTasks=function(){var n={requestorType:s.localDetailsTask,requestorId:this.id,type:s.itineraryDetailsTask,requestState:{action:0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n);this._itineraryTaskChecked=!0},c.prototype.getCardIconInfo=function(){var n=this.viewModel;return{iconClass:n.iconClass,iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},c.prototype._getSidParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("sid:")===0&&(t=n.substring(4))),t},c.prototype._getYpidParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("ypid:")===0&&(t=n.substring(5))),t},c.prototype._getEventIdParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("eventId:")===0&&(t=n.substring(8))),t},c.prototype._setAddItineraryDataTask=function(n){var e=this.viewModel.getEntities(),o=n.select("a.itineraryAdd");if(e&&e.length>0&&o&&o.length>0){var i=e[0],h=ii.getItineraryItem(i.getTitle(),i.getLocation(),i.id,i.getImageUrl(),i.getSelectedCategoryForIcon(),i.interests),r=i.addressFields;h.Destination=r&&(r.city||r.stateMunicipality||r.country);h.EntityTypes=i.getSegmentTypes();var c={entryPoint:u.LocalDetails,itineraryItem:h},l={type:s.itineraryDetailsTask,activateOptions:{},state:c},a=o[0];a.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(l))}},c.prototype._launchOverflowOnActivation=function(){var t,i,r,e;if(this._taskState.launchOverflowTaskOnTaskActivate&&this.panelRoot)if(t=this.panelRoot.select(".shoppingButton"),t&&t.length>0){var n=t[0],o=n.getAttribute("data-browseProductUrl"),s=n.getAttribute("data-productSearchUrl"),c=n.getAttribute("data-autosuggestEndPoint"),l=n.getAttribute("data-retailer"),u=this.viewModel.getEntities(),f="";u&&u.length>0&&(f=u[0].getTitle());i=this._taskState.productRootKeyword;i||(i=n.getAttribute("data-productRootKeyword"));this.launchOverflowTask.invoke({taskType:0,title:l||f,loadingUrl:o,productSearchUrl:s,autosuggestEndpoint:c,entryPoint:0,productRootKeyword:i,impressionGuid:h.getImpressionGuid(this.panelRoot)});this._taskState.launchOverflowTaskOnTaskActivate=!1}else r=this.panelRoot.select("#autoDealers"),r&&r.length>0&&(e=_w.AutoDealersFormCode||this._taskState.productFormCode||"BLSTBV",_w.AutoDealersFormCode=null,this._openAutoDealersOverlay(r[0].parentElement,e),this._taskState.launchOverflowTaskOnTaskActivate=!1)},c.prototype._onWidthChanged=function(n,t){var i,r;w&&w.enableBoldUXChanges&&(i=this.panelRoot.select("div.overlay-taskpane"),t===464?i.add_class("single_col"):i.remove_class("single_col"),n&&t&&(r=n>t?{TYPE:"CLP",COL:at.NarrowWidth}:{TYPE:"EXP",COL:at.WideWidth},this._logHelper&&this._logHelper.log(p.LDA,r,this._getImpressionGuid())))},c.prototype._openAutoDealersOverlay=function(n,t){var i,u,f;if(n){var e=n.getAttribute("data-redirectUrl"),o=n.getAttribute("data-queryTemplateUrl"),r=this._taskState.productRootKeyword;r||(r=n.getAttribute("data-productRootKeyword"));i=this.viewModel.getEntities();u="";i&&i.length>0&&(u=i[0].getTitle());f={taskType:1,title:u,redirectUrl:e,queryTemplateUrl:o,productRootKeyword:r,formCode:t,impressionGuid:h.getImpressionGuid(this.panelRoot)};this.launchOverflowTask.invoke(f)}},c.prototype._handleAutoDealersBtnClick=function(){var t=this,n,i;this.panelRoot&&(n=this.panelRoot.select("#autoDealers"),n.add_event("click",function(i){i.stopPropagation();i.preventDefault();t._openAutoDealersOverlay(n[0].parentElement,"BLMTBV")}),i=this.panelRoot.select("#autoDealerBrowseAllLink"),i.add_event("click",function(i){i.stopPropagation();i.preventDefault();t._openAutoDealersOverlay(n[0].parentElement,"BLMTVS")}))},c}(l),ou=function(i){function r(t,r,u,f,e,o,s,h,c){var l=i.call(this,t,r,u,f,e,o,s,h,c)||this;return l.setRecommendedWidth(n.hotelCardWidth),l.setCurrentWidth(n.hotelCardWidth),sj_evt.bind("bm_scrollCard",function(){i.prototype._registerOverlayLinksForInstrumentation.call(l,".hr_link","HotelAds","CI.HotelAdsClick","adsUrl")}),l}return y(r,i),r.prototype.getSupportedSize=function(){return[464]},r.prototype._createUrl=function(){var t=i.prototype._createUrl.call(this),e,r,f,o,s,u,a;if(n.useNewFormCode)e=Logger.getOverlayType(),e||(t+="&mapsVertical=true");else{var e=Logger.getOverlayType();e?t+=this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?"&FORM=BHO001":"&FORM=BHO002":(t+="&FORM=BHO003",t+="&mapsVertical=true")}if(r=this._taskState.passThruParam,f=r&&(r.indexOf("sponover")>-1||r.indexOf("sponad")>-1),!f&&r&&r.toUpperCase().indexOf("FORM=")===-1&&(t+=r.indexOf("&")!==0?"&"+r:r),f&&t.indexOf("&originig=&")>-1&&(t=t.replace("&originig=&","&")),t+=this._taskState&&this._taskState.parentIG?"&parentIG="+this._taskState.parentIG:"&htlsource=overlaynq",_w.hpa_roomnum&&(t+="&guests="+_w.hpa_roomnum),_w.suppressBookingAdsModule=this._taskState.isBookingModuleEntryPoint,f&&(o=this._getCheckinDate(),s=this._getCheckoutDate(),o&&s&&typeof DateHelper!="undefined"&&typeof DateHelper.formatDate!="undefined"&&(t+="&checkin="+DateHelper.formatDate(new Date(o),"yyyy-mm-dd")+"&checkout="+DateHelper.formatDate(new Date(s),"yyyy-mm-dd"))),this._taskState&&this._taskState.activatingElement&&this._taskState.activatingElement.length&&(u=this._taskState.activatingElement,u.get_attr("data-sponad")==="True")){var h=u.get_attr("data-ad_eid"),l=u.get_attr("data-ad_oid"),v=u.get_attr("data-ad_oq")||"";h&&h.length&&l&&l.length&&(t+="&sponad=true&hotelentityid="+h+"&hotelid="+l+"&originalquery="+v)}return a=this._taskState&&this._taskState.originalQuery,a&&(t+="&loq=".concat(a)),t},r.prototype._getRequestUrlFormat=function(){return i.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},r.prototype._getFormCode=function(){var n=Logger.getOverlayType();return n?this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?"BHO001":"BHO002":"BHO003"},r.prototype.processResponse=function(n,t){_w.hotelsDetailsCardIG=h.getImpressionGuid(n);i.prototype.processResponse.call(this,n,t);this.reprocessDetails(this._taskState);this._processFakeTabDataProcess();sj_evt.fire("filterattached");sj_evt.fire("initRoomRatesModule",this.panelRoot)},r.prototype._getSegmentParam=function(){return"hotel"},r.prototype._getTextAdsCode=function(){return n.enableHotelTextAds?"h":null},r.prototype._suppressProcessDetails=function(){return!0},r.prototype._processFakeTabDataProcess=function(){var i=this,n;this.panelRoot&&this.id&&(n=this.panelRoot.select("div[class=faketab]"),n&&n.length&&n.for_each(function(n){var r=t(n).select("a[data-process]");r&&r.length&&r.for_each(function(n){var u=n.getAttribute("data-process"),r=u&&t.Internals.parseJSON(u);r&&(r.requestorId=i.id,n.setAttribute("data-process",t.Internals.stringify(r)))})}))},r.prototype._getCheckinDate=function(){var n=_w.LocalStorageHelper;return n&&n.getItem("ol_startdate")?n.getItem("ol_startdate"):_w.ol_startdate},r.prototype._getCheckoutDate=function(){var n=_w.LocalStorageHelper;return n&&n.getItem("ol_enddate")?n.getItem("ol_enddate"):_w.ol_enddate},r}(it),et=function(o){function a(n,t,r,f,e,h,l,a){var v=o.call(this,t,h,r,e)||this,b,y;return v._primitivesToHideAfterPrint=[],v._defaultInfoboxContentsTemplate='<a class="infoBoxLink" role="button" href="#"><div class="bm_ib_container bm_ib_titleonly"><div class="bm_ib_title">{title}<\/div><\/div><\/a>',v.showCloseButton=!0,v.type=s.localListingTask,v.poiManager=f,v._contextMenu=l,v._taskUrlParams.push({param:"poicount",paramGetter:function(){return v._getPoiCountParam()}}),v.disposables.push(v.poiManager.contextMenuInvoked.add(function(n){return v._contextMenuInvoked(n)})),v.disposables.push(e.poiSelected.add(function(n){return v._setSelectedPrimitive(n)})),v.disposables.push(v.poiManager.mapViewChanged.add(function(n){return v.updateMapBounds(n)})),v._micropoiFetched=!1,v._microPoiManager=a,b=v.poiManager.getZIndex(),v._microPoiManager.setZIndex(b-1),v.disposables.push(v._microPoiManager.poiViewStateChanged.add(function(n){v._onPoiViewStateChanged(n,!0)})),v.disposables.push(v._microPoiManager.zoomChangedOnClusterSelect.add(function(){v.map.viewChanged.addOne(function(){v.poiManager._computeBestMapViewOnSetPrimitives=!1;o.prototype._refreshWithDelay.call(v)})})),v._dateFilterChanged=!1,v._registerEvents(t),v.controlTemplateFactory=n,v.disposables.push(v.laneScrolled.add(function(){v._contextMenuOnListMode&&v._hideListItemContextMenu()})),v._setTaskCompleted=!1,v._polygonLayerAdded=!1,v._categories=new oi,v._categories.changed.add(function(n){v._onCategoriesChanged(n)}),v.registerFilters=new nt,v.disposables.push(v.registerFilters.add(function(){v.registerFilterBarEventHandlersV2();v.registerFilterBarSwitchQueryEventHandlers();sj_evt&&sj_evt.fire("filterattached")})),y=c.features.taskFramework,i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt?sj_evt.bind("triggerMapSearch",function(n){var t,i;if(v.displayState&&v.displayState.prominence===1)if(t=n&&n[1],t){if(i=t.filters,typeof i!="undefined"){v._logInstrumentationEventForEntityClick();v.onFilterValueChanged(i)}}else v._logInstrumentationEventForEntityClick(),v._refresh({mapPannedOrZooomed:!0,isResearchOnOverlay:!0})}):y&&y.nearbyListingButtonsEnabled&&sj_evt&&sj_evt.bind("triggerMapSearch",function(){v.displayState&&v.displayState.prominence===1&&(v._taskState&&(v._taskState.disableListingRefresh=!1),v._logInstrumentationEventForEntityClick(),v._refresh({mapPannedOrZooomed:!0,isResearchOnOverlay:!0}),v._taskState&&(v._taskState.entryPoint===u.Nearby?(v._taskState.disableListingRefresh=!0,v._nearbyFloatingContainer&&v._nearbyFloatingContainer.logNearbyInstrumentationData(ht.SearchAreaClick,{})):v._nearbyFloatingContainer&&v._nearbyFloatingContainer.logNearbyInstrumentationData(ht.AutoRefreshOnExit,{})))}),w&&w.enableBoldUXChanges&&v.disposables.push(v.toggleCompleted.add(function(n){var t={TYPE:n,COL:n==="EXP"?v.getCurrentWidth()===732?tt.ThreeColumns:v.getCurrentWidth()===484?tt.TwoColumns:tt.SingleColumn:tt.Collapsed};v._logHelper.log(p.LLA,t,v._getImpressionGuid())})),v}return y(a,o),a.prototype.activate=function(n,t,i,r){var e=this,s,f,h,l,a;this.viewModel||(this.viewModel=new yi(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));s=c.features.taskFramework;s&&(s.nearbyButtonEnabled&&t.entryPoint===u.Nearby&&(t.disableListingRefresh=!0),s.nearbyListingButtonsEnabled&&!t.nearbyPivotEntity&&t.pivotEntity&&(f=this._getNormalizedPivotEntity(t.pivotEntity),f&&f.name&&f.location&&(t.nearbyPivotEntity={title:f.name,location:f.location,id:f.id,idType:f.idType})));this.registerViewModelEvents();h=t.fullQuery?t.fullQuery:t.query;l=t.taskTitle?t.taskTitle:h;this.setTitle(l);t&&t.categoryLayers&&(this._taskState=t,this._categories.insertAll(t.categoryLayers));o.prototype.activate.call(this,n,t);t.content?this._logActivated(p.LLT):(t.disableTaskActivate=!0,a={requestState:t},o.prototype.process.call(this,a,function(n){e.processResponse(n.data.content);e._logActivated(p.LLT);sj_evt&&e.displayState&&e.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",e.panelRoot,e.stackId)},r))},a.prototype.process=function(n,t){var f=this,r=n&&n.requestState,e;r.hideEntity?(this._setTaskCompleted?((i._isLargeMapShownOnSerp()||this._taskState.entryPoint===u.Permalink)&&r.selectedEntityId&&(this.viewModel&&this.viewModel.isWaterfallListingsEnabled()?Microsoft.Maps.setTimeout(function(){f._updateSelectedPrimitiveById(r.selectedEntityId)},20):this._updateSelectedPrimitiveById(r.selectedEntityId)),this._hideSelectedPrimitive(r.selectedEntityId)):(this._hideSelected=new nt,this.disposables.push(this._hideSelected.addOne(function(){f._hideSelectedPrimitive(r.selectedEntityId)}))),t&&t({processorId:this.id,data:{}})):r.showEntity?(r.selectedEntityId&&(e=function(){var n=f.viewModel.UpdatePrimitiveState(r.selectedEntityId,0);n&&f.poiManager.invalidated.invoke()},this._setTaskCompleted?e():(this._hideSelected=new nt,this.disposables.push(this._hideSelected.addOne(function(){e()})))),t&&t({processorId:this.id,data:{}})):r.hideContextMenu?(this._transientLensViewModel.hide(),t&&t({processorId:this.id,data:{}})):o.prototype.process.call(this,n,t)},a.prototype.deactivate=function(){o.prototype.deactivate.call(this);this._categories.length===0?this._microPoiManager&&this._microPoiManager.dispose():this._updateCategories("removeLayer");this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();var n={hideBackButton:!0,listingTaskId:this.id},t={requestorType:s.localListingTask,type:s.localDetailsTask,requestState:n,useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,t);this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1);this._nearbyFloatingContainer&&this._nearbyFloatingContainer.deregister(this.id)},a.prototype.registerViewModelEvents=function(){var t=this;this.disposables.push(this.viewModel.loadInfobox.add(function(i){t.activateInfobox(i,"",!1,!0,n.enableRichInfoBox)}));o.prototype.registerViewModelEvents.call(this)},a.prototype.hasPrintContent=function(){return this.isPrintable()},a.prototype.getPrintContent=function(){var o=this,n,i,u,f,r,t,e;if(!this.hasPrintContent())return null;if(n=this.getMapPrimitives(),n[0]&&n[0].entity&&n[0].entity.usePricePoi)for(this._priceText=[],i=0;i<n.length;i++)u=n[i].entity,u.iconText?this._priceText.push(u.iconText):this._priceText.push("");for(f=null,this.viewModel instanceof yi&&(f=this.viewModel.getListingsHtmlContentForPrint(this._colorIndex)),r=0;r<n.length;r++)t=n[r],t&&t.viewState==3&&(this._primitivesToHideAfterPrint.push(t),t.viewState=0);return e=new oi,e.insert(this.poiManager.getLayerId(),0),pr.onPrintDialogClose.addOne(function(){return o.cleanUpPrintEntities()}),new yr(f,e,null)},a.prototype.cleanUpPrintEntities=function(){for(var f,e,u,t,n,r=0;r<this._primitivesToHideAfterPrint.length;r++)f=this._primitivesToHideAfterPrint[r],f&&(f.viewState=3);if(e=this.viewModel,e){for(u=e.getPushpinPrimitives(),t=0;t<u.length;t++)n=u[t].entity,n&&n.iconText&&n.iconText.length>0&&(n.iconText=this._priceText&&this._priceText.length>0&&n.usePricePoi?this._priceText[t]:"");this.poiManager.setPrimitives(u,!0)}i&&i._refocusPrintDropDownMenu(this.id)},a.prototype._getCardTypeAugmentation=function(){return"listing"},a.prototype._resetMicropois=function(){this._microPoiManager&&this._microPoiManager.fetchMicroPois(null,[])},a.prototype._onPrimitivesChanged=function(n){this._setPivotPrimitive();o.prototype._onPrimitivesChanged.call(this,n);this._categories&&this._categories.length>0&&this._updateCategories("updateTaskEntities",null,null,this.viewModel.getEntities())},a.prototype.processResponse=function(r,u){var v=this,nt,l,tt,lt,it,rt,ni,a,h,at,vt,p,k,ti,g,yt,pt,ut,ii,ri,ui,fi,ft,oi,si,bt,ht,ct;this._getTaskState().content=r;var y=r.select(".bm_filterBar"),hi=u&&u.isInfiniteScroll,ci=u&&(u.mapPannedOrZooomed||u.isPaginated);if(!hi&&ci&&sj_evt.fire("scrollToTop"),y.length>0&&(!u||!u.isInfiniteScroll||u.mapPannedOrZooomed)&&(y.removeFromParent(),this.setFilters(y)),nt=r.select(".wfr_grid"),nt&&nt.length>0&&(this.resizableComponentId=nt.get_attr("id")),l=this.viewModel.getPaginationRootId(r),this._stopSharing=r.select("div[data-stopsharing]").get_attr("data-stopsharing")==="true",u&&(u.mapPannedOrZooomed||u.filterValueChanged)&&l&&(tt=this.viewModel.getPaginationViewModel(),tt&&(tt.updatePaginationRootId(l),lt=d.getEntitiesFromResponse(r,this._taskState),it=lt&&lt.entities,it&&it.length))){var kt=this.viewModel.getHouseListingCounts(r.select("div[data-listingMetadata]")),dt=kt?kt:it.length,gt=this._getTotalResultCount(r);gt>dt&&tt.resetPaginationState(dt,gt)}if(this.viewModel.setResponseContent(r,this._getTaskState(),u),u&&u.mapPannedOrZooomed&&this.viewModel.isWaterfallListingsEnabled()&&l&&(rt=this.panelRoot.select("#"+l),rt.length>0&&(ni=i._getWaterfallResizeEventName(w,l),sj_evt.fire(ni,rt[0]),sj_evt.fire("EntityWfrCellsAdded",rt.select("a.listings-item")))),a=this.viewModel.panelRoot.select("div[data-mapcardwidth]"),h=a&&a.length&&a[0].getAttribute("data-mapcardwidth"),n.wideListCardFallback&&h==="416px"&&t("body")[0].clientWidth<n.wideListCardMinClientWidth&&(at=this.viewModel.panelRoot.select(".listing-shopping-button"),vt=this.viewModel.panelRoot.select(".listing-autodealers-button"),at&&at.length!==0||vt&&vt.length!==0||(h="360px",a[0].setAttribute("data-mapcardwidth",h),a.set_style({width:h}),p=this.viewModel.panelRoot.select("div.bm_cardWidth_416"),p&&p.length>0&&(p.remove_class("bm_cardWidth_416"),p.add_class("bm_cardWidth_360")))),h&&(k=parseInt(h),this.setRecommendedWidth(k),this.setCurrentWidth(k),this.viewModel.isTaskOnItinerarySlideout(this._taskState)&&this.resizeCard.invoke()),this.getFilters()?sj_evt.fire("resetFilterDisplay"):sj_evt.fire("filterattached"),n.doubleWideListEnabled&&!n.enablePoiCentering?this._setViewportPaddingForCardSide(k+30):n.enablePoiCentering&&i&&(ti=32,this._setViewportPaddingForCardSide(k+i.getVerticalTaskBarWidth()+ti)),g=this.viewModel.isTaskOnItinerarySlideout(this._taskState),yt=this._getImpressionGuid(),u&&u.isInfiniteScroll&&n.usePaginationIgForInstrumentingClicksInInfiniteScroll&&(pt=r.select("div[data-ig]").get_attr("data-ig"),pt&&(yt=pt)),this._localListingPageData={taskParentId:g?this._taskState.parentTaskId:this.id,query:this._taskState.query,clickHandler:function(n,t){return v._processItemClickEvent(t)},contextMenuHandler:g?null:function(n,t){return v._processContextMenuEvent(n,t)},saveButtonClickHandler:function(n,t,i){return v._processSaveButtonClickEvent(n,t,i)},listItemCarouselHandler:function(n,t){return v.viewModel.InsertListItemCarousel(n,t)},originIG:this._taskState.originIG,parentIG:yt,isBookingModuleEntryPoint:this._taskState.isBookingModuleEntryPoint,saveMode:typeof this._taskState.parentTaskId!="undefined"},n.passListFormToDetails&&this._taskState.formCode&&(this._localListingPageData.formCode=this._taskState.formCode),g&&(this._localListingPageData.listingTaskId=this.id,this._addBackButton()),this.pageProcessor.process(this.viewModel.getResponseContainer(),this._localListingPageData),ut=this.panelRoot.select("div.bm_chainshoppingctr"),ut.length&&y.length&&(ut.removeFromParent(),y[0].appendChild(ut[0])),this.viewModel.registerListItemEvents(this._taskState.query,this.pageProcessor),this.viewModel.setIconOnlyLimitBySegmentTypeOrCategoryId(),this._registerNoResultResetFiltersClickHandler(),this._setFocusToClickedSortOptionIfApplicable(),this._updateStateWithQueryParseData(),this._processLocalTopicLinks(),g&&(ii={action:9},ri={type:s.itineraryDetailsTask,taskId:this._taskState.parentTaskId,requestorType:s.localListingTask,requestorId:this.id,requestState:ii},e.invokeHandler(f.taskProcessDataHandlerKey,ri)),ui=this._getTotalResultCount(r),fi=this.viewModel.enableServerPagination(this,u,ui),fi||(this.viewModel.processPoiPagination(this._taskState,function(){v._doScrollLaneAction()}),this._setDisableListingRefresh(r)),this.viewModel.updateAdvertising(this._getTaskState()),!u||!u.mapPannedOrZooomed&&!u.isPaginated)try{var ft=[],ei=this.panelRoot.select("div[data-boundingbox]").get_attr("data-boundingbox"),o=ei&&t.Internals.parseJSON(ei);if(o&&o.boundingBox&&o.boundingBox.length>1){ft=[];ft.push(new b(o.boundingBox[0].latitude,o.boundingBox[0].longitude));ft.push(new b(o.boundingBox[1].latitude,o.boundingBox[1].longitude));var wt=this.map.getMode().getMapViewForLocationsInView(ft),et=li.fromLocation(wt.cameraLocation,!0),st=o.minZoomLevel;st&&!isNaN(st)&&et<st&&(et=st);oi=cr.fromEdges(o.boundingBox[0].latitude,o.boundingBox[0].longitude,o.boundingBox[1].latitude,o.boundingBox[1].longitude);si=li.toLocation(oi.center,et,!0);wt=ot.constructView(this.map,si,et,null,!1,this.map.getViewportPadding(),this.map.getActualSize());this.poiManager&&(this.poiManager.setMapViewFromBackend&&this.poiManager.setMapViewFromBackend(wt),this.poiManager.MapViewFromBackendIsSet())}}catch(ai){}if(this.setTaskComplete(u),sj_evt&&sj_evt.fire("MapSearchTaskActivated",this.viewModel.getResponseContainer()),bt=c.features.taskFramework,bt&&bt.nearbyListingButtonsEnabled)if(this._updateTaskStateOnPivotResponse(r),this._taskState.nearbyPivotEntity)this._getResultDistanceAroundPivotAndUpdate();else if(ht=this.viewModel.getResponseContainer().select("div.nearbyInfoBoxButton"),ht)for(ct=0;ct<ht.length;ct++)t(ht[ct]).removeFromParent();this._logShoppingButtonShown();this._logAutosButtonShown();this.viewModel.localEntitiesWithinRUBRegion(r,this._getTaskState())&&this.close();n.enableTopicSearchExperience&&this._processBreadCrumbs()},a.prototype._processBreadCrumbs=function(){var r=this.panelRoot.select(".topicSearchCrumb.parentTopics a"),i,o,n,s,c;if(r.length>0){for(i=0;i<r.length;i++)o=r[i],n=this._getProcessOptions(o),n&&n.requestState&&(s={type:"LocalSearchTask",requestState:n.requestState},n.requestState.disableTaskActivate&&(s.requestorId=this.id),o.setAttribute("data-process",t.Internals.stringify(s)));this._addMarkerInstrumentationForListItems("feature","TopicSearch");_w.clarity&&_w.clarity("set","ListingSource","TopicSearch");c={logData:{feature:ft.Search,action:"EP",data:{entryPoint:u.TopicSearch}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,c)}},a.prototype._getProcessOptions=function(n){var i=null,r=n&&n.getAttribute("data-process");if(r)try{i=t.Internals.parseJSON(r)}catch(u){}return i},a.prototype._getCategoryOrSegment=function(){if(this.viewModel){var n=this.viewModel.getCategory();return n?n.toLowerCase():"none"}return"none"},a.prototype._getNormalizedPivotEntity=function(n){if(n)if(typeof n=="string")try{return JSON.parse(n)}catch(t){return null}else return n;else return null},a.prototype._updateTaskStateOnPivotResponse=function(n){var t,r,u,i;this._taskState.nearbyPivotEntity||(this._taskState.pivotEntity?(t=this._getNormalizedPivotEntity(this._taskState.pivotEntity),t&&t.name&&t.location&&(this._taskState.nearbyPivotEntity={title:t.name,id:t.id,idType:t.idType,location:t.location},this._taskState.pivotEntity=null)):n&&n.length>0&&(r=n.select("div.overlay-listings"),r&&r.length>0&&(u=r.get_attr("data-pivot"),u&&u.length>0&&(i=JSON.parse(u),i&&i.name&&i.location&&(this._taskState.nearbyPivotEntity={title:i.name,id:i.id,idType:i.idType,location:i.location},r.set_attr("data-pivot",""))))))},a.prototype._getLatLngsFromRoutableLocations=function(n){for(var i,r="",t=0;t<n.length;t++)i=n[t]&&n[t].location,i&&(r+=i.latitude+","+i.longitude+";");return r.slice(0,-1)},a.prototype._getResultDistanceAroundPivotAndUpdate=function(){var n=this,a=c.features.taskFramework,s=this.viewModel.getResponseContainer(),h=s.select("div.bm_multicol").length>0,l=[],i,f,r,e;if(s.select("a.listings-item").for_each(function(n){n.querySelector("div.nearbyDistance:empty")&&l.push(n)}),i=t(l),i.length!==0){f=[];i.for_each(function(n){var i=n.getAttribute("data-entity"),t=i&&JSON.parse(i);t&&t.routablePoint&&f.push({location:t.routablePoint,title:t.entity&&(t.entity.name||t.entity.title||t.entity.address)})});r=[];i.for_each(function(n){var t=n.querySelector("div.nearbyInfoBoxButton");t&&r.push({nearbyInfoBoxButtonDiv:t,nearbyDistanceDiv:t.querySelector("div.nearbyDistance"),nearbyTimeDiv:t.querySelector("div.nearbyTime")})});var v=this._getLatLngsFromRoutableLocations(f),p=c.features.directions,y=a.nearbyDistanceMatrixProxyURL,o=y.replace("${lat}",this._taskState.nearbyPivotEntity.location.latitude).replace("${lng}",this._taskState.nearbyPivotEntity.location.longitude).replace("${destinations}",v).replace("${travelMode}","driving").replace("${key}",ef.instance.getSessionId());this._nearbyFloatingContainer=cu.getInstance(this.map);e=this._nearbyFloatingContainer.getModeForTask(this.id);this._nearbyFloatingContainer.registerTaskInformationAndShow(this.id,{populatedDistanceMatrixURL:o.replace("driving","${mode}"),updateCallback:function(t){n.modeUpdatedCallback(t,r,f,i,h)},exitNearbyCallback:function(){n._taskState.entryPoint=u.Autosuggest;sj_evt.fire("triggerMapSearch");n._taskState.disableListingRefresh=!1;var t=n._getNormalizedPivotEntity(n._taskState.pivotEntity);t&&n._taskState.nearbyPivotEntity&&t.location===n._taskState.nearbyPivotEntity.location&&(n._taskState.pivotEntity=null);n._taskState.nearbyPivotEntity=null;n._nearbyFloatingContainer=null},updateTransportationModeCallback:function(t){n.updateTransportationModeAndIconCallback(t,r)},requestStatusCallback:function(t){n._showOrHideWaitLayer(t)},currentMode:e});e==="driving"&&(o+="&startTime="+cu.getCurrentDateTime());st.downloadJson(o.replace("driving",e),"locallisting",function(t){n.modeUpdatedCallback(t,r,f,i,h);n.updateTransportationModeAndIconCallback(e,r)})}},a.prototype.modeUpdatedCallback=function(n,u,f,e,o){var s=this,l=null,p=n,a=p.resourceSets,v,h,y;a&&a.length>0&&(v=a[0],h=v.resources,h&&h.length>0&&(y=h[0],l=y.results));l&&(t(".bm_nearbyMapContainer").remove_class("bm_hideOnLoad"),l.forEach(function(n){var v=n,y=v.destinationIndex,h=v.travelDuration,l=v.travelDistance,p,k,e;h=h>1?Math.round(h):1;var tt=c.features.directions,it=tt.unit,d=!l||l===-1;if(l*=1e3,p=i._readableTextFromDistance(l,it!==1),u&&u.length>0){var o=u[y],w=o.nearbyDistanceDiv,nt=o.nearbyTimeDiv;if(w.style.display=d?"none":"inline-block",w.innerText=p,d||w.setAttribute("aria-label",p),k="".concat(h," ").concat(r.L_NearbyMinute),nt.innerText=k,nt.setAttribute("aria-label",k),!o.nearbyInfoBoxButtonDiv.getAttribute("data-task")&&(e=f[y],e&&e.location&&e.location.latitude&&e.location.longitude&&s._taskState.nearbyPivotEntity&&s._taskState.nearbyPivotEntity.location.latitude&&s._taskState.nearbyPivotEntity.location.longitude)){var a=new fr,rt=new b(e.location.latitude,e.location.longitude),ut=new b(s._taskState.nearbyPivotEntity.location.latitude,s._taskState.nearbyPivotEntity.location.longitude);a.tryAddWaypoint(new bt(s._taskState.nearbyPivotEntity.title,ut),0);a.tryAddWaypoint(new bt(e.title||null,rt),1);a.mode=g.driving;o.nearbyInfoBoxButtonDiv.setAttribute("data-task",JSON.stringify({state:fr.inputDataToDirectionsState(a),type:"DirectionsTask"}));o.nearbyInfoBoxButtonDiv.setAttribute("data-instrumentation",JSON.stringify({logData:{feature:ht.NearbyFeatureName,action:ht.ActionClick,data:{PVT:f[y],DST:s._taskState.nearbyPivotEntity,M:g.driving}}}));t(o.nearbyInfoBoxButtonDiv).remove_class("bm_hideOnLoad")}}}),o&&this._fixNearbyInfoBoxButtonPlacement(e,u),u&&u.length>0&&e.for_each(function(n){var t=n.querySelector("div.b_imagePair.tall_m > div.inner > div.cico > img");t&&(t.parentElement.style.height="".concat(n.clientHeight,"px"),t.style.height="".concat(n.clientHeight,"px"))}))},a.prototype.updateTransportationModeAndIconCallback=function(n,i){var r=new RegExp(/"mode":[1-3]/),u=new RegExp(/"M":[1-3]/);i&&i.length>0&&i.forEach(function(i){var e=i.nearbyInfoBoxButtonDiv.querySelector("span"),o=i.nearbyInfoBoxButtonDiv.getAttribute("data-task"),s=i.nearbyInfoBoxButtonDiv.getAttribute("data-instrumentation"),f=t(i.nearbyInfoBoxButtonDiv);n==="driving"?(e.className="",f.set_attr("data-task",o.replace(r,'"mode":'.concat(g.driving))),f.set_attr("data-instrumentation",s.replace(u,'"M":'.concat(g.driving)))):n==="walking"?(e.className="nearbyWalking",f.set_attr("data-task",o.replace(r,'"mode":'.concat(g.walking))),f.set_attr("data-instrumentation",s.replace(u,'"M":'.concat(g.walking)))):n==="transit"?(e.className="nearbyTransit",f.set_attr("data-task",o.replace(r,'"mode":'.concat(g.transit))),f.set_attr("data-instrumentation",s.replace(u,'"M":'.concat(g.transit)))):(f.remove_attr("data-task"),f.remove_attr("data-instrumentation"))})},a.prototype._fixNearbyInfoBoxButtonPlacement=function(n,t){var v=this.viewModel.getResponseContainer(),y=v.select("div.bm_2col").length>0,s=!1,h=[],f,a,o;n.for_each(function(n){var t=n.querySelector("div.lMCard"),i;t?(i=t.querySelector("div.b_hPanel"),i.style.paddingBottom="8px"):(t=n.querySelector("div.b_vPanel"),t.style.paddingBottom="0px",s=!0);h.push(t)});f=[];n.for_each(function(n){return f.push(n.clientHeight)});for(var e=h.map(function(n){return n.clientHeight}),u=Array(n.length),c=y?2:3,i=0,r=s?e:f;i<r.length-c;)for(var l=i+c,p=r.slice(i,l),o=Math.max.apply(null,p);i<l;)u[i++]=o;if(i<r.length)for(a=r.slice(i,r.length),o=Math.max.apply(null,a);i<r.length;)u[i++]=o;t&&t.length>0&&t.forEach(function(n,t){var r=n.nearbyInfoBoxButtonDiv,i=r.style.marginTop,f=0;i&&i.length>2&&(f=Number(i.slice(0,-2)));u[t]>e[t]&&(r.style.marginTop="".concat(u[t]-e[t]+Math.max(f,8),"px"))})},a.prototype.setTaskComplete=function(t){var u=this,a=this.poiManager,h=this._taskState&&this._taskState.id?rt.ID:rt.SB,c=this._logHelper.perfStart(h),f=this._getCategoryOrSegment(),r,e,s;f&&n.useShowMeForSegmentMicroPoi.indexOf(f)>-1||(f=null);r=this._getTaskState();r.selectedEntityId&&(this._updateSelectedPrimitiveById(r.selectedEntityId,t),this._hideSelectedPrimitive(r.selectedEntityId));this.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(e=window.$cp_bsperf=window.$cp_bsperf||{},e.Maps_CP_CLT=e.Maps_CP_CLT||performance.now(),k.record("Maps_CP_LLT",Math.round(e.Maps_CP_CLT)));s=this.map.getFrameManager();this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();k.removeKey("SearchRequest");this._firstFrameRenderedHandler=s.frameRendered.addOne(function(){function e(){var u=k.getStartTime(t.id,!0),r,f;u&&(k.log("Maps_LLTTG",u),t.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(k.log("Maps_CP_LLTTG",performance.timing.navigationStart),l.hasCardPrimerPerfDataLogged=!0),r=Microsoft.Maps.Local,f=t instanceof r.HotelsListingTask?"Maps_HLLTTG":t instanceof r.RestaurantsListingTask?"Maps_RLLTTG":t instanceof r.HouseListingTask?"Maps_RELLTTG":i._isAttractionCategory(t.viewModel.getCardCategoryId())?"Maps_ALLTTG":"",f&&k.log(f,u));n.enableImprovedPerf&&Microsoft.Maps.setTimeout(function(){sj_evt.fire("RMS.LoadImg")},0)}c.end("RT");var t=u;f&&u._categories.indexOf(f)===-1?(u._categories.insert(f),s.frameRendered.addOne(e)):e();r&&r.searchPerfState&&(u._microPoiManager&&u._microPoiManager.setTaskDisplayState({prominence:1}),u._requestMicroPoiRefresh(r))});this.registerFilterBarEventHandlersV2();this.registerFilterBarSwitchQueryEventHandlers();this._moveComparePanelToSortbar();this._hideSelected&&this._hideSelected.invoke();t&&t.mapPannedOrZooomed&&this.scrollLane.invoke(this.panelRoot);this._drawBoundary();o.prototype.setTaskComplete.call(this,t);this._setTaskCompleted=!0},a.prototype.setDisplayState=function(n){var s=this,f,u,e,r;if(o.prototype.setDisplayState.call(this,n),f=c.features.taskFramework,this._categories.length===0?this._microPoiManager&&this._microPoiManager.setTaskDisplayState(n):this._updateCategories("updateDisplayState",null,this.displayState),this.getFilters()&&n.animationState===0&&sj_evt.fire("resetFilterDisplay"),f&&f.nearbyListingButtonsEnabled&&n&&(n.prominence&&n.prominence===2||n.isHidden)&&this._nearbyFloatingContainer&&this._nearbyFloatingContainer.showContainer(!1,this.id),n.activationState===2)i._getIsSlideCardEnabled()||(u=this.viewModel&&this.viewModel.getResponseContainer(),u&&(u.remove_class(a._hoverClassName),e=t("."+a._hoverClassName,u[0]),e.remove_class(a._hoverClassName))),this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1),l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1}),f&&f.nearbyListingButtonsEnabled&&n.prominence&&n.prominence===1&&this._nearbyFloatingContainer&&(this._nearbyFloatingContainer.activateTask(this.id),this._nearbyFloatingContainer.showContainer(!0,this.id,!0)),r=this.viewModel.getPaginationViewModel(),r&&r.setActiveState&&(n.prominence&&n.prominence===1?r.setActiveState(!0):r.setActiveState(!1));else if(n.activationState===1&&(i._getIsSlideCardEnabled()&&(u=this.viewModel&&this.viewModel.getResponseContainer(),u&&(u.remove_class(a._hoverClassName),e=t("."+a._hoverClassName,u[0]),e.remove_class(a._hoverClassName))),this._taskState&&(this._taskState.selectedEntityId=null),this._taskState&&this._taskState.vdpid&&this._taskState.vdpid!==a._clearAttributeValue&&!this._polygonLayerAdded&&(this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){s.disposables.push(s._cityPolygonManager=n);n.addLayer(s._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0),f&&f.nearbyListingButtonsEnabled&&this._nearbyFloatingContainer&&(this._nearbyFloatingContainer.activateTask(this.id),this._nearbyFloatingContainer.showContainer(!0,this.id)),n.prominence&&n.prominence==1)){if(this.viewModel.isWaterfallListingsEnabled()){var h=this.viewModel.getPaginationRootId(this.panelRoot),v=this.panelRoot.select("#"+h),y=i._getWaterfallResizeEventName(w,h);sj_evt.fire(y,v[0]);sj_evt.fire("EntityWfrCellsAdded",v.select("a.listings-item"))}r=this.viewModel.getPaginationViewModel();r&&r.setActiveState&&r.setActiveState(!0)}typeof n.colorIndex=="number"&&(this._colorIndex=n.colorIndex);this.viewModel.isTaskOnItinerarySlideout(this._taskState)&&n.stackOrder===1&&(this._taskState.parentTaskId=undefined,this._localListingPageData.taskParentId=this.id,this._localListingPageData.listingTaskId=undefined,this.viewModel.resetLeftLaneTaskPrimitives(this.id))},a.prototype.isSharable=function(){return o.prototype.isSharable.call(this)},a.prototype._doScrollLaneAction=function(){this.scrollLane.invoke(this.panelRoot)},a.prototype._registerEvents=function(){var n=this;this.disposables.push(this.poiManager.refreshResultsRequired.add(function(){if(!n._taskState||!n._taskState.disableListingRefresh){var t=_ge("map_auto_refresh_checkbox");(!t||t.checked)&&(n._taskState.point&&(n._taskState.point=null),o.prototype._refreshWithDelay.call(n,{mapPannedOrZooomed:!0}),n._requestMicroPoiRefresh(n._getTaskState()))}}))},a.prototype._closeChildTasks=function(){var n=this;this.viewModel.isTaskOnItinerarySlideout(this._taskState)||this.map.getContainer().instanceAsync("TaskManager",function(t){var u=t.getFocusedStack(),r,i,f;if(u.id===n.stackId)for(r=u.getAllTasks(),i=0,f=r.length;i<f;i++)r[i].id!==n.id&&t.removeTaskAndReseatChild(r[i].id)})},a.prototype.onFilterValueChanged=function(n,t){this._closeChildTasks();this._taskState.localFilters=n;this._categories.length>0&&this._updateCategories("updateFilters",this._taskState.localFilters);this.viewModel&&this.viewModel.resetServerPagination&&this.viewModel.resetServerPagination();o.prototype._refreshWithDelay.call(this,t?{appliedFilterOption:t,filterValueChanged:!0}:{filterValueChanged:!0})},a.prototype.registerFilterBarEventHandlersV2=function(){var i,s,r,f,a,u,h,v,e,c,l,o;if(this.panelRoot[0])if(i=void 0,i=this.getFilters()?t(".stickyFiltersRoot")[0].getElementsByClassName("ftrPrBar"):this.panelRoot[0].getElementsByClassName("ftrPrBar"),s=i&&i.length&&i[0].getAttribute("data-advancefilters-house"),s&&s==="true"&&this._priceRangeFilterHandler(i),r=this.panelRoot[0].getElementsByClassName("bm_sortOption"),r&&r.length>0)for(this._bindFiltersV2(r),f=0,a=r.length;f<a;f++)u=r[f].getElementsByClassName("b_toggle"),u&&u.length>0&&(u[0].setAttribute("tabindex","-1"),sj_be(u[0],"click",function(n){sj_pd(n)}));else h=this.panelRoot.select("#LayoutSortBar")[0],h&&this.registerFilterEventHandlers(h);v=n.showInlineFilters?".overlaylistingheader":"#bm_contextualTaskbar";e=this.panelRoot.select(v)[0]||this.panelRoot[0];this.getFilters()&&(c=".stickyFiltersRoot",this.viewModel.isTaskOnItinerarySlideout(this._taskState)&&(c+=".slideout"),l=t(c),l.length>0&&(e=l[0]));e&&(o=e.getElementsByClassName("bm_filterBar")[0],o&&this.registerFilterEventHandlers(o),this.restoreWidthForMultiSelect(o))},a.prototype._onWidthChanged=function(n,t){var f,r,e,o,u,s,i,h;this.panelRoot&&(f=this.panelRoot.select("div[data-mapcardwidth]"),f.set_attr("data-mapcardwidth",t+"px"),this._updateInstrumentationForListItems(t),r=this.panelRoot.select(".maps_tna_ad_carousel"),r&&r.length>0&&(e="width_"+n,r.remove_class(e),o="width_"+t,r.add_class(o),r.fireEvent("mouseover")),this.viewModel&&!this.viewModel.isWaterfallListingsEnabled()?(u=this.panelRoot.select(".bm_svrpagination"),u&&u.length>0&&(t==240?u.set_style({display:"none"}):u.set_style({display:"block"})),i=this.panelRoot.select("a.listings-item.hover"),i&&i.length>0&&(s=i.getParent().getParent(),this._scrollToTargetForSelectedElement(s,t))):this.viewModel&&(i=this.panelRoot.select("."+a._waterfallSelectedClassName),i&&i.length>0&&this._scrollToTargetForSelectedElement(i,t)),this.viewModel&&this.shouldResize()&&this._updateWidthClassForBoldUX(this.panelRoot,n,t),n&&t&&(h=n>t?{TYPE:"CLP",COL:this.getCurrentWidth()===484?tt.TwoColumns:tt.SingleColumn}:{TYPE:"EXP",COL:this.getCurrentWidth()===732?tt.ThreeColumns:tt.TwoColumns},this._logHelper&&this._logHelper.log(p.LLA,h,this._getImpressionGuid())))},a.prototype._scrollToTargetForSelectedElement=function(n,t){var r=-3,i;w&&w.enableBoldUXChanges&&(t==240?r=-1:t==484&&(r=-2));i=n.get_sibling(r);i&&i.length>0&&sj_evt.fire("scrollToTarget",i[0])},a.prototype._addMarkerInstrumentationForListItems=function(n,i){var r=this.panelRoot.select("a.listings-item");r.for_each(function(){var f=r.get_attr("data-instrumentation"),u;f&&(u=t.Internals.parseJSON(f),u&&u.logData&&u.logData.data&&(u.logData.data[n]=i,r.set_attr("data-instrumentation",t.Internals.stringify(u))))})},a.prototype._updateInstrumentationForListItems=function(n){var i=this.panelRoot.select("a.listings-item");i.for_each(function(){var u=i.get_attr("data-instrumentation"),r;u&&(r=t.Internals.parseJSON(u),r&&r.logData&&r.logData.data&&(r.logData.data.BLD=n===240?tt.SingleColumn:n===484?tt.TwoColumns:tt.ThreeColumns,i.set_attr("data-instrumentation",t.Internals.stringify(r))))})},a.prototype._updateWidthClassForBoldUX=function(n,t,i){var u="bm_cardWidth_"+t,r=n.select("."+u),f;r&&r.length!=0||(u="bm_cardWidth",r=n.select("."+u));r.remove_class(u);r.remove_class("boldux");f="bm_cardWidth_"+i;r.add_class(f);r.add_class("boldux")},a.prototype.restoreWidthForMultiSelect=function(n){var u=n&&n.getAttribute("seg"),i,r,e,f;if(u&&u!=="House"&&u==="Hotel"&&(i=n.getElementsByClassName("b_filterOverlay"),i&&!(i.length<1)))for(r=0,e=i.length;r<e;r++)f=t(i[r]),f&&f.set_style({"max-width":"none"})},a.prototype.registerFilterEventHandlers=function(n){var o=n.getElementsByClassName("filterOption"),r,u,f,i,t,e;for(this._bindFiltersV2(o),r=n.getElementsByClassName("b_toggle"),t=0,u=r.length;t<u;t++)f=r[t],sj_be(f,"click",function(n){sj_pd(n)});if(i=n.getElementsByClassName("toggleFilter"),i&&i.length)for(this._bindFiltersV2(i),t=0;t<i.length;t++)sj_be(i[t],"click",function(n){n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation&&n.stopImmediatePropagation())});e=n.getElementsByClassName("b_filterCtrl");this._bindMultiselectFilters(e)},a.prototype._priceRangeFilterHandler=function(){var n=this,i=function(i){var s=t(".flt_scale_current"),l=s&&s.get_attr("data-href"),a,p,w,v,b;if(s&&l&&!(l.indexOf("realestate")<0)){a=0;a=i[1]?i[1]:_w.priceFilterPrice;var k=_w.minFilterPrice?_w.minFilterPrice:0,d=_w.minPermissibleFilterPrice,g=_w.maxPermissibleFilterPrice,y="mso:real_estate.house.price_limit",c=s.get_attr("data-filterkey"),o=n._getParamterValue("filters",l),u=n.extractLocalFilterArgs(o,"gsfilter%3a","%22"),r="";u&&u.length&&(r=n._base64Decode(decodeURIComponent(u)),p=r.indexOf(c),p>-1&&(w=new RegExp(c.concat("=[0-9]+-[0-9]+;?"),"g"),r=r.replace(w,"")));r&&r.lastIndexOf(";")!==r.length-1&&(r=r.concat(";"));r.indexOf(y)<0&&(r=r.concat(y,"=",d,"-",g,";"));r=r.concat(c,"=",k.toString(),"-",a.toString());o=u&&u.length?o.replace(u,n._base64Encode(r)):o.concat("+gsfilter%3a%22",n._base64Encode(r),"%22");n.onFilterValueChanged(decodeURIComponent(o).replace(/\+/g," "));v=n.getInstrumentationFilterValue(c);v&&(b={logData:{feature:"FSB",action:"SE",data:{Q:n._taskState.query,FT:v,FA:n._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(n.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,b))}};sj_evt.unbind("priceFilterUpdate",i);sj_evt.bind("priceFilterUpdate",i)},a.prototype._logShoppingButtonShown=function(){var t,n,i;this.panelRoot&&(t=this.panelRoot.select(".listing-shopping-button"),t&&t.length>0&&(n=Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger,n&&n.logObject&&(i={feature:"Shopping",action:"ShoppingButtonShown",data:{}},n.logObject(i,this._getImpressionGuid()))))},a.prototype._logAutosButtonShown=function(){var t,n,i;this.panelRoot&&(t=this.panelRoot.select(".listing-autodealers-button"),t&&t.length>0&&(n=Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger,n&&n.logObject&&(i={feature:"Autos",action:"AutosButtonShown",data:{}},n.logObject(i,this._getImpressionGuid()))))},a.prototype._base64Decode=function(n){return _w?_w.atob(n):""},a.prototype._base64Encode=function(n){return _w?_w.btoa(n):""},a.prototype._getParamterValue=function(n,t){if(!t)return null;n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?i[2]:"":null},a.prototype._moveComparePanelToSortbar=function(){var r,u,f,e;n.showInlineFilters&&(r=this.panelRoot.select(".cmp_panel"),u=this.panelRoot.select("#LayoutSortBar"),r&&r.length>0?u&&u.length>0?u[0].appendChild(r[0]):(f=t(".filter_sort_separator_line"),c.dynamicProperties.market.toLowerCase().indexOf("ja-jp")>-1&&f.length>0?(e=i.createElementWithClassName("div","bm_sortBar bm_filterBarItem"),e.appendChild(r[0]),f.getParent().append(e)):r.set_style({display:"none"})):r.set_style({display:"none"}))},a.prototype.registerFilterBarSwitchQueryEventHandlers=function(){var i=this,s,l=n.showInlineFilters?".overlaylistingheader":"#bm_contextualTaskbar",r=this.panelRoot.select(l+" .bm_searchSwitch a[data-switchquery]"),c,o;if(this.getFilters()&&(c=((s=this.viewModel)===null||s===void 0?void 0:s.isTaskOnItinerarySlideout(this._taskState))?t(".stickyFiltersRoot.slideout"):t(".stickyFiltersRoot"),r=c.select(".bm_searchSwitch a[data-switchquery]")),r&&r.length>0)for(o=0;o<r.length;o++)r[o].addEventListener("click",function(n){var r,a,t,o,s,c,l;n.preventDefault();r=n.currentTarget.getAttribute("data-switchquery");r&&(i._taskState.localFilters=i._getCategoryOrSegment()==="house"?i.decodeHtmlEncoding(n.currentTarget.getAttribute("data-filterparams")):null,i._taskState.query=r,i._taskState.rootKeyword=r,a={logData:{feature:"FSB",action:"SE",data:{Q:i._taskState.query,FT:5,IS:!0}},impressionGuid:h.getImpressionGuid(i.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,a),i.viewModel&&i.viewModel.resetServerPagination&&i.viewModel.resetServerPagination(),i._dateFilterChanged?(t=_w.LocalStorageHelper,t?(o=t.getItem("ol_startdate"),s=t.getItem("ol_enddate"),c=t.getItem("hpa_roomnum"),i._resetFilterStates(),t.setItem("ol_startdate",o,1),t.setItem("ol_enddate",s,1),t.setItem("hpa_roomnum",c,1)):(o=_w.ol_startdate,s=_w.ol_enddate,c=_w.hpa_roomnum,i._resetFilterStates,_w.ol_startdate=o,_w.ol_enddate=s,_w.hpa_roomnum=c)):i._resetFilterStates(),i._closeChildTasks(),i._refresh({forceLogAsLocalListingTask:!0,forceLoggingEntryPoint:u.QuerySwitch}),i.poiManager.setPrimitives([]),l=i._getCategoryOrSegment(),l&&i._categories.remove(l),i._resetMicropois(),i._requestMicroPoiRefresh(i._getTaskState()))})},a.prototype.logInstrumentationEventForServerRenderedFilter=function(n,t){t===void 0&&(t=null);var i=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.className,r=i==="ftrPr"?1:i==="ftrRt"?2:0,u=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.parentElement&&n.currentTarget.parentElement.parentElement.getAttribute("data-filterkey"),o={logData:{feature:"FSB",action:"SE",data:{Q:this._taskState.query,FT:r,FA:this._taskState.localFilters,IS:!0,CK:u}},impressionGuid:h.getImpressionGuid(this.panelRoot)||t};e.invokeHandler(f.instrumentationDataHandlerKey,o)},a.prototype._resetFilterStates=function(){this._taskState.localFilters=""},a.prototype._processLocalTopicLinks=function(){var i=this,n;this.panelRoot&&this.id&&(n=this.panelRoot.select("div[class=topicsModuleContainer]"),n&&n.length&&n.for_each(function(n){var r=t(n).select("a[data-process]");r&&r.length&&r.for_each(function(n){var u=n.getAttribute("data-process"),r=u&&t.Internals.parseJSON(u);r&&(r.requestorId=i.id,n.setAttribute("data-process",t.Internals.stringify(r)))})}))},a.prototype._registerNoResultResetFiltersClickHandler=function(){var t=this,i,r;this.panelRoot&&(i=this.panelRoot.select("div[data-answerinfo]"),i&&i.length&&i.get_attr("data-answerinfo")==="0"&&(r=n.useNewErrorCard?this.panelRoot.select(".bm_resetButtonOverlay"):this.panelRoot.select(".bm_resetButton"),r&&r.length&&r.add_event("click",function(n){n&&n.preventDefault();t._resetFilterStates();t._categories&&t._categories.length>0&&t._updateCategories("updateFilters",t._taskState.localFilters);t.viewModel&&t.viewModel.resetServerPagination&&t.viewModel.resetServerPagination();o.prototype._refreshWithDelay.call(t,{mapPannedOrZooomed:!0})})))},a.prototype._setFocusToClickedSortOptionIfApplicable=function(){if(this._sortOptionClickedToReloadContent){var n=this.panelRoot.select(".selectedSortOption");n&&n.length>0&&n[0].focus();this._sortOptionClickedToReloadContent=!1}},a.prototype._bindFiltersV2=function(n){var t=this,r,u,i;if(n&&n.length)for(r=0,u=n.length;r<u;r++)(i=n[r],i.className&&i.className.indexOf("selectedSortOption")>=0)||(i.firstElementChild&&i.firstElementChild.classList&&i.firstElementChild.classList.contains("dropdown-range")?sj_be(i,"click",function(n){var r,c,l,s,h,b,g,y,p;if(n.currentTarget&&(r=n.currentTarget,r.parentElement&&r.parentElement.parentElement&&r.firstElementChild)&&(c=r.parentElement.getAttribute("id"),c)){var w=c.indexOf("_min")>-1,u=r.parentElement.parentElement,e=u&&u.getAttribute("data-filterkey");if(u&&e&&!(e.indexOf("real_estate")<0)&&(l=u.getAttribute("parent-id"),l)&&(s=u.previousElementSibling,s)&&(s.classList.add("adv_clicked"),h=s&&u.previousElementSibling.getElementsByClassName("fs_label"),h&&h.length)){b=h[0];b.innerHTML=r.firstElementChild.innerText;var k=_ge(l),a=k&&k.getElementsByClassName(w?"max-filter":"min-filter"),v=a&&a.length&&a[0].getElementsByClassName("b_toggle b_selected");if(v&&v.length){var d=v[0].parentElement,o=d.getAttribute("data-filterparam"),f=t.extractLocalFilterArgs(o,"gsfilter:","&quot;"),i="";f&&f.length&&(i=t._base64Decode(f),i.indexOf(e)>-1&&(g=new RegExp(";?"+e.concat("=[0-9]+(-[0-9]+;)?"),"g"),i=i.replace(g,"")));i&&(i=i.concat(";"));i=i.concat(e,"=");y=(parseInt(r.firstElementChild.innerText)||0).toString();p=(parseInt(d.firstElementChild.textContent)||0).toString();i=w?i.concat(y,"-",p):i.concat(p,"-",y);o=f&&f.length?o.replace(f,t._base64Encode(i)):o.concat(" gsfilter:&quot;",t._base64Encode(i),"&quot;");t.onFilterValueChanged(t.decodeHtmlEncoding(o));t.logInstrumentationEventForServerRenderedFilter(n)}}}}):sj_be(i,"click",function(n){var u=n.currentTarget.getAttribute("data-filterParam"),i,f,e,r;if(u||(u=n.currentTarget.getAttribute("data-url-params")),i=t.decodeHtmlEncoding(u),typeof i!="undefined"){f=t._taskState.localFilters;i.indexOf("hotel_filters:")>-1&&i.indexOf("local_filters")===-1&&(e=/(local_filters:"[,\w]+")/,r=e.exec(f),r&&r.length>0&&(i+=" "+r[0]));t.onFilterValueChanged(i);t.logInstrumentationEventForServerRenderedFilter(n)}}),sj_be(i,"keydown",function(n){var i=n.which;(i===13||i===32)&&(event.currentTarget.className.indexOf("bm_sortOption")>=0&&(t._sortOptionClickedToReloadContent=!0),n.currentTarget.click&&n.currentTarget.click())}))},a.prototype._bindMultiselectFilters=function(n){for(var r,i,t=0;t<n.length;t++)r="",i=n[t].getElementsByClassName("b_filterOverlay"),i&&i.length>0&&(r=i[0].getAttribute("data-filterkey")),this._bindMultiselectFilterForId(n[t].id,r)},a.prototype._bindMultiselectFilterForId=function(n,i){var r=this;sj_evt.bind("filterItems_selected",function(u){var ft,g,nt,l,p,tt,et,v,ot,c,a,w,y,it,st,ht;if(u[1]&&u[1].FilterControlId===n){k.setStartTime(r.id);var rt=u[1],ct=rt.FilterControlId,s=rt.SelectedFilterItemIds,o="";if(s&&s.length>0){if(o=t("#"+s[0]).get_attr("data-filterparam"),s.length>1)if(o.indexOf("realestate")>-1){var b="",ut="gsfilter:",d=r.extractLocalFilterArgs(o,ut);if(!d)return;for(ft=r._base64Decode(d),c=1;c<s.length;c++)(g=t("#"+s[c]),a=g&&g.get_attr("data-filterparam"),a)&&(nt=r.extractLocalFilterArgs(a,ut),l=nt&&r._base64Decode(nt),l)&&(p=l.indexOf(i),tt=l.indexOf(";",p),l=tt===-1?l.substring(p):l.substring(p,tt),b=b.concat(l,";"));et=r._base64Encode(b+ft);o=o.replace(d,et)}else{for(v=r.extractLocalFilterArgs(o),ot=v.join(","),c=1;c<s.length;c++)for(a=t("#"+s[c]).get_attr("data-filterparam"),w=r.extractLocalFilterArgs(a),y=0;y<w.length;y++)v.indexOf(w[y])===-1&&v.push(w[y]);o=o.replace(ot,v.join(","))}}else o=t("#fo_"+ct).get_attr("data-nofilterparam");o=r.decodeHtmlEncoding(o);r.onFilterValueChanged(o);it=r.getInstrumentationFilterValue(i);it&&(st={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:it,FA:r._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(r.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,st));ht={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:6,FA:r._taskState.localFilters,IS:!0,CK:i}},impressionGuid:h.getImpressionGuid(r.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,ht)}})},a.prototype.getInstrumentationFilterValue=function(n){switch(n){case"mso:real_estate.house.house_type":return"ftrD_Type";case"mso:real_estate.house.built_date_min":return"ftrD_Built_After";case"mso:real_estate.house.listing_status":return"ftrD_Listing_Status";case"mso:real_estate.house.price_range":return"ftrD_Price_Range";default:return""}},a.prototype.extractLocalFilterArgs=function(n,t,i){var f,u,r;return(t===void 0&&(t=""),i===void 0&&(i="&quot;"),!n)?[]:(t||(t="local_filters:"),t=t+i,f=n,u=f.indexOf(t)+t.length,u===t.length-1)?[]:(r=f.substr(u),u=r.indexOf(i),u===-1)?[]:(r=r.substr(0,u),r.length===0)?[]:f.indexOf("realestate")>-1?r:r.split(",")},a.prototype.decodeHtmlEncoding=function(n){var t=sj_ce("textarea");return t.innerHTML=n,t.value},a.prototype._onPoiViewStateChanged=function(t,r){var k=this,o=t.primitive.entity,h,c,p,b,y;if(o){h=this.pageProcessor.getListItem(o.id);this._logPoiHoverIfNecessary(t,u.LocalListing,r);switch(t.newValue){case 1:if(this.viewModel&&this.viewModel.loadDelayedListingImagesInPagination(),c=t.primitive,r?(p=this._defaultInfoboxContentsTemplate.replace("{title}",o.getTitle()),this.activateInfobox(c,p,!0)):this.activateInfobox(c),Microsoft.Maps.setTimeout(function(){k._registerInfoboxClickHandler(o,r)},n.enableRichInfoBox?151:501),this._taskState&&typeof this._taskState.scrollListOnPoiHover!="undefined"&&!this._taskState.scrollListOnPoiHover)return;this._contextMenuOnListMode&&this._hideListItemContextMenu();this.viewModel.getResponseContainer().add_class(a._hoverClassName);break;case 2:if(o.id){h&&(this.viewModel.getResponseContainer().remove_class(a._hoverClassName),h.remove_class(a._hoverClassName));var d=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),w=this._getPoiLocalTaskState(o,u.POI),v=this.viewModel.isTaskOnItinerarySlideout(this._taskState);v&&(w.listingTaskId=this.id);b={parentId:v?this._taskState.parentTaskId:this.id,saveSlideoutTask:v};e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:w,activateOptions:b});this._logPoiClick(o,r);this._setSelectedPrimitive(t.primitive);n.enableRichInfoBox&&l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1})}else o.infoboxAdLink&&(y=o.infoboxAdLink,_w.si_ct&&_w.si_ct(y,!1,null),_w.open(y.href,"_blank"));break;case 0:if(l.mouseoverTimeout===0&&(l.mouseoverTimeout=500),window.clearTimeout(l.mouseoverDelayHandle),l.mouseoverDelayHandle=window.setTimeout(function(){l.mapsInfobox&&(l.mapsInfobox.preventAutoClose||l.mapsInfobox.setOptions({visible:!1}))},n.enableRichInfoBox?l.mouseoverTimeout/2:l.mouseoverTimeout),h){if(i._getIsSlideCardEnabled()&&this._taskState.selectedEntityId&&h===this.pageProcessor.getListItem(this._taskState.selectedEntityId))break;this.viewModel.getResponseContainer().remove_class(a._hoverClassName);h.remove_class(a._hoverClassName)}}}},a.prototype._registerInfoboxClickHandler=function(n,i){var o=this,h=t(".infoBoxLink");h&&(h.set_attr("aria-label",r.InfoboxListAriaLabel),h.set_style({cursor:"pointer"}),h.add_event("click",function(t){var h=o._getPoiLocalTaskState(n,u.Infobox),r=o.viewModel.isTaskOnItinerarySlideout(o._taskState),c;r&&(h.listingTaskId=o.id);c={parentId:r?o._taskState.parentTaskId:o.id,saveSlideoutTask:r};e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:h,activateOptions:c});o._logInfoboxClick(n,i);t&&(t.preventDefault&&t.preventDefault(),t.stopImmediatePropagation&&t.stopImmediatePropagation())}))},a.prototype._getPoiLocalTaskState=function(t,r){var u=this._taskState,s=this.viewModel.getResponseContainer(),a=s.select("a[data-productrootkeyword]").get_attr("data-productrootkeyword"),e=this.pageProcessor,c=e.getCatId(s),f={entryPoint:r.toString(),id:t.id,flippingCard:!0,taskTitle:t.getTitle(),selectedCategoryId:c?c:t.getSelectedCategoryForIcon&&t.getSelectedCategoryForIcon(),originIG:u&&u.originIG,parentIG:e.getImpressionGuidFromEntity(this._getImpressionGuid(),t.id),iid:e.iids&&e.iids[t.id],searchQueryCategory:u&&u.searchQueryCategory,listingCategoryPath:this.pageProcessor.getListingCategoryPath(s),asName:t&&t.getTitle&&t.getTitle(),asFormattedAddress:t&&t.getAddress&&t.getAddress(),productRootKeyword:a},l,o,h;return n.passListFormToDetails&&u&&u.formCode&&(f.formCode=u.formCode),l=t.id.indexOf("eventId")>-1,l&&(o=t.getLocation(),h=t.getCity(),o&&(f.latLongForEventRequery=o.latitude+","+o.longitude,f.locationForEventRequery=h?h:"undefined")),t instanceof ni&&(f.localFilters=t.getLocalFilters()),i._updateSearchTaskStateWithAdsData(f,t),f},a.prototype._updateStateWithQueryParseData=function(){var r=this,u=this.panelRoot.select("div[data-queryparse]"),f,i,e;u&&u.length===1&&(f=u[0].getAttribute("data-queryparse"),f&&(i=t.Internals.parseJSON(f),i&&(i.queryKeyword&&(this._queryKeyword=i.queryKeyword.trim(),this._getTaskState().query=this._queryKeyword,this.setTitle(this._queryKeyword),this._initialTitle=this._queryKeyword,this._updateCategories("updateQuery"),e=this.poiManager,e&&e.labelsRendered.addOne(function(){r._taskState.mapBounds=r._getLocalMapViewBounds();r.serializableObjectChanged.invoke({magnitude:0})})),i.spellerCorrectedQuery&&(this._getTaskState().spellerCorrectedQuery=i.spellerCorrectedQuery),i.queryLocation&&(this._getTaskState().queryParseLocation=i.queryLocation),n.bypassMicropoiWorkaround?this._getTaskState().microPoiRequestIsAllowed=i.microPoiRequestIsAllowed:i.microPoiRequestIsAllowed&&(this._getTaskState().microPoiRequestIsAllowed=i.microPoiRequestIsAllowed),i.chainId&&(this._chainId=i.chainId),i.catId&&(this._catId=i.catId))))},a.prototype._logPoiClick=function(t,i,r){if(this._getTaskState()){var o=this._getTaskState().query||"",s=i?!0:!1,u=this._getlogData(t,o,s,"POI");u.impressionGuid=h.getImpressionGuid(this.panelRoot)||r;n.usePaginationIgForInstrumentingClicksInInfiniteScroll&&(u.impressionGuid=this.pageProcessor.getImpressionGuidFromEntity(u.impressionGuid,t.id));e.invokeHandler(f.instrumentationDataHandlerKey,u);this._logInstrumentationEventForEntityClick()}},a.prototype._logInfoboxClick=function(n,t){var r,o,i;this._getTaskState()&&(r=this._getTaskState().query||"",o=t?!0:!1);i=this._getlogData(n,r,o,u.Infobox);i.impressionGuid=h.getImpressionGuid(this.panelRoot);e.invokeHandler(f.instrumentationDataHandlerKey,i)},a.getSearchTypeFromEntity=function(n){var t=n;return t.getSelectedCategoryForIcon&&t.getSelectedCategoryForIcon()?t.getSelectedCategoryForIcon():t.getSearchCategory&&t.getSearchCategory()?t.getSearchCategory():t.getPrimaryCategoryName&&t.getPrimaryCategoryName()?t.getPrimaryCategoryName():t.getPrimaryCategoryPath&&t.getPrimaryCategoryPath()?t.getPrimaryCategoryPath():""},a.prototype._getlogData=function(n,t,i,r){return{logData:{feature:r,action:"C",data:{SRC:u.LocalListing,TYP:a.getSearchTypeFromEntity(n),LBL:n.getTitle?n.getTitle():"",ID:n.id,Q:t,BB:this._getLocalMapViewBounds(),MP:i}}}},a.prototype._updateSelectedPrimitiveById=function(n,t){for(var i,u=this.getMapPrimitives(),r=0;r<u.length;r++)if(i=u[r],i&&i.entity&&i.entity.id===n){this._taskState.selectedEntityId=null;this._setSelectedPrimitive(i,t);return}},a.prototype._setSelectedPrimitive=function(t,r){var f,u;if(this._taskState){if(this._taskState.selectedEntityId){if(this._taskState.selectedEntityId===t.entity.id)return;this._resetSelectedPrimitive()}i._getIsSlideCardEnabled()&&(f=this.panelRoot.select("a.listings-item.hover"),f&&f.length&&f.remove_class(a._hoverClassName),u=this.pageProcessor.getListItem(t.entity.id),u&&(this.viewModel.getResponseContainer().add_class(a._hoverClassName),u.add_class(a._hoverClassName),this.viewModel.isWaterfallListingsEnabled()&&(u.add_class(a._waterfallSelectedClassName),n.enableAutoScrollToSelectedListItem&&(!r||r&&!r.isInfiniteScroll)&&this._scrollToTargetForSelectedElement(u,this.getCurrentWidth()))));this._taskState.selectedEntityId=t.entity.id}},a.prototype._hideSelectedPrimitive=function(n){var t=this.viewModel.UpdatePrimitiveState(n,3);t&&(this.serializableObjectChanged.invoke({magnitude:0}),this.poiManager&&this.poiManager.invalidated.invoke())},a.prototype._resetSelectedPrimitive=function(){var n=this.viewModel.UpdatePrimitiveState(this._taskState.selectedEntityId,0);n&&this.poiManager.invalidated.invoke()},a.prototype._processItemClickEvent=function(n){for(var i=this.viewModel.getPushpinPrimitives(),t=0,r=i.length;t<r;t++)if(i[t].entity.id===n){this._setSelectedPrimitive(i[t]);break}this._logInstrumentationEventForEntityClick()},a.prototype.concatOverlayPrimitive=function(){this._contextMenuOnListMode?this._hideListItemContextMenu():o.prototype.concatOverlayPrimitive.call(this)},a.prototype.getSupportedSize=function(){return this.viewModel&&this.viewModel.isTaskOnItinerarySlideout(this._taskState)?[484]:[732,484]},a.prototype.getSlideoutSupportedSize=function(){return this.shouldResize()?[944,464]:[464]},a.prototype._hideListItemContextMenu=function(){this._contextMenuOnListMode=!1;this._contextMenuElement.removeFromParent();this._contextMenuElement=null},a.prototype._hideContextMenuForOtherListingTasks=function(){var n={requestorType:s.localListingTask,requestorId:this.id,type:s.localListingTask,requestState:{hideContextMenu:!0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n)},a.prototype._processContextMenuEvent=function(n,r){var u=this,e,f,o,s;for(this._contextMenuOnListMode&&this._hideListItemContextMenu(),this._hideContextMenuForOtherListingTasks(),this._contextMenu.hide(),e=this.viewModel.getPushpinPrimitives(),f=0,o=e.length;f<o;f++)e[f].entity.id===r&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),s=t(n.currentTarget),this._contextMenuOnListMode=!0,this._transientLensViewModel.buildMenu(e[f],s,function(t){u._contextMenuElement=i._createContextMenuElement(n);u._contextMenuElement.set_style({"pointer-events":"none"});t.appendTo(u._contextMenuElement);u.primitiveInteracted.invoke({action:1,element:u._contextMenuElement})}))},a.prototype._processSaveButtonClickEvent=function(i,r,f){var c=this.viewModel.getPushpinPrimitives(),y,e,s,o,a,p,l,h,w,v;if(c)for(this.viewModel.isTaskOnItinerarySlideout(this._taskState)&&i&&i.preventDefault(),y=function(){var y,v,w,b;if(c[h].entity.id===f){if(i.preventDefault&&i.preventDefault(),i.stopPropagation&&i.stopPropagation(),s=c[h].entity,!s)return{value:void 0};if(e.viewModel.isTaskOnItinerarySlideout(e._taskState)&&(r.classList.remove("savePlus"),r.classList.add("saveTick")),o=s.getLocation(),a=e.viewModel.isWaterfallListingsEnabled(),y=a?t(r):t(r.parentElement),a&&(v=y.select("div.collectionsPopOut"),w=y.select("img"),v&&v.length&&w&&w.length&&(b=n.enableScalingForWaterfallSaveButton?"30px":"20px",v.set_style({top:b}),v.add_event("mouseenter",function(){var t=v.get_sibling(-2);n.enableEnlargeImageOnHover&&t.add_class("cellHover");t.length>0&&t[0].firstChild.classList.add("hover")}),v.add_event("mouseleave",function(){var t=v.get_sibling(-2);n.enableEnlargeImageOnHover&&t.remove_class("cellHover");t.length>0&&t[0].firstChild.classList.remove("hover")}))),e._transientLensViewModel.getButtonGroupViewModel().setEntityData(s,{requestorType:"LocalListingTask",requestorId:e.id},y),!s||!o)return{value:void 0};p=(new si).getIsSignedIn();l={logData:{feature:"LC",action:"C",data:{AN:"CollectionsMenu",CP:o,EP:u.LocalListing}}};p?e._transientLensViewModel.getButtonGroupViewModel().collectionMenuButtonClicked(i,o,l,u.LocalListing):ri.isEditable?e._transientLensViewModel.getButtonGroupViewModel().saveWithTravelButtonClicked(i,o,l,u.LocalListing):e._transientLensViewModel.getButtonGroupViewModel().collectionButtonClicked(i,o,l,u.LocalListing);i.target&&i.target.classList.contains("bm_saveButton")&&i.target.setAttribute("aria-expanded","true")}},e=this,h=0,w=c.length;h<w;h++)if(v=y(),typeof v=="object")return v.value},a.prototype._shouldProcessResponseOnRefresh=function(n,t){var r=!!this._taskState.localFilters,u=t&&t.mapPannedOrZooomed;return o.prototype._shouldProcessResponseOnRefresh.call(this,n)||r&&!u||i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.scenarioKey==="ERR"},a.prototype._postRefresh=function(){sj_evt&&this.displayState&&this.displayState.prominence===1&&this.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",this.panelRoot,this.stackId)},a.prototype._requestMicroPoiRefresh=function(t){var u;if(t&&!(this._categories.length>0)&&!t.forceDisableMicroPoi){var f=this._isRestaurantMicropoiAllowed(t),e=this.viewModel.getCardCategoryId(),r=e==="School";n.bypassMicropoiWorkaround?(u=t.category&&i._isRestaurantCategory(t.category)||t.searchQueryCategory&&t.searchQueryCategory.indexOf("Restaurant")>-1||this instanceof bi,t.microPoiRequestIsAllowed&&u&&this._previousCatId!==this._catId&&(this._previousCatId=this._catId,this._microPoiManager&&this._microPoiManager.clearMicropoiData()),(t.microPoiRequestIsAllowed||u||r)&&this._microPoiManager&&this._microPoiManager.fetchMicroPois(t.query,this.getMapPrimitives(),u?t.microPoiRequestIsAllowed?null:"requestnotallowed":t.localFilters?t.localFilters:null,this._chainId,this._catId,r?"90199":e)):(t.microPoiRequestIsAllowed||r||f||this.microPoiRequestForLocalOverlayIsAllowed())&&this._microPoiManager&&this._microPoiManager.fetchMicroPois(t.query,this.getMapPrimitives(),t.localFilters&&!f?t.localFilters:f&&t.isFilterSelected?"filterselected":null,this._chainId,this._catId,r?"90199":e)}},a.prototype._isRestaurantMicropoiAllowed=function(n){var r=this._getCategoryOrSegment(),t;return r&&r.toLowerCase().indexOf("testinglocation")>-1?!1:n&&n.entryPoint===u.ServerPagination?!0:(t=this.viewModel.getEntities(),(t&&t.length>=15||this._chainId)&&(n.isFallbackRequery&&(n.category&&i._isRestaurantCategory(n.category)||n.searchQueryCategory&&n.searchQueryCategory.indexOf("Restaurant")>-1)||this instanceof bi))?(this._catId||(this._catId="90287"),!0):!1},a.prototype._onCategoriesChanged=function(n){var c,l,o,t,s,r;if(n.added&&this._taskState)for(t=0,s=n.added.length;t<s;t++)r=n.added[t],c=r,i._isHotelsCategory(r)&&(c="hotel"),l=this._taskState.query,(hr.useRootQueryInitially[c]||hr.useRootQueryAlways)&&this._taskState.rootKeyword&&(l=this._taskState.rootKeyword),o=i._isLocalOrRealEstateScenarioOverlayShownOnSerp()?this._taskState.localFilters||this._taskState.filterUrlParam:this._taskState.localFilters,i._isAttractionCategory(r)&&(o=o?o+' tsource:"attraction"':'tsource:"attraction"'),e.invokeHandler(f.layerManagerDataHandlerKey,{action:"activateLayer",entryPoint:u.LocalListing,taskId:this.id,parentTaskId:this._taskState.parentTaskId,queryText:l,category:r,displayState:this.displayState,filters:o,cacheId:this._taskState.cacheId,mapBounds:this._taskState.mapBounds,routePoints:null,taskEntities:this.viewModel.getEntities(),disableRefresh:this._taskState.disableListingRefresh,impressionGuid:h.getImpressionGuid(this.panelRoot),poiManager:this.poiManager});if(n.removed)for(t=0,s=n.removed.length;t<s;t++)r=n.removed[t],e.invokeHandler(f.layerManagerDataHandlerKey,{action:"removeLayer",category:r,taskId:this.id,impressionGuid:h.getImpressionGuid(this.panelRoot)})},a.prototype._updateCategories=function(n,t,i,r){for(var o=0,s=this._categories.length;o<s;o++)e.invokeHandler(f.layerManagerDataHandlerKey,{action:n,entryPoint:u.LocalListing,taskId:this.id,displayState:i,filters:t,category:this._categories[o],queryText:this._taskState.query,taskEntities:r,impressionGuid:h.getImpressionGuid(this.panelRoot)})},a.prototype._drawBoundary=function(){var t=this,n=this.panelRoot.select("div[data-vdpid]").get_attr("data-vdpid")||this._taskState&&this._taskState.vdpid,i=!1;if(n&&this._taskState){if(n===a._clearAttributeValue&&this._polygonLayerAdded&&this._cityPolygonManager){this._cityPolygonManager.removeLayer();this._polygonLayerAdded=!1;return}this._taskState.vdpid&&this._taskState.vdpid!==n&&(i=!0);this._taskState.vdpid=n}this._taskState&&this._taskState.vdpid&&this._taskState.vdpid!==a._clearAttributeValue&&(!this._polygonLayerAdded||i)&&(this._polygonLayerAdded&&this._cityPolygonManager&&this._cityPolygonManager.removeLayer(),this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){t.disposables.push(t._cityPolygonManager=n);n.addLayer(t._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0)},a.prototype._getPivotEntityForTask=function(){var t=this._taskState.pivotEntity=this._taskState.pivotEntity||this.panelRoot.select("div[data-pivot]").get_attr("data-pivot"),i=this._getNormalizedPivotEntity(t),n;return w.nearbyListingButtonsEnabled&&(!t||i&&!i.name)&&this._taskState.nearbyPivotEntity&&(n=this._taskState.nearbyPivotEntity,t={name:n.title,id:n.id,idType:n.idType,location:n.location}),t},a.prototype._setPivotPrimitive=function(){var i=this._getPivotEntityForTask(),n,r,u;if(i&&this.poiManager){if(i===a._clearAttributeValue){this.poiManager.setPivotPrimitive(null);return}typeof i=="string"&&(i=this._taskState.pivotEntity=t.Internals.parseJSON(i));n=i;n&&n.name&&n.idType&&n.id&&n.location&&n.location.latitude&&n.location.longitude&&!isNaN(n.location.latitude)&&!isNaN(n.location.longitude)&&(r=new b(n.location.latitude,n.location.longitude),u=new ni(n.name,null,n.idType+":"+n.id,r,r),u.setSearchCategory("PivotEntity"),u.setSelectedCategoryForIcon("PivotEntity"),this.poiManager.setPivotPrimitive(new hi(r,u)))}},a.prototype._setDisableListingRefresh=function(t){var i,r;this._taskState.disableListingRefresh!==!1&&this._taskState.scenarioKey==="EIC"&&(i=d.parseCategory(t),i=i&&i.toLowerCase(),n.enableListingRefreshCats&&n.enableListingRefreshCats.indexOf(i)>-1&&(this._taskState.disableListingRefresh=!1,r=this._queryKeyword||i,this._taskState.query=this._taskState.taskTitle=r,this._initialTitle=r,this.setTitle(r)))},a.prototype._getPoiCountParam=function(){var n="";return this._taskState&&this._taskState.poiCount!==null&&(n=this._taskState.poiCount),n},a.prototype._addBackButton=function(){if(this.viewModel.isTaskOnItinerarySlideout(this._taskState)){var n=i.shouldLeftLaneBeHidden();n&&(this.showCloseButton=!1,this.setBackButtonText(r.L_LocalSearch_ReturnToItinerary))}},a._clearAttributeValue="nodata",a._hoverClassName="hover",a._waterfallSelectedClassName="wfrselected",a._polygonMinZoomLevel=3,a._polygonMaxZoomLevel=11,a}(l),tr=function(r){function u(n,t,i,u,f,e,o,s){var h=r.call(this,n,t,i,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return y(u,r),u.prototype.activate=function(n,i,u,f){var e=this,o=this._taskState&&this._taskState.isCompareOverlayOpen,s=i&&i.isCompareOverlayOpen;if(o&&!s){sj_evt.fire("ovlHide","ent_ovlc",!0);return}this._compareOverlayShowHandlerWrapper||(this._compareOverlayShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._compareOverlayShowHandler.apply(e,t[0])},sj_evt.bind("ovlShow",this._compareOverlayShowHandlerWrapper,0));this._compareOverlayHideHandlerWrapper||(this._compareOverlayHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._compareOverlayHideHandler.apply(e,t[0])},sj_evt.bind("ovlHide",this._compareOverlayHideHandlerWrapper,0));this._layoutChangedHandler||(this._layoutChangedHandler=function(n){n[1]==="MultiCardLeftSelectionLayout"?e._filterOverlays=e._removeFilterOverlays():n[1]==="MultiCardLeftLayout"&&e._filterOverlays&&e._filterOverlays.length>0&&Microsoft.Maps.setTimeout(function(){var i=document.getElementsByClassName("taskLayoutContainer"),n,r,u;if(i&&i.length>0)for(n=0,r=e._filterOverlays.length;n<r;n++)u=e._filterOverlays[n],t(i[0]).append(u);e._filterOverlays=null},1e3)},sj_evt.bind("layoutChanged",this._layoutChangedHandler));r.prototype.activate.call(this,n,i,null,f)},u.prototype.deactivate=function(){this._removeFilterOverlays();sj_evt&&sj_evt.unbind("layoutChanged",this._layoutChangedHandler);r.prototype.deactivate.call(this)},u.prototype._refresh=function(n){n&&n.mapPannedOrZooomed&&this._taskState.locationFilter&&(this._taskState.locationFilter=null,this._updateLocalFiltersForPricePoi(),this._updateCategoriesLayer("updateFilters",this._taskState.localFilters));r.prototype._refresh.call(this,n);i._isLocalOverlayShownOnSerp()&&n.isResearchOnOverlay&&this._updateCategoriesLayer("refreshData")},u.prototype.shouldResize=function(){return n.enabledCategoriesForResize.indexOf("hotel")>-1},u.prototype._updateCategoriesLayer=function(n,t){var r,u,o;if(this._categories&&this._categories.length>0)for(r=0,u=this._categories.length;r<u;r++)i._isHotelsCategory(this._categories[r])&&(o={action:n,taskId:this.id,parentTaskId:this._taskState.parentTaskId,category:this._categories[r],filters:t,queryText:this._taskState.query,impressionGuid:h.getImpressionGuid(this.panelRoot)},e.invokeHandler(f.layerManagerDataHandlerKey,o))},u.prototype._onWidthChanged=function(n,t){if(this.panelRoot){var i=this.panelRoot.select(".cmp_panel");t==240?i.set_style({display:"none"}):i.set_style({display:""});r.prototype._onWidthChanged.call(this,n,t)}},u.prototype._resetFilterStates=function(){if(r.prototype._resetFilterStates.call(this),n.showPricePoiHotelsOnOneMap){var t=_w.LocalStorageHelper;_w.priceFilterPrice=undefined;t?(t.removeItem("ol_startdate"),t.removeItem("ol_enddate"),t.removeItem("hpa_roomnum")):(_w.ol_startdate=null,_w.ol_enddate=null,_w.hpa_roomnum=null);this._taskState.locationFilter=null}},u.prototype._createUrl=function(i,u,f){var o,l,e,h;if(n.useNewListingSearchCount&&!f?f=n.listingSearchCount:(!f||f===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("Hotel")>-1&&this._isThreeColumnsOk(i)&&(f=21),this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1),this._updateLocalFiltersForPricePoi(),o=r.prototype._createUrl.call(this,i,u,f),i&&(i.filterValueChanged||i.mapPannedOrZooomed)&&(o+="&htlsource=overlayf"),n.useNewFormCode)l=Logger.getOverlayType(),l||(o+="&mapsVertical=true");else{var l=Logger.getOverlayType(),s=this._taskState.passThruParam;l?o+=this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?s&&s.indexOf("hotelCollectionOverlay=1")!==-1?"&FORM=HOTELC":"&FORM=BHO001":"&FORM=BHO002":(o+="&FORM=BHO003",o+="&mapsVertical=true")}if(s&&s.toUpperCase().indexOf("FORM=")===-1&&(o+=s.indexOf("&")!==0?"&"+s:s),this._taskState.cacheId&&(o+="&cacheid="+this._taskState.cacheId),this._taskState.pivotEntity){if(e=this._taskState.pivotEntity,typeof e=="string"&&e!==et._clearAttributeValue)try{e=t.Internals.parseJSON(e)}catch(a){}e=e;e&&e.id&&e.location&&e.location.latitude&&e.location.longitude&&(o+="&pivotinfo=".concat(e.id,"|").concat(e.location.latitude,"|").concat(e.location.longitude))}return this._taskState.hotelCompare&&(o+="&compsel=2"),this._taskState.hotelPrimerPois&&this._taskState.hotelPrimerPois.length>0&&(h="",this._taskState.hotelPrimerPois.forEach(function(n){h+=n.entity.id+","}),h=h.substr(0,h.length-1),h&&(o+="&hotelypids="+h),this._taskState.hotelPrimerPois=null),o},u.prototype._getFormCode=function(){var t=Logger.getOverlayType(),n=this._taskState.passThruParam;return t?this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?n&&n.indexOf("hotelCollectionOverlay=1")!==-1?"HOTELC":"BHO001":"BHO002":"BHO003"},u.prototype._getCacheId=function(){return""},u.prototype.onFilterValueChanged=function(n,t){var e,i,o,u,c,f,s,h;this._taskState.originIG&&(e=/GST(\d{1,2})/,i=e.exec(n),i&&i.length>1&&(o=i[1],u=e.exec(this._taskState.localFilters),u&&u.length>1&&(c=u[1],o!=c&&sj_evt.fire("VRGuestsFilterChanged_"+this._taskState.originIG,o))),n&&(f=n.match(/NumOfGuests-(\d)/),f&&f.length===2&&(s=f[1],h=_w.LocalStorageHelper,h?h.setItem("hpa_roomnum",s,1):_w.hpa_roomnum=s)));this._updateLocalFiltersForPricePoi(n);r.prototype.onFilterValueChanged.call(this,this._taskState.localFilters,t)},u.prototype.processResponse=function(i,u){var f,s,e,o,h;if(r.prototype.processResponse.call(this,i,u),this._taskState&&this.panelRoot&&(f=this.panelRoot.select("div[data-cacheid]"),f&&f.length===1&&(s=f[0].getAttribute("data-cacheid"),s&&(this._taskState.cacheId=s))),n.showInlineFilters&&(e=t(".infobubble_content .b_vPanel"),e))for(o=0;o<e.length;o++)h=e[o],h&&h.setAttribute("class","")},u.prototype.registerFilterBarEventHandlersV2=function(){var i=this.panelRoot.select("#bm_contextualTaskbar")[0]||this.panelRoot[0],u,n;this.getFilters()&&(u=t(".stickyFiltersRoot"),u.length>0&&(i=u[0]));i&&(this._processCalendarControl(),this._processPriceFilter(),n=i.getElementsByClassName("bm_filterBar")[0],n&&(_w.hpaFilter=n.getAttribute("fp"),this._processLocationFilter(n)));r.prototype.registerFilterBarEventHandlersV2.call(this);this._addDropdownClassToInlinedFilters()},u.prototype._getRequestUrlFormat=function(){return r.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},u.prototype._removeFilterOverlays=function(){var r,i,u,f;if(n.showInlineFilters&&(r=document.getElementsByClassName("taskLayoutContainer"),r&&r.length>0)){if(i=t(r[0]).select("[data-filterTaskId='"+this.id+"']"),i&&i.length>0)for(u=0,f=i.length;u<f;u++)t(i[u]).removeFromParent();return i}},u.prototype._addDropdownClassToInlinedFilters=function(){var r,i,u,f,e;if(n.showInlineFilters)for(r=this.panelRoot.select(".bm_filterBarItem .b_dropdown"),i=0,u=r.length;i<u;i++)f=r[i],e=t(f),e.add_class("bm_filterBarDropdown")},u.prototype._getPriceFilterFromUrlParam=function(){var n=this._taskState.filterUrlParam,i,t,u,r,f;if(n&&n.length>0&&(i=n.indexOf("LHP"),i>-1&&(t=n.indexOf("_",i),t>-1&&(u=n.substring(i+4,t),r=n.indexOf("_",t+1),r>-1))))return f=n.substring(t+5,r),"LHP-"+u+"_HHP-"+f},u.prototype._updateLocalFiltersForPricePoi=function(i){var f=_w.LocalStorageHelper,l=f?f.getItem("ol_startdate"):_w.ol_startdate,a=f?f.getItem("ol_enddate"):_w.ol_enddate,v,g,r,u,y,nt,tt,b,i,h,d;if(n.showPricePoiHotelsOnOneMap){if(this._taskState&&this._taskState.localFilters&&this._taskState.fromSharing){v=this._taskState.localFilters;this._saveDateFromFilters(v,"_SD-\\d{8}","ol_startdate");this._saveDateFromFilters(v,"_ED-\\d{8}","ol_enddate");this._taskState.fromSharing=!1;return}_w.ol_hdf=!0;g=null;_w.ol_startdate=this._getTaskStateStartDate()||l||g;_w.ol_enddate=this._getTaskStateEndDate()||a}if(r=i||this._taskState.localFilters||this._taskState.filterUrlParam,c.isMobile&&r&&(r.indexOf("hotel_filters")===0?(_w.mobile_hotel_filters=r,r=_w.mobile_local_filters):_w.mobile_local_filters=r),r?r.indexOf('local_filters:"UR')===-1&&r.indexOf(",UR")===-1&&(r=r.replace('local_filters:"','local_filters:"UR4U,')):r='local_filters:"UR4U"',_w.ol_hdf){if(u="",_w.priceFilterPrice?u="LHP-0_HHP-"+_w.priceFilterPrice.replace("+",""):(u=this._getPriceFilterFromUrlParam(),u||(u="")),y=!0,n.showInlineFilters){var p=void 0,w=void 0,e=void 0;if(e=this.getFilters()?t(".stickyFiltersRoot").select("[data-date]"):this.panelRoot.select("[data-date]"),e&&e.length===2&&(nt=e[0].getAttribute("data-date"),tt=e[1].getAttribute("data-date"),p=new Date(this._formatDate(nt)),w=new Date(this._formatDate(tt))),p&&w){var it="MMddyyyy",o=this._calendarFormatDate(p,it),s=this._calendarFormatDate(w,it);u=u?u+"_SD-"+o+"_ED-"+s:"SD-"+o+"_ED-"+s;y=!1}}if(y&&l&&a){var rt="MMddyyyy",ft=new Date(l),et=new Date(a),o=this._calendarFormatDate(ft,rt),s=this._calendarFormatDate(et,rt);u=u?u+"_SD-"+o+"_ED-"+s:"SD-"+o+"_ED-"+s}b=f?f.getItem("hpa_roomnum"):_w.hpa_roomnum;b&&(u+="_NumOfGuests-"+b);i=u?'hotel_filters:"'+u+'" segment:"Hotel"':'segment:"Hotel"';var k=/(local_filters:"[,\w]+")/.exec(r),ut=r.indexOf("hotel_filters");r=ut===-1?r+" "+i:r.slice(0,ut)+i;r&&r.indexOf("local_filters:")===-1&&k&&k.length>0&&(r+=" "+k[0]);_w.mobile_hotel_filters&&(r+=" "+_w.mobile_hotel_filters)}else r+=' segment:"Hotel"';this._taskState.locationFilter?r+=" "+this._taskState.locationFilter:_w.hotelLocationFilter&&(r+=" "+_w.hotelLocationFilter);r.indexOf("LocationFilterKey")===-1&&this.panelRoot&&(h=this.panelRoot.select("div[data-locationfilterkey]"),h&&h.length&&(d=h.get_attr("data-locationfilterkey"),d&&(r+=' LocationFilterKey:"'+d+'"')));this._taskState.localFilters=r},u.prototype._formatDate=function(t){return n.modifyIntlDateFormat&&t.indexOf(".")>-1&&(t=t.replace(/\./g,"/")),t},u.prototype._compareOverlayShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!0,this.serializableObjectChanged.invoke({magnitude:2}))},u.prototype._compareOverlayHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},u.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(t){var e,u;n.enableRichInfoBox&&l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1});var i=t[1],f=i.entity.id.replace("ypid:","").replace("sid:",""),r=_ge(f);r&&(e=new Microsoft.Maps.Location(i.geometry.y,i.geometry.x),u="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+r.innerHTML+"<\/div><\/a><\/div>",i.entity.infoboxHtml=u)})},u.prototype._processPriceFilter=function(){var n=this;this._priceChangeHandler&&sj_evt.unbind("priceFilterUpdate",this._priceChangeHandler);this._priceChangeHandler=function(){n.onFilterValueChanged(null);var t={logData:{feature:"FSB",action:"SE",data:{Q:n._taskState.query,FT:1,FA:n._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(n.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,t)};sj_evt.bind("priceFilterUpdate",this._priceChangeHandler)},u.prototype._processCalendarControl=function(){var i=this,r;this.panelRoot&&(r=void 0,r=this.getFilters()?t(".stickyFiltersRoot").select("div[data-calendarEndId]"):this.panelRoot.select("div[data-calendarEndId]"),r&&r.length&&(this._calendarEndId=r.get_attr("data-calendarEndId")));this._calendarEndId&&(this._calendarChangeHandler&&sj_evt.unbind("TwoCalCombo_EndDateClick",this._calendarChangeHandler),this._calendarChangeHandler=function(r){var u=_w.LocalStorageHelper,a=r[1],o,s,c,l;if(a==i._calendarEndId){n.showInlineFilters?(o=void 0,o=i.getFilters()?t(".stickyFiltersRoot").select("[data-date]"):i.panelRoot.select("[data-date]"),o&&o.length===2&&typeof DateHelper!="undefined"&&typeof DateHelper.parseDate!="undefined"&&(s=DateHelper.parseDate(o[0].getAttribute("data-date"),"mm/dd/yyyy").toJSON(),c=DateHelper.parseDate(o[1].getAttribute("data-date"),"mm/dd/yyyy").toJSON(),u?(u.setItem("ol_startdate",s,1),u.setItem("ol_enddate",c,1)):(_w.ol_startdate=s,_w.ol_enddate=c))):r&&r.length>=4&&r[2]&&r[3]&&(u?(u.setItem("ol_startdate",r[2].toJSON(),1),u.setItem("ol_enddate",r[3].toJSON(),1)):(_w.ol_startdate=r[2].toJSON(),_w.ol_enddate=r[3].toJSON()));i._dateFilterChanged=!0;i.onFilterValueChanged(null);l={logData:{feature:"FSB",action:"SE",data:{Q:i._taskState.query,FT:4,FA:i._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(i.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,l)}},sj_evt.bind("TwoCalCombo_EndDateClick",this._calendarChangeHandler))},u.prototype._processLocationFilter=function(i){var r=this,u=i.getElementsByClassName("catfOption"),o,s;if(u!=null&&u.length>0)for(o=0;o<u.length;o++)s=u[o],sj_be(s,"click",function(u){var a=u.currentTarget.getAttribute("data-filterParam"),c=r.decodeHtmlEncoding(a),o,s,l;if(c!=null){n.showInlineFilters&&i&&(o=void 0,o=r.getFilters()?t("#ftrD_Location",i):t(".bm_filterBarDropdown #ftrD_Location"),s=o.getParent(),s&&s.add_class("b_hide"));r._taskState.locationFilter=c;r._taskState.pivotEntity=null;r.onFilterValueChanged(null);l={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:7,FA:r._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(r.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,l)}})},u.prototype._getTaskStateStartDate=function(){return this._taskState&&this._taskState.startDate?this._validatedDateString(this._taskState.startDate):null},u.prototype._getTaskStateEndDate=function(){return this._taskState&&this._taskState.endDate?this._validatedDateString(this._taskState.endDate):null},u.prototype._validatedDateString=function(n){var t;try{if(n=this._formatDate(n),t=new Date(n),t){var i=t.getMonth(),r=t.getDate(),u=t.getFullYear();if(i>=0&&i<12&&r>0&&r<32&&u>2e3)return t.toDateString()}}catch(f){return null}return null},u.prototype._calendarFormatDate=function(n,t){var i=n.getMonth(),r=n.getDate();return t.replace(/yyyy/i,n.getFullYear().toString()).replace(/mm/i,(i<9?"0":"")+(i+1)).replace(/m/i,(i+1).toString()).replace(/dd/i,(r<10?"0":"")+r).replace(/d/i,r.toString())},u.prototype._saveDateFromFilters=function(n,t,i){var e=new RegExp(t,"i"),u=n.search(e),r,f;u>-1&&u+12<=n.length&&(r=n.substr(u+4,8),r&&r.length===8&&(f=this._convertFilterDate(r),f&&(_w[i]=f)))},u.prototype._convertFilterDate=function(n){var r;if(n&&n.length===8){n=this._formatDate(n);var t=parseInt(n.substr(0,2),10),i=parseInt(n.substr(2,2),10),u=parseInt(n.substr(4,4),10);return isNaN(t)||t<1||t>12||isNaN(i)||i>31||i<1||isNaN(u)?null:(r=new Date(u,t-1,i),r?r.toDateString():null)}return null},u.prototype._getSegmentParam=function(){return"hotel"},u.prototype._getTextAdsCode=function(){return n.enableHotelListBtTextAds?"hb":null},u}(et),he=function(i){function r(t,r,u,f,e,o,s,h,c){var l=i.call(this,t,r,u,f,e,o,s,h,c)||this;return l.setRecommendedWidth(n.houseCardWidth),l.setCurrentWidth(n.houseCardWidth),l._safariClassRemoved=!1,l}return y(r,i),r.prototype.getSupportedSize=function(){return[464]},r.prototype._getRequestUrlFormat=function(){return i.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},r.prototype.processResponse=function(n,t){var u,r,f;i.prototype.processResponse.call(this,n,t);u="data-interestdata";r=n&&n.select("[".concat(u,"]")).get_attr("id");r&&this.map&&(f="SubscriptionComponent_Init_".concat(r),sj_evt.fire(f));i.prototype._registerOverlayLinksForInstrumentation.call(this,".b_entityTP a","OverlayInteractions","CI.HouseLinksClick","REOverlayUrl")},r.prototype.deactivate=function(){if(i.prototype.deactivate.call(this),this._safariClassRemoved){var n=t(".taskLayoutContainer");n&&n.add_class("bm_safari");this._safariClassRemoved=!1}},r.prototype._getSegmentParam=function(){return"house"},r.prototype._getTextAdsCode=function(){return null},r}(it),pi=function(r){function u(n,t,i,u,f,e,o,s){var h=r.call(this,n,t,i,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return y(u,r),u.prototype._refresh=function(n){this.map.getMapType().id!==ei.birdseyeV2&&r.prototype._refresh.call(this,n)},u.prototype.activate=function(n,i,u,f){var e=this;this._layoutChangedHandler||(this._layoutChangedHandler=function(n){n[1]==="MultiCardLeftSelectionLayout"?e._filterOverlays=e._removeFilterOverlays():n[1]==="MultiCardLeftLayout"&&e._filterOverlays&&e._filterOverlays.length>0&&Microsoft.Maps.setTimeout(function(){var i=document.getElementsByClassName("taskLayoutContainer"),n,r,u;if(i&&i.length>0)for(n=0,r=e._filterOverlays.length;n<r;n++)u=e._filterOverlays[n],t(i[0]).append(u);e._filterOverlays=null},1e3)},sj_evt.bind("layoutChanged",this._layoutChangedHandler));this._setIsRealEstateTask();r.prototype.activate.call(this,n,i,null,f)},u.prototype.deactivate=function(){this._removeFilterOverlays();sj_evt&&sj_evt.unbind("layoutChanged",this._layoutChangedHandler);this._clearIsRealEstateTask();r.prototype.deactivate.call(this)},u.prototype.shouldResize=function(){return n.enabledCategoriesForResize.indexOf("house")>-1},u.prototype._createUrl=function(t,i,u){if(this._taskState){this._taskState.poiCount=n.useNewListingSearchCount?n.listingSearchCount.toString():"20";this._taskState.isFallbackRequery=!0;this._taskState.scrollListOnPoiHover=!1;this._taskState.spellerCorrectedQuery&&(this._taskState.localFilters?(this._taskState.localFilters.indexOf("tsource:")<0&&(this._taskState.localFilters+=' tsource:"realestate"'),this._taskState.localFilters.indexOf("segment:")<0&&(this._taskState.localFilters+=' segment:"generic.carousel"'),this._taskState.localFilters.indexOf("secq:")<0&&(this._taskState.localFilters+=' secq:"'+this._taskState.spellerCorrectedQuery+'"')):this._taskState.localFilters='tsource:"realestate" segment:"generic.carousel" secq:"'+this._taskState.spellerCorrectedQuery+'"');this._taskState.queryParseLocation&&(this._taskState.localFilters?this._taskState.localFilters.indexOf("loc:")<0&&(this._taskState.localFilters+=' loc:"'+this._taskState.queryParseLocation+'"'):this._taskState.localFilters='loc:"'+this._taskState.queryParseLocation+'"');var f=this._tryGetFlyoutParamFromUrl(document.location.search.toLowerCase());f&&(this._taskState.localFilters?this._taskState.localFilters.indexOf("flyout:")<0&&(this._taskState.localFilters+=' flyout:"1"'):this._taskState.localFilters='flyout:"1"')}return(!u||u===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("House")>-1&&this._isThreeColumnsOk(t)&&(u=18),r.prototype._createUrl.call(this,t,i,u)},u.prototype._tryGetFlyoutParamFromUrl=function(n){var i="flyout=",r,t,u;return!n||n.indexOf(i)===-1?!1:(r=n.indexOf(i)+i.length,r===n.length)?!1:(t=n.substring(r),u=t.indexOf("&"),u!==-1&&(t=t.substring(0,u)),t==="1")?!0:!1},u.prototype._getRequestUrlFormat=function(){return r.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},u.prototype.logInstrumentationEventForServerRenderedFilter=function(n){var t=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.id,i={logData:{feature:"FSB",action:"SE",data:{Q:this._taskState.query,FT:t,FA:this._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,i)},u.prototype.processResponse=function(n,t){this._setPreloadedInterestCguidForFollowControl(t);this._updateQueryParamsForSubscription(n);r.prototype.processResponse.call(this,n,t)},u.prototype._setPreloadedInterestCguidForFollowControl=function(n){var e,i,u,t,r,f;if((n===void 0&&(n={}),e=n.mapPannedOrZooomed||n.filterValueChanged,this._isSessionStorageSupported())&&(i="FollowControl",_w[i]=_w[i]||{},u=_w[i],t=this._getInterestCguidFromUrl(),t)){if(r="mapsShouldDisableFollowControlPreload",f="mapsPreloadedInterestCguid",e){u.preloadedInterestCguid=null;sessionStorage.setItem(r,"true");return}(sessionStorage.getItem(f)!==t||sessionStorage.getItem(r)!=="true")&&(u.preloadedInterestCguid=t,sessionStorage.setItem(f,t),sessionStorage.removeItem(r))}},u.prototype._isSessionStorageSupported=function(){if(typeof sessionStorage=="undefined")return!1;try{return sessionStorage.setItem("mapsSessionStorageTest",Math.random().toString()),sessionStorage.getItem("mapsSessionStorageTest"),sessionStorage.removeItem("mapsSessionStorageTest"),!0}catch(n){return!1}},u.prototype._getInterestCguidFromUrl=function(){var i=document.location.search.toLowerCase(),t=i.match(/icguid=([a-z0-9-]+)/),n;return t?(n=t[1],!n||n.length!==36)?null:n:null},u.prototype._updateQueryParamsForSubscription=function(n){var f=this,t="data-interestdata",i=n&&n.select("[".concat(t,"]")).get_attr("id"),r="data-interest-json",u=n&&n.select("[".concat(r,"]")).get_attr("id");(i||u)&&this.map&&this.poiManager&&this.disposables.push(this.poiManager.labelsRendered.addOne(function(){var o=ot.getMapCenter(f.map),e=ot.getMercatorZoomLevel(f.map),h=_ge(u),v=document.getElementById(i),y,n,c,l,p,a,s,w;if(h){y=h.getAttribute(r);try{n=JSON.parse(y)}catch(b){}if(!n||!n.Filters||!o)return;n.Filters.MapZoomLevel=e;c=o.latitude;l=o.longitude;!isNaN(c)&&!isNaN(l)&&Math.abs(c)<=90&&Math.abs(l)<=180&&(n.Filters.MapCenterPointLat=c,n.Filters.MapCenterPointLong=l);h.setAttribute(r,JSON.stringify(n));e>=12&&e<=20?(p="init_"+u,sj_evt.fire(p)):(a=sj_fa(h,".fc-sec"),a&&a.parentNode.removeChild(a))}else v&&(s=v.getAttribute(t),s&&(s+=";"),s+="cp:".concat(o.latitude,"~").concat(o.longitude,";lvl:").concat(e),v.setAttribute(t,s),e>=12&&e<=20&&(w="SubscriptionComponent_Init_".concat(i),sj_evt.fire(w)))}))},u.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(n){var t=n[1],u=t.entity.id.replace("ypid:","").replace("sid:",""),i=_ge(u),f,r;i&&(f=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),r="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+i.innerHTML+"<\/div><\/a><\/div>",t.entity.infoboxHtml=r)})},u.prototype._getSegmentParam=function(){return"house"},u.prototype._getTextAdsCode=function(){return null},u.prototype.registerFilterBarEventHandlersV2=function(){r.prototype.registerFilterBarEventHandlersV2.call(this);this._changePositionOfFilterOverlays()},u.prototype._removeFilterOverlays=function(){var r,i,u,f;if(n.showInlineFilters&&n.advancedFiltersEnabledForRE&&(r=document.getElementsByClassName("taskLayoutContainer"),r&&r.length>0)){if(i=t(r[0]).select("[data-filterTaskId='"+this.id+"']"),i&&i.length>0)for(u=0,f=i.length;u<f;u++)t(i[u]).removeFromParent();return i}},u.prototype._changePositionOfFilterOverlays=function(){var t=this,r;if(n.showInlineFilters&&n.advancedFiltersEnabledForRE)Microsoft.Maps.setTimeout(function(){t._removeFilterOverlays();var n=i.getVerticalTaskBarWidth(),r=32,u=document.getElementsByClassName("taskLayoutContainer"),f=t.panelRoot.select(".b_filterOverlay"),e=t.panelRoot.select(".bm_filterBarItem .b_dropdown");t._changeFilterPositions(u,f,n,r);t._changeFilterPositions(u,e,n,r-10)},1e3);else if(n.showInlineFilters){var f=15,u=this.panelRoot.select(".bm_filterBarItem .ftrH"),e=function(n){var t=u[n];u[n].addEventListener("click",function(){Microsoft.Maps.setTimeout(function(){var n=t.nextElementSibling;if(n){var e=document.getElementsByClassName("bm_scrollbarMask"),i=e[0].getBoundingClientRect(),r=n.getBoundingClientRect(),u=r.left+r.width-(i.left+i.width-f);u>0&&(n.style.marginLeft=-u+"px")}},100)})};for(r=0;r<u.length;r++)e(r)}},u.prototype._changeFilterPositions=function(n,i,r,u){var e,s,f,h;if(n&&n.length>0&&i&&i.length>0)for(e=0,s=i.length;e<s;e++)if(f=i[e],h=f.getAttribute("data-filterkey")==="mso:real_estate.house.sort",!(f.id.indexOf("maxd")>-1)&&!(f.id.indexOf("mind")>-1)){var o=t(f),l=f.parentElement,c=l.getBoundingClientRect();o.set_style({"z-index":1e4,left:c.left-r,top:c.top+u+(h?10:0)});this.id&&o.set_attr("data-filterTaskId",this.id);o.add_class("advanceFilters");t(n[0]).append(f)}},u.prototype._setIsRealEstateTask=function(){this.poiManager&&this.poiManager.setIsRealEstateTask&&this.poiManager.setIsRealEstateTask(!0)},u.prototype._clearIsRealEstateTask=function(){this.poiManager&&this.poiManager.setIsRealEstateTask&&this.poiManager.setIsRealEstateTask(!1)},u}(et),ce=function(){function i(){this._birdseyePreviewInitialized=!1}return i.prototype.process=function(n,t,i){n&&t&&(this._processStreetside(n,i,t),this._processGeochain(n,t))},i.prototype._processStreetside=function(i,r,u){var w=this,o=i.select("a[data-streetside]"),k=u?u.routablePoint:null,a,y,p,c,s,d,g,v,l,h;if(!br||!br.isEnabled){n&&n.addNewSSPlcHoldImage?(a=i.select(".ssContainer"),a&&a.length>0&&(h=t(".cico.plchold.ssModule",a.getParent()[0]),h&&h.length>0?h.add_class("setOn"):a.set_style({display:"none"})),o&&(y=t("#bev2Img",o.getParent()[0]),y&&y.removeFromParent(),o.removeFromParent())):o&&o.getParent().getParent()&&o.getParent().getParent().removeFromParent();return}p=o&&o.get_attr("data-streetside");p?(c=t.Internals.parseJSON(p),s=c.localDetailsStartupOptions,s&&(s.fov=null,s.heading=null,s.pitch=null,!s.routablePoint&&k&&(s.routablePoint=k),o.set_attr("data-streetside",t.Internals.stringify(c))),s.canonicalImageUrlGroup&&s.canonicalImageUrlGroup.length?o.set_style({display:"block","background-image":"url('"+s.canonicalImageUrlGroup[0].url+"')"}):(o.set_attr("data-streetside",""),d=r&&r.start(pf.LocalDetailsIntegrationTime),s.sivImageContainer=o,u&&!u.location&&(c===null||c===void 0?void 0:c.location)&&(u.location=new b(c.location.latitude,c.location.longitude)),g={action:"showBubbleImage",location:new b(c.location.latitude,c.location.longitude),localDetailsStartupOptions:s,perfState:d,callback:function(){w._processBirdsEyePreview(i,u,o,!1)},errorCallback:function(){w._processBirdsEyePreview(i,u,o,!0)}},v=i.select(".b_FBleedModule.plchold.ssModule"),v&&v.length>0&&v.set_style({display:"none"}),e.invokeHandler(f.streetsideDataHandlerKey,g))):(l=i.select(".ssContainer"),l&&l.length>0&&(h=t(".cico.plchold.ssModule",l.getParent()[0]),n&&n.addNewSSPlcHoldImage?h&&h.length>0?h.add_class("setOn"):l.set_style({display:"none"}):(h&&h.length>0&&h.remove_class("setOn"),l.getParent()&&l.getParent().removeFromParent())))},i.prototype._processBirdsEyePreview=function(n,t,i,r){var f=this,u;if(!this._birdseyePreviewInitialized){if(this._birdseyePreviewInitialized=!0,!n||!t||!t.map||!t.location){r&&i&&i.getParent().getParent()&&i.getParent().getParent().removeFromParent();return}u=n.select("a[id=bev2Img]");u&&u.length?(this._loadBirdsEyeThumbnail(n,t,i,r),t.map.mapResized.add(function(){f._loadBirdsEyeThumbnail(n,t,i,r)})):r&&i&&i.getParent()&&i.getParent().removeFromParent()}},i.prototype._loadBirdsEyeThumbnail=function(i,r,u,f){var v=this,e=i.select("a[id=bev2Img]"),y=r.location,s=r.map,l=lt.north,h=c.features.taskFramework,p=h&&h.defaultZoomLevel?h.defaultZoomLevel:16,a=li.toLocation(y,p,!0);o.BirdseyeV2Manager.getBirdseyeV2Thumbnail(s.getConfig(),a,19,function(o){var c,y,h,p;o?(e.set_style({"background-image":"url('"+o+"')"}),u.getParent().set_style({display:""}),u?(c=u.get_style("display"),c&&c.indexOf("none")===-1?(u.add_class("bm_sharedModule"),u.set_style({display:"inline-block"}),e.add_class("bm_sharedModule"),e.set_style({display:"inline-block"})):e.set_style({display:"block"})):e.set_style({display:"block"}),e.add_event("click",function(n){v._birdseyePreviewClicked(n,a,s,l,r.taskTitle,r.getDisplayState,r.impressionGuid)})):(e.set_style({display:"none"}),c=u.get_style("display"),c&&c.indexOf("none")===-1&&(u.remove_class("bm_sharedModule"),u.set_style({display:"block"})),f&&u&&(y=u.getParent().getParent(),h=y.length>0&&t(".cico.plchold.ssModule",y[0]),n&&n.addNewSSPlcHoldImage?h&&h.length>0?(h.add_class("setOn"),p=i.select(".b_FBleedModule.plchold.noAns"),p&&p.length>0&&p.set_style({display:"none"})):y.set_style({display:"none"}):(h&&h.length>0&&h.remove_class("setOn"),y.set_style({display:"none"}))))},l,s.getViewport())},i.prototype._computeBirdsEyeHeading=function(n,t){if(!n||!t||isNaN(n.latitude)||isNaN(n.longitude)||isNaN(t.latitude)||isNaN(t.longitude))return lt.north;var r=this._toRad(n.longitude-t.longitude),u=Math.sin(r)*Math.cos(this._toRad(n.latitude)),f=Math.cos(this._toRad(t.latitude))*Math.sin(this._toRad(n.latitude))-Math.sin(this._toRad(t.latitude))*Math.cos(this._toRad(n.latitude))*Math.cos(r),e=this._toDeg(Math.atan2(u,f)),i=(e+360)%360;return i>=315||i>=0&&i<45?lt.north:i>=45&&i<135?lt.east:i>=135&&i<225?lt.south:i>=225&&i<315?lt.west:lt.north},i.prototype._toRad=function(n){return n*Math.PI/180},i.prototype._toDeg=function(n){return n*180/Math.PI},i.prototype._birdseyePreviewClicked=function(n,t,i,r,o,s,h){h===void 0&&(h=null);n&&n.preventDefault();n&&n.stopPropagation();e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:ft.BirdseyeV2,action:"C",data:{EP:u.LocalDetails,CP:t}},impressionGuid:h});var l=c.features.taskFramework,a=l&&l.defaultZoomLevel?l.defaultZoomLevel:16;ot.setMapCenter(i,t,a,r,new hf(i.getView(),new ar(li.toLocation(t,a,!0),r)),null,null,{top:0,right:0,bottom:0,left:0});i.getFrameManager().frameRendered.addOne(function(){i.setMapType(i.createMapType(ei.birdseyeV2));i.getBirdseyeV2Manager().then(function(n){var i=s();n&&n.addContextPoi(t,o,i?i.colorIndex:3)})})},i.prototype._processGeochain=function(n,t){var i,r,u;t.geochainManager&&t.map&&(i=n?n.select(".geochainModule"):null,i&&t.location)&&(t.boundingBox||(t.boundingBox=[t.location,t.location,t.location,t.location]),r=cr.fromCorners(t.boundingBox[0],t.boundingBox[1]),u=function(n){if(!n||n.length===0){i.parent().removeFromParent();return}var r=new uu(n,t.controlTemplateFactory);r.getControl().appendTo(i)},t.geochainManager.getGeochain(u,t.location,r,!0))},i}(),ir=function(){function e(){this._saveButtonClickHandlers={}}return e.prototype.getCatId=function(n){var t;return i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(t=this.getListingCategoryPath(n)),t},e.prototype.getListingCategoryPath=function(n){var i,t;return n&&(t=n.select("div[data-category]"),t&&t.length&&(i=t.get_attr("data-category"))),i},e.prototype.process=function(n,t){var r=this;if(n){this._adsQueryCompositionString=n.select("div[data-adqcomp]").get_attr("data-adqcomp");this._listElements={};this.iids={};this._listItems=n.select("a[data-entity]");var u=n.select(".announceContainer"),e=!!(u&&u.length),f=this.getCatId(n),i=0;this._updateListCategoryStatus(n);this._listItems.for_each(function(u){var o=r._processItem(i,n,u,f,t,e),s,h;o&&o.entity&&(s=o.entity.fetchMoreUrl,h=u.parentElement,s&&h&&r._fetchListItemCarousel(s,h,n,i,f,t));i++})}},e.prototype._updateListCategoryStatus=function(t){var u=this.getListingCategoryPath(t),r,i;if(u&&n.listingQuicksaveCategoryWhitelist&&n.listingQuicksaveCategoryWhitelist.length>0)for(r=u.split("."),i=0;i<r.length;i++)if(n.listingQuicksaveCategoryWhitelist.indexOf(r[i])>-1){this._qsCategoryWhitelisted=!0;n.waterfallEnabledCategories.indexOf(r[i].toLowerCase())>-1&&t.select("div.wfr_cells").length>0&&(this._qsCategoryWaterfallWhitelisted=!0);break}},e.prototype._processItem=function(n,i,r,u,f,e){var p=r.getAttribute("data-entity"),it=r.parentElement&&r.parentElement.classList.contains("b_rtbad"),o=p&&p.length>0&&!it&&t.Internals.parseJSON(p),c,h,w,s,l,d,v,y,g,nt,tt;if(o&&o.entity&&o.entity.id){c=t(r);h=o.entity.id;this._listElements[h]=c;w=r.getAttribute("h");w&&(s=w.split("="),s&&s.length===2&&(s=s[1].split("."),s&&s.length&&(this.iids[h]=s[0].replace(",","."))));this._qsCategoryWhitelisted||(l=i.select(".quicksave"),l&&l.length>0&&l.remove_class("quicksave"));var a=this.getListingCategoryPath(i),b=r.getAttribute("data-productRootKeyword"),k=!(f===null||f===void 0?void 0:f.saveMode);k?this._setTaskData(r,o.entity,f,u,a,o.extraFuiAugmentations,e,b):(d=t(r),v=d.select(".cico").getParent(),d.add_class("savePlus"),y=function(n){return f.saveButtonClickHandler(n,r,h)},this._saveButtonClickHandlers[h]=y,v.add_event("click",y),v.add_event("keydown",function(n){var t=n;t&&t.keyCode===13&&y(n)}),g=v.get_sibling(1),this._setTaskData(g[0],o.entity,f,u,a,o.extraFuiAugmentations,e,b));n===0&&this._setAttributeForShoppingChainListingButton(i,o.entity,f,u,a,o.extraFuiAugmentations,b);this._qsCategoryWhitelisted&&k&&this._addQuicksaveIcon(r,h,a,f);k&&c.add_event("click",function(n){return f.clickHandler(n,o.entity.id)});(f===null||f===void 0?void 0:f.contextMenuHandler)&&c.add_event("contextmenu",function(n){return f.contextMenuHandler(n,o.entity.id)});nt=i.select("div[data-mapcardwidth]");tt=parseInt(nt.get_attr("data-mapcardwidth"));this._setInstrumentationData(r,o.entity.id,n,f,tt)}return this._updateListItemStyle(r),o},e.prototype.getSaveButtonClickHandler=function(n){return this._saveButtonClickHandlers[n]},e.prototype.getListItem=function(n){return this._listElements[n]},e.prototype.getFirstListItem=function(){return t(this._listItems[0])},e.prototype.getImpressionGuidFromEntity=function(t,i){var e=t,u,f,r;return n.usePaginationIgForInstrumentingClicksInInfiniteScroll&&(u=this.getListItem(i),u&&(f=u.get_attr("data-instrumentation"),f&&(r=JSON.parse(f),r&&r.impressionGuid&&(e=r.impressionGuid)))),e},e.prototype._setInstrumentationData=function(n,i,r,u,e){var o={ID:i,Q:u&&u.query?u.query:"",PO:r+1,BLD:e===484?tt.TwoColumns:tt.ThreeColumns},s=p[p.LLT]+"_C",h={logData:{feature:ft.Search,action:s,data:o},impressionGuid:this.getImpressionGuidFromEntity(u&&u.parentIG,i)};n.setAttribute(f.instrumentationDataHandlerKey,t.Internals.stringify(h))},e.prototype._updateListItemStyle=function(n){var i=t(n).select("div.inner img");i&&i.length!==0||t(n).select("div.inner").add_class("imgHolder")},e.prototype._setTaskData=function(n,r,e,o,h,c,l,a){var w=u.LocalListing,v={entryPoint:w,id:r.id,listingTaskId:e===null||e===void 0?void 0:e.listingTaskId,flippingCard:!0,taskTitle:r.title,selectedCategoryId:o?o:r.primaryCategoryPath,originIG:e&&e.originIG,parentIG:e&&e.parentIG,iid:this.iids[r.id],query:r.id?r.seeMoreQueryText:r.title,infoboxHtml:r.infoboxHtml,isBookingModuleEntryPoint:e&&e.isBookingModuleEntryPoint,listingCategoryPath:h,extraFuiAugmentations:c,asName:r&&r.title,asFormattedAddress:r&&r.address,disableWideCard:!0,adProviderId:r.adProviderId,adStoreId:r.adStoreId,adQuery:r.adQuery,adYpid:r.adYpid,adImpressionGuid:r.adImpressionGuid,adRetailEntitySource:r.adRetailEntitySource,adBusinessLocationId:r.adBusinessLocationId,adTriggerType:r.adTriggerType,adsRLinkUrl:r.adsRLinkUrl,localFilters:r.localFilters,productRootKeyword:a,originalQuery:e&&e.query},p,y;!this._adsQueryCompositionString||r.title&&r.title.toLowerCase().indexOf(this._adsQueryCompositionString.toLowerCase())>-1||(v.query=r.title+" "+this._adsQueryCompositionString);l&&(v.noCoBan=!0);e&&e.formCode&&(v.formCode=e.formCode);v.id&&v.id.indexOf("eventId:")===0&&(v.latLongForEventRequery=r.latitude+","+r.longitude,v.locationForEventRequery=r.city);p=typeof(e===null||e===void 0?void 0:e.listingTaskId)!="undefined";y={state:v,type:i._isZipCodeCategory(v.selectedCategoryId)?s.polygonEntityDetailsTask:s.localDetailsTask,activateOptions:{parentId:e&&e.taskParentId,saveSlideoutTask:p}};n.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(y));this._setAttributeForShoppingOrAutoButton(n,y,e)},e.prototype._setAttributeForShoppingChainListingButton=function(n,r,e,o,h,c,l){var y,a,p,v,w;n&&!(n.length<1)&&r&&e&&(y=null,a=n[0].querySelector(".listing-chainshopping-button"),a&&(y={feature:"Shopping",action:"ShoppingChainButtonClicked",data:{}},p={entryPoint:u.LocalListing,id:r.id,flippingCard:!0,taskTitle:r.title,selectedCategoryId:o?o:r.primaryCategoryPath,originIG:e&&e.originIG,parentIG:e&&e.parentIG,iid:this.iids[r.id],query:r.id?r.seeMoreQueryText:r.title,infoboxHtml:r.infoboxHtml,isBookingModuleEntryPoint:e&&e.isBookingModuleEntryPoint,listingCategoryPath:h,extraFuiAugmentations:c,asName:r&&r.title,asFormattedAddress:r&&r.address,disableWideCard:!0,adProviderId:r.adProviderId,adStoreId:r.adStoreId,adQuery:r.adQuery,adYpid:r.adYpid,adImpressionGuid:r.adImpressionGuid,adRetailEntitySource:r.adRetailEntitySource,adBusinessLocationId:r.adBusinessLocationId,adTriggerType:r.adTriggerType,adsRLinkUrl:r.adsRLinkUrl,localFilters:r.localFilters,productRootKeyword:l,originalQuery:e&&e.query},v={state:p,type:i._isZipCodeCategory(p.selectedCategoryId)?s.polygonEntityDetailsTask:s.localDetailsTask,activateOptions:{parentId:e&&e.taskParentId}},v.state.productFormCode="BLMLSA",v.state.launchOverflowTaskOnTaskActivate=!0,a.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(v)),w={logData:y,impressionGuid:e&&e.parentIG},a.setAttribute(f.instrumentationDataHandlerKey,t.Internals.stringify(w))))},e.prototype._setAttributeForShoppingOrAutoButton=function(n,i,r){var e=null,u=n.querySelector(".listing-shopping-button"),o;u?e={feature:"Shopping",action:"ShoppingButtonClicked",data:{}}:(u=n.querySelector(".listing-autodealers-button"),u&&(e={feature:"Autos",action:"AutosButtonClicked",data:{}}));u&&(i.state.productFormCode="BLMLSA",i.state.launchOverflowTaskOnTaskActivate=!0,u.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(i)),o={logData:e,impressionGuid:r&&r.parentIG},u.setAttribute(f.instrumentationDataHandlerKey,t.Internals.stringify(o)))},e.prototype._addQuicksaveIcon=function(i,u,f,e){var a=t(i),o=a.select(".bm_qsicon"),h,s,l;o&&o.length>0&&!c.isInPrivateMode&&o.get_attr("processed")!=="true"&&(o.set_attr("processed","true"),o.add_class("bm_saveButton"),o.set_attr("title",r.L_EditButton),o.set_attr("alt",r.L_EditButton),o.set_attr("role","button"),o.set_attr("tabindex","0"),o.set_attr("aria-expanded","false"),o.add_event("click",function(n){return e.saveButtonClickHandler(n,i,u)}),o.add_event("keydown",function(n){var t=n;t&&t.keyCode===13&&e.saveButtonClickHandler(n,i,u)}),this._qsCategoryWaterfallWhitelisted&&(h=o.getParent(),h&&h.length&&(h.add_event("mouseleave",function(){if(o.get_style("visibility")==="hidden"){var t=document.getElementById("transientLens");t&&t.style.visibility==="visible"||document.body.click()}n.enableEnlargeImageOnHover&&h[0].firstChild.classList.remove("cellHover");h[0].firstChild.firstChild.classList.remove("hover")}),s=o.get_sibling(-1),n.enableScalingForWaterfallSaveButton&&s.length>0&&(o.removeFromParent(),s[0].firstChild.appendChild(o[0]),l=a.select(".collectionsPopOut"),l.removeFromParent(),s[0].firstChild.appendChild(l[0])),o.add_event("mouseenter",function(){n.enableEnlargeImageOnHover&&s.add_class("cellHover");s.length>0&&s[0].firstChild.classList.add("hover")}),o.add_event("mouseleave",function(){n.enableEnlargeImageOnHover&&s.remove_class("cellHover");s.length>0&&s[0].firstChild.classList.remove("hover")}))))},e.prototype._fetchListItemCarousel=function(n,t,i,r,u,f){var e=this,o=function(n){var o,s,h,c;if(t.innerHTML="",sj_appHTML(t,n),typeof rms!="undefined"&&rms.start(),o=t.getElementsByClassName("listings-item"),e._updateListCategoryStatus(i),o)for(s=0;s<o.length;s++)h=o[s],h&&(c=e._processItem(r,i,h,u,f),c&&f.listItemCarouselHandler(c,h))};st.downloadGeneric(n,"fetchListItemCarousel",o,null,null,null,0)},e}(),wi=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,i.resources=r,t.defineProperty("factLabel"),t.defineProperty("factData"),t.defineProperty("extendedFacts"),i}return y(t,n),t.prototype.dispose=function(){this.factData=null;this.factLabel=null},t.prototype.nullToDisplayNone=function(n){return n?"":"none"},t.prototype.displayOnTrails=function(n){return this.showIfEqual(n,"trails")},t.prototype.displayOnCampgrounds=function(n){return this.showIfEqual(n,"campgrounds")},t.prototype.showIfEqual=function(n,t){return n===t?"":"none"},t}(ti),su=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("start"),t.defineProperty("end"),i}return y(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.start=null;this.end=null},t}(ti),hu=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("day"),t.defineProperty("hourRanges"),i}return y(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.day=null},t}(ti),le=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return y(t,n),t}(ru),rr=function(){function n(){}return n.getNameForProperty=function(n){switch(n){case"at":return r.L_PrintExtendedAt_Text;case"capital":return r.L_PrintExtendedCapitol_Text;case"countyseat":return r.L_PrintExtendedCounty_Text;case"area":return r.L_PrintExtendedArea_Text;case"population":return r.L_PrintExtendedPopulation_Text;case"cuisine":return r.L_PrintExtendedCuisine_Text;case"price":return r.L_PrintExtendedPrice_Text;case"hotelclass":return r.L_PrintExtendedHotelClass_Text;case"avgrate":return r.L_PrintExtendedAvgRate_Text;case"Founded":case"founded":return r.L_PrintExtendedFounded_Text;case"gdp":return r.L_PrintExtendedGDP_Text;case"callingcode":return r.L_PrintExtendedCC_Text;case"specialty":return r.L_PrintSpecialtyTitle_Text;case"experience":return r.L_PrintExperienceTitle_Text;case"clinic":return r.L_PrintClinicTitle_Text;case"homefacts":return r.L_PrintHomeFactsTitle_Text;case"moreinfo":return r.L_PrintMoreInfoTitle_Text;case"lastsold":return r.L_PrintLastSoldTitle_Text;case"zestimate":return r.L_PrintZestimateTitle_Text;case"Season":return r.L_PrintSeason_Text;case"Activity":case"Activities":return r.L_PrintActivities_Text;case"Rates":return r.L_PrintRates_Text;case"Open":return r.L_PrintOpen_Text;case"Sites":return r.L_PrintSites_Text;case"Interests":return r.L_PrintInterests_Text;case"Opened":return r.L_PrintOpened_Text;case"Floors":return r.L_PrintFloors_Text;case"Height":return r.L_PrintHeight_Text;case"Architect":case"Architects":return r.L_PrintArchitects_Text;case"Established":return r.L_PrintEstablished_Text;case"Artist":case"Artists":return r.L_PrintArtists_Text;case"Subjects":return r.L_PrintSubjects_Text;case"Media":return r.L_PrintMedia_Text;case"Teams":return r.L_PrintTeams_Text;case"Capacity":return r.L_PrintCapacity_Text;case"Elevation":return r.L_PrintElevation_Text;case"Prominence":return r.L_PrintProminence_Text;case"speciality":return r.L_PrintSpecialtyTitle_Text;case"Nearby airports":case"Nearby airport":return r.L_PrintNearbyAirport_Text;case"First ascent":return r.L_PrintFirstAscent_Text;case"First ascender":return r.L_PrintFirstAscender_Text;case"Mountain range":return r.L_PrintMountainRange_Text;case"Last eruption":return r.L_PrintLastEruption_Text;case"Colleges and universities":return r.L_PrintCollegesUniversities_Text;case"Architecture firm":return r.L_PrintArchitectureFirm_Text;case"Service Areas":return r.L_PrintServiceAreas_Text;case"Date completed":return r.L_PrintDateCompleted_Text;case"Annual visitors":return r.L_PrintAnnualVisitors_Text;case"Average stay":return r.L_PrintAverageStay_Text}return null},n.parseAndPushDataFactForPrint=function(t,i){var r,u;if(i&&t)for(r in t)u=n.getNameForProperty(r),n.complexType.indexOf(r)!==-1?n.pushFactToList(i,null,null,t):n.pushFactToList(i,u,n.beautifyList.indexOf(r)===-1?t[r]:n.beautify(t[r]))},n.listContains=function(n,t){for(var i=0;i<n.length;i++)if(n[i].getFactLabel()===t)return!0;return!1},n.pushFactToList=function(t,i,r,u){if(!n.listContains(t,i)){var f=n.setFactsInfo(t,i,r,u);f&&t.push(f)}},n.setFactsInfo=function(t,i,r,u){var f=null;return u?f=n.setExtendedFacts(t,u):i&&r&&(f=new wi,f.setFactLabel(i),f.setFactData(r)),f},n.setExtendedFacts=function(n,t){var o=null,i,u,f,e;return t&&(t.trails&&(i=t.trails,u=new le,u.length=i.length?i.length:"",u.lengthIcon=i.lengthIcon?i.lengthIcon:"",u.elevation=i.elevation?i.elevation:"",u.elevationIcon=i.elevationIcon?i.elevationIcon:"",u.duration=i.duration?i.duration:"",u.durationIcon=i.durationIcon?i.durationIcon:"",u.difficulty=i.difficulty?i.difficulty:"",u.type="trails",o=new wi,o.setFactLabel(u.length||u.elevation||u.duration?r.L_PrintTrailInfo_Text:""),o.setExtendedFacts(u)),t.campgrounds&&(f=t.campgrounds,e=new oe,e.rvSites=f.RVSites?f.RVSites:"",e.rvIcon=f.RVIcon?f.RVIcon:"",e.tentSites=f.tentSites?f.tentSites:"",e.tentIcon=f.tentIcon?f.tentIcon:"",o=new wi,o.setFactLabel(e.rvSites||e.tentSites?r.L_PrintMainSites_Text:""),o.setExtendedFacts(e))),o},n.beautify=function(n){return n.split(",").join(r.L_PrintSeparator_Text)},n.beautifyList=["Main sites","Nearby airport","Nearby airports","Colleges and universities","Teams","Media","Subjects","Artist","Artists","Architect","Architects","Height","Interests","Sites","Activities","Activity"],n.complexType=["trails","campgrounds"],n}(),ae=function(){function u(){}return u.RequestDetailPopouts=function(i){if(i&&i[1]&&i[2]){var f=i[1],r=i[2],e=n.locationFilterAjaxEndpoint+f;sj_ajax(e,{callback:function(n,i){var e,o,f;n&&i!==null&&i.request!==null&&i.request.responseText!==null&&i.request.responseText!==""&&(e=JSON.parse(i.request.responseText),e&&(o=t("#"+r),f=function(){sj_evt.unbind("frameRendered",f);o.remove_event("mouseover,touchStart",f);u.CreateDetailPopouts(e,r)},sj_evt.bind("frameRendered",f,0),o.add_event("mouseover,touchStart",f)))}})}},u.CreateDetailPopouts=function(n,u){var e,h,b,c,p,k,l,f,s,w,d,o,a,v,y;if(n!==null&&u!==null&&(e=[],n.Neighborhoods&&n.Neighborhoods.length>0&&(e=e.concat(n.Neighborhoods)),n.PointsOfInterest&&n.PointsOfInterest.length>0&&(e=e.concat(n.PointsOfInterest)),n.Transportation&&n.Transportation.length>0&&(e=e.concat(n.Transportation)),h=t("#"+u),b=n.MapUrl,c=h.select("#ftrD_Location .catfOption"),h&&h.length!==0&&b&&c&&c.length!==0))for(p=h.select("#ftrD_Location"),k=p.getParent().getParent(),l=0;l<e.length;l++)if(f=e[l],f.Location){s=i._createElement("div").add_class("b_htlLocInfo");s.append(i._createElement("img").add_class("b_locMap").set_attr("src",this.getStaticMapUrl(f.Location.Latitude,f.Location.Longitude,n.MapUrl)));w=i._createElement("div").add_class("b_htlLocTitle");d=r.HotelsFound+"<span>"+(f.NearbyHotelCount>100?"100+":f.NearbyHotelCount)+"<\/span>"+r.HotelsNear+f.Name;w.appendHTML(d);s.append(w);o=[];f.PriceTrend===0?o.push(r.HotelPricesHere+"<span class=b_htlGood>"+r.HotelPricesWithin+"<\/span>"+r.HotelWithinCityAverage):f.PriceTrend>1?o.push(r.HotelPricesHere+"<span class=b_htlNeutral>"+Math.round((f.PriceTrend-1)*100)+"%"+r.HotelPricesExpensive+"<\/span>"+r.HotelCityAverage):o.push(r.HotelPricesHere+"<span class=b_htlGood>"+Math.round((1-f.PriceTrend)*100)+"%"+r.HotelPricesCheaper+"<\/span>"+r.HotelCityAverage);f.Distance===0?o.push(r.HotelThisLocation+"<span class=b_htlGood>"+r.HotelNear+"<\/span>"+r.HotelCityCenter):o.push("<span>"+f.Distance+"<\/span>"+r.HotelDistanceFromCityCenter);a="b_htlNeutral";v=r.HotelSafetyNeutral;switch(f.CrimeIndex){case 1:case 2:a="b_htlExcellent";v=r.HotelSafetyExcellent;break;case 3:a="b_htlGood";v=r.HotelSafetyGood}for(o.push(r.HotelAreaSafety+"<span class="+a+">"+v+"<\/span>"),y=0;y<o.length;y++)s.append(i._createElement("div").add_class("b_htlLocData").appendHTML(o[y]));s.append(i._createElement("p").appendText(f.Description));this.attachPopoutEvents(s,c,k,p,f.Id)}},u.attachPopoutEvents=function(i,r,u,f,e){for(var o=null,s=0;s<r.length;s++)if(r[s].getAttribute("data-filterparam").indexOf(e)>=0){o=t(r[s]);break}o&&(o.add_event("mouseover",function(){var r,h,l,a,c;if(n.showInlineFilters){var v=window.innerHeight,y=window.innerWidth,e=50,s=document.getElementsByClassName("taskLayoutContainer");s&&s.length>0&&(r=o[0].getBoundingClientRect(),i.set_style({"z-index":1e4,left:r.left+r.width-e,top:r.top-f[0].scrollTop-32}),t(s[0]).append(i),i[0].getBoundingClientRect().right>y&&(i[0].style.left=(r.left-i[0].offsetWidth-e).toString()+"px"),h=i[0].getBoundingClientRect().bottom-v,h>0&&(i[0].style.top=(r.top-f[0].scrollTop-e-h).toString()+"px"))}else l=window.innerHeight,a=window.innerWidth,i.set_style({"z-index":7,left:o[0].offsetLeft+o[0].offsetWidth-150,top:o[0].offsetTop-f[0].scrollTop-32}),u.append(i),i[0].getBoundingClientRect().right>a&&(i[0].style.left=(o[0].offsetLeft-i[0].offsetWidth-150).toString()+"px"),c=i[0].getBoundingClientRect().bottom-l,c>0&&(i[0].style.top=(o[0].offsetTop-f[0].scrollTop-50-c).toString()+"px")}),o.add_event("mouseout",function(){n.showInlineFilters?i&&i.removeFromParent():u.select(".b_htlLocInfo").removeFromParent()}),n.showInlineFilters&&o.add_event("mouseup",function(){i&&i.removeFromParent()}),o.add_event("touchend",function(){Microsoft.Maps.setTimeout(function(){n.showInlineFilters?i&&i.removeFromParent():u&&u.select(".b_htlLocInfo").removeFromParent()},50)}))},u.getStaticMapUrl=function(n,t,i){return i+"&da=ro&ml=Basemap,Landmarks,OsmBuildings&ms=300,150&pushpin=".concat(n,",").concat(t,";176;1")},u}();sj_evt.bind("AttachLocFilterPopouts",ae.RequestDetailPopouts);var ht=function(){function n(){}return n.NearbyFeatureName="NBS",n.ActionClick="C",n.ActionModeSwitch="MS",n.SearchAreaShown="SAS",n.SearchAreaClick="SAC",n.AutoRefreshOnExit="ARE",n.ActionClose="X",n}(),cu=function(){function n(n){var u=this,e,f;this.drivingText=r.L_NearbyFloatingContainerDrivingTitle;this.walkingText=r.L_NearbyFloatingContainerWalkingTitle;this.transitText=r.L_NearbyFloatingContainerTransitTitle;this.titleText=r.L_NearbyFloatingContainerNearbyTitle;this._outsideClickHandler=function(){u._nearbyFloatingContainerDiv.select("div.nearbyDropdownList").set_style({visibility:"hidden"})};this._anchorClickHandler=function(n){var t,i;n.stopImmediatePropagation();switch(n.target.className){case"nearbyDrivingOption":t="driving";break;case"nearbyWalkingOption":t="walking";break;case"nearbyTransitOption":t="transit"}u._currentActiveTask&&(i=u._floatingContainerRegisteredTasks[u._currentActiveTask],i&&t&&(u._callDistanceMatrixandUpdate(i,t),u.logNearbyInstrumentationData(ht.ActionModeSwitch,{P:i.currentMode,N:t})))};this._dropdownClickHandler=function(){var n=u._nearbyFloatingContainerDiv.select("div.nearbyDropdownList"),t=n.get_style("visibility")==="hidden",i=t?"visible":"hidden";n.set_style({visibility:i})};this._closeClickHandler=function(){u._handleClose(u._currentActiveTask)};this.resources=r;this._nearbyFloatingContainerDiv=t("div.b_nearbyFloatingContainer");this._nearbyFloatingContainerDiv.length===0&&(e=new dt(fe),this._nearbyFloatingContainerDiv=e.applyDataTemplate(this),f=t("div#mapContainer"),f.length<1&&(f=t("div#b_content .largeMap")),f.append(this._nearbyFloatingContainerDiv),n.viewChanged.add(function(n){u._onMapViewChanged(n)}),this._searchButton=t(".bm_nearbyMapSearchButton"),this._searchButton.add_event("click",function(n){u._onNearbySearchClick(n)}));this._taskLayoutContainer=t("div.taskLayoutContainer");this._taskbarWidth=i.getVerticalTaskBarWidth()/2;this._map=n;this._mapState={zoom:0,bounds:[]};this._showOrHideSearchButton(!1);this._floatingContainerShown=!1;this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").add_event("blur",this._outsideClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdownList > a").add_event("mousedown",this._anchorClickHandler);this._nearbyFloatingContainerDiv.select("span.nearbyCloseIcon").add_event("click",this._closeClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").add_event("click",this._dropdownClickHandler);this._floatingContainerRegisteredTasks={};this.showContainer(!0)}return n.prototype.dispose=function(){this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").remove_event("blur",this._outsideClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdownList > a").remove_event("mousedown",this._anchorClickHandler);this._nearbyFloatingContainerDiv.select("span.nearbyCloseIcon").remove_event("click",this._closeClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").remove_event("click",this._dropdownClickHandler);this.showContainer(!1)},n.prototype.registerTaskInformationAndShow=function(n,t){this._mapState={zoom:0,bounds:[]};this._floatingContainerRegisteredTasks[n]=t;this._currentActiveTask=n;this.showContainer(!0,n)},n.prototype.activateTask=function(n){this._currentActiveTask=n},n.prototype._handleClose=function(n){var t=this._floatingContainerRegisteredTasks[n];t&&(t.exitNearbyCallback(),this._floatingContainerRegisteredTasks[n]=null,this.logNearbyInstrumentationData(ht.ActionClose,{task:n}));this.showContainer(!1,n)},n.prototype.getModeForTask=function(n){var t=this._floatingContainerRegisteredTasks[n];return t?t.currentMode:"driving"},n.prototype.showContainer=function(n,t,i){if(t===this._currentActiveTask){var r=this._floatingContainerRegisteredTasks[this._currentActiveTask];this._showOrHideFloatingMapContainer(n);this._showOrHideNearbyModeSelector(n);n?(r&&this._setMode(r.currentMode),this._centerContainer(i)):this._showOrHideSearchButton(!1);this._floatingContainerShown=n}},n.prototype._centerContainer=function(n){var r=parseFloat(this._taskLayoutContainer&&this._taskLayoutContainer.get_style("width")||"0px"),e=c.features.taskFramework,i,u,f,o,s;n&&e&&e.showLoadingSkeleton&&(i=t(".taskLayoutSkeletonContainer"),u=parseFloat(i.get_style("width")||"0px"),i.length>0&&i[0].style.left&&(u+=parseFloat(i[0].style.left||"0px")),r=Math.max(r,u));f=this._nearbyFloatingContainerDiv.has_class("bm_hideOnLoad");f&&this._nearbyFloatingContainerDiv.remove_class("bm_hideOnLoad");o=parseFloat(this._nearbyFloatingContainerDiv.get_style("width")||"200px");s=(r+this._taskbarWidth-o)/2;this._nearbyFloatingContainerDiv.set_style({"margin-left":"".concat(s,"px")});f&&this._nearbyFloatingContainerDiv.add_class("bm_hideOnLoad")},n.prototype._callDistanceMatrixandUpdate=function(t,i){var r=t.populatedDistanceMatrixURL.replace("${mode}",i);i==="driving"&&(r+="&startTime="+n.getCurrentDateTime());st.downloadJson(r,"nearbyfloatingcontainer",function(n,t){var i=t;i&&(i.requestStatusCallback(!1),i.updateCallback(n))},function(n){var t=n;t&&t.requestStatusCallback(!1)},t);this._setMode(i);t.requestStatusCallback(!0);t.updateTransportationModeCallback(i);t.currentMode=i},n.prototype._setMode=function(n){var r,i;if(n&&(r=t("div.nearbyDropdown"),r&&r.length>0&&(i=r[0],i&&i.childNodes&&i.childNodes.length>0)))switch(n){case"driving":i.childNodes[0].textContent=this.drivingText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("walking transit");break;case"walking":i.childNodes[0].textContent=this.walkingText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("transit");this._nearbyFloatingContainerDiv.select("span.nearbyModePic").add_class("walking");break;case"transit":i.childNodes[0].textContent=this.transitText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("walking");this._nearbyFloatingContainerDiv.select("span.nearbyModePic").add_class("transit")}},n.prototype.deregister=function(n){this._floatingContainerRegisteredTasks[n]&&this._handleClose(n)},n.prototype._onMapViewChanged=function(){this._floatingContainerShown&&this._isMapChangeSignificant()&&(this._showOrHideSearchButton(!0),this.logNearbyInstrumentationData(ht.SearchAreaShown,{}))},n.prototype._showOrHideSearchButton=function(n){n?this._searchButton.has_class("bm_show")||this._searchButton.add_class("bm_show"):this._searchButton.remove_class("bm_show")},n.prototype._showOrHideFloatingMapContainer=function(n){n?this._nearbyFloatingContainerDiv.has_class("bm_show")||this._nearbyFloatingContainerDiv.add_class("bm_show"):this._nearbyFloatingContainerDiv.remove_class("bm_show")},n.prototype._showOrHideNearbyModeSelector=function(n){var t=this._nearbyFloatingContainerDiv.select(".b_nearbyFloatingContainer");n?t.has_class("bm_show")||t.add_class("bm_show"):t.remove_class("bm_show")},n.prototype._isMapChangeSignificant=function(){var t=!1,u=this._map,n=this._mapState,i=u.getMercatorZoomLevel(),r=u.getBounds().bounds,f;return n.zoom===0||n.bounds.length===0?(n.zoom=i,n.bounds=r,t):(n.zoom!==i?t=!0:(f=this._getOverlapPercent(n.bounds,r),t=f<.9),t&&(n.zoom=i,n.bounds=r),t)},n.prototype._getOverlapPercent=function(n,t){if(n.length<4||t.length<4)return 0;var i=this._normalizeBounds(n),r=this._normalizeBounds(t),u=Math.max(0,Math.min(i[1],r[1])-Math.max(i[3],r[3])),f=Math.max(0,Math.min(i[0],r[0])-Math.max(i[2],r[2])),e=u*f,o=(i[1]-i[3])*(i[0]-i[2]);return e/o},n.prototype._normalizeBounds=function(n){return[90+n[0],180+n[1],90+n[2],180+n[3]]},n.prototype._onNearbySearchClick=function(){sj_evt.fire("triggerMapSearch");this._showOrHideSearchButton(!1);this._mapState={zoom:this._map.getMercatorZoomLevel(),bounds:this._map.getBounds().bounds}},n.prototype.logNearbyInstrumentationData=function(n,t){var i={logData:{feature:ht.NearbyFeatureName,action:n,data:t},impressionGuid:c.dynamicProperties.mapsIG};e.invokeHandler(f.instrumentationDataHandlerKey,i)},n.getCurrentDateTime=function(){var n=new Date;return n.toISOString()},n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n}(),ve=function(n){function t(t,i,r,u,f,e,o,h,c){var l=n.call(this,t,i,r,u,f,e,o,h,c)||this;return l.type=s.polygonEntityDetailsTask,l.displayState={groupName:"PolygonEntityDetails"},l}return y(t,n),t.prototype.activate=function(t,r,u,f){r.selectedCategoryId&&i._isZipCodeCategory(r.selectedCategoryId.toLowerCase())&&r&&r.id&&r.id.indexOf("sid:")>=0&&(r.query=r.taskTitle,r.id=null);n.prototype.activate.call(this,t,r,null,f)},t.prototype.canColorFade=function(){return c.features.taskFramework.canCardColorFade},t.prototype.setTaskComplete=function(){var t,i;n.prototype.setTaskComplete.call(this);t=this.viewModel.getEntities();t&&t.length>0&&(i=this.viewModel.getEntities()[0].getVdpId(),i&&(this._taskState.vdpid=i,this.serializableObjectChanged.invoke({magnitude:0})))},t.prototype._createUrl=function(t,i,r){var u=n.prototype._createUrl.call(this,t,i,r);return this._taskState&&this._taskState.point&&this._taskState.point.length===2&&(u+="&bmpoint="+this._taskState.point[0]+","+this._taskState.point[1]),u},t}(it),ye=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return y(i,n),i.prototype.process=function(n,i){var r=this,u,f;n&&(this._listElements={},this.iids={},this._listItems=n.select("a[data-entity]"),u=this.getCatId(n),f=0,this._listItems.for_each(function(e){var a=e.getAttribute("data-entity"),o,c,l,v,s,h,y,p,w;a&&a.length>0?(o=t.Internals.parseJSON(a),o&&o.entity&&o.entity.id&&(c=t(e),l=o.entity.id,r._listElements[l]=c,v=e.getAttribute("h"),v&&(s=v.split("="),s&&s.length===2&&(s=s[1].split("."),s&&s.length&&(r.iids[l]=s[0].replace(",",".")))),r._setTaskData(e,o.entity,i,u),c.add_event("click",function(n){return i.clickHandler(n,o.entity.id)}),c.add_event("contextmenu",function(n){return i.contextMenuHandler(n,o.entity.id)}))):(h=e.getElementsByClassName("b_factrow"),h&&h.length>0&&h[0].innerHTML&&(y=h[0].innerHTML.trim().split("-")[0],r._setTaskData(e,{title:y,primaryCategoryPath:"ZipCode"},i,u)));r._updateListItemStyle(e);p=n.select("div[data-mapcardwidth]");w=parseInt(p.get_attr("data-mapcardwidth"));r._setInstrumentationData(e,l,f,i,w);f++}))},i.prototype._updateListItemStyle=function(n){var i=t(n).select("div.inner img"),r;i&&i.length!==0||(r=t(n).select("div.b_vPanel"),r.set_style({"margin-left":0,"text-align":"left"}))},i}(ir),pe=function(n){function r(t,i,r,u,f,e,o,s){return n.call(this,t,i,r,u,f,e,o,s)||this}return y(r,n),r.prototype._refresh=function(){},r.prototype.activate=function(t,i,r,u){this.viewModel||(this.viewModel=new ke(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));n.prototype.activate.call(this,t,i,null,u)},r.prototype._onPoiViewStateChanged=function(n,t){var o=n.primitive,i=o.entity;if(i&&i.id&&o.metadata){var h=this.map.getConfig(),c=this.map.getMercatorZoomLevel(),l=h.postCodeMaxHoverClickZoom,r=this.pageProcessor;if(n.newValue===2&&c<=l){var a=u.POI,p=r.getCatId(this.viewModel.getResponseContainer()),v={entryPoint:a,id:i.id,flippingCard:!0,taskTitle:o.metadata.title,originIG:this._taskState&&this._taskState.originIG,parentIG:r.getImpressionGuidFromEntity(this._getImpressionGuid(),i.id),iid:r.iids&&r.iids[i.id],searchQueryCategory:this._taskState&&this._taskState.searchQueryCategory},y={parentId:this.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.polygonEntityDetailsTask,state:v,activateOptions:y});this._logPoiClick(i,t);this._setSelectedPrimitive(n.primitive)}}},r.prototype.processResponse=function(r,u){if(i._isZipCodeCategory(this._taskState.category)||i._isZipCodeCategory(this._taskState.searchQueryCategory)){var e=r.select(".listings-item"),f=[];e.for_each(function(n){var r=t(n),i=r.select(".b_factrow");i&&i.length>0&&i[0].innerHTML.indexOf("-")>=0&&f.push(r.getParent())});f.forEach(function(n){return n.removeFromParent()})}n.prototype.processResponse.call(this,r,u)},r.prototype._createUrl=function(t,i,r){var f=i,u;if(this._taskState.originalResponse&&(u=this._taskState.originalResponse.select("div.overlay-listings").get_attr("data-listingMetadata"),u.length>0)){var e=JSON.parse(u),o=parseInt(e.BlockedCount),s=this._taskState.originalResponse.select(".listings-item").length;f=o+s}return n.prototype._createUrl.call(this,t,f,typeof r=="number"?r:100)},r}(et),d;(function(r){function ct(n,t,i,r){var u,f,s,c,e,h;if(n&&(u=ot(n,t),u&&u.intentKey)){if(f=o[u.intentKey],nf.assert(typeof f=="function","taskInvoker is not defined!"),t&&(t.scenarioKey=u.scenarioKey,ht(n,t)),u.intentKey===a){if(l.cleanupPrimerData(r),s=pt(n,t),s){f&&f(n,s);it(n,t.entryPoint,u.scenarioKey,t.query,[],t.mapsEntryPointState);return}}else{if(u.intentKey===rt){l.cleanupPrimerData(r);c=wt(n,i,r);it(n,t.entryPoint,u.scenarioKey,t.query,c,t.mapsEntryPointState);return}if(u.intentKey===ut){if(l.cleanupPrimerData(r),e=dt(n),e){e.entryPoint=t.entryPoint;f&&f(n,e);it(n,t.entryPoint,u.scenarioKey,t.query,[],t.mapsEntryPointState);return}}else if(u.intentKey===et){l.cleanupPrimerData(r);h=kt(n,t,r);f&&f(n,h);it(n,t.entryPoint,u.scenarioKey,t.query,h.boundingBox,t.mapsEntryPointState);return}}f&&f(n,t)}}function lt(t,r){var h=null,u,o,e,f,s,c;if(t&&(u=ot(t,r),u&&u.intentKey)){if(r.scenarioKey&&!(i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&u.scenarioKey==="ERR")){for(e=Object.keys(n.scenarioKeys),f=0;f<e.length;f++)if(n.scenarioKeys[e[f]]===r.scenarioKey){o=e[f];break}if(o&&n.multiEntityScenarios.indexOf(o)>=0&&(u.intentKey===k||u.intentKey===w))return null}s=v[u.intentKey];s&&(c=s(),h=c.parseEntitiesFromResponse(t,r));r&&(r.scenarioKey=u.scenarioKey,ht(t,r))}return h}function st(i){var u=null,f,r,e,o;return i&&(f=i.select("div[data-category]"),f&&f.length&&(u=f.get_attr("data-category")),u||(r=i.select("div.overlay-taskpane"),n.enableTopicSearchExperience&&c.isMobile&&r&&r.length===0&&(e=i.select("div.tsMobileContainer"),e&&e.length&&(r=e.select(".bm_tsEntityCard"))),r&&r.length&&r.for_each(function(n){var r=n.getAttribute("data-entity"),i;r&&r.length&&(i=t.Internals.parseJSON(r),i&&i.entity&&i.entity.primaryCategoryPath&&(u=i.entity.primaryCategoryPath))})),u||(o=i.select("div[data-segmenttype]"),o&&o.length&&(u=o.get_attr("data-segmenttype")))),u}function at(n){var t=n&&n.select("div[data-hasmoreresults]");return t&&t.length&&t.get_attr("data-hasmoreresults")==="false"}function ot(t,i){var u=t.select("[data-answerinfo]").get_attr("data-answerinfo"),r={};return u?(n.polygonEntityScenarios.indexOf(u)>=0&&vt(t)&&yt(t)?r.intentKey=w:n.singleEntityScenarios.indexOf(u)>=0?r.intentKey=i.localFilters?d:k:n.multiEntityScenarios.indexOf(u)>=0?r.intentKey=d:n.directionsIntentDrivingScenarios.indexOf(u)>=0?(nt=g.driving,r.intentKey=a):n.directionsIntentTransitScenarios.indexOf(u)>=0?(nt=g.transit,r.intentKey=a):n.directionsIntentWalkingScenarios.indexOf(u)>=0?(nt=g.walking,r.intentKey=a):n.trafficIntentScenarios.indexOf(u)>=0?r.intentKey=rt:n.itineraryDetailsIntentScenarios.indexOf(u)>=0?r.intentKey=ut:n.itineraryListingsIntentScenarios.indexOf(u)>=0&&(r.intentKey=et),r.scenarioKey=n.scenarioKeys[u],r):r}function vt(n){var r=n.select("[data-entity]").get_attr("data-entity"),i;return r&&(i=t.Internals.parseJSON(r),i&&i.entity&&i.entity&&i.entity.vdpId&&i.entity.vdpId!=="")?!0:!1}function yt(i){var u=i.select("[data-entity]").get_attr("data-entity"),r;return u&&(r=t.Internals.parseJSON(u),r&&r.entity&&r.entity&&r.entity.locationType&&r.entity.locationType!==""&&n.boundaryDisabledLocationTypes.indexOf(r.entity.locationType)===-1)?!0:!1}function y(t,r,u,f){f===void 0&&(f=!0);f&&u&&(u.content=r);var e=st(r);i._isHouseCategory(e)?u.searchQueryCategory="house":i._isRestaurantCategory(e)?u.searchQueryCategory="restaurant":i._isHotelsCategory(e)?u.searchQueryCategory="hotel":i._isZipCodeCategory(e)?u.searchQueryCategory="zipcode":u.scenarioKey==="LTS"&&n.enableTopicSearchExperience&&(u.searchQueryCategory="topicSearch");t=i._overrideTasktypeBasedOnCategory(t,u);tt(t,u)}function tt(n,t){e.invokeHandler(f.taskDataHandlerKey,{type:n,state:t})}function pt(n,i){var c=n.select("[data-directionsintent]").get_attr("data-directionsintent"),r,s,h,f,u,e,o;if(c&&(r=t.Internals.parseJSON(c),r&&r.waypoints&&r.waypoints.length>0)){for(s=[],h=r.waypoints.length,f=0;f<h;f++)u=r.waypoints[f],u&&u.address&&u.point&&(e=new bt(u.address,new b(u.point.latitude,u.point.longitude)),f===h-1?e.waypointType=2:f===0&&(e.waypointType=1),e.rawAddress=u.rawAddress,e.eid=u.eid,s.push(e));return o={waypoints:s,mode:nt,entryPoint:5,taskStartTime:i.searchPerfState&&i.searchPerfState.timestamp(),originalQuery:i.originalQuery},r.longDistanceDisplay&&(o.longDistanceDisplay=r.longDistanceDisplay),ur.bestModeEnabled&&!r.isTransportModeSpecified&&(o.mode=g.multimode),o}return null}function wt(n,i,r){var f=[],s=n.select("[data-boundingbox]").get_attr("data-boundingbox"),e=s&&t.Internals.parseJSON(s),o,u;return e&&e.boundingBox&&e.boundingBox.length>1&&(o=[],u=e.boundingBox[0],i&&i.hide(),o.push(new b(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),u=e.boundingBox[1],o.push(new b(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),r.setView(r.getMode().getMapViewForLocationsInView(o)),i&&i.show(2)),f}function kt(n,r,f){var h={content:n,searchTaskState:r},o,l,v;if(h.entryPoint=r.entryPoint===u.Permalink&&i._isTravelOverlayShownOnSerp()?u.TravelL2:r.entryPoint,o=n.select("div[data-title]"),o&&o.length===1){l=o[0].getAttribute("data-title");h.title=l;var s=[],c=[],a=o[0].getAttribute("data-boundingbox"),e=a&&t.Internals.parseJSON(a);e&&!isNaN(e.SouthLatitude)&&!isNaN(e.WestLongitude)&&!isNaN(e.NorthLatitude)&&!isNaN(e.EastLongitude)&&e.SouthLatitude<90&&e.SouthLatitude>-90&&e.NorthLatitude<90&&e.NorthLatitude>-90&&(s=[e.SouthLatitude,e.WestLongitude,e.NorthLatitude,e.EastLongitude],c.push(new b(s[0],s[1])),c.push(new b(s[2],s[3])),f.setView(f.getMode().getMapViewForLocationsInView(c)),h.boundingBox=s);v=o[0].getAttribute("data-vdpid");h.vdpId=v}return h}function dt(n){var t=n.select("[data-itinerary]").get_attr("data-itinerary");return t?{itineraryJson:t}:null}function it(n,t,i,r,u,o){var y,a=n.select("div[data-ig]"),s,v,l;a&&a.length===1&&(y=a[0].getAttribute("data-ig")||"");s={EP:t||"",Q:r||"",BB:u,SNRO:i||""};v=h.getMasterImpressionGuid();s&&v&&(s.MIG=v);l={impressionGuid:y,logData:{feature:ft.Search,action:p[p.STP],data:s}};e.invokeHandler(f.instrumentationDataHandlerKey,l);o&&(l={logData:{feature:"TM",action:"EntryPointInst",data:o},impressionGuid:c.dynamicProperties.mapsIG},e.invokeHandler(f.instrumentationDataHandlerKey,l))}function ht(n,t){if(t&&t.isEatAndDrinkOpalAction){t.isFilterSelected=!0;return}var i=n.select("div[data-isFilterSelected]").get_attr("data-isFilterSelected");if(i&&i.toLowerCase().indexOf("true")>-1){t.isFilterSelected=!0;return}t.isFilterSelected=!1}var w="polygonEntity",k="singleEntity",d="multiEntity",a="directions",rt="traffic",ut="itinerary",et="itineraryList",o={},v,nt;o[k]=function(n,t){y(s.localDetailsTask,n,t)};o[d]=function(n,t){y(s.localListingTask,n,t)};o[w]=function(n,t){y(s.polygonEntityDetailsTask,n,t)};o["multiPolygon"]=function(n,t){y(s.polygonListingTask,n,t)};o[a]=function(n,t){tt(s.directionsTask,t)};o[rt]=function(){};o[ut]=function(n,t){tt(s.itineraryDetailsTask,t)};o[et]=function(n,t){tt(s.itineraryListingsTask,t)};v={};v[k]=function(){return new vi};v[d]=function(){return new yi};v[w]=function(){return new vi};r.parseResponse=ct;r.getEntitiesFromResponse=lt;r.parseCategory=st;r.parseNoMoreResults=at;r.parseAnswerInfo=ot;r.invokeTask=y})(d||(d={}));var we=function(t){function i(i,r,u,f,e,o,s,h,c){var l=t.call(this,i,r,u,f,e,o,s,h,c)||this;return l.setRecommendedWidth(n.restaurantCardWidth),l.setCurrentWidth(n.restaurantCardWidth),l}return y(i,t),i.prototype._createUrl=function(){var n;return Logger.getOverlayType()||(n='disablempr:"true"',this._taskState.extraFuiAugmentations?this._taskState.extraFuiAugmentations+=" "+n:this._taskState.extraFuiAugmentations=n),t.prototype._createUrl.call(this)},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i.prototype._getSegmentParam=function(){return"restaurant"},i.prototype._getTextAdsCode=function(){return n.enableRestaurantTextAds?"r":null},i}(it),bi=function(t){function i(n,i,r,u,f,e,o,s){var h=t.call(this,n,i,r,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._segmentFuiAdded=!1,h._bindEventsForInfobox(),h}return y(i,t),i.prototype.shouldResize=function(){return n.enabledCategoriesForResize.indexOf("restaurant")>-1},i.prototype._createUrl=function(i,r,u){var h=this._taskState&&this._taskState.isCategoryQuery,e=this._taskState&&this._taskState.searchQueryCategory,o=this._taskState&&this._taskState.segmentType,c=n.waterfallEnabledCategories&&n.waterfallEnabledCategories.length>0&&(e&&n.waterfallEnabledCategories.indexOf(e.toLowerCase())>=0||o&&n.waterfallEnabledCategories.indexOf(o.toLowerCase())>=0),s,f;return c||(n.useNewListingSearchCount&&!u?u=n.listingSearchCount:h&&(!u||u===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("Restaurant")>-1&&this._isThreeColumnsOk(i)&&(u=21)),this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1),i&&i.isPaginated?(f=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),f&&(this._taskState.extraFuiAugmentations='cacheid:"'.concat(f,'" segment:"Restaurant"'))):this._segmentFuiAdded||(this._segmentFuiAdded=!0,this._taskState.extraFuiAugmentations?this._taskState.extraFuiAugmentations+=' segment:"Restaurant"':this._taskState.extraFuiAugmentations='segment:"Restaurant"'),s=t.prototype._createUrl.call(this,i,r,u),i&&i.isPaginated&&(f=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),f&&(this._taskState.extraFuiAugmentations=null)),s},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(n){var t=n[1],u=t.entity.id.replace("ypid:","").replace("sid:",""),i=_ge(u),f,r;i&&(f=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),r="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+i.innerHTML+"<\/div><\/a><\/div>",t.entity.infoboxHtml=r)})},i.prototype._getSegmentParam=function(){return"restaurant"},i.prototype._getTextAdsCode=function(){return n.enableRestListMlBtTextAds?"rm":n.enableRestListBtTextAds?"rb":null},i}(et),lu=function(r){function f(n,t,i,u,f,e,o,s){var h=r.call(this,n,t,i,u,f,e,o,s)||this;return h.poiManager=u,h}return y(f,r),f.prototype._refresh=function(){},f.prototype.activate=function(n,t,i,u){r.prototype.activate.call(this,n,t,null,u)},f.prototype.isSharable=function(){return this._stopSharing?!1:this._primitives&&this._primitives.length>0},f.prototype.processResponse=function(n,t){this._carouselPrimerPois=[];r.prototype.processResponse.call(this,n,t);this._processTopicCarousels();Microsoft.Maps.setTimeout(function(){sj_evt.fire("RMS.LoadImg")},0);this._createCarouselPrimitives();this._setTaskTitle();_w.clarity&&(_w.clarity("set","answers","TopicSearch"),sj_evt.fire("clarity.trigger","TopicSearch"))},f.prototype._createUrl=function(n,t,i){return r.prototype._createUrl.call(this,n,t,typeof i=="number"?i:100)},f.prototype._createCarouselPrimitives=function(){var r=this,f=this.panelRoot.select(".topicSearchContainer"),n=f.select(".b_topsrchcrsl"),u,i;if(n&&n.length){for(this._primitives=[],u=function(i){var f=n[i],e,u;f&&(e=f.getAttribute("data-listtype"),u=t(f).select("div[data-entity]"),u&&u.length&&u.for_each(function(n){var a=n&&n.getAttribute("data-entity"),u,f,s,h,l,i,o,c;if(a&&(u=t.Internals.parseJSON(a),f=u.geometry,u&&u.entity&&f&&f.x&&f.y)){s=null;try{s=new b(f.y,f.x)}catch(v){return}h=u.routablePoint;l=null;h&&(l=new b(h.latitude,h.longitude));i=u.entity;o=new ni(i.title,i.address,i.id,s,l||s,i.menuUrl,i.imageUrl,i.primaryCategoryPath,i.primaryCategoryName,i.vdpId,i.locationType,i.startDateTime,i.endDateTime,i.utcOffset,i.isAllDayEvent,i.segmentTypes);i.infoboxHtml&&(o.infoboxHtml=i.infoboxHtml);!e||o.getPrimaryCategoryPath()||o.getPrimaryCategoryName()||o.setSelectedCategoryForIcon(e);c=new hi(s,o);r._primitives.push(c);c.entity.infoboxHtml&&r._registerEntityEvents(c,n)}}))},i=0;i<n.length;i++)u(i);this.poiManager&&this.poiManager.setPrimitives(this._primitives)}},f.prototype._registerForSaveButton=function(){return},f.prototype._registerEntityEvents=function(n,i){var r=this,u=t(i),f=function(){return r._processMouseOver(n)},e=function(){return r._processMouseOut(n)};u.add_event("mouseenter",f).add_event("mouseleave",e);this._registerForSaveButton(n,i)},f.prototype._processMouseOver=function(n){var t=n;t&&t.entity&&t.viewState!==1&&t.viewState!==3&&(t.viewState=1,t.zIndex=2,this._hoverPoi=t,t.entity.changed&&t.entity.changed.invoke({sender:t.entity}),this._showInfobox(n.entity,!0))},f.prototype._processMouseOut=function(n){var i=n?n.viewState:null,t=this._hoverPoi;this._hideInfobox();n&&t&&i!==3&&(t.viewState=0,t.zIndex=0,t.entity.changed&&t.entity.changed.invoke({sender:t.entity}),this._hoverPoi=null)},f.prototype._showInfobox=function(n,t){var i=this,r,e;if(n&&n.infoboxHtml&&(r=n.getLocation()||n.getRoutableLocation(),r)){var u=c.features.localSearch,o=u&&u.enableRichInfoBox?t?!1:!0:!0,s=this.getInfoboxOffset(this.displayState),f={entity:n,htmlContent:n.infoboxHtml,location:r,showCloseButton:!1,showPointer:!1,visible:o,autoAlignment:!0,offset:s};!this._infobox||u&&u.enableRichInfoBox?(e=150,Microsoft.Maps.setTimeout(function(){i._infobox=null;i._infobox=new Microsoft.Maps.MapsInfobox(r,f,i._transientLensViewModel.getButtonGroupViewModel(),i.id);i._infobox.setMap(i.map)},e)):this._infobox.setOptions(f)}},f.prototype._getTextAdsCode=function(){return n.enableTopicSearchTextAds?"ts":null},f.prototype.getInfoboxOffset=function(n){return n&&n.prominence&&n.prominence===1&&Number(c.stlVersion)>8.22&&this.map.getMapType().id===ei.road?new Microsoft.Maps.Point(22,22):new Microsoft.Maps.Point(10,10)},f.prototype._hideInfobox=function(){var n=this,t;this._infobox&&(t=151,Microsoft.Maps.setTimeout(function(){var t=c.features.localSearch;n._infobox.preventAutoClose||n._infobox.setOptions({visible:!1,closeDelayTime:t.enableRichInfoBox?150:500})},t))},f.prototype._processTopicFilters=function(n){var f=n.select("a.ftrT"),r,e,l,o,a;if(f&&f.length>0)for(r=0;r<f.length;r++)if(e=f[r],e){var s="",c=e,v=c.search,y=i.getParamFromQueryString(v,"filters"),w=y.replace(/\+/g," "),h=t(e).select(".fs_label");h&&h.length>0&&(s=i._decodeHTML(h[0].innerHTML));l={type:"LocalSearchTask",requestState:{query:s,filterUrlParam:w,forceDisableMicroPoi:!1,entryPoint:u.TopicSearch,primerPois:this._carouselPrimerPois.length>r?this._carouselPrimerPois[r]:null}};o=t(c);o.set_attr("data-process",JSON.stringify(l));o.remove_attr("href");a={logData:{feature:ft.Search,action:p[p.LSR],data:{query:s,T:"L",entryPoint:u.TopicSearch,ClickType:"FilterClick"}}};o.set_attr("data-instrumentation",JSON.stringify(a))}},f.prototype._processTopicCarouselTitles=function(n){var r=n.select(".b_topsrchtop[data-process]"),e,u,f;if(r&&r.length>0&&this.id)for(e=function(n){var h="",f=r[n],l=t(f).select("a"),a=l.length>0&&l[0],o,s,e,c,v;a&&(h=i.getParamFromQueryString(a.search,"filters").replace(/\+/g," "));o=[];f&&(s=t(f.parentElement).select("div[data-ypid]"),s&&s.length?(s.for_each(function(n){var t=n&&n.getAttribute("data-ypid");t&&o.push({entity:{id:t}})}),u._carouselPrimerPois[n]=o):u._carouselPrimerPois[n]=null);e=u._getProcessOptions(f);e&&e.requestState&&(c=e.requestState,h&&(c.filterUrlParam=h),c.primerPois=o,v={type:"LocalSearchTask",requestState:e.requestState},f.setAttribute("data-process",JSON.stringify(v)))},u=this,f=0;f<r.length;f++)e(f)},f.prototype._processTopicCarouselSeeAll=function(n){for(var f,a,e,o,c=n.select(".b_topentcrsl"),s=0;s<c.length;s++){var l=t(c[s]),h=l.select(".b_topsrchtop"),r=l.select(".carousel_seemore"),u=r.select("a.b_moreLink");h.length>0&&r.length>0&&u.length>0&&(f=i._createElement("div"),f.set_attr("class",u.get_attr("class")),f.set_attr("h",u.get_attr("h")),f[0].innerHTML=u[0].innerHTML,u.removeFromParent(),r.append(f),r.set_attr("data-process",h.get_attr("data-process")),a=h.get_attr("data-instrumentation"),e=JSON.parse(a),((o=e.logData)===null||o===void 0?void 0:o.data)&&(e.logData.data.SeeAll=!0),r.set_attr("data-instrumentation",JSON.stringify(e)))}},f.prototype._processTopicCarouselEntities=function(n){var r=n.select(".b_topsrchcrsl"),u,s,i,f,e,o,h;if(r&&r.length&&this.id)for(u=0;u<r.length;u++)if(s=r[u],s&&(i=t(s).select("div[data-process]"),i&&i.length>0))for(f=0;f<i.length;f++)e=i[f],o=this._getProcessOptions(e),o&&o.requestState&&(h={state:o.requestState,type:"LocalDetailsTask",activateOptions:{parentId:this.id}},h.state.flippingCard=!0,e.setAttribute("data-task",JSON.stringify(h)),e.removeAttribute("data-process"))},f.prototype._processTopicCarousels=function(){var n=this.panelRoot.select(".topicSearchContainer");this._processTopicCarouselTitles(n);this._processTopicCarouselEntities(n);this._processTopicCarouselSeeAll(n);this._processTopicFilters(n)},f.prototype._setTaskTitle=function(){if(this._taskState){var n=this._taskState.taskTitle?this._taskState.taskTitle:this._taskState.query?this._taskState.query:"",t=this.getTitle();n&&t&&n!==t&&this.setTitle(n)}},f}(et),au=function(){function n(){}return n.prototype.createBar=function(n){var r=new uf([]),u,t,f,i,e,o;if(!n||!n.categories&&!n.levels)return null;if(n.levels&&n.levels.length>0){for(u=new gt("bm_level","bm_level","Level",0,5),t=0;t<n.levels.length;t++){var s=n.levels[t],h=s.getName(),c=new wt(t.toString(),h,null,t===n.defaultFloor);u.addOption(c)}r.addItem(u)}if(n.categories&&n.categories.length>0){for(f=new gt("bm_category","bm_category","Category",0,5),i=0;i<n.categories.length;i++)e=n.categories[i],o=new wt(i.toString(),e),f.addOption(o);r.addItem(f)}return r.getItemsNumber()===0?null:r},n}(),vt=function(){function n(){}return n.logFilterBarInteraction=function(n,t,i,r){var o={logData:{feature:"FSB",action:t,data:{EP:u.VenueMap,ID:n,IT:i,DN:r}}};e.invokeHandler(f.instrumentationDataHandlerKey,o)},n.logBusinessClick=function(n,t,i){var r={logData:{feature:ft.VenueMap,action:"C",data:{EP:t,ID:n,YP:i,IM:c.isMobile}}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.logMobileActivation=function(n){var t={logData:{feature:ft.VenueMap,action:"A",data:{EP:u.SerpAnswer,ID:n}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},n.logMobileViewToggle=function(n,t){var i={logData:{feature:ft.VenueMap,action:"C",data:{TG:"ViewToggle",ID:n,TL:t}}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},n}(),vu=function(n){function f(t,i,u,f){var e=this,s={},h,o;return e=n.call(this,s,u,i)||this,s.defineProperty("entities"),e._map=t,e.controlTemplateFactory=u,e.resources=r,e._businessYpidDictionary={},e._selecteDirectoryBusiness=null,e._venueMap=f.venueMap,e._venueMapTask=f,h=e._venueMap.defaultFloor,o=e._venueMap.floors.filter(function(n){return n.getName()===h}),e.activeFloor=o.length>0&&o[0],e.entities=new oi,e._lang=c.dynamicProperties.market.split("-")[0].toLowerCase(),e._setPrimitiveDictionaries(),e._createUIElements(),e}return y(f,n),f.prototype._setPrimitiveDictionaries=function(){var r={},u,s,t,f,h,i,e,n,o;for(this.categories=[],u=this._venueMap.floors,s=u.length,t=0;t<s;t++)for(f=u[t].getPrimitives(),h=f.length,i=0;i<h;i++)e=f[i],n=e.metadata,n&&n.ypid&&n.category&&(!this.activeCategory||n.category===this.activeCategory)&&(this._businessYpidDictionary[n.ypid]=e,r[n.category]=!0);for(o in r)r[o]&&this.categories.push(o);this.categories.sort()},f.prototype._createUIElements=function(){this.name=this._venueMap.name;this._updateEntityList();this._createFiltersBar()},f.prototype._updateEntityList=function(){var r=this,t,i,n;if(this.entities.clear(),this.activeFloor)this._venueMap.setActiveFloor(this.activeFloor.getName()),this._addBusinessesToList(this.activeFloor);else{for(t=this._venueMap.floors,i=t.length,n=0;n<i;n++)this._addBusinessesToList(t[n]);this._venueMap.setActiveFloor(this._venueMap.defaultFloor)}this.updateNoEntityMessage();this._map.getTemplateSelector().then(function(){r._venueMapTask.directoryUpdated.invoke()})},f.prototype._addBusinessesToList=function(n){for(var r,t,u=n.getPrimitives(),f=u.length,i=0;i<f;i++)r=u[i],t=r.metadata,t&&t.ypid&&t.category&&(!this.activeCategory||t.category===this.activeCategory)&&(t.name=r.getTitle(),t.taskInfo=t.ypid&&this._buildEntityDataTask(t),this.entities.insert(t))},f.prototype.toggleSelectedBusiness=function(n){var t="bm_selected";this._selecteDirectoryBusiness&&this._selecteDirectoryBusiness.remove_class(t);n&&(n.add_class(t),this._selecteDirectoryBusiness=n)},f.prototype.onBusinessClick=function(n){var i=t(n.currentTarget?n.currentTarget:n);this.toggleSelectedBusiness(i);vt.logBusinessClick(this._venueMapTask.venueMapState.venueMapId,u.TaskCard,this._getYpidFromBusiness(i))},f.prototype.onBusinessMouseOver=function(n){var f,r;if(this._map.getMercatorZoomLevel()>=15&&!c.isMobile){var e=t(n.currentTarget||n),u=this._getYpidFromBusiness(e),i=u&&this._businessYpidDictionary[u];i&&(i.setState(3),f=i.metadata.polygon,r=new Microsoft.Maps.Polyline(f.getLocations(),{strokeColor:"rgb(0, 0, 0)"}),this._venueMap.activeFloorLayer.add(r),this._hoveredEntityInfo={primitive:i,highlightPolyline:r})}},f.prototype._getYpidFromBusiness=function(n){var t=n&&n.get_attr("data-task"),i=t&&t.length>0&&JSON.parse(t),r=i&&i.state&&i.state.id;return r&&r.substring(5)},f.prototype._buildEntityDataTask=function(n){var i={},t={};return t.entryPoint="LocalListing",t.id="ypid:"+n.ypid,t.flippingCard=!0,t.taskTitle=n.name.replace(/\n/g," "),t.originalName=t.taskTitle,t.selectedCategoryId=n.category,i.state=t,i.type=s.localDetailsTask,i.activateOptions={},i.activateOptions.parentId=this._venueMapTask.id,JSON.stringify(i)},f.prototype._createFiltersBar=function(){var n=this;this._filterBarViewModel=new rf(this.controlTemplateFactory);var t=this._venueMap.floors.filter(function(t){return t.getName()===n.activeFloor.getName()}),i={categories:this.categories,levels:this._venueMap.floors,defaultFloor:this._venueMap.floors.indexOf(t[0])},r=new au;this._filtersBar=r.createBar(i);this._filterBarViewModel.filterItemDiscardedFromSelection.add(function(t){var i=n._venueMapTask.venueMapState.venueMapId;t.id==="bm_level"?(vt.logFilterBarInteraction(i,"R",t.displayName,n.activeFloor.getName()),n.entities.clear(),n.activeFloor=null):t.id==="bm_category"&&(vt.logFilterBarInteraction(i,"R",t.displayName,n.activeCategory),n.activeCategory=null,n._venueMap.setBusinessCategoryFilters([]));n._updateEntityList()});this._filterBarViewModel.filterOptionClicked.add(function(t){var r=n._venueMapTask.venueMapState.venueMapId,i=t.item,u=parseInt(t.value);i.id==="bm_level"?(n.entities.clear(),n.activeFloor=n._venueMap.floors[u],vt.logFilterBarInteraction(r,"SE",i.displayName,n.activeFloor.getName())):i.id==="bm_category"&&(n.activeCategory=n.categories[u],n._venueMap.setBusinessCategoryFilters([n.activeCategory]),vt.logFilterBarInteraction(r,"SE",i.displayName,n.activeCategory));n._updateEntityList()})},f.prototype.showFiltersBar=function(){var n=i._isFeatureEnabled("mobileMyPlaces")?t("#venueFilterContainer"):this._venueMapTask.panelRoot.select("div[class=bm_filtersBarModule]");typeof n!="undefined"&&this._filterBarViewModel.update(this._filtersBar,n)},f.prototype.updateNoEntityMessage=function(){var n=this;this._map.getTemplateSelector().then(function(){var t=n._venueMapTask.panelRoot.select(".bm_noEntityMessage");t&&(t.set_style({display:n.entities.length>0?"none":""}),t.set_text(n.activeFloor&&n.activeFloor.hasRichDetailsPois?n.resources.L_VenueMapTask_NoCategory_Message:n.resources.L_VenueMapTask_NoEntity_Message))})},f.prototype.onBusinessMouseOut=function(){if(this._hoveredEntityInfo){var n=this._hoveredEntityInfo.primitive;n.setState(2);this._venueMap.activeFloorLayer.remove(this._hoveredEntityInfo.highlightPolyline);this._hoveredEntityInfo=null}},f._iconDictionary={},f}(yt),be=function(n){function o(t,i){var u=n.call(this)||this;return u.map=t,u.type=s.venueMapDirectoryTask,u._controlTemplateFactory=i,u.resources=r,u.scrollLane=new nt,u.venueMapLoaded=new nt,u.directoryUpdated=new nt,u}return y(o,n),o.prototype.activate=function(t,i){var r=this,u;i||this.deactivate();n.prototype.activate.call(this,t);u=t.getContainer();this.setTitle(this.resources.L_VenueMapTaskTitle_Suffix+i.title);this.venueMapState=i;u.downloadDependency("VenueMap",function(){r._venueMapFactoryType=Microsoft.Maps.VenueMaps.VenueMapFactory;var n=new r._venueMapFactoryType(t);n.create({venueMapId:r.venueMapState.venueMapId,businessClickedHandler:function(n){r._handleBusinessClick(n)},success:function(n){r.initVenueMap(n)}})});this.setPercentLoaded(1)},o.prototype.initVenueMap=function(n){var r=this,t,u,f;this.venueMap=n;this.venueMap.setActiveFloor(this.venueMap.defaultFloor);this.setTitle(this.resources.L_VenueMapTaskTitle_Suffix+this.venueMap.name);this._viewModel=new vu(this.map,i._isFeatureEnabled("mobileMyPlaces")?tu:nu,this._controlTemplateFactory,this);this.panelRoot.clear();this.changed.add(function(n){if(n&&n.name&&n.name==="displayState"&&n.newValue!==n.oldValue){var t=n.newValue,i=n.oldValue;t&&t.activationState!==3?r.venueMap.show():r.venueMap.hide()}});this.displayState.activationState===3?this.venueMap.hide():this.venueMap.show();t=n.bestMapView;u=ot.constructView(this.map,t.center,Math.round(t.zoom));this.map.setView(u);f=new dt(i._isFeatureEnabled("mobileMyPlaces")?tu:nu,this._viewModel).applyDataTemplate(this._viewModel);this.addControl(f);this._viewModel.showFiltersBar();this._viewModel.updateNoEntityMessage();this.venueMapLoaded.invoke()},o.prototype.setDisplayState=function(t){t.activationState===1&&this._viewModel&&this._viewModel.toggleSelectedBusiness(null);n.prototype.setDisplayState.call(this,t)},o.prototype.deactivate=function(){var t,i;n.prototype.deactivate.call(this);t=this.venueMap&&this.venueMap.getActiveFloor();t&&(i=this.venueMap.floors.filter(function(n){return t===n.getName()}),this.map.getLayers().remove(i[0]));this._viewModel&&this._viewModel.entities.clear();this._viewModel&&this._viewModel.dispose();this.venueMap&&this.venueMap.dispose();n.prototype.deactivate.call(this)},o.prototype.close=function(){var n={action:"remove",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)},o.prototype.serialize=function(){return this.venueMapState},o.prototype.processCallback=function(){return},o.prototype.getCardIconInfo=function(){var n=o._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||o._cardIconCatIdMapping["default"];return{iconClass:"vmTask",iconElements:this.getCardIcons(n)}},o.prototype.getIconColorAndClassName=function(n){var t=o._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||o._cardIconCatIdMapping["default"];this._buildCardIcon(null,t,function(t){n(t,"venueMapTask")})},o.prototype.isSharable=function(){return!1},o.prototype.getListingFromPushpin=function(n){var o=null,s=n&&n.metadata&&n.metadata.ypid,u,r,f,e;if(s)for(u=this.panelRoot.select(i._isFeatureEnabled("mobileMyPlaces")?".bm_venueEntity":"#bm_venueEntity"),r=0;r<u.length;r++)if(f=u[r],e=f.getAttribute("data-task"),e&&e.indexOf(s)>=0){o=t(f);break}return o},o.prototype._handleBusinessClick=function(n){var t=n.primitive,i=this.getListingFromPushpin(t),r;i&&(r=t&&t.metadata&&t.metadata.ypid,this.scrollLane.invoke(i),this._viewModel&&this._viewModel.toggleSelectedBusiness(i),e.invokeHandler(f.taskDataHandlerKey,JSON.parse(i.get_attr("data-task"))),vt.logBusinessClick(this.venueMapState.venueMapId,u.POI,r))},o._cardIconCatIdMapping={Airport:"91621",Mall:"90771","default":"91600"},o}(h),yu=function(n){function t(t,i,u,f,e){var o=this,s={},h,c;for(o=n.call(this,s,i,gi)||this,o._controlTemplateFactory=i,s.defineProperty("printEntities"),s.defineProperty("listHours"),s.defineProperty("wikiText"),s.defineProperty("printFacts"),o._entities=[],o._openHours=[],o._printFacts=[],o.resources=r,o._dataFacts=f,h=0;h<u.length;h++)c=new nr(u[h]),o._entities.push(c);return o.createHoursTemplate(),o._setPrintFacts(),o.setListHours(o._openHours),o.setPrintFacts(o._printFacts),o._entities&&o._entities.length&&o._entities[0].getTitle()!==e&&(o._entities[0].originalName=e),o.setPrintEntities(o._entities),o}return y(t,n),t.prototype.hideIfMatchedData=function(n){return n===null&&this._entities[0].getTitle()===n?"none":""},t.prototype.createHoursTemplate=function(){var t,e,o,s,l,u,v,h,a;if(this._dataFacts&&this._dataFacts.openHours!==undefined)for(t=0;t<this._dataFacts.openHours.length;t++){var f=new hu,n=[],r=[];for(e=0;e<this._dataFacts.openHours[t].hoursRanges.length;e++)if(o=this._dataFacts.openHours[t].hoursRanges[e].start,s=this._dataFacts.openHours[t].hoursRanges[e].end,o!=s){f.setDay(this._dataFacts.openHours[t].day);o=o.split(":");s=s.split(":");var c=new su,y=i._formatShortTimeString(Number(o[0]),Number(o[1]),0),p=i._formatShortTimeString(Number(s[0]),Number(s[1]),0);c.setStart(y);c.setEnd(p);n.push(c);e>=0&&this._openHours.length>0&&(r=this._openHours[this._openHours.length-1].getHourRanges())}if(r&&r.length>0&&n&&n.length>0&&r.length===n.length){for(l=!1,u=0;u<r.length;u++)(r[u].getStart()!==n[u].getStart()||r[u].getEnd()!==n[u].getEnd())&&(l=!0);l?(f.setHourRanges(n),this._openHours.push(f)):(v=f.getDay(),h=this._openHours[this._openHours.length-1].getDay(),h.indexOf("-")>0&&(a=[],a=h.split("-"),h=a[0].trim()),this._openHours[this._openHours.length-1].setDay(h+" - "+v))}else n&&n.length>0&&(f.setHourRanges(n),this._openHours.push(f))}},t.prototype._setPrintFacts=function(){if(this._entities[0].getLocation()&&!this._entities[0].id.toUpperCase().match("YPID")&&(this._entities[0].getLocationType()==="State"||this._entities[0].getLocationType()==="StreetAddress"||this._entities[0].getLocationType()==="County")){var n=this._entities[0].getLocation(),t=n.latitude.toString()+", "+n.longitude.toString();this._pushFactsIntoList(r.L_PrintExtendedLatLong_Text,t)}this._dataFacts&&(this._dataFacts.website&&!this._entities[0].getWebsite()&&this._entities[0].setWebsite(this._dataFacts.website),this._dataFacts.phone&&!this._entities[0].getPhone()&&this._entities[0].setPhone(this._dataFacts.phone),rr.parseAndPushDataFactForPrint(this._dataFacts,this._printFacts))},t.prototype._pushFactsIntoList=function(n,t,i){var r=rr.setFactsInfo(this._printFacts,n,t,i);r&&this._printFacts.push(r)},t}(yt),pu=function(n){function i(i,r,u,f,e){var o=this,v={},c,s,p,h,y,a;for(o=n.call(this,v,r,gi)||this,o._controlTemplateFactory=r,v.defineProperty("printEntities"),v.defineProperty("printEntitiesList2"),o._entities1=[],o._entities2=[],c=e?e.select("a.listings-item"):null,s=0;s<u.length;s++)u[s].entity.iconText=(s+1).toString(),p=u[s].entity,h=new nr(p),o.setPrintIconTextAndColor(h,s,f),c&&s<c.length&&(y=t(c[s]).get_attr("data-facts"),y&&(a=[],o.setPrintFactsForEntity(l.parseDataFact(y),a),a.length>0&&(h.printFacts=a))),s%2==0?o._entities1.push(h):o._entities2.push(h);return o.setPrintEntities(o._entities1),o.setPrintEntitiesList2(o._entities2),o}return y(i,n),i.prototype.hideIfMatchedData=function(n){return n&&n.getAddress()===null||n.getTitle()===n.getAddress()?"none":""},i.prototype.setPrintIconTextAndColor=function(n,t,i){n.iconText=(t+1).toString();n.colorIndex=i},i.prototype.setPrintFactsForEntity=function(n,t){rr.parseAndPushDataFactForPrint(n,t)},i}(yt),ke=function(n){function i(t,i,r,u,f,e,o){return n.call(this,t,i,r,u,f,e,o)||this}return y(i,n),i.prototype.setResponseContent=function(t,i){var r=this;(n.prototype.setResponseContent.call(this,t,i),t&&this.panelRoot)&&(this._zipCodes=[],this._zipCodePolygonDownloadCompleted=!1,this.zipCodePolygonsDownloaded=new nt,this.zipCodePolygonsDownloaded.add(function(){r._zipCodePolygonDownloadCompleted=!0}),this._getZipCodePolygonsFromResponse(t,i))},i.prototype.registerListItemEvents=function(n,t){var i=this;this._listingPageProcessor=t;this._zipCodePolygonDownloadCompleted?this._handlerHoverEvents():this.zipCodePolygonsDownloaded.add(function(){i._handlerHoverEvents()})},i.prototype.parseEntitiesFromResponse=function(){return{entities:[],pushpins:[]}},i.prototype._shouldPaginate=function(n){return!n||n.length<=this._paginationItemsPerPage?!1:!0},i.prototype._paginationSetDisplayForItems=function(n,t,i,r){var u,f,e;if(n&&!(n.length<=this._paginationItemsPerPage)){for(u=0,f=n.length;u<f;u++)e=Math.floor(u/this._paginationItemsPerPage)+1===t,e?n[u].removeAttribute("style"):n[u].style.display="none";r&&r()}},i.prototype._handlerHoverEvents=function(){var t=this,n;this._registerListItemEventsForZipCodes();n=this._poiManager.getLayer();n?Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,this.map):this._poiManager.primitivesRendered.addOne(function(){n=t._poiManager.getLayer();Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,t.map)})},i.prototype._getZipCodePolygonsFromResponse=function(n){var t=this,i=n.select(this._selector);i.for_each(function(n){var i=t._findZipCodeInItem(n,!0);i&&i.length>0&&t._zipCodes.indexOf(i)<0&&t._zipCodes.push(i)});this._zipCodes.length>0&&this.map.getCityPolygonManager().then(function(){Microsoft.Maps.Internal.CityPolygonManager.populatePostCodeLayer(t.map,null,t._zipCodes,function(n){t._poiManager.setPrimitives(n);t._primitives=n;t.zipCodePolygonsDownloaded.invoke()},!0)})},i.prototype._registerListItemEventsForZipCodes=function(){var n=this,r=this.panelRoot.select("a[data-entity]"),i=Microsoft.Maps.Internal.CityPolygonManager;r.for_each(function(r){var o=n._findZipCodeInItem(r),u,f,h,c,e;if(o&&o.length>0){for(f=0,h=n._primitives.length;f<h;f++)if(c=n._primitives[f],e=c.metadata,e&&o.indexOf(e.title)>=0&&!e.polygon){u=n._primitives[f];break}if(u){var s=t(r),l=function(){i.handlePostCodePrimitiveHover({eventName:"mouseover",layer:n._poiManager.getLayer(),primitive:u});n._entityCardHoverStartTime=Date.now()},a=function(){i.handlePostCodePrimitiveHover({eventName:"mouseout",layer:n._poiManager.getLayer(),primitive:u});n._logEntityCardHoverIfNecessary(u.entity)};s.add_event("mouseenter",l).add_event("mouseleave",a);n._addEventsToEventList(s,"mouseenter",l);n._addEventsToEventList(s,"mouseleave",a)}}})},i.prototype._findZipCodeInItem=function(n,i){var r,e=n.getAttribute("data-entity"),u,f;return e&&e.length>0?(u=t.Internals.parseJSON(e),u&&u.entity&&(r=u.entity.title)):(f=n.getElementsByClassName("b_factrow"),f&&f.length>0&&(r=f[0].innerHTML)),i&&(r=r.trim().split("-")[0]),r},i}(yi),wu=function(t){function i(n,i,u,f,e,o,s){var h=this,c={};return h=t.call(this,c,n,ne)||this,c.defineProperty("showSeeMore"),h._listingTask=f,h._totalResultCount=e,h._infiniteScrollComponentId=o,h._isWaterfallGrid=s,h.setShowSeeMore(!1),h._initialItemsCount=u,h._paginationItemsPerPage=i,h._offset=u>i?u-i:0,h.resources=r,h._enableInfiniteScrolling=h._totalResultCount>h._paginationItemsPerPage?!0:!1,h._sendPaginationRequestWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];h._sendPaginationRequest.apply(h)},h._setupMatchingCategories(),h}return y(i,t),i.prototype.seeMoreClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._infiniteScrollRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this,!0)},i.prototype.updateDisplayState=function(n,t,i){var u=!1,f,e,r;return this.setShowSeeMore(!1),i&&i.length&&(f=this._listingTask.panelRoot.select("[data-answerinfo]").get_attr("data-answerinfo"),e=i.select("[data-answerinfo]").get_attr("data-answerinfo"),(f===e||this._hasMatchingCategory(this._listingTask.panelRoot,i))&&(this._isWaterfallGrid?(r=i.select("a.listings-item"),sj_evt.fire("onemapdomupd",this._infiniteScrollComponentId,r),sj_evt.fire("EntityWfrCellsAdded",r)):(r=i.select("#"+this._infiniteScrollComponentId+" ul > *"),this._addNewEntities(r),this._getCategory(i.select("div[data-category]")).toLowerCase()==="house"&&sj_evt.fire("housemapdomupd")),u=!0)),n>0&&(this._enableInfiniteScrolling=n<this._paginationItemsPerPage||t||this._totalResultCount&&n+this._offset>=this._totalResultCount?!1:!0),n===0&&this._infiniteScrollRequestSent&&this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage),this._infiniteScrollRequestSent=!1,u},i.prototype.isWaterfallEnabled=function(){return this._isWaterfallGrid},i.prototype.setActiveState=function(t){t&&!this._isActive?(this._isActive=!0,n&&n.useAlternateScrollEventForInfiniteScrolling?sj_evt.bind("nonCustomScrolled",this._sendPaginationRequestWrapper):sj_evt.bind("customScrolled",this._sendPaginationRequestWrapper)):t||(this._isActive=!1,n&&n.useAlternateScrollEventForInfiniteScrolling?sj_evt.unbind("nonCustomScrolled",this._sendPaginationRequestWrapper):sj_evt.unbind("customScrolled",this._sendPaginationRequestWrapper))},i.prototype.resetPaginationState=function(n,t){this._initialItemsCount=n;this._offset=0;this._totalResultCount=t;this._enableInfiniteScrolling=!0},i.prototype.updatePaginationRootId=function(n){this._infiniteScrollComponentId=n},i.prototype._sendPaginationRequest=function(){var n,i,t;this._enableInfiniteScrolling&&!this._infiniteScrollRequestSent&&this._isActive&&(n=this._listingTask.viewModel.getDomEntities(),n&&n.length&&n.length-4>0&&(i=n[n.length-4],t=i.getBoundingClientRect(),t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)&&(this._initialItemsCount<this._totalResultCount&&this._initialItemsCount<this._paginationItemsPerPage?(this._offset=this._initialItemsCount,this._initialItemsCount+=this._paginationItemsPerPage):this._offset+=this._paginationItemsPerPage,this._infiniteScrollRequestSent=!0,this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this,!0))))},i.prototype._addNewEntities=function(n){var t=this._listingTask.panelRoot.select(".b_vList");t&&n.for_each(function(n){t.append(n)})},i.prototype._getCategory=function(n){return n&&n.length?n.get_attr("data-category"):null},i.prototype.tryParseJSON=function(n){try{return JSON.parse(n)}catch(t){return null}},i.prototype._parseQueryAttribute=function(n){if(n){var t=n.select("[data-queryparse]").get_attr("data-queryparse");return this.tryParseJSON(t)}return null},i.prototype._hasMatchingCategory=function(t,i){var r=!1,u,f;if(n.enableCategoryMatchingForInfiniteScroll&&t&&i&&(u=this._parseQueryAttribute(t),f=this._parseQueryAttribute(i),u&&f)){var s=u.catId,e=u.segment,h=f.catId,o=f.segment;r=this._areCompatibleCategories(s?s:e,h?h:o);!r&&e&&o&&(r=e===o)}return r},i.prototype._areCompatibleCategories=function(n,t){var i=!1,r,u;return n&&t&&(n===t?i=!0:(r=this._matchingCategoriesDictionary[n],u=this._matchingCategoriesDictionary[t],i=r!==undefined&&u!==undefined&&r===u)),i},i.prototype._setupMatchingCategories=function(){var t,r,i;if(this._matchingCategoriesDictionary={},n.enableCategoryMatchingForInfiniteScroll&&n.matchingCategoriesForInfiniteScroll)for(t=0;t<n.matchingCategoriesForInfiniteScroll.length;t++)for(r=n.matchingCategoriesForInfiniteScroll[t].split("~"),i=0;i<r.length;i++)this._matchingCategoriesDictionary[r[i]]=t},i}(yt),bu=function(n){function t(t,i,u,f){var e=this,o={};return e=n.call(this,o,t,re)||this,o.defineProperty("showLeftChevron"),o.defineProperty("showRightChevron"),e._listingTask=u,e._totalResultCount=f,e.setShowLeftChevron(!1),e.setShowRightChevron(!0),e._offset=0,e._paginationItemsPerPage=i,e.resources=r,e}return y(t,n),t.prototype.leftChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage,this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this));this._offset===0&&this.setShowLeftChevron(!1)},t.prototype.rightChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._rightChevronRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this)},t.prototype.seeMoreClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._rightChevronRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this)},t.prototype.updateDisplayState=function(n,t){return n>0&&(n<this._paginationItemsPerPage||t||this._totalResultCount&&n+this._offset>=this._totalResultCount?this.setShowRightChevron(!1):this.setShowRightChevron(!0)),n===0&&this._rightChevronRequestSent&&this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage),this._offset>0?this.setShowLeftChevron(!0):this.setShowLeftChevron(!1),this._rightChevronRequestSent=!1,!0},t.prototype.isWaterfallEnabled=function(){return!1},t.prototype.setActiveState=function(){},t.prototype.resetPaginationState=function(){},t.prototype.updatePaginationRootId=function(){},t}(yt);a.HotelsDetailsTask=ou;a.HotelsListingTask=tr;a.HouseDetailsTask=he;a.HouseListingTask=pi;a.PolygonListingTask=pe;a.RestaurantDetailsTask=we;a.RestaurantsListingTask=bi;a.TopicSearchLandingTask=lu;a.AnnotationControl=iu;a.DirectoryFilterBarFactory=au;a.GeochainListViewModel=uu;a.LocalDetailsPageProcessor=ce;a.LocalDetailsPrintViewModel=yu;a.LocalDetailsTask=it;a.LocalListingPageProcessor=ir;a.LocalListingPrintViewModel=pu;a.LocalListingTask=et;a.LocalPrintEntity=nr;a.LocalPrintFacts=wi;a.LocalPrintHourRange=su;a.LocalPrintOpenHours=hu;a.LocalSearchTask=l;a.LogHelper=fu;a.PolygonEntityDetailsTask=ve;a.PolygonListingPageProcessor=ye;a.ResponseIntentProcessor=d;a.SearchInstrumentationAction=p;a.ServerPaginationViewModel=bu;a.InfiniteScrollPaginationViewModel=wu;a.VenueMapLogHelper=vt;a.VenueMapTask=be;a.VenueMapTaskViewModel=vu}catch(ku){if(o.logger)o.logger.logCriticalError(ku);else throw ku;}}).call(window)